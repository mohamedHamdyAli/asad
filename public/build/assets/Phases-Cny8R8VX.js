import{m as h,i as C,p as f,r as V,q as F,c as L,o as d,w as O,b as s,f as c,h as M,j as b,F as U,s as A,u as E,t as m,y as P,k as _,n as R}from"./app-CpUfYV9e.js";import{_ as q}from"./AuthenticatedLayout-B3A4OH2E.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j=[{value:"site_handover",label:"Site Handover"},{value:"fondation",label:"Foundation"},{value:"finishing",label:"Finishing"},{value:"handover",label:"Handover"}];function H(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function J(t){var n;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((n=t==null?void 0:t.data)==null?void 0:n.data)?t.data.data:[]}function G(t={}){var l;const n=H(t.description),o=n&&typeof n=="object"?n:{en:n??"",ar:n??""};return{id:t.id,unit_id:t.unit_id,status:t.status,status_label:((l=j.find(i=>i.value===t.status))==null?void 0:l.label)||t.status,desc_en:o.en??"",desc_ar:o.ar??"",created_at:t.created_at,updated_at:t.updated_at}}const x={statuses:()=>j,list:async t=>{const{data:n}=await h.get(`/api/unit-phase/${t}`);return J(n).map(G)},create:async t=>{const{data:n}=await h.post("/api/unit-phase/create",t);return n},update:async t=>{const{data:n}=await h.post("/api/unit-phase/update",t);return n},remove:async t=>{const{data:n}=await h.delete(`/api/unit-phase/delete/${t}`);return n}};function K(t,n=[]){return{unit_id:t,data:n.map(o=>{var l,i;return{status:o.status,description:{en:((l=o.description)==null?void 0:l.en)??"",ar:((i=o.description)==null?void 0:i.ar)??""}}})}}function Q(t,n=[]){return{unit_id:t,data:n.map(o=>{var i,v;const l={id:o.id};return o.status!==void 0&&(l.status=o.status),o.description&&(l.description={en:((i=o.description)==null?void 0:i.en)??"",ar:((v=o.description)==null?void 0:v.ar)??""}),l})}}const W={class:"p-6 space-y-8"},X={class:"flex items-center justify-between"},Y=["href"],Z={class:"bg-white p-6 rounded-2xl shadow space-y-4"},ee={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},te=["value"],se={class:"flex items-end"},ae=["disabled"],ne={key:0,class:"text-sm text-red-600"},ie={class:"bg-white p-6 rounded-2xl shadow"},re={key:0,class:"text-sm text-gray-500"},oe={key:1},le={key:0,class:"text-center text-gray-500 py-10"},de={key:1,class:"space-y-5"},ue={class:"flex items-center justify-center mb-4"},ce={class:"inline-flex items-center justify-center rounded-full bg-blue-50 text-blue-700 px-2.5 py-0.5 text-[13px] border border-blue-200"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},ve=["onUpdate:modelValue"],be=["value"],me=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],fe={class:"mt-4 flex justify-end"},xe=["disabled","onClick"],ge=["onClick"],he={__name:"Phases",props:{unitId:{type:[Number,String],required:!0}},setup(t){const n=t,o=C(()=>"/units-management"),l=x.statuses(),i=f({status:"",description:{en:"",ar:""}}),v=f(!1),k=f(""),D=C(()=>{var r,e;return!!i.value.status&&!!((r=i.value.description.en)!=null&&r.trim())&&!!((e=i.value.description.ar)!=null&&e.trim())});async function N(){var r,e;v.value=!0;try{const a=K(n.unitId,[i.value]);await x.create(a),await y(),i.value={status:"",description:{en:"",ar:""}}}catch(a){k.value=((e=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:e.message)||"Save failed"}finally{v.value=!1}}const w=f([]),p=V({}),g=V({}),S=f(!1);function T(r){Object.keys(p).forEach(e=>delete p[e]),r.forEach(e=>{p[e.id]={status:e.status,description:{en:e.desc_en||"",ar:e.desc_ar||""}}})}async function y(){S.value=!0;try{const r=await x.list(n.unitId);w.value=r,T(r)}finally{S.value=!1}}async function B(r){const e=p[r];if(e){g[r]=!0;try{const a=Q(n.unitId,[{id:r,status:e.status,description:e.description}]);await x.update(a),await y()}finally{g[r]=!1}}}async function I(r){confirm("Delete this phase?")&&(await x.remove(r),await y())}return F(y),(r,e)=>(d(),L(q,null,{default:O(()=>[s("div",W,[s("div",X,[e[3]||(e[3]=s("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Phases",-1)),s("a",{href:o.value,class:"px-3 py-1 border rounded text-gray-700 hover:bg-gray-100"}," ← Back to Units ",8,Y)]),s("div",Z,[e[8]||(e[8]=s("h3",{class:"text-lg font-semibold text-gray-800 flex items-center gap-2"}," Add / Upsert Phase ",-1)),s("div",ee,[s("div",null,[e[5]||(e[5]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Status *",-1)),b(s("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.status=a),class:"form-input"},[e[4]||(e[4]=s("option",{value:"",disabled:""},"Select status",-1)),(d(!0),c(U,null,A(E(l),a=>(d(),c("option",{key:a.value,value:a.value},m(a.label),9,te))),128))],512),[[P,i.value.status]])]),s("div",null,[e[6]||(e[6]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN) *",-1)),b(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.description.en=a),class:"form-input"},null,512),[[_,i.value.description.en]])]),s("div",null,[e[7]||(e[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR) *",-1)),b(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.description.ar=a),class:"form-input",dir:"rtl"},null,512),[[_,i.value.description.ar]])]),s("div",se,[s("button",{class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700",disabled:v.value||!D.value,onClick:N},m(v.value?"Saving…":"Save Phase"),9,ae)])]),k.value?(d(),c("div",ne,m(k.value),1)):M("",!0)]),s("div",ie,[s("div",{class:"flex items-center justify-between mb-4"},[e[9]||(e[9]=s("h3",{class:"text-lg font-semibold text-gray-800"},"Existing Phases",-1)),s("button",{onClick:y,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),S.value?(d(),c("div",re,"Loading…")):(d(),c("div",oe,[w.value.length?(d(),c("div",de,[(d(!0),c(U,null,A(w.value,(a,$)=>(d(),c("div",{key:a.id,class:R(["rounded-xl p-5 border shadow-sm hover:shadow-md transition bg-white",$===0?"border-yellow-400":"border-gray-200"])},[s("div",ue,[s("span",ce,m(a.status_label),1)]),s("div",pe,[s("div",null,[e[10]||(e[10]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Status *",-1)),b(s("select",{"onUpdate:modelValue":u=>p[a.id].status=u,class:"form-input"},[(d(!0),c(U,null,A(E(l),u=>(d(),c("option",{key:u.value,value:u.value},m(u.label),9,be))),128))],8,ve),[[P,p[a.id].status]])]),s("div",null,[e[11]||(e[11]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (EN)",-1)),b(s("textarea",{"onUpdate:modelValue":u=>p[a.id].description.en=u,class:"form-input min-h-[60px]"},null,8,me),[[_,p[a.id].description.en]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (AR)",-1)),b(s("textarea",{"onUpdate:modelValue":u=>p[a.id].description.ar=u,class:"form-input min-h-[60px]",dir:"rtl"},null,8,ye),[[_,p[a.id].description.ar]])])]),s("div",fe,[s("button",{class:"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-60",disabled:g[a.id],onClick:u=>B(a.id)},m(g[a.id]?"Saving…":"Save Changes"),9,xe),s("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-600 bg-red-50 hover:bg-red-100 ml-3",onClick:u=>I(a.id)}," Delete ",8,ge)])],2))),128))])):(d(),c("div",le," No phases found. "))]))])])]),_:1}))}},Se=z(he,[["__scopeId","data-v-497c5226"]]);export{Se as default};
