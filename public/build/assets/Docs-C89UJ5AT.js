import{k as F,l as _,i as S,m as N,p as J,c as M,o as c,w as z,b as a,a as T,j as b,s as h,f as p,h as V,t as g,F as G,q as H,e as K}from"./app-BJ7Yrijg.js";import{_ as Q}from"./AuthenticatedLayout-byBFqb7B.js";import{F as E,a as W}from"./FolderPicker-BVgAQz2J.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Y(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function Z(e){var s;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((s=e==null?void 0:e.data)==null?void 0:s.data)?e.data.data:[]}function ee(e){return e?`/storage/${e}`:""}function te(e){return(e||"").split("/").pop()||""}function le(e){return/\.pdf$/i.test(e||"")}function ae(e={}){const s=Y(e.title),r=s&&typeof s=="object"?s:{en:s??"",ar:s??""},n=ee(e.file);return{id:e.id,unit_id:e.unit_id,folder_id:e.folder_id,file:e.file??"",file_url:n,file_name:te(e.file),is_pdf:le(e.file),title_en:r.en??"",title_ar:r.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const C={list:async e=>{const{data:s}=await F.get(`/api/unit-docs/${e}`);return Z(s).map(ae)},create:async e=>{const{data:s}=await F.post("/api/unit-docs/create",e,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async e=>{const{data:s}=await F.post("/api/unit-docs/update",e,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async e=>{const{data:s}=await F.delete(`/api/unit-docs/delete/${e}`);return s}};function ne(e,s=[]){const r=new FormData;return r.append("unit_id",String(e)),s.forEach((n,u)=>{var v,d;r.append(`data[${u}][folder_id]`,String(n.folder_id??"")),r.append(`data[${u}][title][en]`,((v=n==null?void 0:n.title)==null?void 0:v.en)??""),r.append(`data[${u}][title][ar]`,((d=n==null?void 0:n.title)==null?void 0:d.ar)??""),n.file&&r.append(`data[${u}][file]`,n.file)}),r}function se(e,s=[]){const r=new FormData;return r.append("unit_id",String(e)),s.forEach((n,u)=>{var v,d;r.append(`data[${u}][id]`,String(n.id??"")),r.append(`data[${u}][folder_id]`,String(n.folder_id??"")),((v=n==null?void 0:n.title)==null?void 0:v.en)!==void 0&&r.append(`data[${u}][title][en]`,n.title.en??""),((d=n==null?void 0:n.title)==null?void 0:d.ar)!==void 0&&r.append(`data[${u}][title][ar]`,n.title.ar??""),n.file&&r.append(`data[${u}][file]`,n.file)}),r}const ie={class:"p-6 space-y-6"},oe={class:"flex items-center justify-between"},re=["href"],de={class:"bg-white p-4 rounded shadow"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce={class:"mt-4"},fe={key:0,class:"mt-3 text-sm text-gray-600"},pe={class:"mt-4 flex items-center gap-3"},me=["disabled"],_e={key:0,class:"text-red-600 text-sm"},ve={class:"bg-white p-4 rounded shadow"},ge={key:0,class:"text-sm text-gray-500"},xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ye={class:"aspect-[4/3] bg-white flex items-center justify-center"},be=["src"],he={key:1,class:"text-gray-500 text-sm flex flex-col items-center"},ke={class:"mt-1"},we={class:"p-3 space-y-2 text-sm"},Ue={class:"flex items-center justify-between text-xs text-gray-500"},Fe=["onUpdate:modelValue"],Ve=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],De={class:"text-[11px]"},$e=["onChange"],Ae={class:"flex gap-2 pt-1"},Ne=["href"],Se=["onClick","disabled"],Te=["onClick"],Ee={key:0,class:"col-span-full text-center text-gray-500 py-8"},je={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(e){const s=_([]),r=_(!1);async function n(){r.value=!0;try{s.value=await W.list("document")}finally{r.value=!1}}const u=e,v=S(()=>"/units-management"),d=_({folder_id:null,title:{en:"",ar:""}}),x=_([]),k=_(!1),w=_(""),j=S(()=>{var i,t;return!!d.value.folder_id&&!!((i=d.value.title.en)!=null&&i.trim())&&!!((t=d.value.title.ar)!=null&&t.trim())&&x.value.length>0});function R(i){const t=Array.from(i.target.files||[]);x.value=t}async function B(){var i,t;k.value=!0,w.value="";try{const l=x.value.map(m=>({folder_id:d.value.folder_id,title:{...d.value.title},file:m})),o=ne(u.unitId,l);await C.create(o),await y(),x.value=[],d.value.title={en:"",ar:""}}catch(l){console.error(l),w.value=((t=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Upload failed"}finally{k.value=!1}}const D=_([]),$=_(!1),f=N({}),A=N({}),U=N({});function I(i){i.forEach(t=>{f[t.id]={folder_id:t.folder_id??null,title:{en:t.title_en||"",ar:t.title_ar||""}}})}async function y(){$.value=!0;try{const i=await C.list(u.unitId);D.value=i,I(i)}finally{$.value=!1}}function L(i,t){var o;const l=((o=t.target.files)==null?void 0:o[0])||null;l&&(A[i]=l)}async function q(i){var l,o;const t=f[i];if(t){U[i]=!0;try{const m=[{id:i,folder_id:t.folder_id,title:t.title,file:A[i]}],P=se(u.unitId,m);await C.update(P),delete A[i],await y()}catch(m){console.error(m),alert(((o=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:o.message)||"Update failed")}finally{U[i]=!1}}}async function O(i){confirm("Delete this document?")&&(await C.remove(i),await y())}return J(async()=>{await n(),await y()}),(i,t)=>(c(),M(Q,null,{default:z(()=>[a("div",ie,[a("div",oe,[t[5]||(t[5]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Documents",-1)),a("a",{href:v.value,class:"px-3 py-1 border rounded"},"Back to Units",8,re)]),a("div",de,[t[8]||(t[8]=a("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),a("div",ue,[T(E,{type:"document",label:"Folder *",modelValue:d.value.folder_id,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value.folder_id=l),options:s.value,onCreated:t[1]||(t[1]=l=>s.value.unshift(l)),onRefresh:n},null,8,["modelValue","options"]),a("div",null,[t[6]||(t[6]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),b(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.value.title.en=l),class:"form-input",type:"text",required:""},null,512),[[h,d.value.title.en]])]),a("div",null,[t[7]||(t[7]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),b(a("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>d.value.title.ar=l),class:"form-input",type:"text",required:""},null,512),[[h,d.value.title.ar]])])]),a("div",ce,[a("input",{type:"file",multiple:"",accept:"image/*,application/pdf",onChange:R},null,32),x.value.length?(c(),p("div",fe,g(x.value.length)+" file(s) selected ",1)):V("",!0)]),a("div",pe,[a("button",{disabled:k.value||!j.value,onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},g(k.value?"Uploadingâ€¦":"Upload"),9,me),w.value?(c(),p("span",_e,g(w.value),1)):V("",!0)])]),a("div",ve,[a("div",{class:"flex items-center justify-between mb-3"},[t[9]||(t[9]=a("h3",{class:"text-lg font-bold"},"Documents",-1)),a("button",{onClick:y,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(c(),p("div",ge,"Loadingâ€¦")):(c(),p("div",xe,[(c(!0),p(G,null,H(D.value,l=>(c(),p("div",{key:l.id,class:"rounded border bg-gray-50 overflow-hidden"},[a("div",ye,[l.file_url&&!l.is_pdf?(c(),p("img",{key:0,src:l.file_url,class:"w-full h-full object-cover"},null,8,be)):(c(),p("div",he,[t[10]||(t[10]=a("span",{class:"text-4xl"},"ðŸ“„",-1)),a("span",ke,g(l.file_name),1)]))]),a("div",we,[a("div",Ue,[a("span",null,"#"+g(l.id),1),a("span",null,"Folder: "+g(l.folder_id),1)]),a("div",null,[t[11]||(t[11]=a("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),b(a("input",{"onUpdate:modelValue":o=>f[l.id].title.en=o,class:"form-input",type:"text"},null,8,Fe),[[h,f[l.id].title.en]])]),a("div",null,[t[12]||(t[12]=a("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),b(a("input",{"onUpdate:modelValue":o=>f[l.id].title.ar=o,class:"form-input",type:"text"},null,8,Ve),[[h,f[l.id].title.ar]])]),T(E,{type:"document",label:"Folder *",modelValue:f[l.id].folder_id,"onUpdate:modelValue":o=>f[l.id].folder_id=o,options:s.value,onCreated:t[4]||(t[4]=o=>s.value.unshift(o)),onRefresh:n},null,8,["modelValue","onUpdate:modelValue","options"]),t[15]||(t[15]=K()),a("div",null,[t[13]||(t[13]=a("label",{class:"block text-[11px] text-gray-500"},"Folder ID *",-1)),b(a("input",{"onUpdate:modelValue":o=>f[l.id].folder_id=o,class:"form-input",type:"number",min:"1"},null,8,Ce),[[h,f[l.id].folder_id,void 0,{number:!0}]])]),a("div",De,[t[14]||(t[14]=a("label",{class:"block text-gray-500"},"Replace file",-1)),a("input",{type:"file",accept:"image/*,application/pdf",onChange:o=>L(l.id,o)},null,40,$e)]),a("div",Ae,[l.file_url?(c(),p("a",{key:0,href:l.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Ne)):V("",!0),a("button",{class:"px-2 py-1 border rounded",onClick:o=>q(l.id),disabled:U[l.id]},g(U[l.id]?"Savingâ€¦":"Save"),9,Se),a("button",{class:"px-2 py-1 border rounded text-red-600",onClick:o=>O(l.id)},"Delete",8,Te)])])]))),128)),D.value.length?V("",!0):(c(),p("div",Ee," No documents found. "))]))])])]),_:1}))}},qe=X(je,[["__scopeId","data-v-19a631b9"]]);export{qe as default};
