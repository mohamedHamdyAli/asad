<<<<<<<< HEAD:public/build/assets/Drawings-rmeBmS52.js
import{m as I,r as N,p as y,i as K,q as ue,c as F,o as d,w as Q,b as r,a as $,u as v,h as m,f as p,F as W,s as X,t as h,j as O,k as z}from"./app-T0LQ4Oxa.js";import{_ as ce}from"./AuthenticatedLayout-BxpqaVNf.js";import{_ as fe}from"./UnitNav-BIzs7DlU.js";import{F as Y,a as pe}from"./FolderPicker-BreGTiDA.js";import{c as R,a as me,b as U,f as Z,F as ge,E as A,d as M}from"./index.esm-BOvK6yvX.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ve(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return a}}function be(a){var o;return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.message)?a.message:Array.isArray((o=a==null?void 0:a.data)==null?void 0:o.data)?a.data.data:[]}function xe(a){return a?`/storage/${a}`:""}function ye(a={}){const o=ve(a.title),u=o&&typeof o=="object"?o:{en:o??"",ar:o??""};return{id:a.id,unit_id:a.unit_id,folder_id:a.folder_id,date:a.date??"",image:a.image??"",image_url:xe(a.image),title_en:u.en??"",title_ar:u.ar??"",created_at:a.created_at,updated_at:a.updated_at}}const T={list:async a=>{const{data:o}=await I.get(`/api/unit-drawing/${a}`);return be(o).map(ye)},create:async a=>{const{data:o}=await I.post("/api/unit-drawing/create",a,{headers:{"Content-Type":"multipart/form-data"}});return o},update:async a=>{const{data:o}=await I.post("/api/unit-drawing/update",a,{headers:{"Content-Type":"multipart/form-data"}});return o},remove:async a=>{const{data:o}=await I.delete(`/api/unit-drawing/delete/${a}`);return o}};function he(a,o=[]){const u=new FormData;return u.append("unit_id",String(a)),o.forEach((n,c)=>{var w,b;u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),u.append(`data[${c}][date]`,n.date??""),u.append(`data[${c}][title][en]`,((w=n==null?void 0:n.title)==null?void 0:w.en)??""),u.append(`data[${c}][title][ar]`,((b=n==null?void 0:n.title)==null?void 0:b.ar)??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}function we(a,o=[]){const u=new FormData;return u.append("unit_id",String(a)),o.forEach((n,c)=>{var w,b;u.append(`data[${c}][id]`,String(n.id??"")),u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),n.date!==void 0&&u.append(`data[${c}][date]`,n.date??""),((w=n==null?void 0:n.title)==null?void 0:w.en)!==void 0&&u.append(`data[${c}][title][en]`,n.title.en??""),((b=n==null?void 0:n.title)==null?void 0:b.ar)!==void 0&&u.append(`data[${c}][title][ar]`,n.title.ar??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}const ke={class:"p-6 space-y-6"},$e={class:"flex items-center justify-between"},Fe=["href"],Ue={class:"bg-white p-4 rounded shadow"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},qe={class:"md:col-span-1"},Ae={class:"mt-4"},Ve=["onChange"],Se={key:1,class:"mt-3 flex flex-wrap gap-2"},je=["href"],Ce=["src"],Ie={class:"mt-4 flex items-center gap-3"},Ne=["disabled"],Re={key:0,class:"text-red-600 text-sm"},Te={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},Ee={key:0,class:"text-sm text-gray-500"},Le={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-5"},Pe={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},Be=["src"],Oe={key:1,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},ze=["href"],Me={key:2,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Je={class:"break-all px-2"},Ge=["href"],He={class:"p-3.5 space-y-3 text-sm"},Ke=["onUpdate:modelValue"],Qe={key:0,class:"error"},We={key:0,class:"error"},Xe=["onUpdate:modelValue"],Ye={key:0,class:"error"},Ze=["onUpdate:modelValue"],et={key:0,class:"error"},tt={class:"text-[11px]"},at=["onChange"],rt={key:0,class:"mt-1 text-[11px] text-gray-500"},st={class:"flex items-center gap-2 pt-2"},nt=["onClick","disabled"],it=["onClick"],lt={key:0,class:"col-span-full text-center text-gray-500 py-8"},dt={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(a){const o=R({folder_id:Z().required("Folder is required"),date:U().required("Date is required"),title:R({en:U().required("English title is required"),ar:U().required("Arabic title is required")}),files:me().nullable().test("required","Please select at least one file",t=>Array.isArray(t)&&t.length>0)}),u=R({folder_id:Z().required("Folder is required"),date:U().required("Date is required"),title:R({en:U().required("English title is required"),ar:U().required("Arabic title is required")})}),n=N({}),c=y([]),w=y(!1);async function b(){w.value=!0;try{c.value=await pe.list("drawing",D.unitId)}finally{w.value=!1}}const D=a,ee=K(()=>"/units-management"),x=y({folder_id:null,date:"",title:{en:"",ar:""},files:[]}),E=y([]),V=y([]),S=y(!1),j=y("");K(()=>{var t,e;return!!x.value.folder_id&&!!x.value.date&&!!((t=x.value.title.en)!=null&&t.trim())&&!!((e=x.value.title.ar)!=null&&e.trim())&&E.value.length>0});function te(t,e){const s=Array.from(t.target.files||[]);E.value=s,V.value=s.map(i=>URL.createObjectURL(i)),e("files",s)}function L(t){return t?`/storage/${t.image}`:""}function ae(t){return t!=null&&t.image?/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|heic|heif|avif)$/i.test(t.image):!1}function re(t){return t!=null&&t.image?/\.pdf$/i.test(t.image):!1}function se(t){return t!=null&&t.image?decodeURIComponent(t.image.split("/").pop()):"Unknown file"}async function ne(t){var e,s;S.value=!0,j.value="",x.value.files=[];try{const i=t.files.map(g=>({folder_id:t.folder_id,date:t.date,title:{...t.title},image:g})),l=he(D.unitId,i);await T.create(l),await q(),E.value=[],V.value=[],x.value.title={en:"",ar:""}}catch(i){console.error(i),j.value=((s=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:s.message)||(i==null?void 0:i.message)||"Upload failed"}finally{S.value=!1}}const P=y([]),B=y(!1),_=N({}),k=N({}),C=N({});function ie(t){t.forEach(e=>{_[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function q(){B.value=!0;try{const t=await T.list(D.unitId);P.value=t,ie(t)}finally{B.value=!1}}function J(t){const e=t==null?void 0:t.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}function le(t,e){var i;const s=((i=e.target.files)==null?void 0:i[0])||null;s&&(k[t]=s)}async function de(t){var s,i;const e=_[t];if(e){n[t]={};try{await u.validate(e,{abortEarly:!1})}catch(l){l.inner.forEach(g=>{n[t][g.path]=g.message});return}C[t]=!0;try{const l=[{id:t,folder_id:e.folder_id,date:e.date,title:e.title,image:k[t]}],g=we(D.unitId,l);await T.update(g),delete k[t],await q()}catch(l){console.error(l),alert(((i=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:i.message)||"Update failed")}finally{C[t]=!1}}}async function oe(t){confirm("Delete this drawing?")&&(await T.remove(t),await q())}return ue(async()=>{await b(),await q()}),(t,e)=>(d(),F(ce,null,{default:Q(()=>[r("div",ke,[r("div",$e,[e[4]||(e[4]=r("h2",{class:"text-2xl font-bold text-dash-title"},"Project Drawings",-1)),r("a",{href:ee.value,class:"px-3 py-1 border rounded text-black"},"Back to Projects",8,Fe)]),$(fe,{"unit-id":Number(a.unitId),cols:2},null,8,["unit-id"]),$(v(ge),{"validation-schema":v(o),"validate-on-mount":!1,"initial-values":x.value,onSubmit:ne},{default:Q(({setFieldValue:s,submitCount:i})=>[r("div",Ue,[e[8]||(e[8]=r("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),r("div",De,[r("div",qe,[$(Y,{type:"drawing",label:"Folder *",fileType:"drawing","model-value":x.value.folder_id,options:c.value,unitId:D.unitId,"onUpdate:modelValue":l=>{x.value.folder_id=l,s("folder_id",l)},onCreated:e[0]||(e[0]=l=>c.value.unshift(l)),onRefresh:b},null,8,["model-value","options","unitId","onUpdate:modelValue"]),i>0?(d(),F(v(A),{key:0,name:"folder_id",class:"error"})):m("",!0)]),r("div",null,[e[5]||(e[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),$(v(M),{name:"date",type:"date",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"date",class:"error"})):m("",!0)]),r("div",null,[e[6]||(e[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),$(v(M),{name:"title.en",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"title.en",class:"error"})):m("",!0)]),r("div",null,[e[7]||(e[7]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),$(v(M),{name:"title.ar",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"title.ar",class:"error"})):m("",!0)])]),r("div",Ae,[r("input",{type:"file",multiple:"",onChange:l=>te(l,s)},null,40,Ve),i>0?(d(),F(v(A),{key:0,name:"files",class:"error"})):m("",!0),V.value.length?(d(),p("div",Se,[(d(!0),p(W,null,X(V.value,(l,g)=>(d(),p("a",{key:g,href:l,target:"_blank",rel:"noopener"},[r("img",{src:l,class:"w-24 h-16 object-cover rounded border"},null,8,Ce)],8,je))),128))])):m("",!0)]),r("div",Ie,[r("button",{type:"submit",disabled:S.value,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},h(S.value?"Uploadingâ€¦":"Upload"),9,Ne),j.value?(d(),p("span",Re,h(j.value),1)):m("",!0)])])]),_:1},8,["validation-schema","initial-values"]),r("div",Te,[r("div",{class:"flex items-center justify-between mb-4"},[e[9]||(e[9]=r("h3",{class:"text-lg font-semibold text-gray-800"},"Drawings",-1)),r("button",{onClick:q,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),B.value?(d(),p("div",Ee,"Loadingâ€¦")):(d(),p("div",Le,[(d(!0),p(W,null,X(P.value,s=>{var i,l,g,G,H;return d(),p("div",{key:s.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[r("div",Pe,[ae(s)?(d(),p("img",{key:0,src:L(s),class:"absolute inset-0 w-full h-full object-cover"},null,8,Be)):re(s)?(d(),p("div",Oe,[e[10]||(e[10]=r("div",{class:"text-4xl mb-2"},"ðŸ“•",-1)),e[11]||(e[11]=r("span",{class:"px-2"},"PDF Document",-1)),r("a",{href:L(s),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,ze)])):(d(),p("div",Me,[e[12]||(e[12]=r("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),r("span",Je,h(se(s)),1),r("a",{href:L(s),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ge)])),e[13]||(e[13]=r("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1))]),r("div",He,[r("div",null,[e[14]||(e[14]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date *",-1)),O(r("input",{"onUpdate:modelValue":f=>_[s.id].date=f,class:"form-input",type:"date"},null,8,Ke),[[z,_[s.id].date]]),(i=n==null?void 0:n[s.id])!=null&&i.date?(d(),p("p",Qe,h(n[s.id].date),1)):m("",!0)]),$(Y,{type:"drawing",label:"Folder *",modelValue:_[s.id].folder_id,"onUpdate:modelValue":f=>_[s.id].folder_id=f,options:c.value,onCreated:e[1]||(e[1]=f=>c.value.unshift(f)),onRefresh:b},null,8,["modelValue","onUpdate:modelValue","options"]),(l=n==null?void 0:n[s.id])!=null&&l.folder_id?(d(),p("p",We,h(n[s.id].folder_id),1)):m("",!0),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),O(r("textarea",{"onUpdate:modelValue":f=>_[s.id].title.en=f,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[2]||(e[2]=f=>J(f))},null,40,Xe),[[z,_[s.id].title.en]]),(g=n==null?void 0:n[s.id])!=null&&g["title.en"]?(d(),p("p",Ye,h(n[s.id]["title.en"]),1)):m("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),O(r("textarea",{"onUpdate:modelValue":f=>_[s.id].title.ar=f,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[3]||(e[3]=f=>J(f))},null,40,Ze),[[z,_[s.id].title.ar]]),(G=n==null?void 0:n[s.id])!=null&&G["title.ar"]?(d(),p("p",et,h(n[s.id]["title.ar"]),1)):m("",!0)]),r("div",tt,[e[17]||(e[17]=r("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),r("input",{type:"file",onChange:f=>le(s.id,f)},null,40,at),k!=null&&k[s.id]?(d(),p("p",rt," Selected: "+h((H=k[s.id])==null?void 0:H.name),1)):m("",!0)]),r("div",st,[r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:f=>de(s.id),disabled:C[s.id]},h(C[s.id]?"Savingâ€¦":"Save"),9,nt),r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:f=>oe(s.id)}," Delete ",8,it)])])])}),128)),P.value.length?m("",!0):(d(),p("div",lt," No drawings found. "))]))])])]),_:1}))}},gt=_e(dt,[["__scopeId","data-v-63cae0e9"]]);export{gt as default};
========
import{m as I,r as N,p as y,i as K,q as ue,c as F,o as d,w as Q,b as r,a as $,u as v,h as m,f as p,F as W,s as X,t as h,j as O,k as z}from"./app-CzdCp43o.js";import{_ as ce}from"./AuthenticatedLayout-J4lJL3KR.js";import{_ as fe}from"./UnitNav-Df80iObB.js";import{F as Y,a as pe}from"./FolderPicker-CUhnL_R4.js";import{c as R,a as me,b as U,f as Z,F as ge,E as A,d as M}from"./index.esm-CKEvlbkd.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ve(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return a}}function be(a){var o;return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.message)?a.message:Array.isArray((o=a==null?void 0:a.data)==null?void 0:o.data)?a.data.data:[]}function xe(a){return a?`/storage/${a}`:""}function ye(a={}){const o=ve(a.title),u=o&&typeof o=="object"?o:{en:o??"",ar:o??""};return{id:a.id,unit_id:a.unit_id,folder_id:a.folder_id,date:a.date??"",image:a.image??"",image_url:xe(a.image),title_en:u.en??"",title_ar:u.ar??"",created_at:a.created_at,updated_at:a.updated_at}}const T={list:async a=>{const{data:o}=await I.get(`/api/unit-drawing/${a}`);return be(o).map(ye)},create:async a=>{const{data:o}=await I.post("/api/unit-drawing/create",a,{headers:{"Content-Type":"multipart/form-data"}});return o},update:async a=>{const{data:o}=await I.post("/api/unit-drawing/update",a,{headers:{"Content-Type":"multipart/form-data"}});return o},remove:async a=>{const{data:o}=await I.delete(`/api/unit-drawing/delete/${a}`);return o}};function he(a,o=[]){const u=new FormData;return u.append("unit_id",String(a)),o.forEach((n,c)=>{var w,b;u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),u.append(`data[${c}][date]`,n.date??""),u.append(`data[${c}][title][en]`,((w=n==null?void 0:n.title)==null?void 0:w.en)??""),u.append(`data[${c}][title][ar]`,((b=n==null?void 0:n.title)==null?void 0:b.ar)??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}function we(a,o=[]){const u=new FormData;return u.append("unit_id",String(a)),o.forEach((n,c)=>{var w,b;u.append(`data[${c}][id]`,String(n.id??"")),u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),n.date!==void 0&&u.append(`data[${c}][date]`,n.date??""),((w=n==null?void 0:n.title)==null?void 0:w.en)!==void 0&&u.append(`data[${c}][title][en]`,n.title.en??""),((b=n==null?void 0:n.title)==null?void 0:b.ar)!==void 0&&u.append(`data[${c}][title][ar]`,n.title.ar??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}const ke={class:"p-6 space-y-6"},$e={class:"flex items-center justify-between"},Fe=["href"],Ue={class:"bg-white p-4 rounded shadow"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},qe={class:"md:col-span-1"},Ae={class:"mt-4"},Ve=["onChange"],Se={key:1,class:"mt-3 flex flex-wrap gap-2"},je=["href"],Ce=["src"],Ie={class:"mt-4 flex items-center gap-3"},Ne=["disabled"],Re={key:0,class:"text-red-600 text-sm"},Te={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},Ee={key:0,class:"text-sm text-gray-500"},Le={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-5"},Pe={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},Be=["src"],Oe={key:1,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},ze=["href"],Me={key:2,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Je={class:"break-all px-2"},Ge=["href"],He={class:"p-3.5 space-y-3 text-sm"},Ke=["onUpdate:modelValue"],Qe={key:0,class:"error"},We={key:0,class:"error"},Xe=["onUpdate:modelValue"],Ye={key:0,class:"error"},Ze=["onUpdate:modelValue"],et={key:0,class:"error"},tt={class:"text-[11px]"},at=["onChange"],rt={key:0,class:"mt-1 text-[11px] text-gray-500"},st={class:"flex items-center gap-2 pt-2"},nt=["onClick","disabled"],it=["onClick"],lt={key:0,class:"col-span-full text-center text-gray-500 py-8"},dt={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(a){const o=R({folder_id:Z().required("Folder is required"),date:U().required("Date is required"),title:R({en:U().required("English title is required"),ar:U().required("Arabic title is required")}),files:me().nullable().test("required","Please select at least one file",t=>Array.isArray(t)&&t.length>0)}),u=R({folder_id:Z().required("Folder is required"),date:U().required("Date is required"),title:R({en:U().required("English title is required"),ar:U().required("Arabic title is required")})}),n=N({}),c=y([]),w=y(!1);async function b(){w.value=!0;try{c.value=await pe.list("drawing",D.unitId)}finally{w.value=!1}}const D=a,ee=K(()=>"/units-management"),x=y({folder_id:null,date:"",title:{en:"",ar:""},files:[]}),E=y([]),V=y([]),S=y(!1),j=y("");K(()=>{var t,e;return!!x.value.folder_id&&!!x.value.date&&!!((t=x.value.title.en)!=null&&t.trim())&&!!((e=x.value.title.ar)!=null&&e.trim())&&E.value.length>0});function te(t,e){const s=Array.from(t.target.files||[]);E.value=s,V.value=s.map(i=>URL.createObjectURL(i)),e("files",s)}function L(t){return t?`/storage/${t.image}`:""}function ae(t){return t!=null&&t.image?/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|heic|heif|avif)$/i.test(t.image):!1}function re(t){return t!=null&&t.image?/\.pdf$/i.test(t.image):!1}function se(t){return t!=null&&t.image?decodeURIComponent(t.image.split("/").pop()):"Unknown file"}async function ne(t){var e,s;S.value=!0,j.value="",x.value.files=[];try{const i=t.files.map(g=>({folder_id:t.folder_id,date:t.date,title:{...t.title},image:g})),l=he(D.unitId,i);await T.create(l),await q(),E.value=[],V.value=[],x.value.title={en:"",ar:""}}catch(i){console.error(i),j.value=((s=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:s.message)||(i==null?void 0:i.message)||"Upload failed"}finally{S.value=!1}}const P=y([]),B=y(!1),_=N({}),k=N({}),C=N({});function ie(t){t.forEach(e=>{_[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function q(){B.value=!0;try{const t=await T.list(D.unitId);P.value=t,ie(t)}finally{B.value=!1}}function J(t){const e=t==null?void 0:t.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}function le(t,e){var i;const s=((i=e.target.files)==null?void 0:i[0])||null;s&&(k[t]=s)}async function de(t){var s,i;const e=_[t];if(e){n[t]={};try{await u.validate(e,{abortEarly:!1})}catch(l){l.inner.forEach(g=>{n[t][g.path]=g.message});return}C[t]=!0;try{const l=[{id:t,folder_id:e.folder_id,date:e.date,title:e.title,image:k[t]}],g=we(D.unitId,l);await T.update(g),delete k[t],await q()}catch(l){console.error(l),alert(((i=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:i.message)||"Update failed")}finally{C[t]=!1}}}async function oe(t){confirm("Delete this drawing?")&&(await T.remove(t),await q())}return ue(async()=>{await b(),await q()}),(t,e)=>(d(),F(ce,null,{default:Q(()=>[r("div",ke,[r("div",$e,[e[4]||(e[4]=r("h2",{class:"text-2xl font-bold text-dash-title"},"Project Drawings",-1)),r("a",{href:ee.value,class:"px-3 py-1 border rounded text-black"},"Back to Projects",8,Fe)]),$(fe,{"unit-id":Number(a.unitId),cols:2},null,8,["unit-id"]),$(v(ge),{"validation-schema":v(o),"validate-on-mount":!1,"initial-values":x.value,onSubmit:ne},{default:Q(({setFieldValue:s,submitCount:i})=>[r("div",Ue,[e[8]||(e[8]=r("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),r("div",De,[r("div",qe,[$(Y,{type:"drawing",label:"Folder *",fileType:"drawing","model-value":x.value.folder_id,options:c.value,unitId:D.unitId,"onUpdate:modelValue":l=>{x.value.folder_id=l,s("folder_id",l)},onCreated:e[0]||(e[0]=l=>c.value.unshift(l)),onRefresh:b},null,8,["model-value","options","unitId","onUpdate:modelValue"]),i>0?(d(),F(v(A),{key:0,name:"folder_id",class:"error"})):m("",!0)]),r("div",null,[e[5]||(e[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),$(v(M),{name:"date",type:"date",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"date",class:"error"})):m("",!0)]),r("div",null,[e[6]||(e[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),$(v(M),{name:"title.en",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"title.en",class:"error"})):m("",!0)]),r("div",null,[e[7]||(e[7]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),$(v(M),{name:"title.ar",class:"form-input"}),i>0?(d(),F(v(A),{key:0,name:"title.ar",class:"error"})):m("",!0)])]),r("div",Ae,[r("input",{type:"file",multiple:"",onChange:l=>te(l,s)},null,40,Ve),i>0?(d(),F(v(A),{key:0,name:"files",class:"error"})):m("",!0),V.value.length?(d(),p("div",Se,[(d(!0),p(W,null,X(V.value,(l,g)=>(d(),p("a",{key:g,href:l,target:"_blank",rel:"noopener"},[r("img",{src:l,class:"w-24 h-16 object-cover rounded border"},null,8,Ce)],8,je))),128))])):m("",!0)]),r("div",Ie,[r("button",{type:"submit",disabled:S.value,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},h(S.value?"Uploadingâ€¦":"Upload"),9,Ne),j.value?(d(),p("span",Re,h(j.value),1)):m("",!0)])])]),_:1},8,["validation-schema","initial-values"]),r("div",Te,[r("div",{class:"flex items-center justify-between mb-4"},[e[9]||(e[9]=r("h3",{class:"text-lg font-semibold text-gray-800"},"Drawings",-1)),r("button",{onClick:q,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),B.value?(d(),p("div",Ee,"Loadingâ€¦")):(d(),p("div",Le,[(d(!0),p(W,null,X(P.value,s=>{var i,l,g,G,H;return d(),p("div",{key:s.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[r("div",Pe,[ae(s)?(d(),p("img",{key:0,src:L(s),class:"absolute inset-0 w-full h-full object-cover"},null,8,Be)):re(s)?(d(),p("div",Oe,[e[10]||(e[10]=r("div",{class:"text-4xl mb-2"},"ðŸ“•",-1)),e[11]||(e[11]=r("span",{class:"px-2"},"PDF Document",-1)),r("a",{href:L(s),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,ze)])):(d(),p("div",Me,[e[12]||(e[12]=r("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),r("span",Je,h(se(s)),1),r("a",{href:L(s),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ge)])),e[13]||(e[13]=r("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1))]),r("div",He,[r("div",null,[e[14]||(e[14]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date *",-1)),O(r("input",{"onUpdate:modelValue":f=>_[s.id].date=f,class:"form-input",type:"date"},null,8,Ke),[[z,_[s.id].date]]),(i=n==null?void 0:n[s.id])!=null&&i.date?(d(),p("p",Qe,h(n[s.id].date),1)):m("",!0)]),$(Y,{type:"drawing",label:"Folder *",modelValue:_[s.id].folder_id,"onUpdate:modelValue":f=>_[s.id].folder_id=f,options:c.value,onCreated:e[1]||(e[1]=f=>c.value.unshift(f)),onRefresh:b},null,8,["modelValue","onUpdate:modelValue","options"]),(l=n==null?void 0:n[s.id])!=null&&l.folder_id?(d(),p("p",We,h(n[s.id].folder_id),1)):m("",!0),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),O(r("textarea",{"onUpdate:modelValue":f=>_[s.id].title.en=f,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[2]||(e[2]=f=>J(f))},null,40,Xe),[[z,_[s.id].title.en]]),(g=n==null?void 0:n[s.id])!=null&&g["title.en"]?(d(),p("p",Ye,h(n[s.id]["title.en"]),1)):m("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),O(r("textarea",{"onUpdate:modelValue":f=>_[s.id].title.ar=f,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[3]||(e[3]=f=>J(f))},null,40,Ze),[[z,_[s.id].title.ar]]),(G=n==null?void 0:n[s.id])!=null&&G["title.ar"]?(d(),p("p",et,h(n[s.id]["title.ar"]),1)):m("",!0)]),r("div",tt,[e[17]||(e[17]=r("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),r("input",{type:"file",onChange:f=>le(s.id,f)},null,40,at),k!=null&&k[s.id]?(d(),p("p",rt," Selected: "+h((H=k[s.id])==null?void 0:H.name),1)):m("",!0)]),r("div",st,[r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:f=>de(s.id),disabled:C[s.id]},h(C[s.id]?"Savingâ€¦":"Save"),9,nt),r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:f=>oe(s.id)}," Delete ",8,it)])])])}),128)),P.value.length?m("",!0):(d(),p("div",lt," No drawings found. "))]))])])]),_:1}))}},gt=_e(dt,[["__scopeId","data-v-0815a918"]]);export{gt as default};
>>>>>>>> origin/main:public/build/assets/Drawings-DAknzUmq.js
