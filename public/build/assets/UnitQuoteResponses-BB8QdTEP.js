import{m,p as _,i as k,B as te,q as se,c as ne,o as d,w as ie,b as t,f as u,h as C,j as P,k as R,t as o,F as $,s as B,y as ae,n as E,e as v}from"./app-D-mhUt9W.js";import{_ as re}from"./AuthenticatedLayout-sps1aX5l.js";import{U as oe}from"./unitQuotes-BljxzsXR.js";import{V as le}from"./vendors-CzjCfczm.js";import{U as de}from"./users-DbIXe9tB.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";function I(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function pe(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}function O(e={}){const a=I(e.title),l=I(e.time_line);return{id:e.id,unit_quote_id:e.unit_quote_id,vendor_id:e.vendor_id,user_id:e.user_id,title_en:(a==null?void 0:a.en)??"",title_ar:(a==null?void 0:a.ar)??"",price:e.price??"",time_line_en:(l==null?void 0:l.en)??"",time_line_ar:(l==null?void 0:l.ar)??"",created_at:e.created_at,updated_at:e.updated_at}}const T={list:async()=>{const{data:e}=await m.get("/api/unit-quote-responses");return pe(e).map(O)},show:async e=>{const{data:a}=await m.get(`/api/unit-quote-responses/show/${e}`),l=(a==null?void 0:a.data)??a;return O(l)},create:async e=>{const{data:a}=await m.post("/api/unit-quote-responses/create",e,{headers:{"Content-Type":"multipart/form-data"}});return a},update:async(e,a)=>{const{data:l}=await m.post(`/api/unit-quote-responses/update/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}});return l},remove:async e=>{const{data:a}=await m.delete(`/api/unit-quote-responses/delete/${e}`);return a}};function ce(e={}){var l,g;const a=new FormData;return a.append("data[unit_quote_id]",e.unit_quote_id??""),a.append("data[vendor_id]",e.vendor_id??""),a.append("data[user_id]",e.user_id??""),a.append("data[title][en]",((l=e.title)==null?void 0:l.en)??""),a.append("data[title][ar]",((g=e.title)==null?void 0:g.ar)??""),e.price!==void 0&&a.append("data[price]",e.price),e.time_line&&(a.append("data[time_line][en]",e.time_line.en??""),a.append("data[time_line][ar]",e.time_line.ar??"")),a}function _e(e={}){const a=new FormData;return e.unit_quote_id!==void 0&&a.append("data[unit_quote_id]",e.unit_quote_id),e.vendor_id!==void 0&&a.append("data[vendor_id]",e.vendor_id),e.user_id!==void 0&&a.append("data[user_id]",e.user_id),e.title&&(a.append("data[title][en]",e.title.en??""),a.append("data[title][ar]",e.title.ar??"")),e.price!==void 0&&a.append("data[price]",e.price),e.time_line&&(a.append("data[time_line][en]",e.time_line.en??""),a.append("data[time_line][ar]",e.time_line.ar??"")),a}const ve={list:async()=>{const{data:e}=await m.get("/api/type-of-buildings");return e.data||e}},fe={list:async()=>{const{data:e}=await m.get("/api/type-of-prices");return e.data||e}},me={class:"p-6 space-y-8"},ge={class:"flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"},ye={class:"text-sm text-gray-500"},xe={class:"bg-white p-6 rounded-2xl shadow"},be={key:0,class:"text-sm text-gray-500"},he={key:1,class:"text-center text-gray-500 py-6"},we={key:2,class:"overflow-x-auto"},ke={class:"min-w-full border border-gray-200 text-sm"},Ce={class:"py-2 px-3 font-medium"},Ue={class:"py-2 px-3"},Ve={class:"font-semibold text-gray-900"},Ae={class:"text-xs text-gray-500"},Pe={class:"py-2 px-3 text-gray-700"},$e={class:"py-2 px-3"},Te=["onUpdate:modelValue","disabled"],De=["value"],Qe={class:"py-2 px-3"},Re=["onUpdate:modelValue","disabled"],Be={class:"py-2 px-3"},Se=["onUpdate:modelValue","disabled"],Le={class:"py-2 px-3"},Ne={class:"py-2 px-3 text-center space-x-2"},Fe=["onClick"],Me=["onClick"],Ee=["onClick"],Ie=["onClick"],Oe=["onClick"],ze={key:0,class:"flex justify-between items-center mt-6 text-sm"},Je={class:"text-gray-600"},Ge={class:"space-x-2"},He=["disabled"],Ke=["onClick"],We=["disabled"],Xe={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-[200]"},Ye={class:"bg-white w-full max-w-lg rounded-xl shadow-lg p-6 space-y-5"},Ze={class:"space-y-3 text-sm text-gray-700"},je={key:0},qe=["href"],et=["src"],tt={class:"flex justify-end pt-4"},st={__name:"UnitQuoteResponses",setup(e){const a=_([]),l=_([]),g=_([]),S=_([]),L=_([]),U=_(""),D=_(!1),Q=_(!1),p=_(null);function z(n){p.value=n,Q.value=!0}const c=_(1),x=_(7),b=k(()=>{const n=U.value.toLowerCase();return a.value.filter(s=>s.title.toLowerCase().includes(n)||s.user_name&&s.user_name.toLowerCase().includes(n)).sort((s,f)=>f.id-s.id)}),h=k(()=>Math.ceil(b.value.length/x.value)),J=k(()=>(c.value-1)*x.value+1),G=k(()=>Math.min(c.value*x.value,b.value.length)),N=k(()=>{const n=(c.value-1)*x.value;return b.value.slice(n,n+x.value)});te(U,()=>c.value=1);async function w(){D.value=!0;try{const[n,s,f,V,A,i]=await Promise.all([oe.list(),T.list(),de.list(),le.list(),ve.list(),fe.list()]);a.value=n.map(y=>{const r=s.find(ee=>ee.unit_quote_id===y.id);return{...y,has_response:!!r,editing:!1,response:r?{id:r.id,vendor_id:r.vendor_id,user_id:r.user_id,price:r.price,time_line:r.time_line_en||""}:{vendor_id:"",user_id:"",price:"",time_line:""}}}),l.value=f,g.value=V,S.value=A,L.value=i}finally{D.value=!1}}function H(n){n.editing=!0}async function K(n){const s=ce({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await T.create(s),await w()}async function W(n){const s=_e({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await T.update(n.response.id,s),n.editing=!1,await w()}async function X(n){confirm("Delete this response?")&&(await T.remove(n.response.id),await w())}function Y(n){var s;return((s=g.value.find(f=>f.id===n))==null?void 0:s.name)||"—"}function Z(n){n>=1&&n<=h.value&&(c.value=n)}function j(){c.value<h.value&&c.value++}function q(){c.value>1&&c.value--}function F(n){return n?new Date(n).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function M(n){return n?typeof n=="object"&&n.en?n.en:n:"—"}return se(w),(n,s)=>(d(),ne(re,null,{default:ie(()=>{var f,V,A;return[t("div",me,[t("div",{class:"flex items-center justify-between"},[s[2]||(s[2]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Quote Responses",-1)),t("button",{onClick:w,class:"px-3 py-1.5 border rounded-lg text-sm hover:bg-gray-50"}," Refresh ")]),t("div",ge,[P(t("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>U.value=i),type:"text",placeholder:"Search quotes by title or user…",class:"form-input w-1/2"},null,512),[[R,U.value]]),t("span",ye,o(b.value.length)+" quote(s) found ",1)]),t("div",xe,[s[5]||(s[5]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Quotes & Responses",-1)),D.value?(d(),u("div",be,"Loading…")):N.value.length?(d(),u("div",we,[t("table",ke,[s[4]||(s[4]=t("thead",{class:"bg-gray-100 text-gray-700"},[t("tr",null,[t("th",{class:"py-2 px-3 text-left"}),t("th",{class:"py-2 px-3 text-left"},"Title"),t("th",{class:"py-2 px-3 text-left"},"User"),t("th",{class:"py-2 px-3 text-left"},"Vendor"),t("th",{class:"py-2 px-3 text-left"},"Price"),t("th",{class:"py-2 px-3 text-left"},"Timeline"),t("th",{class:"py-2 px-3 text-left"},"Status"),t("th",{class:"py-2 px-3 text-center"},"Actions")])],-1)),t("tbody",null,[(d(!0),u($,null,B(N.value,i=>{var y;return d(),u("tr",{key:i.id,class:"border-t hover:bg-gray-50 transition"},[t("td",Ce,o(i.id),1),t("td",Ue,[t("div",Ve,o(i.title),1),t("div",Ae,o(F(i.created_at)),1)]),t("td",Pe,o(((y=l.value.find(r=>r.id===i.user_id))==null?void 0:y.name)||`User ${i.user_id}`),1),t("td",$e,[P(t("select",{"onUpdate:modelValue":r=>i.response.vendor_id=r,class:"form-input",disabled:!i.editing&&i.has_response},[s[3]||(s[3]=t("option",{value:"",disabled:""},"Select Vendor",-1)),(d(!0),u($,null,B(g.value,r=>(d(),u("option",{key:r.id,value:r.id},o(r.name),9,De))),128))],8,Te),[[ae,i.response.vendor_id]])]),t("td",Qe,[P(t("input",{"onUpdate:modelValue":r=>i.response.price=r,type:"number",class:"form-input",disabled:!i.editing&&i.has_response},null,8,Re),[[R,i.response.price,void 0,{number:!0}]])]),t("td",Be,[P(t("input",{"onUpdate:modelValue":r=>i.response.time_line=r,type:"text",class:"form-input",disabled:!i.editing&&i.has_response},null,8,Se),[[R,i.response.time_line]])]),t("td",Le,[t("span",{class:E(["px-2 py-0.5 rounded-full text-xs border",i.has_response?"bg-green-100 text-green-700 border-green-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},o(i.has_response?"Responded":"Pending"),3)]),t("td",Ne,[t("button",{class:"px-2 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-100",onClick:r=>z(i)}," Details ",8,Fe),i.has_response?(d(),u($,{key:1},[i.editing?C("",!0):(d(),u("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:r=>H(i)}," Edit ",8,Ee)),i.editing?(d(),u("button",{key:1,class:"px-3 py-1 text-xs border rounded-lg text-green-700 border-green-200 hover:bg-green-50",onClick:r=>W(i)}," Update ",8,Ie)):C("",!0),t("button",{class:"px-3 py-1 text-xs border rounded-lg text-red-700 border-red-200 hover:bg-red-50",onClick:r=>X(i)}," Delete ",8,Oe)],64)):(d(),u("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:r=>K(i)}," Save ",8,Me))])])}),128))])]),h.value>1?(d(),u("div",ze,[t("span",Je," Showing "+o(J.value)+"–"+o(G.value)+" of "+o(b.value.length),1),t("div",Ge,[t("button",{onClick:q,disabled:c.value===1,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"},"Prev",8,He),(d(!0),u($,null,B(h.value,i=>(d(),u("button",{key:i,onClick:y=>Z(i),class:E(["px-3 py-1 border rounded-lg",i===c.value?"bg-blue-600 text-white":"hover:bg-gray-50"])},o(i),11,Ke))),128)),t("button",{onClick:j,disabled:c.value===h.value,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"},"Next",8,We)])])):C("",!0)])):(d(),u("div",he," No quotes found. "))])]),Q.value?(d(),u("div",Xe,[t("div",Ye,[s[16]||(s[16]=t("h3",{class:"text-xl font-bold text-gray-800"},"Quote Details",-1)),t("div",Ze,[t("div",null,[s[6]||(s[6]=t("b",null,"Title:",-1)),v(" "+o(p.value.title),1)]),t("div",null,[s[7]||(s[7]=t("b",null,"Other Title:",-1)),v(" "+o(p.value.other_title||"—"),1)]),t("div",null,[s[8]||(s[8]=t("b",null,"Building Type:",-1)),v(" "+o(M((f=S.value.find(i=>i.id===p.value.type_of_building_id))==null?void 0:f.name)||"—"),1)]),t("div",null,[s[9]||(s[9]=t("b",null,"Price Type:",-1)),v(" "+o(M((V=L.value.find(i=>i.id===p.value.type_of_price_id))==null?void 0:V.name)||"—"),1)]),t("div",null,[s[10]||(s[10]=t("b",null,"User:",-1)),v(" "+o(((A=l.value.find(i=>i.id===p.value.user_id))==null?void 0:A.name)||`User ${p.value.user_id}`),1)]),t("div",null,[s[11]||(s[11]=t("b",null,"Vendor:",-1)),v(" "+o(Y(p.value.response.vendor_id)),1)]),t("div",null,[s[12]||(s[12]=t("b",null,"Price:",-1)),v(" "+o(p.value.response.price||"—"),1)]),t("div",null,[s[13]||(s[13]=t("b",null,"Timeline:",-1)),v(" "+o(p.value.response.time_line||"—"),1)]),p.value.pay_image?(d(),u("div",je,[s[14]||(s[14]=t("b",null,"Payment Image:",-1)),t("a",{href:`/storage/${p.value.pay_image}`,target:"_blank"},[t("img",{src:`/storage/${p.value.pay_image}`,class:"h-24 w-24 object-cover rounded shadow mt-1"},null,8,et)],8,qe)])):C("",!0),t("div",null,[s[15]||(s[15]=t("b",null,"Created At:",-1)),v(" "+o(F(p.value.created_at)),1)])]),t("div",tt,[t("button",{class:"px-4 py-2 border rounded-lg hover:bg-gray-50",onClick:s[1]||(s[1]=i=>Q.value=!1)}," Close ")])])])):C("",!0)]}),_:1}))}},dt=ue(st,[["__scopeId","data-v-e34a6005"]]);export{dt as default};
