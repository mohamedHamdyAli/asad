import{m as y,i as R,p as x,r as N,q as I,c as J,o as p,w as M,b as t,a as z,j as k,k as w,f as m,h as C,t as _,F as P,s as X}from"./app-DvYuR-gS.js";import{_ as G}from"./AuthenticatedLayout-C6SZ-xrs.js";import{_ as H}from"./UnitNav-C1V0M81o.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Q(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function W(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}function Y(e){return e?`/storage/${e}`:""}function S(e){return(e||"").split("/").pop()||""}function Z(e){return(S(e).split(".").pop()||"").toLowerCase()}function ee(e){const a=Z(e);return a==="pdf"?"ðŸ“• PDF":a==="doc"||a==="docx"?"ðŸ“ DOC":a==="xls"||a==="xlsx"?"ðŸ“Š XLS":"ðŸ“„"}function te(e={}){const a=Q(e.title),o=a&&typeof a=="object"?a:{en:a??"",ar:a??""},i=Y(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:i,file_name:S(e.file),file_icon:ee(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const U={list:async e=>{const{data:a}=await y.get(`/api/unit-report/${e}`);return W(a).map(te)},create:async e=>{const{data:a}=await y.post("/api/unit-report/create",e,{headers:{"Content-Type":"multipart/form-data"}});return a},update:async e=>{const{data:a}=await y.post("/api/unit-report/update",e,{headers:{"Content-Type":"multipart/form-data"}});return a},remove:async e=>{const{data:a}=await y.delete(`/api/unit-report/delete/${e}`);return a}};function se(e,a=[]){const o=new FormData;return o.append("unit_id",String(e)),a.forEach((i,r)=>{var c,u;o.append(`data[${r}][title][en]`,((c=i==null?void 0:i.title)==null?void 0:c.en)??""),o.append(`data[${r}][title][ar]`,((u=i==null?void 0:i.title)==null?void 0:u.ar)??""),i.file&&o.append(`data[${r}][file]`,i.file)}),o}function ne(e,a=[]){const o=new FormData;return o.append("unit_id",String(e)),a.forEach((i,r)=>{var c,u;o.append(`data[${r}][id]`,String(i.id??"")),((c=i==null?void 0:i.title)==null?void 0:c.en)!==void 0&&o.append(`data[${r}][title][en]`,i.title.en??""),((u=i==null?void 0:i.title)==null?void 0:u.ar)!==void 0&&o.append(`data[${r}][title][ar]`,i.title.ar??""),i.file&&o.append(`data[${r}][file]`,i.file)}),o}const ae={class:"p-6 space-y-6"},ie={class:"flex items-center justify-between"},le=["href"],oe={class:"bg-white p-4 rounded shadow"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"mt-4"},ce={key:0,class:"mt-3 text-sm text-gray-600"},ue={class:"mt-4 flex items-center gap-3"},pe=["disabled"],fe={key:0,class:"text-red-600 text-sm"},me={class:"bg-white p-4 rounded shadow"},ve={key:0,class:"text-sm text-gray-500"},xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},_e={class:"h-32 bg-white flex items-center justify-center p-3 text-center"},ge={class:"text-gray-600"},be={class:"text-3xl"},he={class:"text-xs mt-1 break-all"},ye={class:"p-3 space-y-2 text-sm"},ke=["onUpdate:modelValue"],we=["onUpdate:modelValue"],Ce={class:"text-[11px]"},Ue=["onChange"],Fe={class:"flex gap-2 pt-1"},$e=["href"],Ae=["onClick","disabled"],Re=["onClick"],Ne={key:0,class:"col-span-full text-center text-gray-500 py-8"},D=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",De={__name:"Reports",props:{unitId:{type:[Number,String],required:!0}},setup(e){const a=e,o=R(()=>a.unitId),i=R(()=>"/units-management"),r=x({title:{en:"",ar:""}}),c=x([]),u=x(!1),b=x(""),V=R(()=>{var l,s;return!!((l=r.value.title.en)!=null&&l.trim())&&!!((s=r.value.title.ar)!=null&&s.trim())&&c.value.length>0});function E(l){const s=Array.from(l.target.files||[]);c.value=s}async function T(){var l,s;u.value=!0,b.value="";try{const n=c.value.map(f=>({title:{...r.value.title},file:f})),d=se(o.value,n);await U.create(d),await g(),c.value=[],r.value.title={en:"",ar:""}}catch(n){console.error(n),b.value=((s=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:s.message)||(n==null?void 0:n.message)||"Upload failed"}finally{u.value=!1}}const F=x([]),$=x(!1),v=N({}),A=N({}),h=N({});function B(l){l.forEach(s=>{v[s.id]={title:{en:s.title_en||"",ar:s.title_ar||""}}})}async function g(){$.value=!0;try{const l=await U.list(o.value);F.value=l,B(l)}finally{$.value=!1}}function L(l,s){var d;const n=((d=s.target.files)==null?void 0:d[0])||null;n&&(A[l]=n)}async function j(l){var n,d;const s=v[l];if(s){h[l]=!0;try{const f=[{id:l,title:s.title,file:A[l]}],q=ne(o.value,f);await U.update(q),delete A[l],await g()}catch(f){console.error(f),alert(((d=(n=f==null?void 0:f.response)==null?void 0:n.data)==null?void 0:d.message)||"Update failed")}finally{h[l]=!1}}}async function O(l){confirm("Delete this report?")&&(await U.remove(l),await g())}return I(g),(l,s)=>(p(),J(G,null,{default:M(()=>[t("div",ae,[t("div",ie,[s[2]||(s[2]=t("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Reports",-1)),t("a",{href:i.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,le)]),z(H,{"unit-id":Number(o.value),cols:2},null,8,["unit-id"]),t("div",oe,[s[5]||(s[5]=t("h3",{class:"text-lg font-bold mb-3"},"Add Reports",-1)),t("div",re,[t("div",null,[s[3]||(s[3]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>r.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[w,r.value.title.en]])]),t("div",null,[s[4]||(s[4]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),k(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>r.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[w,r.value.title.ar]])])]),t("div",de,[t("input",{type:"file",multiple:"",accept:D,onChange:E},null,32),c.value.length?(p(),m("div",ce,_(c.value.length)+" file(s) selected ",1)):C("",!0)]),t("div",ue,[t("button",{disabled:u.value||!V.value,onClick:T,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},_(u.value?"Uploadingâ€¦":"Upload"),9,pe),b.value?(p(),m("span",fe,_(b.value),1)):C("",!0)])]),t("div",me,[t("div",{class:"flex items-center justify-between mb-3"},[s[6]||(s[6]=t("h3",{class:"text-lg font-bold"},"Reports",-1)),t("button",{onClick:g,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(p(),m("div",ve,"Loadingâ€¦")):(p(),m("div",xe,[(p(!0),m(P,null,X(F.value,n=>(p(),m("div",{key:n.id,class:"rounded border bg-gray-50 overflow-hidden"},[t("div",_e,[t("div",ge,[t("div",be,_(n.file_icon.split(" ")[0]),1),t("div",he,_(n.file_name),1)])]),t("div",ye,[t("div",null,[s[7]||(s[7]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),k(t("input",{"onUpdate:modelValue":d=>v[n.id].title.en=d,class:"form-input",type:"text"},null,8,ke),[[w,v[n.id].title.en]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),k(t("input",{"onUpdate:modelValue":d=>v[n.id].title.ar=d,class:"form-input",type:"text"},null,8,we),[[w,v[n.id].title.ar]])]),t("div",Ce,[s[9]||(s[9]=t("label",{class:"block text-gray-500"},"Replace File",-1)),t("input",{type:"file",accept:D,onChange:d=>L(n.id,d)},null,40,Ue)]),t("div",Fe,[n.file_url?(p(),m("a",{key:0,href:n.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,$e)):C("",!0),t("button",{class:"px-2 py-1 border rounded",onClick:d=>j(n.id),disabled:h[n.id]},_(h[n.id]?"Savingâ€¦":"Save"),9,Ae),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>O(n.id)}," Delete ",8,Re)])])]))),128)),F.value.length?C("",!0):(p(),m("div",Ne," No reports found. "))]))])])]),_:1}))}},Be=K(De,[["__scopeId","data-v-d8f9af0e"]]);export{Be as default};
