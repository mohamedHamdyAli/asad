import{m,p as d,i as M,B as J,q as K,f as r,o as c,a as D,u as O,g as Q,w as W,b as e,j as V,k as E,F as _,s as R,t as u,e as X,h as F,y as Y}from"./app-4D-wkT_p.js";import{_ as Z}from"./AuthenticatedLayout-CCBjItTP.js";import{U as L}from"./users-DY6UNjpd.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={list:async()=>{const{data:l}=await m.get("/api/roles");return l.data??l},create:async l=>{const{data:n}=await m.post("/api/roles/create",l);return n},update:async(l,n)=>{const{data:y}=await m.post(`/api/roles/update/${l}`,n);return y},remove:async l=>{const{data:n}=await m.delete(`/api/roles/delete/${l}`);return n},syncPermissions:async(l,n)=>{const{data:y}=await m.post(`/api/roles/${l}/sync-permissions`,n);return y}},ee={list:async()=>{const{data:l}=await m.get("/api/permissions");return l.data??l},create:async l=>{const{data:n}=await m.post("/api/permissions",l);return n},remove:async l=>{const{data:n}=await m.delete(`/api/permissions/${l}`);return n}},se={class:"p-6 space-y-10"},te={class:"bg-white p-6 rounded shadow space-y-4"},ae={class:"flex gap-2"},le={class:"w-full text-sm border"},oe={class:"p-2 font-medium"},ne={class:"p-2"},ie={class:"grid grid-cols-3 gap-2"},re=["checked","onChange"],ce={class:"p-2"},de=["onClick"],ue={class:"bg-white p-6 rounded shadow space-y-4"},pe={class:"flex flex-wrap gap-4 items-center"},me=["value"],ve={class:"w-full text-sm"},fe={class:"px-4 py-3"},ye={class:"px-4 py-3"},_e={class:"px-4 py-3 font-medium"},ge={class:"px-4 py-3"},he=["value","onChange"],xe=["value"],be={class:"px-4 py-3 text-right"},we=["disabled","onClick"],Re={class:"flex justify-between items-center mt-4"},ke={class:"text-sm text-gray-600"},Ce={class:"flex gap-2"},Pe=["disabled"],$e=["disabled"],Ae={key:0,class:"text-green-600 text-sm"},Ue={key:1,class:"text-red-600 text-sm"},Me={__name:"RolesManagement",setup(l){const n=d([]),y=d([]),k=d([]),g=d(""),h=d({}),x=d({}),C=d(""),P=d(""),b=d(""),w=d(""),v=d(1),A=d(10);async function U(){const a=await $.list(),t=await ee.list(),s=await L.list();n.value=a.data??a,y.value=t.data??t,k.value=s.data??s,k.value.forEach(o=>{var p,i;h.value[o.id]=((i=(p=o.roles)==null?void 0:p[0])==null?void 0:i.name)??"",x.value[o.id]=!1})}const S=M(()=>{let a=k.value;if(b.value){const t=b.value.toLowerCase();a=a.filter(s=>s.name.toLowerCase().includes(t)||s.email.toLowerCase().includes(t))}return w.value&&(a=a.filter(t=>{var s;return(s=t.roles)==null?void 0:s.some(o=>o.name===w.value)})),a}),B=M(()=>Math.ceil(S.value.length/A.value)),N=M(()=>{const a=(v.value-1)*A.value;return S.value.slice(a,a+A.value)});J([b,w],()=>{v.value=1});async function T(){g.value&&(await $.create({name:g.value}),g.value="",await U())}async function j(a){confirm("Delete role?")&&(await $.remove(a),await U())}function q(a,t,s){z(a,t)}async function z(a,t){var i;const s=n.value.find(f=>f.id===a);if(!s)return;const o=((i=s.permissions)==null?void 0:i.map(f=>f.name))??[],p=o.includes(t)?o.filter(f=>f!==t):[...o,t];await $.syncPermissions(a,{permissions:p}),s.permissions=p.map(f=>({name:f}))}function G(a,t){h.value[a]=t}async function H(a){C.value="",P.value="",x.value[a]=!0;try{await L.assignRole(a,{roles:[h.value[a]]});const t=k.value.find(s=>s.id===a);t&&(t.roles=[{name:h.value[a]}]),C.value="Role assigned successfully"}catch{P.value="Failed to assign role"}finally{x.value[a]=!1}}return K(U),(a,t)=>(c(),r(_,null,[D(O(Q),{title:"Roles & Permissions"}),D(Z,null,{default:W(()=>[e("div",se,[e("section",te,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold"},"Roles",-1)),e("div",ae,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),placeholder:"Role name",class:"form-input w-64"},null,512),[[E,g.value]]),e("button",{class:"btn-primary",onClick:T}," Add Role ")]),e("table",le,[t[5]||(t[5]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2 text-left"},"Role"),e("th",{class:"p-2"},"Permissions"),e("th",{class:"p-2"},"Actions")])],-1)),e("tbody",null,[(c(!0),r(_,null,R(n.value,s=>(c(),r("tr",{key:s.id,class:"border-t"},[e("td",oe,u(s.name),1),e("td",ne,[e("div",ie,[(c(!0),r(_,null,R(y.value,o=>{var p;return c(),r("label",{key:o.id,class:"flex items-center gap-1 text-xs"},[e("input",{type:"checkbox",checked:(p=s.permissions)==null?void 0:p.some(i=>i.name===o.name),onChange:i=>q(s.id,o.name,i)},null,40,re),X(" "+u(o.name),1)])}),128))])]),e("td",ce,[e("button",{class:"btn-danger",onClick:o=>j(s.id)}," Delete ",8,de)])]))),128))])])]),e("section",ue,[t[10]||(t[10]=e("h2",{class:"text-xl font-semibold"},"Users",-1)),e("div",pe,[V(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),placeholder:"Search name or email",class:"form-input w-64"},null,512),[[E,b.value]]),V(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),class:"form-input w-48"},[t[7]||(t[7]=e("option",{value:""},"All roles",-1)),(c(!0),r(_,null,R(n.value,s=>(c(),r("option",{key:s.id,value:s.name},u(s.name),9,me))),128))],512),[[Y,w.value]])]),e("table",ve,[t[9]||(t[9]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Name"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Current Role"),e("th",{class:"px-4 py-3"},"Change Role"),e("th",{class:"px-4 py-3 text-right"},"Action")])],-1)),e("tbody",null,[(c(!0),r(_,null,R(N.value,s=>{var o,p;return c(),r("tr",{key:s.id,class:"border-t"},[e("td",fe,u(s.name),1),e("td",ye,u(s.email),1),e("td",_e,u(((p=(o=s.roles)==null?void 0:o[0])==null?void 0:p.name)??"—"),1),e("td",ge,[e("select",{class:"form-input",value:h.value[s.id],onChange:i=>G(s.id,i.target.value)},[t[8]||(t[8]=e("option",{value:""},"— Select role —",-1)),(c(!0),r(_,null,R(n.value,i=>(c(),r("option",{key:i.id,value:i.name},u(i.name),9,xe))),128))],40,he)]),e("td",be,[e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",disabled:x.value[s.id],onClick:i=>H(s.id)},u(x.value[s.id]?"Saving…":"Save"),9,we)])])}),128))])]),e("div",Re,[e("span",ke," Page "+u(v.value)+" of "+u(B.value),1),e("div",Ce,[e("button",{class:"px-3 py-1 border rounded",disabled:v.value===1,onClick:t[3]||(t[3]=s=>v.value--)}," Prev ",8,Pe),e("button",{class:"px-3 py-1 border rounded",disabled:v.value===B.value,onClick:t[4]||(t[4]=s=>v.value++)}," Next ",8,$e)])]),C.value?(c(),r("p",Ae,u(C.value),1)):F("",!0),P.value?(c(),r("p",Ue,u(P.value),1)):F("",!0)])])]),_:1})],64))}},Ee=I(Me,[["__scopeId","data-v-808bbe2e"]]);export{Ee as default};
