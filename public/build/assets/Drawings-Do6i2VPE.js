import{m as D,p as g,i as R,r as j,q as Q,c as X,o as c,w as Y,b as a,a as I,j as _,k as y,f as p,h as w,F as T,s as E,t as x}from"./app-hVErxZBb.js";import{_ as Z}from"./AuthenticatedLayout-D7Gb01l7.js";import{F as L,a as ee}from"./FolderPicker-D283kkHL.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ae(n){try{return typeof n=="string"?JSON.parse(n):n}catch{return n}}function ne(n){var r;return Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.message)?n.message:Array.isArray((r=n==null?void 0:n.data)==null?void 0:r.data)?n.data.data:[]}function le(n){return n?`/storage/${n}`:""}function se(n={}){const r=ae(n.title),d=r&&typeof r=="object"?r:{en:r??"",ar:r??""};return{id:n.id,unit_id:n.unit_id,folder_id:n.folder_id,date:n.date??"",image:n.image??"",image_url:le(n.image),title_en:d.en??"",title_ar:d.ar??"",created_at:n.created_at,updated_at:n.updated_at}}const F={list:async n=>{const{data:r}=await D.get(`/api/unit-drawing/${n}`);return ne(r).map(se)},create:async n=>{const{data:r}=await D.post("/api/unit-drawing/create",n,{headers:{"Content-Type":"multipart/form-data"}});return r},update:async n=>{const{data:r}=await D.post("/api/unit-drawing/update",n,{headers:{"Content-Type":"multipart/form-data"}});return r},remove:async n=>{const{data:r}=await D.delete(`/api/unit-drawing/delete/${n}`);return r}};function re(n,r=[]){const d=new FormData;return d.append("unit_id",String(n)),r.forEach((s,u)=>{var v,o;d.append(`data[${u}][folder_id]`,String(s.folder_id??"")),d.append(`data[${u}][date]`,s.date??""),d.append(`data[${u}][title][en]`,((v=s==null?void 0:s.title)==null?void 0:v.en)??""),d.append(`data[${u}][title][ar]`,((o=s==null?void 0:s.title)==null?void 0:o.ar)??""),s.image&&d.append(`data[${u}][image]`,s.image)}),d}function ie(n,r=[]){const d=new FormData;return d.append("unit_id",String(n)),r.forEach((s,u)=>{var v,o;d.append(`data[${u}][id]`,String(s.id??"")),d.append(`data[${u}][folder_id]`,String(s.folder_id??"")),s.date!==void 0&&d.append(`data[${u}][date]`,s.date??""),((v=s==null?void 0:s.title)==null?void 0:v.en)!==void 0&&d.append(`data[${u}][title][en]`,s.title.en??""),((o=s==null?void 0:s.title)==null?void 0:o.ar)!==void 0&&d.append(`data[${u}][title][ar]`,s.title.ar??""),s.image&&d.append(`data[${u}][image]`,s.image)}),d}const de={class:"p-6 space-y-6"},oe={class:"flex items-center justify-between"},ue=["href"],ce={class:"bg-white p-4 rounded shadow"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},fe={class:"mt-4"},me={key:0,class:"mt-3 flex flex-wrap gap-2"},ge=["src"],ve={class:"mt-4 flex items-center gap-3"},be=["disabled"],xe={key:0,class:"text-red-600 text-sm"},_e={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},ye={key:0,class:"text-sm text-gray-500"},he={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-5"},we={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},ke=["src"],Ue=["src"],$e={key:2,class:"flex flex-col items-center justify-center text-gray-500 text-xs"},Ve={class:"break-all px-2"},Ce=["href"],De={class:"absolute top-2 left-2 flex flex-wrap gap-2"},Fe={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-600 border border-gray-200"},Ae={key:0,class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-600 border border-gray-200"},Se={class:"p-3.5 space-y-3 text-sm"},je=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],Ie={class:"text-[11px]"},Te=["onChange"],Ee={key:0,class:"mt-1 text-[11px] text-gray-500"},Le={class:"flex items-center gap-2 pt-2"},Be=["onClick","disabled"],qe=["onClick"],Oe={key:0,class:"col-span-full text-center text-gray-500 py-8"},Pe={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(n){const r=g([]),d=g(!1);async function s(){d.value=!0;try{r.value=await ee.list("drawing")}finally{d.value=!1}}const u=n,v=R(()=>"/units-management"),o=g({folder_id:null,date:"",title:{en:"",ar:""}}),k=g([]),U=g([]),$=g(!1),V=g(""),B=R(()=>{var l,e;return!!o.value.folder_id&&!!o.value.date&&!!((l=o.value.title.en)!=null&&l.trim())&&!!((e=o.value.title.ar)!=null&&e.trim())&&k.value.length>0});function q(l){const e=Array.from(l.target.files||[]);k.value=e,U.value=e.map(t=>URL.createObjectURL(t))}function O(l){return l?l.mime_type?l.mime_type.startsWith("image/"):/\.(jpg|jpeg|png|gif|webp)$/i.test(l.url||""):!1}function P(l){return l?l.mime_type?l.mime_type==="application/pdf":/\.pdf$/i.test(l.url||""):!1}function J(l){if(!l)return"Unknown file";if(l.file_name)return l.file_name;try{return decodeURIComponent((l.url||"").split("/").pop().split("?")[0])}catch{return"Unknown file"}}async function M(){var l,e;$.value=!0,V.value="";try{const t=k.value.map(i=>({folder_id:o.value.folder_id,date:o.value.date,title:{...o.value.title},image:i})),m=re(u.unitId,t);await F.create(m),await h(),k.value=[],U.value=[],o.value.title={en:"",ar:""}}catch(t){console.error(t),V.value=((e=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Upload failed"}finally{$.value=!1}}const A=g([]),S=g(!1),f=j({}),b=j({}),C=j({});function z(l){l.forEach(e=>{f[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function h(){S.value=!0;try{const l=await F.list(u.unitId);A.value=l,z(l)}finally{S.value=!1}}function N(l){const e=l==null?void 0:l.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}function G(l,e){var m;const t=((m=e.target.files)==null?void 0:m[0])||null;t&&(b[l]=t)}async function H(l){var t,m;const e=f[l];if(e){C[l]=!0;try{const i=[{id:l,folder_id:e.folder_id,date:e.date,title:e.title,image:b[l]}],K=ie(u.unitId,i);await F.update(K),delete b[l],await h()}catch(i){console.error(i),alert(((m=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:m.message)||"Update failed")}finally{C[l]=!1}}}async function W(l){confirm("Delete this drawing?")&&(await F.remove(l),await h())}return Q(async()=>{await s(),await h()}),(l,e)=>(c(),X(Z,null,{default:Y(()=>[a("div",de,[a("div",oe,[e[8]||(e[8]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Drawings",-1)),a("a",{href:v.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ue)]),a("div",ce,[e[12]||(e[12]=a("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),a("div",pe,[I(L,{type:"drawing",label:"Folder *",fileType:"drawing",modelValue:o.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.folder_id=t),options:r.value,onCreated:e[1]||(e[1]=t=>r.value.unshift(t)),onRefresh:s},null,8,["modelValue","options"]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),_(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.date=t),class:"form-input",type:"date",required:""},null,512),[[y,o.value.date]])]),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),_(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title.en=t),class:"form-input",type:"text",required:""},null,512),[[y,o.value.title.en]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),_(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.title.ar=t),class:"form-input",type:"text",required:""},null,512),[[y,o.value.title.ar]])])]),a("div",fe,[a("input",{type:"file",multiple:"",onChange:q},null,32),U.value.length?(c(),p("div",me,[(c(!0),p(T,null,E(U.value,(t,m)=>(c(),p("img",{key:m,src:t,class:"w-24 h-16 object-cover rounded border"},null,8,ge))),128))])):w("",!0)]),a("div",ve,[a("button",{disabled:$.value||!B.value,onClick:M,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},x($.value?"Uploadingâ€¦":"Upload"),9,be),V.value?(c(),p("span",xe,x(V.value),1)):w("",!0)])]),a("div",_e,[a("div",{class:"flex items-center justify-between mb-4"},[e[13]||(e[13]=a("h3",{class:"text-lg font-semibold text-gray-800"},"Drawings",-1)),a("button",{onClick:h,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),S.value?(c(),p("div",ye,"Loadingâ€¦")):(c(),p("div",he,[(c(!0),p(T,null,E(A.value,t=>{var m;return c(),p("div",{key:t.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[a("div",we,[O(t)?(c(),p("img",{key:0,src:t.file_url,class:"absolute inset-0 w-full h-full object-cover"},null,8,ke)):P(t)?(c(),p("iframe",{key:1,src:t.file_url,class:"absolute inset-0 w-full h-full"},null,8,Ue)):(c(),p("div",$e,[e[14]||(e[14]=a("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),a("span",Ve,x(J(t)),1),a("a",{href:t.file_url,target:"_blank",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ce)])),e[15]||(e[15]=a("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1)),a("div",De,[a("span",Fe,x(t.title_en||"Folder"),1),f[t.id].date?(c(),p("span",Ae,x(f[t.id].date),1)):w("",!0)])]),a("div",Se,[a("div",null,[e[16]||(e[16]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date *",-1)),_(a("input",{"onUpdate:modelValue":i=>f[t.id].date=i,class:"form-input",type:"date"},null,8,je),[[y,f[t.id].date]])]),I(L,{type:"drawing",label:"Folder *",modelValue:f[t.id].folder_id,"onUpdate:modelValue":i=>f[t.id].folder_id=i,options:r.value,onCreated:e[5]||(e[5]=i=>r.value.unshift(i)),onRefresh:s},null,8,["modelValue","onUpdate:modelValue","options"]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),_(a("textarea",{"onUpdate:modelValue":i=>f[t.id].title.en=i,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[6]||(e[6]=i=>N(i))},null,40,Ne),[[y,f[t.id].title.en]])]),a("div",null,[e[18]||(e[18]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),_(a("textarea",{"onUpdate:modelValue":i=>f[t.id].title.ar=i,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[7]||(e[7]=i=>N(i))},null,40,Re),[[y,f[t.id].title.ar]])]),a("div",Ie,[e[19]||(e[19]=a("label",{class:"block text-gray-500 mb-1"},"Replace Image",-1)),a("input",{type:"file",accept:"image/*",onChange:i=>G(t.id,i)},null,40,Te),b!=null&&b[t.id]?(c(),p("p",Ee," Selected: "+x((m=b[t.id])==null?void 0:m.name),1)):w("",!0)]),a("div",Le,[a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:i=>H(t.id),disabled:C[t.id]},x(C[t.id]?"Savingâ€¦":"Save"),9,Be),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:i=>W(t.id)}," Delete ",8,qe)])])])}),128)),A.value.length?w("",!0):(c(),p("div",Oe," No drawings found. "))]))])])]),_:1}))}},He=te(Pe,[["__scopeId","data-v-200be95d"]]);export{He as default};
