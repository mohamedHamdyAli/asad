import{m as k,p as f,f as m,o as d,h as v,b as r,c as D,t as g,F as M,s as z,d as I,j as w,k as C,N as L}from"./app-CeiZJvCU.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";function U(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function h(e={}){const t=U(e.name),l=t&&typeof t=="object"?t:{en:t??"",ar:t??""};return{id:e.id,file_type:e.file_type,name_en:l.en??"",name_ar:l.ar??"",label:l.en||l.ar||`Folder #${e.id}`,folder_image:e.folder_image?`/storage/${e.folder_image}`:null,unit_id:e.unit_id??null}}function q(e){var t;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((t=e==null?void 0:e.data)==null?void 0:t.data)?e.data.data:[]}const F={list:async(e,t=null)=>{const{data:l}=await k.get(`/api/folder/${e}`,{params:t?{unit_id:t}:{}});return q(l).map(h)},create:async e=>{const{data:t}=await k.post("/api/folder/create",e,{headers:{"Content-Type":"multipart/form-data"}}),l=(t==null?void 0:t.data)??t;return h(l)},update:async(e,t)=>{const{data:l}=await k.post(`/api/folder/update/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}});return h((l==null?void 0:l.data)??l)},remove:async e=>{const{data:t}=await k.delete(`/api/folder/delete/${e}`);return t}};function R({file_type:e,name:t={en:"",ar:""},folder_image:l=null,unit_id:c=null}){const o=new FormData;return o.append("file_type",e),o.append("name[en]",t.en??""),o.append("name[ar]",t.ar??""),c&&o.append("unit_id",c),l&&o.append("folder_image",l),o}const E={class:"relative w-full"},J={key:0,class:"block text-xs text-gray-500 mb-1"},O={key:1,class:"absolute mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-64 overflow-auto"},P=["onClick"],G=["onClick"],H={key:0,class:"fixed inset-0 z-[1000] flex items-center justify-center"},K={class:"relative z-10 bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fadeIn"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},W={class:"md:col-span-2"},X=["src"],Y={class:"mt-6 flex justify-end gap-3"},Z=["disabled"],ee={key:0,class:"mt-3 text-sm text-red-600"},te={__name:"FolderPicker",props:{type:{type:String,required:!0},modelValue:{type:[Number,String,null],default:null},label:{type:String,default:"Folder"},options:{type:Array,required:!0},unitId:{type:[Number,String],required:!0}},emits:["update:modelValue","created","refresh","removed"],setup(e,{emit:t}){const l=e,c=t,o=f(!1),_=f(!1),b=f(!1),p=f(""),i=f({name:{en:"",ar:""},folder_image:null}),x=f(null);function A(){o.value=!o.value}function j(u){c("update:modelValue",u),o.value=!1}async function N(u){confirm("Delete this folder?")&&(await F.remove(u),c("removed",u),c("refresh"))}function V(u){var n;const a=((n=u.target.files)==null?void 0:n[0])||null;i.value.folder_image=a,x.value=a?URL.createObjectURL(a):null}function S(){i.value={name:{en:"",ar:""},folder_image:null},x.value=null,p.value=""}function y(){_.value=!1,S()}async function $(){var u,a;b.value=!0,p.value="";try{const n=R({file_type:l.type,unit_id:l.unitId,name:i.value.name,folder_image:i.value.folder_image}),s=await F.create(n);c("created",s),c("update:modelValue",s.id),y()}catch(n){p.value=((a=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Create failed"}finally{b.value=!1}}return(u,a)=>{var n;return d(),m("div",E,[e.label?(d(),m("label",J,g(e.label),1)):v("",!0),r("button",{type:"button",class:"form-input flex justify-between items-center w-full",onClick:A},[r("span",null,g(((n=e.options.find(s=>s.id===e.modelValue))==null?void 0:n.label)||"Select folder"),1),a[3]||(a[3]=r("svg",{class:"w-4 h-4 ml-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),o.value?(d(),m("div",O,[(d(!0),m(M,null,z(e.options,s=>(d(),m("div",{key:s.id,class:"flex items-center justify-between px-3 py-2 text-sm hover:bg-gray-50 cursor-pointer"},[r("span",{class:"truncate flex-1",onClick:B=>j(s.id)},g(s.label),9,P),r("button",{class:"ml-2 text-red-500 hover:text-red-700 text-xs",onClick:I(B=>N(s.id),["stop"])}," ✕ ",8,G)]))),128)),r("div",{class:"px-3 py-2 text-sm text-green-600 hover:bg-gray-50 cursor-pointer border-t",onClick:a[0]||(a[0]=s=>{_.value=!0,o.value=!1})}," + New Folder ")])):v("",!0),(d(),D(L,{to:"body"},[_.value?(d(),m("div",H,[r("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:y}),r("div",K,[r("div",{class:"flex items-center justify-between mb-4"},[a[4]||(a[4]=r("h3",{class:"text-xl font-semibold text-gray-800"},"Create Folder",-1)),r("button",{class:"text-gray-400 hover:text-gray-600",onClick:y},"✕")]),r("div",Q,[r("div",null,[a[5]||(a[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN) *",-1)),w(r("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>i.value.name.en=s),type:"text",class:"form-input"},null,512),[[C,i.value.name.en]])]),r("div",null,[a[6]||(a[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR) *",-1)),w(r("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>i.value.name.ar=s),type:"text",class:"form-input"},null,512),[[C,i.value.name.ar]])]),r("div",W,[a[7]||(a[7]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Image (optional)",-1)),r("input",{type:"file",accept:"image/*",onChange:V,class:"form-input"},null,32),x.value?(d(),m("img",{key:0,src:x.value,class:"mt-2 w-24 h-16 object-cover rounded border"},null,8,X)):v("",!0)])]),r("div",Y,[r("button",{class:"px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100",onClick:y}," Cancel "),r("button",{class:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-60",disabled:b.value||!i.value.name.en.trim()||!i.value.name.ar.trim(),onClick:$},g(b.value?"Saving…":"Create"),9,Z)]),p.value?(d(),m("div",ee,g(p.value),1)):v("",!0)])])):v("",!0)]))])}}},le=T(te,[["__scopeId","data-v-b22fbfb3"]]);export{le as F,F as a};
