import{m as _,p as r,i as x,q as J,c as P,o as n,w as k,b as e,j as T,f as d,h as q,k as Q,F as E,s as R,t as l,u as f,v as W,a as p,z as X}from"./app-Ddo0-UJ6.js";import{_ as Y}from"./AuthenticatedLayout-CTeKgYcY.js";import{c as Z,b as y,F as ee,d as C,E as A}from"./index.esm-3Xgvr1dQ.js";import{U as te}from"./users-DMinzGr5.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";function j(t){var i;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((i=t==null?void 0:t.data)==null?void 0:i.data)?t.data.data:[]}function B(t={}){var i,v;return{id:t.id,user_id:t.user_id,user_name:((i=t.user)==null?void 0:i.name)||"",user_email:((v=t.user)==null?void 0:v.email)||"",type:t.type||"all",title:t.title||"",body:t.body||"",is_seen:t.is_seen||!1,seen_time:t.seen_time,created_at:t.created_at,updated_at:t.updated_at}}const N={list:async()=>{const{data:t}=await _.get("/api/notifications");return j(t).map(B)},show:async t=>{const{data:i}=await _.get(`/api/notifications/show/${t}`);return j(i).map(B)},create:async t=>{const{data:i}=await _.post("/api/notifications/create",t);return i},remove:async t=>{const{data:i}=await _.delete(`/api/notifications/delete/${t}`);return i}};function ae(t={}){const i={title:t.title,body:t.body};return t.user_id&&(i.user_id=t.user_id),i}const ie={class:"p-6 space-y-6"},oe={class:"bg-white rounded-xl shadow border overflow-hidden"},ne={class:"w-full text-sm"},le={class:"px-4 py-3"},re={class:"px-4 py-3"},de={key:0},ue={key:1,class:"text-gray-400 italic"},ce={class:"px-4 py-3 max-w-xs truncate"},me={class:"px-4 py-3 max-w-md truncate"},fe={class:"px-4 py-3 text-xs text-gray-500"},pe={class:"px-4 py-3 text-right space-x-2"},ve=["onClick"],be={class:"flex justify-between"},_e={class:"space-x-2"},xe=["disabled"],ye=["disabled"],he={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},ge={class:"bg-white w-full max-w-2xl rounded-xl p-6 max-h-[85vh] overflow-y-auto"},we={class:"space-y-4"},ke={class:"flex items-center space-x-2 mb-2"},Ce={key:0},Ae=["value"],S=10,Ne={__name:"Index",setup(t){const{show:i}=X(),v=r([]),U=r([]),b=r(""),u=r(1),h=r(!1),c=r(!0),D=r(0),g=r({}),F=x(()=>Z({title:y().required("Title is required"),body:y().required("Message body is required"),user_id:c.value?y():y().required("Please select a user")}));async function w(){v.value=await N.list()}async function I(){U.value=await te.list()}const L=x(()=>v.value.filter(o=>{var s,a,m;return((s=o.title)==null?void 0:s.toLowerCase().includes(b.value.toLowerCase()))||((a=o.user_name)==null?void 0:a.toLowerCase().includes(b.value.toLowerCase()))||((m=o.body)==null?void 0:m.toLowerCase().includes(b.value.toLowerCase()))})),M=x(()=>Math.ceil(L.value.length/S)),V=x(()=>L.value.slice((u.value-1)*S,u.value*S));function z(){c.value=!0,g.value={title:"",body:"",user_id:""},D.value++,h.value=!0}function $(){h.value=!1}function O(){c.value&&(g.value.user_id="")}async function K(o){var a;const s={title:o.title,body:o.body};!c.value&&o.user_id&&(s.user_id=parseInt(o.user_id));try{await N.create(ae(s)),$(),w()}catch(m){console.error("SEND ERROR",((a=m.response)==null?void 0:a.data)||m),i(m)}}async function G(o){confirm("Delete notification?")&&(await N.remove(o),w())}function H(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return J(()=>{w(),I()}),(o,s)=>(n(),P(Y,null,{default:k(()=>[e("div",ie,[e("div",{class:"flex justify-between items-center"},[s[4]||(s[4]=e("h2",{class:"text-2xl font-bold"},"Notifications",-1)),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:z}," + Send Notification ")]),T(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>b.value=a),placeholder:"Search by title or user name",class:"form-input w-72"},null,512),[[Q,b.value]]),e("div",oe,[e("table",ne,[s[5]||(s[5]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"User Name"),e("th",{class:"px-4 py-3"},"Title"),e("th",{class:"px-4 py-3"},"Body"),e("th",{class:"px-4 py-3"},"Date"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),d(E,null,R(V.value,a=>(n(),d("tr",{key:a.id,class:"border-t"},[e("td",le,l(a.id),1),e("td",re,[a.user_name?(n(),d("div",de,l(a.user_name),1)):(n(),d("div",ue,"All Users"))]),e("td",ce,l(a.title),1),e("td",me,l(a.body),1),e("td",fe,l(H(a.created_at)),1),e("td",pe,[e("button",{class:"text-red-600",onClick:m=>G(a.id)},"Delete",8,ve)])]))),128))])])]),e("div",be,[e("span",null,"Page "+l(u.value)+" of "+l(M.value),1),e("div",_e,[e("button",{onClick:s[1]||(s[1]=a=>u.value--),disabled:u.value===1},"Prev",8,xe),e("button",{onClick:s[2]||(s[2]=a=>u.value++),disabled:u.value===M.value},"Next",8,ye)])]),h.value?(n(),d("div",he,[e("div",ge,[s[12]||(s[12]=e("h3",{class:"text-lg font-semibold mb-4"},"Send Notification",-1)),(n(),P(f(ee),{ref:"formRef","validate-on-mount":!1,key:D.value,"validation-schema":F.value,"initial-values":g.value,onSubmit:K},{default:k(()=>[e("div",we,[e("div",null,[e("label",ke,[T(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=a=>c.value=a),onChange:O,class:"form-checkbox"},null,544),[[W,c.value]]),s[6]||(s[6]=e("span",{class:"text-sm font-medium"},"Send to All Users",-1))])]),c.value?q("",!0):(n(),d("div",Ce,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium mb-1"},"Select User",-1)),p(f(C),{name:"user_id",as:"select",class:"form-input"},{default:k(()=>[s[7]||(s[7]=e("option",{value:""},"-- Select User --",-1)),(n(!0),d(E,null,R(U.value,a=>(n(),d("option",{key:a.id,value:a.id},l(a.name)+" ("+l(a.email)+") ",9,Ae))),128))]),_:1}),p(f(A),{name:"user_id",class:"error"})])),e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium mb-1"},"Title",-1)),p(f(C),{name:"title",class:"form-input",placeholder:"Notification Title"}),p(f(A),{name:"title",class:"error"})]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),p(f(C),{name:"body",as:"textarea",rows:"5",class:"form-input",placeholder:"Notification Message"}),p(f(A),{name:"body",class:"error"})])]),e("div",{class:"flex justify-end gap-2 mt-6"},[e("button",{type:"button",class:"border px-4 py-2 rounded",onClick:$}," Cancel "),s[11]||(s[11]=e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded"}," Send ",-1))])]),_:1},8,["validation-schema","initial-values"]))])])):q("",!0)])]),_:1}))}},$e=se(Ne,[["__scopeId","data-v-cb747550"]]);export{$e as default};
