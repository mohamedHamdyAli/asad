import{p as o,B as K,c as j,o as r,b as t,f as b,h,a as T,t as d,w as Q,u as w,N as X,i as S,q as Y,j as $,k as Z,y as F,F as q,s as U,v as ee,n as te}from"./app-K_l_k4qp.js";import{_ as le}from"./AuthenticatedLayout-Ob8rRmGM.js";import{T as A,a as B}from"./typeOfPrice-Cpwzdz7x.js";import{c as se,d as ie,e as ne,a as L,b as M,F as ae}from"./index.esm-C0lUfxbp.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},re={class:"bg-white rounded-xl shadow-xl w-full max-w-lg p-6 relative"},de={class:"text-xl font-semibold mb-4"},ue={key:0,class:"bg-red-100 text-red-700 p-3 rounded mb-4 text-sm"},ce={class:"mb-3"},pe={class:"error"},ve={class:"mb-3"},be={class:"error"},me={key:0,class:"mb-3"},fe={class:"error"},ye={class:"flex justify-end mt-6 gap-3"},ge=["disabled"],_e={__name:"QuoteTypeModal",props:{mode:String,type:String,item:Object},emits:["close","saved"],setup(C,{emit:P}){const a=C,g=P,u=o(!1),m=o(""),f=se({title_en:L().required("English title is required"),title_ar:L().required("Arabic title is required"),price:a.type==="building"?ie().nullable().min(0,"Price must be >= 0"):ne().nullable()}),_=o({title_en:"",title_ar:"",price:null});K(()=>a.item,n=>{if(!n)return;const i=y(n.title);_.value={title_en:i.en,title_ar:i.ar,price:n.price??null}},{immediate:!0});function y(n){if(!n)return{en:"",ar:""};try{const i=JSON.parse(n);return{en:i.en??"",ar:i.ar??""}}catch{return{en:"",ar:""}}}async function c(n){var p,x;u.value=!0,m.value="";const i=a.mode==="add"?{data:[{title:{en:n.title_en,ar:n.title_ar},price:a.type==="building"?n.price:null}]}:{data:{title:{en:n.title_en,ar:n.title_ar},price:a.type==="building"?n.price:null}};try{a.mode==="add"?a.type==="building"?await A.create(i):await B.create(i):a.type==="building"?await A.update(a.item.id,i):await B.update(a.item.id,i),g("saved"),g("close")}catch(k){console.error(k),m.value=((x=(p=k.response)==null?void 0:p.data)==null?void 0:x.message)||"Server error. Please try again."}finally{u.value=!1}}return(n,i)=>(r(),j(X,{to:"body"},[t("div",oe,[t("div",re,[t("button",{onClick:i[0]||(i[0]=p=>n.$emit("close")),class:"absolute top-3 right-4 text-gray-500 hover:text-black"}," ✕ "),t("h3",de,d(C.mode==="add"?"Add Item":"Edit Item"),1),m.value?(r(),b("div",ue,d(m.value),1)):h("",!0),T(w(ae),{onSubmit:c,"validation-schema":w(f)},{default:Q(({errors:p})=>[t("div",ce,[i[2]||(i[2]=t("label",{class:"label"},"Title (EN) *",-1)),T(w(M),{name:"title_en",class:"form-input"}),t("span",pe,d(p.title_en),1)]),t("div",ve,[i[3]||(i[3]=t("label",{class:"label"},"Title (AR) *",-1)),T(w(M),{name:"title_ar",class:"form-input",dir:"rtl"}),t("span",be,d(p.title_ar),1)]),C.type==="building"?(r(),b("div",me,[i[4]||(i[4]=t("label",{class:"label"},"Price",-1)),T(w(M),{name:"price",type:"number",class:"form-input"}),t("span",fe,d(p.price),1)])):h("",!0),t("div",ye,[t("button",{type:"button",onClick:i[1]||(i[1]=x=>n.$emit("close")),class:"px-4 py-2 border rounded"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",disabled:u.value},d(u.value?"Saving…":"Save"),9,ge)])]),_:1},8,["validation-schema"])])])]))}},he=z(_e,[["__scopeId","data-v-dcf869e4"]]),xe={class:"p-6 space-y-10"},ke={class:"bg-white p-4 rounded-xl shadow flex flex-wrap gap-4 items-center"},we={class:"ml-auto flex gap-3"},$e={class:"bg-white rounded-xl shadow p-6"},Ce={class:"min-w-full border text-sm"},Pe={class:"bg-gray-100"},Te={class:"table-header w-10 text-center"},Se=["checked"],Ae={class:"table-cell text-center"},Be=["value"],Ne={class:"table-cell font-medium text-gray-700"},Ee={class:"table-cell"},Ve={class:"font-semibold text-gray-900"},De={class:"text-gray-500 text-xs"},Fe={key:0,class:"table-cell"},Me={key:1,class:"table-cell text-gray-400"},je={class:"table-cell text-center"},Ie={class:"p-3 text-center"},Oe={class:"action-buttons"},qe=["onClick"],Ue=["onClick"],Le={class:"flex justify-between items-center mt-4"},Qe={class:"space-x-2"},ze=["disabled"],Je=["disabled"],Re={__name:"QuoteTypesPage",setup(C){const P=o([]),a=o([]),g=o(""),u=o(""),m=o(""),f=o(1),_=o(10),y=o({open:!1,mode:"add",type:null,item:null}),c=o([]),n=o({key:"id",dir:"desc"});function i(l){if(!l)return{en:"",ar:""};if(typeof l=="string")try{const e=JSON.parse(l);return{en:(e==null?void 0:e.en)??"",ar:(e==null?void 0:e.ar)??""}}catch{return{en:"",ar:""}}return{en:(l==null?void 0:l.en)??"",ar:(l==null?void 0:l.ar)??""}}function p(l){y.value={open:!0,mode:"add",type:l,item:null}}function x(l){y.value={open:!0,mode:"edit",type:l.type,item:l}}function k(l){confirm("Delete this item?")&&(l.type==="building"?A.remove(l.id):B.remove(l.id),V())}function J(l){l.target.checked?c.value=N.value.map(e=>e.uid):c.value=[]}function R(){confirm("Delete selected items?")&&(c.value.forEach(l=>{const e=N.value.find(s=>s.uid===l);k(e)}),c.value=[])}const N=S(()=>{const l=P.value.map(s=>({...s,type:"building",uid:"b"+s.id})),e=a.value.map(s=>({...s,type:"price",uid:"p"+s.id}));return[...l,...e]}),I=S(()=>{let l=N.value;if(u.value&&(l=l.filter(e=>e.type===u.value)),m.value==="has_price"&&(l=l.filter(e=>e.type==="building"&&e.price)),m.value==="no_price"&&(l=l.filter(e=>e.type==="building"&&!e.price)),g.value){const e=g.value.toLowerCase();l=l.filter(s=>{const v=i(s.title);return v.en.toLowerCase().includes(e)||v.ar.toLowerCase().includes(e)})}return l=[...l].sort((e,s)=>{let v=e[n.value.key],D=s[n.value.key];return n.value.key==="title"&&(v=i(e.title).en,D=i(s.title).en),n.value.dir==="asc"?v>D?1:-1:v<D?1:-1}),l}),O=S(()=>Math.ceil(I.value.length/_.value)),W=S(()=>{const l=(f.value-1)*_.value;return I.value.slice(l,l+_.value)});function E(l){n.value.key===l?n.value.dir=n.value.dir==="asc"?"desc":"asc":(n.value.key=l,n.value.dir="asc")}function G(){f.value<O.value&&f.value++}function H(){f.value>1&&f.value--}async function V(){P.value=await A.list(),a.value=await B.list()}return Y(V),(l,e)=>(r(),j(le,null,{default:Q(()=>[t("div",xe,[t("div",ke,[$(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),placeholder:"Search by EN/AR title…",class:"form-input w-64"},null,512),[[Z,g.value]]),$(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),class:"form-input w-40"},e[11]||(e[11]=[t("option",{value:""},"All Types",-1),t("option",{value:"building"},"Building",-1),t("option",{value:"price"},"Price",-1)]),512),[[F,u.value]]),u.value==="building"?$((r(),b("select",{key:0,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),class:"form-input w-40"},e[12]||(e[12]=[t("option",{value:""},"All",-1),t("option",{value:"has_price"},"With Price",-1),t("option",{value:"no_price"},"No Price",-1)]),512)),[[F,m.value]]):h("",!0),c.value.length?(r(),b("button",{key:1,onClick:R,class:"px-4 py-2 bg-red-600 text-white rounded"}," Delete Selected ("+d(c.value.length)+") ",1)):h("",!0),t("div",we,[t("button",{onClick:e[3]||(e[3]=s=>p("building")),class:"btn-green"},"+ Building"),t("button",{onClick:e[4]||(e[4]=s=>p("price")),class:"btn-blue"},"+ Price")])]),t("div",$e,[t("table",Ce,[t("thead",Pe,[t("tr",null,[t("th",Te,[t("input",{type:"checkbox",onChange:J,checked:l.allSelected},null,40,Se)]),t("th",{class:"table-header w-16 cursor-pointer",onClick:e[5]||(e[5]=s=>E("id"))}," ID "),t("th",{class:"table-header cursor-pointer",onClick:e[6]||(e[6]=s=>E("title"))}," Title "),u.value!=="price"?(r(),b("th",{key:0,class:"table-header w-24 cursor-pointer",onClick:e[7]||(e[7]=s=>E("price"))}," Price ")):h("",!0),e[13]||(e[13]=t("th",{class:"table-header w-24 text-center"},"Type",-1)),e[14]||(e[14]=t("th",{class:"table-header w-32 text-center"},"Actions",-1))])]),t("tbody",null,[(r(!0),b(q,null,U(W.value,s=>(r(),b("tr",{key:s.uid,class:"border-b hover:bg-gray-50 transition"},[t("td",Ae,[$(t("input",{type:"checkbox",value:s.uid,"onUpdate:modelValue":e[8]||(e[8]=v=>c.value=v)},null,8,Be),[[ee,c.value]])]),t("td",Ne,d(s.id),1),t("td",Ee,[t("div",Ve,d(i(s.title).en||"—"),1),t("div",De,d(i(s.title).ar||"—"),1)]),s.type==="building"?(r(),b("td",Fe,d(s.price??"—"),1)):u.value!=="price"?(r(),b("td",Me,"—")):h("",!0),t("td",je,[t("span",{class:te(["px-2 py-1 rounded text-xs font-medium",s.type==="building"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"])},d(s.type),3)]),t("td",Ie,[t("div",Oe,[t("button",{onClick:v=>x(s),class:"btn-edit"},"Edit",8,qe),t("button",{onClick:v=>k(s),class:"btn-delete"},"Delete",8,Ue)])])]))),128))])]),t("div",Le,[$(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>_.value=s),class:"form-input w-24"},[(r(),b(q,null,U([10,25,50],s=>t("option",{key:s},d(s),1)),64))],512),[[F,_.value]]),t("div",Qe,[t("button",{onClick:H,class:"btn-gray",disabled:f.value===1},"Prev",8,ze),t("button",{onClick:G,class:"btn-gray",disabled:f.value===O.value},"Next",8,Je)])])]),y.value.open?(r(),j(he,{key:0,mode:y.value.mode,type:y.value.type,item:y.value.item,onClose:e[10]||(e[10]=s=>y.value.open=!1),onSaved:V},null,8,["mode","type","item"])):h("",!0)])]),_:1}))}},Ye=z(Re,[["__scopeId","data-v-2e99d989"]]);export{Ye as default};
