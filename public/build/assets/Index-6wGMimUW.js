import{k as V,l as U,p as ee,c as te,o as p,w as D,b as t,f as m,h as $,F as I,q as M,e as g,t as f,a as L,u as E,S as N,d as ne,j as x,s as w,y as ae}from"./app-BJ7Yrijg.js";import{_ as se}from"./AuthenticatedLayout-byBFqb7B.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";function le(n){try{return typeof n=="string"?JSON.parse(n):n}catch{return n}}function J(n){const r=le(n);return r&&typeof r=="object"?{en:r.en??"",ar:r.ar??""}:{en:r??"",ar:r??""}}function B(n){var r;return Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.message)?n.message:Array.isArray((r=n==null?void 0:n.data)==null?void 0:r.data)?n.data.data:[]}function ie(n){return(n==null?void 0:n.data)??(n==null?void 0:n.message)??n}function T(n){return n?`/storage/${n}`:""}function H(n){return n?String(n).slice(0,10):""}function O(n={}){const r=J(n.name),d=J(n.description),_=Array.isArray(n.home_unit_gallery)?n.home_unit_gallery.map(l=>({id:l.id??void 0,image:l.image,image_url:T(l.image)})):Array.isArray(n.gallery)?n.gallery.map(l=>({id:l.id??void 0,image:l.image,image_url:T(l.image)})):[];return{...n,name_en:r.en,name_ar:r.ar,description_en:d.en,description_ar:d.ar,location:n.location??"",lat:n.lat??null,long:n.long??null,start_date:H(n.start_date),end_date:H(n.end_date),status:n.status??"",user_id:n.user_id??null,vendor_id:n.vendor_id??null,cover_image_url:T(n.cover_image),gallery:_}}const P={list:async(n={})=>{const{data:r}=await V.get("/api/units",{params:n});return B(r).map(O)},listByUser:async(n,r={})=>{const{data:d}=await V.get(`/api/units/user/${n}`,{params:r});return B(d).map(O)},listByVendor:async(n,r={})=>{const{data:d}=await V.get(`/api/units/vendor/${n}`,{params:r});return B(d).map(O)},show:async n=>{const{data:r}=await V.get(`/api/units/show/${n}`);return O(ie(r))},create:async n=>{const{data:r}=await V.post("/api/units/create",n,{headers:{"Content-Type":"multipart/form-data"}});return r},update:async(n,r)=>{const{data:d}=await V.post(`/api/units/update/${n}`,r,{headers:{"Content-Type":"multipart/form-data"}});return d},remove:async n=>{const{data:r}=await V.delete(`/api/units/delete/${n}`);return r}};function oe({name:n={en:"",ar:""},description:r={en:"",ar:""},location:d,lat:_,long:l,start_date:s,end_date:b,cover_image:h,gallery:q=[],user_id:v,vendor_id:k,status:C,...S}){const u=new FormData;return u.append("name[en]",n.en??""),u.append("name[ar]",n.ar??""),u.append("description[en]",r.en??""),u.append("description[ar]",r.ar??""),u.append("location",d??""),u.append("lat",String(_??"")),u.append("long",String(l??"")),u.append("start_date",s??""),u.append("end_date",b??""),h&&u.append("cover_image",h),(q||[]).forEach(o=>o&&u.append("gallery[]",o)),u.append("user_id",String(v??"")),u.append("vendor_id",String(k??"")),C&&u.append("status",C),Object.entries(S).forEach(([o,y])=>{y!=null&&y!==""&&u.append(o,y)}),u}function de(n={}){const{name:r,description:d,location:_,lat:l,long:s,start_date:b,end_date:h,cover_image:q,gallery:v,user_id:k,vendor_id:C,status:S,...u}=n,o=new FormData;return r&&(r.en!==void 0&&o.append("name[en]",r.en??""),r.ar!==void 0&&o.append("name[ar]",r.ar??"")),d&&(d.en!==void 0&&o.append("description[en]",d.en??""),d.ar!==void 0&&o.append("description[ar]",d.ar??"")),_!==void 0&&o.append("location",_??""),l!==void 0&&o.append("lat",String(l??"")),s!==void 0&&o.append("long",String(s??"")),b!==void 0&&o.append("start_date",b??""),h!==void 0&&o.append("end_date",h??""),q&&o.append("cover_image",q),Array.isArray(v)&&v.length&&v.forEach(y=>y&&o.append("gallery[]",y)),k!==void 0&&o.append("user_id",String(k??"")),C!==void 0&&o.append("vendor_id",String(C??"")),S!==void 0&&S!==""&&o.append("status",S),Object.entries(u).forEach(([y,j])=>{j!=null&&j!==""&&o.append(y,j)}),o}const ue={class:"p-6 space-y-6"},ce={class:"bg-white shadow rounded-lg p-4"},pe={key:0,class:"text-sm text-gray-500"},me={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ve={class:"aspect-[4/3] bg-white flex items-center justify-center"},ge=["src"],fe={key:1,class:"text-gray-400 text-sm"},xe={class:"p-3 space-y-2"},_e={class:"font-semibold truncate"},be={key:0,class:"text-gray-400"},ye={class:"text-xs text-gray-500"},we={class:"text-xs text-gray-500"},he={class:"text-xs text-gray-500"},ke={class:"grid grid-cols-3 gap-2 pt-2 text-xs"},Ue={class:"flex gap-2 pt-2"},qe=["onClick"],Ae=["onClick"],Ce={key:0,class:"col-span-full text-center text-gray-500 py-8"},Se={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},Ve={class:"bg-white rounded-2xl shadow-lg w-full max-w-3xl p-5 relative"},De={class:"text-lg font-bold mb-4"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je=["required"],Le=["required"],Ee={class:"md:col-span-2"},Ne=["required"],Pe={class:"md:col-span-2"},Re=["required"],Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Fe=["required"],Ie=["required"],Me=["required"],Be=["required"],Te=["required"],Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4"},ze=["required"],Je=["required"],He={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Ke={class:"block text-xs text-gray-500 mb-1"},Qe=["required"],We={key:0,class:"mt-2"},Xe=["src"],Ye=["required"],Ze={key:0,class:"mt-2 flex flex-wrap gap-2"},et=["src"],tt={class:"mt-5 flex items-center gap-3"},nt=["disabled"],at={key:0,class:"text-sm text-red-600 mt-2"},st={key:1,class:"mt-2 text-sm text-red-600 list-disc pl-6"},rt={__name:"Index",setup(n){const r=U([]),d=U(!1),_=U(!1),l=U(null),s=U({name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]}),b=U(null),h=U([]),q=U(!1),v=U(""),k=U({});function C(i){return`/units-management/${i}/docs`}function S(i){return`/units-management/${i}/drawing`}function u(i){return`/units-management/${i}/gallery`}function o(i){return`/units-management/${i}/timeline`}function y(i){return`/units-management/${i}/reports`}function j(i){return`/units-management/${i}/phases`}function G(){s.value={name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]},b.value=null,h.value=[],v.value="",k.value={},l.value=null}function K(){G(),_.value=!0}async function Q(i){G(),l.value=i.id;const e=await P.show(i.id);s.value.name.en=e.name_en||"",s.value.name.ar=e.name_ar||"",s.value.description.en=e.description_en||"",s.value.description.ar=e.description_ar||"",s.value.location=e.location||"",s.value.lat=e.lat,s.value.long=e.long,s.value.start_date=e.start_date||"",s.value.end_date=e.end_date||"",s.value.user_id=e.user_id??null,s.value.vendor_id=e.vendor_id??null,s.value.status=e.status||"",b.value=e.cover_image_url||null,_.value=!0}function F(){_.value=!1}function W(i){var a;const e=((a=i.target.files)==null?void 0:a[0])||null;s.value.cover_image=e,b.value=e?URL.createObjectURL(e):b.value}function X(i){const e=Array.from(i.target.files||[]);s.value.gallery=e,h.value=e.map(a=>URL.createObjectURL(a))}async function R(){d.value=!0;try{r.value=await P.list()}finally{d.value=!1}}async function Y(){var i,e,a,A,z;q.value=!0,v.value="",k.value={};try{if(l.value){const c=de(s.value);await P.update(l.value,c)}else{const c=oe(s.value);await P.create(c)}await R(),F()}catch(c){((i=c==null?void 0:c.response)==null?void 0:i.status)===422&&((a=(e=c==null?void 0:c.response)==null?void 0:e.data)!=null&&a.errors)?(k.value=c.response.data.errors,v.value=c.response.data.message||"Validation error"):v.value=((z=(A=c==null?void 0:c.response)==null?void 0:A.data)==null?void 0:z.message)||(c==null?void 0:c.message)||"Request failed"}finally{q.value=!1}}async function Z(i){confirm(`Delete unit #${i.id}?`)&&(await P.remove(i.id),await R())}return ee(R),(i,e)=>(p(),te(se,null,{default:D(()=>[t("div",ue,[t("div",{class:"flex items-center justify-between"},[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Units",-1)),t("button",{onClick:K,class:"inline-flex items-center rounded-md bg-gray-800 px-4 py-2 text-xs font-semibold uppercase tracking-widest text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"}," + Add Unit ")]),t("div",ce,[t("div",{class:"flex items-center justify-between mb-3"},[e[13]||(e[13]=t("h3",{class:"text-lg font-bold"},"All Units",-1)),t("button",{onClick:R,class:"px-3 py-1 border rounded"},"Refresh")]),d.value?(p(),m("div",pe,"Loading…")):(p(),m("div",me,[(p(!0),m(I,null,M(r.value,a=>(p(),m("div",{key:a.id,class:"rounded border overflow-hidden bg-gray-50"},[t("div",ve,[a.cover_image_url?(p(),m("img",{key:0,src:a.cover_image_url,class:"w-full h-full object-cover"},null,8,ge)):(p(),m("div",fe,"No Cover"))]),t("div",xe,[t("div",_e,[g(f(a.name_en||"—")+" ",1),a.name_ar?(p(),m("span",be,"/")):$("",!0),g(" "+f(a.name_ar),1)]),t("div",ye,[e[14]||(e[14]=t("span",{class:"font-medium"},"Location:",-1)),g(" "+f(a.location||"—"),1)]),t("div",we,[e[15]||(e[15]=t("span",{class:"font-medium"},"Period:",-1)),g(" "+f(a.start_date||"—")+" → "+f(a.end_date||"—"),1)]),t("div",he,[e[16]||(e[16]=t("span",{class:"font-medium"},"Status:",-1)),g(" "+f(a.status||"—"),1)]),t("div",ke,[L(E(N),{href:C(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[17]||(e[17]=[g(" Docs ")])),_:2},1032,["href"]),L(E(N),{href:u(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[18]||(e[18]=[g(" Gallery ")])),_:2},1032,["href"]),L(E(N),{href:S(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[19]||(e[19]=[g(" Drawing ")])),_:2},1032,["href"]),L(E(N),{href:y(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[20]||(e[20]=[g(" Reports ")])),_:2},1032,["href"]),L(E(N),{href:j(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[21]||(e[21]=[g(" Phases ")])),_:2},1032,["href"]),L(E(N),{href:o(a.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:D(()=>e[22]||(e[22]=[g(" TimeLine ")])),_:2},1032,["href"])]),t("div",Ue,[t("button",{class:"px-3 py-1 border rounded text-sm",onClick:A=>Q(a)},"Edit",8,qe),t("button",{class:"px-3 py-1 border rounded text-sm text-red-600",onClick:A=>Z(a)},"Delete",8,Ae)])])]))),128)),r.value.length?$("",!0):(p(),m("div",Ce," No units found. "))]))]),_.value?(p(),m("div",Se,[t("div",Ve,[t("button",{onClick:F,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600"},"✕"),t("h3",De,f(l.value?"Edit Unit":"Add Unit"),1),t("form",{onSubmit:ne(Y,["prevent"])},[t("div",$e,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN)*",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name.en=a),class:"form-input",type:"text",required:!l.value},null,8,je),[[w,s.value.name.en]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR)*",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.name.ar=a),class:"form-input",type:"text",required:!l.value},null,8,Le),[[w,s.value.name.ar]])]),t("div",Ee,[e[25]||(e[25]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)*",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.description.en=a),class:"form-input",type:"text",required:!l.value},null,8,Ne),[[w,s.value.description.en]])]),t("div",Pe,[e[26]||(e[26]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)*",-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.description.ar=a),class:"form-input",type:"text",required:!l.value},null,8,Re),[[w,s.value.description.ar]])])]),t("div",Oe,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Location*",-1)),x(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.location=a),class:"form-input",type:"text",required:!l.value},null,8,Fe),[[w,s.value.location]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Latitude (-90..90)*",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.lat=a),class:"form-input",type:"number",step:"any",min:"-90",max:"90",required:!l.value},null,8,Ie),[[w,s.value.lat,void 0,{number:!0}]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Longitude (-180..180)*",-1)),x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.long=a),class:"form-input",type:"number",step:"any",min:"-180",max:"180",required:!l.value},null,8,Me),[[w,s.value.long,void 0,{number:!0}]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Start Date*",-1)),x(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.start_date=a),class:"form-input",type:"date",required:!l.value},null,8,Be),[[w,s.value.start_date]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-xs text-gray-500 mb-1"},"End Date* (>= start)",-1)),x(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.end_date=a),class:"form-input",type:"date",required:!l.value},null,8,Te),[[w,s.value.end_date]])])]),t("div",Ge,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-xs text-gray-500 mb-1"},"User ID*",-1)),x(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.user_id=a),class:"form-input",type:"number",min:"1",required:!l.value},null,8,ze),[[w,s.value.user_id,void 0,{number:!0}]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Vendor ID*",-1)),x(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.vendor_id=a),class:"form-input",type:"number",min:"1",required:!l.value},null,8,Je),[[w,s.value.vendor_id,void 0,{number:!0}]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),x(t("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.status=a),class:"form-input"},e[34]||(e[34]=[t("option",{value:""},"(none)",-1),t("option",{value:"under_construction"},"under_construction",-1),t("option",{value:"completed"},"completed",-1)]),512),[[ae,s.value.status]])])]),t("div",He,[t("div",null,[t("label",Ke,"Cover Image* "+f(l.value?"(optional to replace)":""),1),t("input",{type:"file",accept:"image/*",onChange:W,required:!l.value},null,40,Qe),b.value?(p(),m("div",We,[t("img",{src:b.value,class:"w-40 h-28 object-cover rounded border"},null,8,Xe)])):$("",!0)]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Gallery* (multiple on create)",-1)),t("input",{type:"file",accept:"image/*",multiple:"",onChange:X,required:!l.value},null,40,Ye),h.value.length?(p(),m("div",Ze,[(p(!0),m(I,null,M(h.value,(a,A)=>(p(),m("img",{key:A,src:a,class:"w-24 h-16 object-cover rounded border"},null,8,et))),128))])):$("",!0)])]),t("div",tt,[t("button",{disabled:q.value,class:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-60"},f(q.value?"Saving…":l.value?"Update":"Create"),9,nt),t("button",{type:"button",class:"px-3 py-2 border rounded",onClick:F},"Cancel")]),v.value?(p(),m("div",at,f(v.value),1)):$("",!0),Object.keys(k.value).length?(p(),m("ul",st,[(p(!0),m(I,null,M(k.value,(a,A)=>(p(),m("li",{key:A},[t("strong",null,f(A)+":",1),g(" "+f(a.join(", ")),1)]))),128))])):$("",!0)],32)])])):$("",!0)])]),_:1}))}},ut=re(rt,[["__scopeId","data-v-68d03167"]]);export{ut as default};
