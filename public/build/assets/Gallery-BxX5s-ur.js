import{k as U,i as B,l as y,m as F,p as G,c as L,o as c,w as O,b as t,j as g,s as x,f as p,h as D,F as I,q as S,t as h}from"./app-BDxSfDqD.js";import{_ as J}from"./AuthenticatedLayout-B0GFBMmA.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";function z(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return a}}function P(a){var s;return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.message)?a.message:Array.isArray((s=a==null?void 0:a.data)==null?void 0:s.data)?a.data.data:[]}function H(a){return a?`/storage/${a}`:""}function K(a={}){const s=z(a.title),i=s&&typeof s=="object"?s:{en:s??"",ar:s??""};return{id:a.id,unit_id:a.unit_id,folder_id:a.folder_id,date:a.date??"",image:a.image??"",image_url:H(a.image),title_en:i.en??"",title_ar:i.ar??"",created_at:a.created_at,updated_at:a.updated_at}}const $={list:async a=>{const{data:s}=await U.get(`/api/unit-gallery/${a}`);return P(s).map(K)},create:async a=>{const{data:s}=await U.post("/api/unit-gallery/create",a,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async a=>{const{data:s}=await U.post("/api/unit-gallery/update",a,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async a=>{const{data:s}=await U.delete(`/api/unit-gallery/delete/${a}`);return s}};function Q(a,s=[]){const i=new FormData;return i.append("unit_id",String(a)),s.forEach((l,o)=>{var f,m;i.append(`data[${o}][folder_id]`,String(l.folder_id??"")),i.append(`data[${o}][date]`,l.date??""),i.append(`data[${o}][title][en]`,((f=l==null?void 0:l.title)==null?void 0:f.en)??""),i.append(`data[${o}][title][ar]`,((m=l==null?void 0:l.title)==null?void 0:m.ar)??""),l.image&&i.append(`data[${o}][image]`,l.image)}),i}function W(a,s=[]){const i=new FormData;return i.append("unit_id",String(a)),s.forEach((l,o)=>{var f,m;i.append(`data[${o}][id]`,String(l.id??"")),i.append(`data[${o}][folder_id]`,String(l.folder_id??"")),l.date!==void 0&&i.append(`data[${o}][date]`,l.date??""),((f=l==null?void 0:l.title)==null?void 0:f.en)!==void 0&&i.append(`data[${o}][title][en]`,l.title.en??""),((m=l==null?void 0:l.title)==null?void 0:m.ar)!==void 0&&i.append(`data[${o}][title][ar]`,l.title.ar??""),l.image&&i.append(`data[${o}][image]`,l.image)}),i}const X={class:"p-6 space-y-6"},Y={class:"flex items-center justify-between"},Z=["href"],ee={class:"bg-white p-4 rounded shadow"},te={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ae={class:"mt-4"},le={key:0,class:"mt-3 flex flex-wrap gap-2"},ne=["src"],se={class:"mt-4 flex items-center gap-3"},ie=["disabled"],de={key:0,class:"text-red-600 text-sm"},re={class:"bg-white p-4 rounded shadow"},oe={key:0,class:"text-sm text-gray-500"},ue={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"},ce={class:"aspect-[4/3] bg-white flex items-center justify-center"},pe=["src"],fe={key:1,class:"text-gray-400 text-sm"},me={class:"p-2 space-y-2 text-xs"},ve={class:"flex items-center justify-between"},_e={class:"text-gray-500"},ge=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],be=["onUpdate:modelValue"],he={class:"text-[11px]"},ke=["onChange"],we={class:"flex gap-2 pt-1"},Ue=["onClick","disabled"],$e=["onClick"],Ce={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ve={__name:"Gallery",props:{unitId:{type:[Number,String],required:!0}},setup(a){const s=a,i=B(()=>"/units"),l=y({folder_id:null,date:"",title:{en:"",ar:""}}),o=y([]),f=y([]),m=y(!1),k=y("");function j(d){const e=Array.from(d.target.files||[]);o.value=e,f.value=e.map(r=>URL.createObjectURL(r))}async function N(){var d,e;m.value=!0,k.value="";try{const r=o.value.map(n=>({folder_id:l.value.folder_id,date:l.value.date,title:{...l.value.title},image:n})),_=Q(s.unitId,r);await $.create(_),await b(),o.value=[],f.value=[],l.value.title={en:"",ar:""}}catch(r){console.error(r),k.value=((e=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Upload failed"}finally{m.value=!1}}const C=y([]),V=y(!1),v=F({}),A=F({}),w=F({});function E(d){d.forEach(e=>{v[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function b(){V.value=!0;try{const d=await $.list(s.unitId);C.value=d,E(d)}finally{V.value=!1}}function T(d,e){var _;const r=((_=e.target.files)==null?void 0:_[0])||null;r&&(A[d]=r)}async function R(d){var r,_;const e=v[d];if(e){w[d]=!0;try{const n=[{id:d,folder_id:e.folder_id,date:e.date,title:e.title,image:A[d]}],u=W(s.unitId,n);await $.update(u),delete A[d],await b()}catch(n){console.error(n),alert(((_=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:_.message)||"Update failed")}finally{w[d]=!1}}}async function q(d){confirm("Delete this image?")&&(await $.remove(d),await b())}return G(b),(d,e)=>(c(),L(J,null,{default:O(()=>{var r,_;return[t("div",X,[t("div",Y,[e[4]||(e[4]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Gallery",-1)),t("a",{href:i.value,class:"px-3 py-1 border rounded"},"Back to Units",8,Z)]),t("div",ee,[e[9]||(e[9]=t("h3",{class:"text-lg font-bold mb-3"},"Add Images",-1)),t("div",te,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Folder ID *",-1)),g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.folder_id=n),class:"form-input",type:"number",min:"1",required:""},null,512),[[x,l.value.folder_id,void 0,{number:!0}]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.date=n),class:"form-input",type:"date",required:""},null,512),[[x,l.value.date]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[x,l.value.title.en]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[x,l.value.title.ar]])])]),t("div",ae,[t("input",{type:"file",multiple:"",accept:"image/*",onChange:j},null,32),f.value.length?(c(),p("div",le,[(c(!0),p(I,null,S(f.value,(n,u)=>(c(),p("img",{key:u,src:n,class:"w-24 h-16 object-cover rounded border"},null,8,ne))),128))])):D("",!0)]),t("div",se,[t("button",{disabled:m.value||!o.value.length||!l.value.folder_id||!l.value.date||!((r=l.value.title.en)!=null&&r.trim())||!((_=l.value.title.ar)!=null&&_.trim()),onClick:N,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},h(m.value?"Uploading…":"Upload"),9,ie),k.value?(c(),p("span",de,h(k.value),1)):D("",!0)])]),t("div",re,[t("div",{class:"flex items-center justify-between mb-3"},[e[10]||(e[10]=t("h3",{class:"text-lg font-bold"},"Images",-1)),t("button",{onClick:b,class:"px-3 py-1 border rounded"},"Refresh")]),V.value?(c(),p("div",oe,"Loading…")):(c(),p("div",ue,[(c(!0),p(I,null,S(C.value,n=>(c(),p("div",{key:n.id,class:"rounded border overflow-hidden bg-gray-50"},[t("div",ce,[n.image_url?(c(),p("img",{key:0,src:n.image_url,class:"w-full h-full object-cover"},null,8,pe)):(c(),p("div",fe,"No Image"))]),t("div",me,[t("div",ve,[t("span",null,"#"+h(n.id),1),t("span",_e,"Folder: "+h(n.folder_id),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-[11px] text-gray-500"},"Date",-1)),g(t("input",{"onUpdate:modelValue":u=>v[n.id].date=u,class:"form-input",type:"date"},null,8,ge),[[x,v[n.id].date]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-[11px] text-gray-500"},"Folder ID",-1)),g(t("input",{"onUpdate:modelValue":u=>v[n.id].folder_id=u,class:"form-input",type:"number",min:"1"},null,8,xe),[[x,v[n.id].folder_id,void 0,{number:!0}]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),g(t("input",{"onUpdate:modelValue":u=>v[n.id].title.en=u,class:"form-input",type:"text"},null,8,ye),[[x,v[n.id].title.en]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),g(t("input",{"onUpdate:modelValue":u=>v[n.id].title.ar=u,class:"form-input",type:"text"},null,8,be),[[x,v[n.id].title.ar]])]),t("div",he,[e[15]||(e[15]=t("label",{class:"block text-gray-500"},"Replace Image",-1)),t("input",{type:"file",accept:"image/*",onChange:u=>T(n.id,u)},null,40,ke)]),t("div",we,[t("button",{class:"px-2 py-1 border rounded",onClick:u=>R(n.id),disabled:w[n.id]},h(w[n.id]?"Saving…":"Save"),9,Ue),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:u=>q(n.id)}," Delete ",8,$e)])])]))),128)),C.value.length?D("",!0):(c(),p("div",Ce," No images found. "))]))])])]}),_:1}))}},Ie=M(Ve,[["__scopeId","data-v-3e1e59aa"]]);export{Ie as default};
