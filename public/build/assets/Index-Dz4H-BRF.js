import{p as c,i as R,q as U,c as j,o as p,w as q,b as e,j as z,f as y,h as S,k as K,F as G,s as H,t as u,u as a,a as s}from"./app-4D-wkT_p.js";import{_ as J}from"./AuthenticatedLayout-CCBjItTP.js";import{c as m,a as o,F as Q,b as r,E as i}from"./index.esm-BzR9PCIV.js";import{C as b,b as W,a as X}from"./contractors-B5EdDnHq.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"p-6 space-y-6"},ee={class:"bg-white rounded-xl shadow border overflow-hidden"},te={class:"w-full text-sm"},ae={class:"px-4 py-3"},se=["src"],ne={class:"px-4 py-3"},le={class:"px-4 py-3"},oe={class:"px-4 py-3 text-right space-x-2"},re=["onClick"],ie=["onClick"],ce={class:"flex justify-between"},de={class:"space-x-2"},pe=["disabled"],ue=["disabled"],me={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},_e={class:"bg-white w-full max-w-2xl rounded-xl p-6"},ve={class:"text-lg font-semibold mb-4"},xe={class:"grid grid-cols-2 gap-4"},A=10,he={__name:"Index",setup(fe){const N=c([]),_=c(""),d=c(1),v=c(!1),x=c(!1),g=c(null),h=c(null),C=c(0),w=c({}),I=m({title:m({en:o().required(),ar:o().required()}),description:m({en:o().required(),ar:o().required()}),email:o().email().required(),company_phone:o().nullable(),representative_phone:o().nullable(),company_address:m({en:o().nullable(),ar:o().nullable()}),representative_name:m({en:o().nullable(),ar:o().nullable()})});async function k(){N.value=await b.list()}const D=R(()=>N.value.filter(t=>{var n,l;return((n=t.email)==null?void 0:n.toLowerCase().includes(_.value.toLowerCase()))||((l=t.title_en)==null?void 0:l.toLowerCase().includes(_.value.toLowerCase()))})),F=R(()=>Math.ceil(D.value.length/A)),L=R(()=>D.value.slice((d.value-1)*A,d.value*A));function M(){x.value=!1,g.value=null,w.value={title:{en:"",ar:""},description:{en:"",ar:""},email:"",company_phone:"",representative_phone:"",company_address:{en:"",ar:""},representative_name:{en:"",ar:""}},h.value=null,C.value++,v.value=!0}function V(t){x.value=!0,g.value=t.id,w.value={title:{en:t.title_en,ar:t.title_ar},description:{en:t.description_en,ar:t.description_ar},email:t.email,company_phone:t.company_phone||"",representative_phone:t.representative_phone||"",company_address:t.company_address||{en:"",ar:""},representative_name:t.representative_name||{en:"",ar:""}},h.value=null,C.value++,v.value=!0}function P(){v.value=!1}function B(t){var n;h.value=((n=t.target.files)==null?void 0:n[0])||null}async function T(t){var l,f,$;const n={email:t.email,title:{en:t.title.en||"",ar:t.title.ar||""},description:{en:t.description.en||"",ar:t.description.ar||""},company_phone:t.company_phone||"",representative_phone:t.representative_phone||"",company_address:t.company_address||{en:"",ar:""},representative_name:t.representative_name||{en:"",ar:""},image:h.value};try{x.value?await b.update(g.value,W(n)):await b.create(X([n])),P(),k()}catch(E){console.error("SAVE ERROR",((l=E.response)==null?void 0:l.data)||E),alert((($=(f=E.response)==null?void 0:f.data)==null?void 0:$.message)||"Save failed")}}async function O(t){confirm("Delete contractor?")&&(await b.remove(t),k())}return U(k),(t,n)=>(p(),j(J,null,{default:q(()=>[e("div",Z,[e("div",{class:"flex justify-between items-center"},[n[3]||(n[3]=e("h2",{class:"text-2xl font-bold"},"Contractors",-1)),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:M}," + Add Contractor ")]),z(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>_.value=l),placeholder:"Search title or email",class:"form-input w-72"},null,512),[[K,_.value]]),e("div",ee,[e("table",te,[n[4]||(n[4]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Image"),e("th",{class:"px-4 py-3"},"Title (EN)"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(p(!0),y(G,null,H(L.value,l=>(p(),y("tr",{key:l.id,class:"border-t"},[e("td",ae,[l.image_url?(p(),y("img",{key:0,src:l.image_url,class:"w-16 h-12 object-cover rounded"},null,8,se)):S("",!0)]),e("td",ne,u(l.title_en),1),e("td",le,u(l.email),1),e("td",oe,[e("button",{class:"text-blue-600",onClick:f=>V(l)},"Details",8,re),e("button",{class:"text-red-600",onClick:f=>O(l.id)},"Delete",8,ie)])]))),128))])])]),e("div",ce,[e("span",null,"Page "+u(d.value)+" of "+u(F.value),1),e("div",de,[e("button",{onClick:n[1]||(n[1]=l=>d.value--),disabled:d.value===1},"Prev",8,pe),e("button",{onClick:n[2]||(n[2]=l=>d.value++),disabled:d.value===F.value},"Next",8,ue)])]),v.value?(p(),y("div",me,[e("div",_e,[e("h3",ve,u(x.value?"Edit Contractor":"Add Contractor"),1),(p(),j(a(Q),{key:C.value,"validation-schema":a(I),"initial-values":w.value,onSubmit:T},{default:q(()=>[e("div",xe,[s(a(r),{name:"title.en",class:"form-input",placeholder:"Title (EN)"}),s(a(i),{name:"title.en",class:"text-red-500 text-xs"}),s(a(r),{name:"title.ar",class:"form-input",placeholder:"Title (AR)"}),s(a(i),{name:"title.ar",class:"text-red-500 text-xs"}),s(a(r),{name:"email",type:"email",class:"form-input col-span-2",placeholder:"Email"}),s(a(i),{name:"email",class:"text-red-500 text-xs col-span-2"}),s(a(r),{name:"description.en",as:"textarea",class:"form-input col-span-2",placeholder:"Description (EN)"}),s(a(i),{name:"description.en",class:"text-red-500 text-xs col-span-2"}),s(a(r),{name:"description.ar",as:"textarea",class:"form-input col-span-2",placeholder:"Description (AR)"}),s(a(i),{name:"description.ar",class:"text-red-500 text-xs col-span-2"}),s(a(r),{name:"company_phone",class:"form-input",placeholder:"Company Phone"}),s(a(i),{name:"company_phone",class:"text-red-500 text-xs"}),s(a(r),{name:"representative_phone",class:"form-input",placeholder:"Representative Phone"}),s(a(i),{name:"representative_phone",class:"text-red-500 text-xs"}),s(a(r),{name:"company_address.en",class:"form-input",placeholder:"Company Address (EN)"}),s(a(i),{name:"company_address.en",class:"text-red-500 text-xs"}),s(a(r),{name:"company_address.ar",class:"form-input",placeholder:"Company Address (AR)"}),s(a(i),{name:"company_address.ar",class:"text-red-500 text-xs"}),s(a(r),{name:"representative_name.en",class:"form-input",placeholder:"Representative Name (EN)"}),s(a(i),{name:"representative_name.en",class:"text-red-500 text-xs"}),s(a(r),{name:"representative_name.ar",class:"form-input",placeholder:"Representative Name (AR)"}),s(a(i),{name:"representative_name.ar",class:"text-red-500 text-xs"}),e("input",{type:"file",accept:"image/*",onChange:B,class:"col-span-2"},null,32)]),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{type:"button",class:"border px-4 py-2",onClick:P},"Cancel"),n[5]||(n[5]=e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values"]))])])):S("",!0)])]),_:1}))}},ke=Y(he,[["__scopeId","data-v-471c31e6"]]);export{ke as default};
