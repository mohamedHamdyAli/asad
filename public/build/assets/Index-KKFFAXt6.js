import{i as ae,p as I,A as se,q as ie,I as Y,f,o as g,h as A,b as r,t as _,m as L,a as O,u as M,g as Ie,w as F,F as B,s as Q,e as N,S as G,z as Pe,d as $e,j,n as $,k as R,y as ee}from"./app-ClThdbk1.js";import{_ as je}from"./AuthenticatedLayout-CMtBQwfm.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{U as De}from"./users-DuqugwAu.js";import{V as Oe}from"./vendors-DOJO8FgP.js";function Le(t,n,l,d){function o(m){return m instanceof l?m:new l(function(p){p(m)})}return new(l||(l=Promise))(function(m,p){function h(w){try{x(d.next(w))}catch(k){p(k)}}function q(w){try{x(d.throw(w))}catch(k){p(k)}}function x(w){w.done?m(w.value):o(w.value).then(h,q)}x((d=d.apply(t,[])).next())})}function Ne(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var te,ue;function Re(){return ue||(ue=1,te=function t(n,l){if(n===l)return!0;if(n&&l&&typeof n=="object"&&typeof l=="object"){if(n.constructor!==l.constructor)return!1;var d,o,m;if(Array.isArray(n)){if(d=n.length,d!=l.length)return!1;for(o=d;o--!==0;)if(!t(n[o],l[o]))return!1;return!0}if(n.constructor===RegExp)return n.source===l.source&&n.flags===l.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===l.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===l.toString();if(m=Object.keys(n),d=m.length,d!==Object.keys(l).length)return!1;for(o=d;o--!==0;)if(!Object.prototype.hasOwnProperty.call(l,m[o]))return!1;for(o=d;o--!==0;){var p=m[o];if(!t(n[p],l[p]))return!1}return!0}return n!==n&&l!==l}),te}var Me=Re(),Fe=Ne(Me);const ce="__googleMapsScriptId";var Z;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(Z||(Z={}));class z{constructor({apiKey:n,authReferrerPolicy:l,channel:d,client:o,id:m=ce,language:p,libraries:h=[],mapIds:q,nonce:x,region:w,retries:k=3,url:U="https://maps.googleapis.com/maps/api/js",version:b}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=n,this.authReferrerPolicy=l,this.channel=d,this.client=o,this.id=m||ce,this.language=p,this.libraries=h,this.mapIds=q,this.nonce=x,this.region=w,this.retries=k,this.url=U,this.version=b,z.instance){if(!Fe(this.options,z.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(z.instance.options)}`);return z.instance}z.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Z.FAILURE:this.done?Z.SUCCESS:this.loading?Z.LOADING:Z.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let n=this.url;return n+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(n+=`&key=${this.apiKey}`),this.channel&&(n+=`&channel=${this.channel}`),this.client&&(n+=`&client=${this.client}`),this.libraries.length>0&&(n+=`&libraries=${this.libraries.join(",")}`),this.language&&(n+=`&language=${this.language}`),this.region&&(n+=`&region=${this.region}`),this.version&&(n+=`&v=${this.version}`),this.mapIds&&(n+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(n+=`&auth_referrer_policy=${this.authReferrerPolicy}`),n}deleteScript(){const n=document.getElementById(this.id);n&&n.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((n,l)=>{this.loadCallback(d=>{d?l(d.error):n(window.google)})})}importLibrary(n){return this.execute(),google.maps.importLibrary(n)}loadCallback(n){this.callbacks.push(n),this.execute()}setScript(){var n,l;if(document.getElementById(this.id)){this.callback();return}const d={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(d).forEach(m=>!d[m]&&delete d[m]),!((l=(n=window==null?void 0:window.google)===null||n===void 0?void 0:n.maps)===null||l===void 0)&&l.importLibrary||(m=>{let p,h,q,x="The Google Maps JavaScript API",w="google",k="importLibrary",U="__ib__",b=document,v=window;v=v[w]||(v[w]={});const E=v.maps||(v.maps={}),P=new Set,c=new URLSearchParams,y=()=>p||(p=new Promise((u,i)=>Le(this,void 0,void 0,function*(){var C;yield h=b.createElement("script"),h.id=this.id,c.set("libraries",[...P]+"");for(q in m)c.set(q.replace(/[A-Z]/g,D=>"_"+D[0].toLowerCase()),m[q]);c.set("callback",w+".maps."+U),h.src=this.url+"?"+c,E[U]=u,h.onerror=()=>p=i(Error(x+" could not load.")),h.nonce=this.nonce||((C=b.querySelector("script[nonce]"))===null||C===void 0?void 0:C.nonce)||"",b.head.append(h)})));E[k]?console.warn(x+" only loads once. Ignoring:",m):E[k]=(u,...i)=>P.add(u)&&y().then(()=>E[k](u,...i))})(d);const o=this.libraries.map(m=>this.importLibrary(m));o.length||o.push(this.importLibrary("core")),Promise.all(o).then(()=>this.callback(),m=>{const p=new ErrorEvent("error",{error:m});this.loadErrorCallback(p)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(n){if(this.errors.push(n),this.errors.length<=this.retries){const l=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${l} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},l)}else this.onerrorEvent=n,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(n=>{n(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const Ve={class:"space-y-2"},Te={key:0,class:"block text-xs text-gray-500"},Ge={class:"flex gap-2"},Ke=["placeholder"],ze={__name:"MapPicker",props:{label:{type:String,default:"Select location"},searchPlaceholder:{type:String,default:"Search place…"},lat:{type:[Number,String],default:null},lng:{type:[Number,String],default:null},address:{type:String,default:""},fallbackCenter:{type:Object,default:()=>({lat:30.0444,lng:31.2357})},zoom:{type:Number,default:13},apiKey:{type:String,default:"AIzaSyD6l04ETuUP7BfQ7MqpL2vMWEalLxNj0d4"}},emits:["update:lat","update:lng","update:address"],setup(t,{emit:n}){const l=t,d=n,o=c=>{if(typeof c=="number")return Number.isFinite(c)?c:null;if(c===""||c==null)return null;const y=Number(c);return Number.isFinite(y)?y:null};ae(()=>{const c=o(l.lat);return c==null?"-":c.toFixed(6)}),ae(()=>{const c=o(l.lng);return c==null?"-":c.toFixed(6)});const m=I(null),p=I(null);let h,q,x,w,k=null;function U({lat:c,lng:y,address:u}){c!=null&&d("update:lat",c),y!=null&&d("update:lng",y),u!==void 0&&d("update:address",u)}function b(c,y){return new Promise(u=>{if(!w)return u("");w.geocode({location:{lat:c,lng:y}},(i,C)=>{C==="OK"&&i&&i.length?u(i[0].formatted_address||""):u("")})})}async function v(){try{k=await new z({apiKey:l.apiKey,version:"weekly",libraries:["places"]}).load()}catch(i){console.error("Google Maps failed to load:",i);return}w=new k.maps.Geocoder;const c=o(l.lat),y=o(l.lng),u=c!=null&&y!=null?{lat:c,lng:y}:l.fallbackCenter;h=new k.maps.Map(m.value,{center:u,zoom:l.zoom,mapTypeControl:!1,streetViewControl:!1}),q=new k.maps.Marker({position:u,map:h,draggable:!0}),h.addListener("click",i=>{const C=i.latLng;E(C.lat(),C.lng(),!0)}),q.addListener("dragend",()=>{const i=q.getPosition();E(i.lat(),i.lng(),!0)});try{x=new k.maps.places.Autocomplete(p.value,{fields:["geometry","formatted_address","name"]}),x.addListener("place_changed",()=>{var V;const i=x.getPlace();if(!((V=i==null?void 0:i.geometry)!=null&&V.location))return;const C=i.geometry.location;h.panTo(C),h.setZoom(15);const D=i.formatted_address||i.name||"";E(C.lat(),C.lng(),!1,D)})}catch{}if(c!=null&&y!=null&&!l.address){const i=await b(c,y);U({address:i||""})}}async function E(c,y,u=!0,i=""){if(!(!q||!h)){if(q.setPosition({lat:c,lng:y}),h.panTo({lat:c,lng:y}),U({lat:c,lng:y}),i)U({address:i});else if(u){const C=await b(c,y);U({address:C||""})}}}se(()=>[l.lat,l.lng],([c,y])=>{if(!h)return;const u=o(c),i=o(y);u==null||i==null||(q.setPosition({lat:u,lng:i}),h.panTo({lat:u,lng:i}))});function P(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{const{latitude:y,longitude:u}=c.coords;E(y,u,!0),h&&h.setZoom(15)},()=>{},{enableHighAccuracy:!0,timeout:8e3})}return ie(async()=>{await Y(),await v()}),(c,y)=>(g(),f("div",Ve,[t.label?(g(),f("label",Te,_(t.label),1)):A("",!0),r("div",Ge,[r("input",{ref_key:"searchEl",ref:p,type:"text",class:"form-input flex-1",placeholder:t.searchPlaceholder},null,8,Ke),r("button",{type:"button",class:"px-3 py-2 border rounded",onClick:P},"📍")]),r("div",{ref_key:"mapEl",ref:m,class:"rounded border",style:{height:"320px"}},null,512)]))}},Be=ge(ze,[["__scopeId","data-v-c24049d5"]]);function Ze(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function pe(t){const n=Ze(t);return n&&typeof n=="object"?{en:n.en??"",ar:n.ar??""}:{en:n??"",ar:n??""}}function re(t){var n;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((n=t==null?void 0:t.data)==null?void 0:n.data)?t.data.data:[]}function Je(t){return(t==null?void 0:t.data)??(t==null?void 0:t.message)??t}function ne(t){return t?`/storage/${t}`:""}function fe(t){return t?String(t).slice(0,10):""}function X(t={}){const n=pe(t.name),l=pe(t.description),d=Array.isArray(t.home_unit_gallery)?t.home_unit_gallery.map(o=>({id:o.id??void 0,image:o.image,image_url:ne(o.image)})):Array.isArray(t.gallery)?t.gallery.map(o=>({id:o.id??void 0,image:o.image,image_url:ne(o.image)})):[];return{...t,name_en:n.en,name_ar:n.ar,description_en:l.en,description_ar:l.ar,location:t.location??"",lat:t.lat??null,long:t.long??null,start_date:fe(t.start_date),end_date:fe(t.end_date),status:t.status??"",user_id:t.user_id??null,vendor_id:t.vendor_id??null,cover_image_url:ne(t.cover_image),gallery:d}}const K={list:async(t={})=>{const{data:n}=await L.get("/api/units",{params:t});return re(n).map(X)},listByUser:async(t,n={})=>{const{data:l}=await L.get(`/api/units/user/${t}`,{params:n});return re(l).map(X)},listByVendor:async(t,n={})=>{const{data:l}=await L.get(`/api/units/vendor/${t}`,{params:n});return re(l).map(X)},show:async t=>{const{data:n}=await L.get(`/api/units/show/${t}`);return X(Je(n))},create:async t=>{const{data:n}=await L.post("/api/units/create",t,{headers:{"Content-Type":"multipart/form-data"}});return n},update:async(t,n)=>{const{data:l}=await L.post(`/api/units/update/${t}`,n,{headers:{"Content-Type":"multipart/form-data"}});return l},remove:async t=>{const{data:n}=await L.delete(`/api/units/delete/${t}`);return n},deleteCover:async t=>{const{data:n}=await L.delete(`/api/units/${t}/cover`);return n},deleteGalleryImage:async(t,n)=>{const{data:l}=await L.delete(`/api/units/${t}/gallery/${n}`);return l}};function He({name:t={en:"",ar:""},description:n={en:"",ar:""},location:l,lat:d,long:o,start_date:m,end_date:p,cover_image:h,gallery:q=[],user_id:x,vendor_id:w,status:k,...U}){const b=new FormData;return b.append("name[en]",t.en??""),b.append("name[ar]",t.ar??""),b.append("description[en]",n.en??""),b.append("description[ar]",n.ar??""),b.append("location",l??""),b.append("lat",String(d??"")),b.append("long",String(o??"")),b.append("start_date",m??""),b.append("end_date",p??""),h&&b.append("cover_image",h),(q||[]).forEach((v,E)=>{v&&b.append(`gallery[${E}]`,v)}),b.append("user_id",String(x??"")),b.append("vendor_id",String(w??"")),k&&b.append("status",k),Object.entries(U).forEach(([v,E])=>{E!=null&&E!==""&&b.append(v,E)}),b}function Qe(t={}){const{name:n,description:l,location:d,lat:o,long:m,start_date:p,end_date:h,cover_image:q,gallery:x,user_id:w,vendor_id:k,status:U,...b}=t,v=new FormData;return n&&(n.en!==void 0&&v.append("name[en]",n.en??""),n.ar!==void 0&&v.append("name[ar]",n.ar??"")),l&&(l.en!==void 0&&v.append("description[en]",l.en??""),l.ar!==void 0&&v.append("description[ar]",l.ar??"")),d!==void 0&&v.append("location",d??""),o!==void 0&&v.append("lat",String(o??"")),m!==void 0&&v.append("long",String(m??"")),p!==void 0&&v.append("start_date",p??""),h!==void 0&&v.append("end_date",h??""),q&&v.append("cover_image",q),Array.isArray(x)&&x.length&&x.forEach((E,P)=>{E&&v.append(`gallery[${P}]`,E)}),w!==void 0&&v.append("user_id",String(w??"")),k!==void 0&&v.append("vendor_id",String(k??"")),U!==void 0&&U!==""&&v.append("status",U),Object.entries(b).forEach(([E,P])=>{P!=null&&P!==""&&v.append(E,P)}),v}const We={class:"p-6 space-y-6"},Xe={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},Ye={key:0,class:"text-sm text-gray-500"},et={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-5"},tt={class:"relative aspect-[4/3] bg-gray-50"},rt=["src"],nt={key:1,class:"absolute inset-0 flex items-center justify-center text-gray-400 text-sm"},at={class:"absolute top-2 left-2 flex flex-wrap gap-2"},st={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},it={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},lt={class:"p-3.5 space-y-3"},ot={class:"text-sm font-semibold text-gray-900 whitespace-pre-wrap break-words"},dt={key:0,class:"text-gray-400"},ut={dir:"rtl"},ct={class:"text-xs text-gray-500"},pt={class:"grid grid-cols-3 gap-2 pt-2 text-xs"},ft={class:"flex gap-2 pt-2"},gt=["onClick"],mt=["onClick"],vt={key:0,class:"col-span-full text-center text-gray-500 py-8"},ht={class:"relative mx-auto w-full max-w-3xl p-4 sm:p-6 h-full flex items-center justify-center"},yt={class:"bg-white rounded-2xl shadow-lg w-full max-h-[min(88vh,900px)] overflow-y-auto focus:outline-none",role:"dialog","aria-modal":"true"},bt={class:"sticky top-0 z-10 bg-white border-b rounded-t-2xl"},_t={class:"flex items-center justify-between px-5 py-3"},xt={class:"text-lg font-bold"},wt={class:"px-5 py-4 space-y-4"},kt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Et=["required"],St={key:0,class:"mt-1 text-xs text-red-600"},Ct=["required"],qt={key:0,class:"mt-1 text-xs text-red-600"},At={class:"md:col-span-2"},Ut=["required"],It={key:0,class:"mt-1 text-xs text-red-600"},Pt={class:"md:col-span-2"},$t=["required"],jt={key:0,class:"mt-1 text-xs text-red-600"},Dt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={class:"md:col-span-2"},Lt=["required"],Nt={key:0,class:"mt-1 text-xs text-red-600"},Rt=["required"],Mt={key:0,class:"mt-1 text-xs text-red-600"},Ft=["required"],Vt={key:0,class:"mt-1 text-xs text-red-600"},Tt=["required"],Gt={key:0,class:"mt-1 text-xs text-red-600"},Kt=["required"],zt={key:0,class:"mt-1 text-xs text-red-600"},Bt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Zt=["required"],Jt=["value"],Ht={key:0,class:"mt-1 text-xs text-red-600"},Qt=["required"],Wt=["value"],Xt={key:0,class:"mt-1 text-xs text-red-600"},Yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},er={class:"block text-xs text-gray-500 mb-1"},tr=["required"],rr={key:0,class:"mt-1 text-xs text-red-600"},nr={key:1,class:"mt-2 relative inline-block"},ar=["src"],sr=["required"],ir={key:0,class:"mt-1 text-xs text-red-600"},lr={key:1,class:"mt-2 flex flex-wrap gap-2"},or=["src"],dr=["onClick"],ur={key:2,class:"mt-2 flex flex-wrap gap-2"},cr=["src"],pr=["onClick"],fr={key:0,class:"rounded border border-red-200 bg-red-50 text-red-700 px-3 py-2"},gr={class:"sticky bottom-0 z-10 bg-white border-t rounded-b-2xl"},mr={class:"px-5 py-3 flex items-center gap-3"},vr=["disabled"],hr={__name:"Index",setup(t){const n=ae(()=>!u.value),l=I({}),d=(a,e)=>{if(!e||Array.isArray(e)&&e.length===0){delete l.value[a];return}l.value[a]=Array.isArray(e)?e:[String(e)]},o=a=>{var e;return((e=l.value[a])==null?void 0:e[0])||""},m=a=>!!l.value[a],p=a=>["form-input",m(a)?"border-red-400 focus:ring-red-500":""];function h(){const a=document.querySelector(".max-h-\\[min\\(88vh\\,900px\\)\\]"),e=a==null?void 0:a.querySelector("input.border-red-400, select.border-red-400, textarea.border-red-400");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}function q(){l.value={},T.value="";const a=i.value,e=s=>s!=null&&String(s).trim()!=="";return n.value?(e(a.name.en)||d("name.en","Name (EN) is required"),e(a.name.ar)||d("name.ar","Name (AR) is required"),e(a.description.en)||d("description.en","Description (EN) is required"),e(a.description.ar)||d("description.ar","Description (AR) is required"),e(a.location)||d("location","Location is required"),typeof a.lat=="number"&&a.lat>=-90&&a.lat<=90||d("lat","Latitude must be between -90 and 90"),typeof a.long=="number"&&a.long>=-180&&a.long<=180||d("long","Longitude must be between -180 and 180"),e(a.start_date)||d("start_date","Start date is required"),e(a.end_date)||d("end_date","End date is required"),e(a.start_date)&&e(a.end_date)&&new Date(a.end_date)<new Date(a.start_date)&&d("end_date","End date must be after or equal to start date"),e(a.user_id)||d("user_id","User is required"),e(a.vendor_id)||d("vendor_id","Vendor is required"),a.cover_image||d("cover_image","Cover image is required"),(!Array.isArray(a.gallery)||a.gallery.length===0)&&d("gallery","Add at least one gallery image")):(a.lat!==null&&(a.lat<-90||a.lat>90)&&d("lat","Latitude must be between -90 and 90"),a.long!==null&&(a.long<-180||a.long>180)&&d("long","Longitude must be between -180 and 180"),e(a.start_date)&&e(a.end_date)&&new Date(a.end_date)<new Date(a.start_date)&&d("end_date","End date must be after or equal to start date")),Object.keys(l.value).length?(T.value="Please fix the highlighted fields.",!1):!0}const x=I([]);async function w(a){confirm("Delete this image?")&&(await K.deleteGalleryImage(u.value,a),x.value=x.value.filter(e=>e.id!==a))}async function k(){confirm("Delete cover image?")&&(await K.deleteCover(u.value),C.value=null)}function U(a){var s,S,W,de;const e=(S=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:S.errors;if(!e)return!1;l.value={};for(const[Ae,Ue]of Object.entries(e))d(Ae,Ue);return T.value=((de=(W=a==null?void 0:a.response)==null?void 0:W.data)==null?void 0:de.message)||"Validation failed. Please review the fields below.",!0}const b=I([]),v=I([]);async function E(){const a=await De.list();b.value=a.map(s=>({id:s.id,name:s.name,email:s.email}));const e=await Oe.list();v.value=e.map(s=>({id:s.id,name:s.name,email:s.email}))}ie(async()=>{await Promise.all([H(),E()])});const P=I([]),c=I(!1),y=I(!1),u=I(null),i=I({name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]}),C=I(null),D=I([]),V=I(!1),T=I(""),me=I({});function ve(a){return`/units-management/${a}/docs`}function he(a){return`/units-management/${a}/drawing`}function ye(a){return`/units-management/${a}/gallery`}function be(a){return`/units-management/${a}/timeline`}function _e(a){return`/units-management/${a}/reports`}function xe(a){return`/units-management/${a}/contractors`}function we(a){return`/units-management/${a}/phases`}function le(){i.value={name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"under_construction",cover_image:null,gallery:[]},C.value=null,D.value=[],T.value="",me.value={},u.value=null}function ke(){le(),y.value=!0}async function Ee(a){le(),u.value=a.id;const e=await K.show(a.id);i.value.name.en=e.name_en||"",i.value.name.ar=e.name_ar||"",i.value.description.en=e.description_en||"",i.value.description.ar=e.description_ar||"",i.value.location=e.location||"",i.value.lat=e.lat,i.value.long=e.long,i.value.start_date=e.start_date||"",i.value.end_date=e.end_date||"",i.value.user_id=e.user_id??null,i.value.vendor_id=e.vendor_id??null,i.value.status=e.status||"",C.value=e.cover_image_url||null,i.value.cover_image=null,x.value=Array.isArray(e.gallery)?e.gallery:[],D.value=[],i.value.gallery=[],y.value=!0}se(()=>y.value,async a=>{a&&await Y()}),se(()=>y.value,a=>{document.body.style.overflow=a?"hidden":""});function J(){y.value=!1}function Se(a){var s;const e=((s=a.target.files)==null?void 0:s[0])||null;i.value.cover_image=e,C.value=e?URL.createObjectURL(e):C.value}function Ce(a){const e=Array.from(a.target.files||[]);i.value.gallery=e,D.value=e.map(s=>URL.createObjectURL(s))}async function H(){c.value=!0;try{P.value=await K.list()}finally{c.value=!1}}async function oe(){var a,e,s;V.value=!0;try{if(!q()){await Y(),h();return}if(u.value){const S=Qe(i.value);await K.update(u.value,S)}else{const S=He(i.value);await K.create(S)}await H(),J()}catch(S){((a=S==null?void 0:S.response)==null?void 0:a.status)===422&&U(S)?(await Y(),h()):T.value=((s=(e=S==null?void 0:S.response)==null?void 0:e.data)==null?void 0:s.message)||(S==null?void 0:S.message)||"Request failed"}finally{V.value=!1}}async function qe(a){confirm(`Delete unit #${a.id}?`)&&(await K.remove(a.id),await H())}return ie(H),(a,e)=>(g(),f(B,null,[O(M(Ie),{title:"Units"}),O(je,null,{default:F(()=>[r("div",We,[r("div",{class:"flex items-center justify-between"},[e[15]||(e[15]=r("h2",{class:"text-2xl font-bold text-dash-title"},"Units",-1)),r("button",{onClick:ke,class:"bg-black text-white px-3 py-2 rounded hover:bg-gray-700 disabled:opacity-50"}," + Add Unit ")]),r("div",Xe,[r("div",{class:"flex items-center justify-between mb-4"},[e[16]||(e[16]=r("h3",{class:"text-lg font-semibold text-gray-800"},"All Units",-1)),r("button",{onClick:H,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),c.value?(g(),f("div",Ye,"Loading…")):(g(),f("div",et,[(g(!0),f(B,null,Q(P.value,s=>(g(),f("div",{key:s.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[r("div",tt,[s.cover_image_url?(g(),f("img",{key:0,src:s.cover_image_url,class:"absolute inset-0 w-full h-full object-cover",alt:""},null,8,rt)):(g(),f("div",nt," No Cover ")),e[17]||(e[17]=r("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1)),r("div",at,[r("span",st,_(s.status||"—"),1),r("span",it,_(s.location||"No location"),1)])]),r("div",lt,[r("div",ot,[N(_(s.name_en||"—")+" ",1),s.name_ar?(g(),f("span",dt," / ")):A("",!0),r("span",ut,_(s.name_ar),1)]),r("div",ct,[e[18]||(e[18]=r("span",{class:"font-medium"},"Period:",-1)),N(" "+_(s.start_date||"—")+" → "+_(s.end_date||"—"),1)]),r("div",pt,[O(M(G),{href:ve(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[19]||(e[19]=[N(" Docs ")])),_:2},1032,["href"]),O(M(G),{href:ye(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[20]||(e[20]=[N(" Gallery ")])),_:2},1032,["href"]),O(M(G),{href:he(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[21]||(e[21]=[N(" Drawing ")])),_:2},1032,["href"]),O(M(G),{href:_e(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[22]||(e[22]=[N(" Reports ")])),_:2},1032,["href"]),O(M(G),{href:we(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[23]||(e[23]=[N(" Phases ")])),_:2},1032,["href"]),O(M(G),{href:be(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[24]||(e[24]=[N(" Timeline ")])),_:2},1032,["href"]),O(M(G),{href:xe(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:F(()=>e[25]||(e[25]=[N(" Assignments ")])),_:2},1032,["href"])]),r("div",ft,[r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50",onClick:S=>Ee(s)}," Edit ",8,gt),r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:S=>qe(s)}," Delete ",8,mt)])])]))),128)),P.value.length?A("",!0):(g(),f("div",vt," No units found. "))]))]),y.value?(g(),f("div",{key:0,class:"fixed inset-0 z-50",onKeydown:Pe(J,["esc"])},[r("div",{class:"absolute inset-0 bg-black/40 back-drop",onClick:J,"aria-hidden":"true"}),r("div",ht,[r("div",yt,[r("div",bt,[r("div",_t,[r("h3",xt,_(u.value?"Edit Unit":"Add Unit"),1),r("button",{onClick:J,class:"text-gray-400 hover:text-gray-600","aria-label":"Close"}," ✕ ")])]),r("div",wt,[r("form",{onSubmit:$e(oe,["prevent"]),class:"space-y-4"},[r("div",kt,[r("div",null,[e[26]||(e[26]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN)*",-1)),j(r("input",{class:$(p("name.en")),"onUpdate:modelValue":e[0]||(e[0]=s=>i.value.name.en=s),type:"text",required:!u.value},null,10,Et),[[R,i.value.name.en]]),o("name.en")?(g(),f("p",St,_(o("name.en")),1)):A("",!0)]),r("div",null,[e[27]||(e[27]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR)*",-1)),j(r("input",{class:$(p("name.ar")),"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.name.ar=s),type:"text",required:!u.value},null,10,Ct),[[R,i.value.name.ar]]),o("name.ar")?(g(),f("p",qt,_(o("name.ar")),1)):A("",!0)]),r("div",At,[e[28]||(e[28]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)*",-1)),j(r("textarea",{class:$(p("description.en")),"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.description.en=s),type:"text",required:!u.value},null,10,Ut),[[R,i.value.description.en]]),o("description.en")?(g(),f("p",It,_(o("description.en")),1)):A("",!0)]),r("div",Pt,[e[29]||(e[29]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)*",-1)),j(r("textarea",{class:$(p("description.ar")),"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.description.ar=s),type:"text",required:!u.value},null,10,$t),[[R,i.value.description.ar]]),o("description.ar")?(g(),f("p",jt,_(o("description.ar")),1)):A("",!0)])]),r("div",Dt,[r("div",Ot,[O(Be,{label:"Pick on map",lat:i.value.lat,"onUpdate:lat":e[4]||(e[4]=s=>i.value.lat=s),lng:i.value.long,"onUpdate:lng":e[5]||(e[5]=s=>i.value.long=s),address:i.value.location,"onUpdate:address":e[6]||(e[6]=s=>i.value.location=s)},null,8,["lat","lng","address"])]),r("div",null,[e[30]||(e[30]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Location*",-1)),j(r("input",{class:$(p("location")),"onUpdate:modelValue":e[7]||(e[7]=s=>i.value.location=s),type:"text",required:!u.value,disabled:""},null,10,Lt),[[R,i.value.location]]),o("location")?(g(),f("p",Nt,_(o("location")),1)):A("",!0)]),r("div",null,[e[31]||(e[31]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Latitude (-90..90)*",-1)),j(r("input",{class:$(p("lat")),"onUpdate:modelValue":e[8]||(e[8]=s=>i.value.lat=s),type:"number",step:"any",min:"-90",max:"90",required:!u.value,disabled:""},null,10,Rt),[[R,i.value.lat,void 0,{number:!0}]]),o("lat")?(g(),f("p",Mt,_(o("lat")),1)):A("",!0)]),r("div",null,[e[32]||(e[32]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Longitude (-180..180)*",-1)),j(r("input",{class:$(p("long")),"onUpdate:modelValue":e[9]||(e[9]=s=>i.value.long=s),type:"number",step:"any",min:"-180",max:"180",required:!u.value,disabled:""},null,10,Ft),[[R,i.value.long,void 0,{number:!0}]]),o("long")?(g(),f("p",Vt,_(o("long")),1)):A("",!0)]),r("div",null,[e[33]||(e[33]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Start Date*",-1)),j(r("input",{class:$(p("start_date")),"onUpdate:modelValue":e[10]||(e[10]=s=>i.value.start_date=s),type:"date",required:!u.value},null,10,Tt),[[R,i.value.start_date]]),o("start_date")?(g(),f("p",Gt,_(o("start_date")),1)):A("",!0)]),r("div",null,[e[34]||(e[34]=r("label",{class:"block text-xs text-gray-500 mb-1"},"End Date*",-1)),j(r("input",{class:$(p("end_date")),"onUpdate:modelValue":e[11]||(e[11]=s=>i.value.end_date=s),type:"date",required:!u.value},null,10,Kt),[[R,i.value.end_date]]),o("end_date")?(g(),f("p",zt,_(o("end_date")),1)):A("",!0)])]),r("div",Bt,[r("div",null,[e[36]||(e[36]=r("label",{class:"block text-xs text-gray-500 mb-1"},"User *",-1)),j(r("select",{class:$(p("user_id")),"onUpdate:modelValue":e[12]||(e[12]=s=>i.value.user_id=s),required:!u.value},[e[35]||(e[35]=r("option",{value:"",disabled:""},"Select a user",-1)),(g(!0),f(B,null,Q(b.value,s=>(g(),f("option",{key:s.id,value:s.id},_(s.name)+" — "+_(s.email),9,Jt))),128))],10,Zt),[[ee,i.value.user_id,void 0,{number:!0}]]),o("user_id")?(g(),f("p",Ht,_(o("user_id")),1)):A("",!0)]),r("div",null,[e[38]||(e[38]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Project Manager *",-1)),j(r("select",{class:$(p("vendor_id")),"onUpdate:modelValue":e[13]||(e[13]=s=>i.value.vendor_id=s),required:!u.value},[e[37]||(e[37]=r("option",{value:"",disabled:""},"Select a Project Manager",-1)),(g(!0),f(B,null,Q(v.value,s=>(g(),f("option",{key:s.id,value:s.id},_(s.name)+" — "+_(s.email),9,Wt))),128))],10,Qt),[[ee,i.value.vendor_id,void 0,{number:!0}]]),o("vendor_id")?(g(),f("p",Xt,_(o("vendor_id")),1)):A("",!0)]),r("div",null,[e[40]||(e[40]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),j(r("select",{class:"form-input","onUpdate:modelValue":e[14]||(e[14]=s=>i.value.status=s)},e[39]||(e[39]=[r("option",{value:"under_construction",selected:""},"under_construction",-1),r("option",{value:"completed"},"completed",-1)]),512),[[ee,i.value.status]])])]),r("div",Yt,[r("div",null,[r("label",er," Cover Image* "+_(u.value?"(optional to replace)":""),1),r("input",{class:$(p("cover_image")),type:"file",accept:"image/*",onChange:Se,required:!u.value},null,42,tr),o("cover_image")?(g(),f("p",rr,_(o("cover_image")),1)):A("",!0),C.value?(g(),f("div",nr,[r("img",{src:C.value,class:"w-40 h-28 object-cover rounded border"},null,8,ar),r("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow hover:bg-red-600",onClick:k}," ✕ ")])):A("",!0)]),r("div",null,[e[41]||(e[41]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Gallery* (multiple on create)",-1)),r("input",{class:$(p("gallery")),type:"file",accept:"image/*",multiple:"",onChange:Ce,required:!u.value},null,42,sr),o("gallery")?(g(),f("p",ir,_(o("gallery")),1)):A("",!0),x.value.length?(g(),f("div",lr,[(g(!0),f(B,null,Q(x.value,s=>(g(),f("div",{key:s.id,class:"relative inline-block"},[r("img",{src:s.image_url,class:"w-24 h-16 object-cover rounded border"},null,8,or),r("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center shadow hover:bg-red-600",onClick:S=>w(s.id)}," ✕ ",8,dr)]))),128))])):A("",!0),D.value.length?(g(),f("div",ur,[(g(!0),f(B,null,Q(D.value,(s,S)=>(g(),f("div",{key:S,class:"relative inline-block"},[r("img",{src:s,class:"w-24 h-16 object-cover rounded border"},null,8,cr),r("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center shadow hover:bg-red-600",onClick:W=>D.value.splice(S,1)}," ✕ ",8,pr)]))),128))])):A("",!0)])]),T.value?(g(),f("div",fr,_(T.value),1)):A("",!0)],32)]),r("div",gr,[r("div",mr,[r("button",{disabled:V.value,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60",onClick:oe},_(V.value?"Saving…":u.value?"Update":"Create"),9,vr),r("button",{type:"button",class:"px-3 py-2 border rounded",onClick:J},"Cancel")])])])])],32)):A("",!0)])]),_:1})],64))}},kr=ge(hr,[["__scopeId","data-v-a37ec0d6"]]);export{kr as default};
