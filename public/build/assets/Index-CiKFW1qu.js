import{p as d,i as E,q as U,c as k,o as u,w as I,b as e,j as K,f as x,h as R,k as G,F as H,s as J,t as v,u as t,a as n,z as Q}from"./app-BBiZH3yc.js";import{_ as W}from"./AuthenticatedLayout-Dh040IqW.js";import{c as _,a as X,b as o,F as Y,d as l,E as i}from"./index.esm-CB2IKpq3.js";import{C as g,b as Z,a as ee}from"./contractors-CEPMCDeu.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"p-6 space-y-6"},se={class:"bg-white rounded-xl shadow border overflow-hidden"},ne={class:"w-full text-sm"},re={class:"px-4 py-3"},ie=["src"],oe={class:"px-4 py-3"},le={class:"px-4 py-3"},de={class:"px-4 py-3 text-right space-x-2"},ce=["onClick"],pe=["onClick"],ue={class:"flex justify-between"},me={class:"space-x-2"},ve=["disabled"],_e=["disabled"],he={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},fe={class:"bg-white w-full max-w-2xl rounded-xl p-6 max-h-[85vh] overflow-y-auto"},ye={class:"text-lg font-semibold mb-4"},xe={class:"grid grid-cols-2 gap-4"},ge={class:"col-span-2"},be={class:"col-span-2"},Ce={class:"col-span-2"},we={class:"col-span-2"},qe=["onChange"],A=10,Ee={__name:"Index",setup(ke){const{show:S}=Q(),N=d([]),h=d(""),c=d(1),f=d(!1),m=d(!1),b=d(null),y=d(null),C=d(0),w=d({}),L=_({title:_({en:o().required("EN title is required"),ar:o().required("AR title is required")}),description:_({en:o().required("English description is required"),ar:o().required("Arabic description is required")}),email:o().email().required("Email is required"),company_phone:o().required("Company phone is required"),representative_phone:o().required("Representative phone is required"),company_address:_({en:o().required("EN address is required"),ar:o().required("AR address is required")}),representative_name:_({en:o().required("EN representative name is required"),ar:o().required("AR representative name is required")}),image:X().test("required-on-create","Image is required",function(a){const{isCreate:s}=this.options.context||{};return s?a instanceof File:!0})});async function q(){N.value=await g.list()}const F=E(()=>N.value.filter(a=>{var s,r;return((s=a.email)==null?void 0:s.toLowerCase().includes(h.value.toLowerCase()))||((r=a.title_en)==null?void 0:r.toLowerCase().includes(h.value.toLowerCase()))})),D=E(()=>Math.ceil(F.value.length/A)),M=E(()=>F.value.slice((c.value-1)*A,c.value*A));function V(){m.value=!1,b.value=null,w.value={title:{en:"",ar:""},description:{en:"",ar:""},email:"",company_phone:"",representative_phone:"",company_address:{en:"",ar:""},representative_name:{en:"",ar:""},image:null},y.value=null,C.value++,f.value=!0}function B(a){m.value=!0,b.value=a.id,w.value={title:{en:a.title_en,ar:a.title_ar},description:{en:a.description_en,ar:a.description_ar},email:a.email,company_phone:a.company_phone||"",representative_phone:a.representative_phone||"",company_address:a.company_address||{en:"",ar:""},representative_name:a.representative_name||{en:"",ar:""},image:null},y.value=null,C.value++,f.value=!0}function $(){f.value=!1}function T(a){var s;y.value=((s=a.target.files)==null?void 0:s[0])||null}async function z(a){var r;const s={email:a.email,title:{en:a.title.en||"",ar:a.title.ar||""},description:{en:a.description.en||"",ar:a.description.ar||""},company_phone:a.company_phone||"",representative_phone:a.representative_phone||"",company_address:a.company_address||{en:"",ar:""},representative_name:a.representative_name||{en:"",ar:""},image:y.value};try{m.value?await g.update(b.value,Z(s)):await g.create(ee([s])),$(),q()}catch(p){console.error("SAVE ERROR",((r=p.response)==null?void 0:r.data)||p),S(p)}}async function O(a){confirm("Delete contractor?")&&(await g.remove(a),q())}return U(q),(a,s)=>(u(),k(W,null,{default:I(()=>[e("div",te,[e("div",{class:"flex justify-between items-center"},[s[3]||(s[3]=e("h2",{class:"text-2xl font-bold"},"Contractors",-1)),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:V}," + Add Contractor ")]),K(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>h.value=r),placeholder:"Search title or email",class:"form-input w-72"},null,512),[[G,h.value]]),e("div",se,[e("table",ne,[s[4]||(s[4]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Image"),e("th",{class:"px-4 py-3"},"Title (EN)"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(u(!0),x(H,null,J(M.value,r=>(u(),x("tr",{key:r.id,class:"border-t"},[e("td",re,[r.image_url?(u(),x("img",{key:0,src:r.image_url,class:"w-16 h-12 object-cover rounded"},null,8,ie)):R("",!0)]),e("td",oe,v(r.title_en),1),e("td",le,v(r.email),1),e("td",de,[e("button",{class:"text-blue-600",onClick:p=>B(r)},"Edit",8,ce),e("button",{class:"text-red-600",onClick:p=>O(r.id)},"Delete",8,pe)])]))),128))])])]),e("div",ue,[e("span",null,"Page "+v(c.value)+" of "+v(D.value),1),e("div",me,[e("button",{onClick:s[1]||(s[1]=r=>c.value--),disabled:c.value===1},"Prev",8,ve),e("button",{onClick:s[2]||(s[2]=r=>c.value++),disabled:c.value===D.value},"Next",8,_e)])]),f.value?(u(),x("div",he,[e("div",fe,[e("h3",ye,v(m.value?"Edit Contractor":"Add Contractor"),1),(u(),k(t(Y),{ref:"formRef","validate-on-mount":!1,key:C.value,"validation-schema":t(L),"initial-values":w.value,"validation-context":{isCreate:!m.value},onSubmit:z},{default:I(({setFieldValue:r,submitCount:p})=>[e("div",xe,[e("div",null,[n(t(l),{name:"title.en",class:"form-input",placeholder:"Title (EN)"}),n(t(i),{name:"title.en",class:"error"})]),e("div",null,[n(t(l),{name:"title.ar",class:"form-input",placeholder:"Title (AR)"}),n(t(i),{name:"title.ar",class:"error"})]),e("div",ge,[n(t(l),{name:"email",type:"email",class:"form-input",placeholder:"Email"}),n(t(i),{name:"email",class:"error"})]),e("div",be,[n(t(l),{name:"description.en",as:"textarea",class:"form-input",placeholder:"Description (EN)"}),n(t(i),{name:"description.en",class:"error"})]),e("div",Ce,[n(t(l),{name:"description.ar",as:"textarea",class:"form-input",placeholder:"Description (AR)"}),n(t(i),{name:"description.ar",class:"error"})]),e("div",null,[n(t(l),{name:"company_phone",class:"form-input",placeholder:"Company Phone"}),n(t(i),{name:"company_phone",class:"error"})]),e("div",null,[n(t(l),{name:"representative_phone",class:"form-input",placeholder:"Representative Phone"}),n(t(i),{name:"representative_phone",class:"error"})]),e("div",null,[n(t(l),{name:"company_address.en",class:"form-input",placeholder:"Company Address (EN)"}),n(t(i),{name:"company_address.en",class:"error"})]),e("div",null,[n(t(l),{name:"company_address.ar",class:"form-input",placeholder:"Company Address (AR)"}),n(t(i),{name:"company_address.ar",class:"error"})]),e("div",null,[n(t(l),{name:"representative_name.en",class:"form-input",placeholder:"Representative Name (EN)"}),n(t(i),{name:"representative_name.en",class:"error"})]),e("div",null,[n(t(l),{name:"representative_name.ar",class:"form-input",placeholder:"Representative Name (AR)"}),n(t(i),{name:"representative_name.ar",class:"error"})]),e("div",we,[e("input",{type:"file",accept:"image/*",onChange:P=>{var j;T(P),r("image",((j=P.target.files)==null?void 0:j[0])||null)}},null,40,qe),p>0?(u(),k(t(i),{key:0,name:"image",class:"error"})):R("",!0)])]),e("div",{class:"flex justify-end gap-2 mt-6"},[e("button",{type:"button",class:"border px-4 py-2 rounded",onClick:$}," Cancel "),s[5]||(s[5]=e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values","validation-context"]))])])):R("",!0)])]),_:1}))}},$e=ae(Ee,[["__scopeId","data-v-0a344c97"]]);export{$e as default};
