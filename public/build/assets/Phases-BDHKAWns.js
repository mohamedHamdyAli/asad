import{m as h,i as C,p as y,r as V,q as L,c as O,o as d,w as F,b as s,a as M,f as c,h as R,j as m,F as U,s as A,u as E,t as b,y as P,k as _,n as q}from"./app-K_l_k4qp.js";import{_ as z}from"./AuthenticatedLayout-Ob8rRmGM.js";import{_ as H}from"./UnitNav-BlX0B9VN.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N=[{value:"site_handover",label:"Site Handover"},{value:"fondation",label:"Skeleton"},{value:"finishing",label:"Finishing"},{value:"handover",label:"Handover"}];function G(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function K(e){var n;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.data)?e.data.data:[]}function Q(e={}){var l;const n=G(e.description),o=n&&typeof n=="object"?n:{en:n??"",ar:n??""};return{id:e.id,unit_id:e.unit_id,status:e.status,status_label:((l=N.find(i=>i.value===e.status))==null?void 0:l.label)||e.status,desc_en:o.en??"",desc_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const x={statuses:()=>N,list:async e=>{const{data:n}=await h.get(`/api/unit-phase/${e}`);return K(n).map(Q)},create:async e=>{const{data:n}=await h.post("/api/unit-phase/create",e);return n},update:async e=>{const{data:n}=await h.post("/api/unit-phase/update",e);return n},remove:async e=>{const{data:n}=await h.delete(`/api/unit-phase/delete/${e}`);return n}};function W(e,n=[]){return{unit_id:e,data:n.map(o=>{var l,i;return{status:o.status,description:{en:((l=o.description)==null?void 0:l.en)??"",ar:((i=o.description)==null?void 0:i.ar)??""}}})}}function X(e,n=[]){return{unit_id:e,data:n.map(o=>{var i,v;const l={id:o.id};return o.status!==void 0&&(l.status=o.status),o.description&&(l.description={en:((i=o.description)==null?void 0:i.en)??"",ar:((v=o.description)==null?void 0:v.ar)??""}),l})}}const Y={class:"p-6 space-y-8"},Z={class:"flex items-center justify-between"},ee=["href"],te={class:"bg-white p-6 rounded-2xl shadow space-y-4"},se={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ae=["value"],ne={class:"flex items-end"},ie=["disabled"],re={key:0,class:"text-sm text-red-600"},oe={class:"bg-white p-6 rounded-2xl shadow"},le={key:0,class:"text-sm text-gray-500"},de={key:1},ue={key:0,class:"text-center text-gray-500 py-10"},ce={key:1,class:"space-y-5"},pe={class:"flex items-center justify-center mb-4"},ve={class:"inline-flex items-center justify-center rounded-full bg-blue-50 text-blue-700 px-2.5 py-0.5 text-[13px] border border-blue-200"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},be=["onUpdate:modelValue"],fe=["value"],ye=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],ge={class:"mt-4 flex justify-end"},he=["disabled","onClick"],_e=["onClick"],ke={__name:"Phases",props:{unitId:{type:[Number,String],required:!0}},setup(e){const n=e,o=C(()=>"/units-management"),l=x.statuses(),i=y({status:"",description:{en:"",ar:""}}),v=y(!1),k=y(""),j=C(()=>{var r,t;return!!i.value.status&&!!((r=i.value.description.en)!=null&&r.trim())&&!!((t=i.value.description.ar)!=null&&t.trim())});async function D(){var r,t;v.value=!0;try{const a=W(n.unitId,[i.value]);await x.create(a),await f(),i.value={status:"",description:{en:"",ar:""}}}catch(a){k.value=((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.message)||"Save failed"}finally{v.value=!1}}const w=y([]),p=V({}),g=V({}),S=y(!1);function I(r){Object.keys(p).forEach(t=>delete p[t]),r.forEach(t=>{p[t.id]={status:t.status,description:{en:t.desc_en||"",ar:t.desc_ar||""}}})}async function f(){S.value=!0;try{const r=await x.list(n.unitId);w.value=r,I(r)}finally{S.value=!1}}async function T(r){const t=p[r];if(t){g[r]=!0;try{const a=X(n.unitId,[{id:r,status:t.status,description:t.description}]);await x.update(a),await f()}finally{g[r]=!1}}}async function $(r){confirm("Delete this phase?")&&(await x.remove(r),await f())}return L(f),(r,t)=>(d(),O(z,null,{default:F(()=>[s("div",Y,[s("div",Z,[t[3]||(t[3]=s("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Phases",-1)),s("a",{href:o.value,class:"px-3 py-1 border rounded text-gray-700 hover:bg-gray-100"}," ← Back to Units ",8,ee)]),M(H,{"unit-id":Number(e.unitId),cols:2},null,8,["unit-id"]),s("div",te,[t[8]||(t[8]=s("h3",{class:"text-lg font-semibold text-gray-800 flex items-center gap-2"}," Add / Upsert Phase ",-1)),s("div",se,[s("div",null,[t[5]||(t[5]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Status *",-1)),m(s("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.value.status=a),class:"form-input"},[t[4]||(t[4]=s("option",{value:"",disabled:""},"Select status",-1)),(d(!0),c(U,null,A(E(l),a=>(d(),c("option",{key:a.value,value:a.value},b(a.label),9,ae))),128))],512),[[P,i.value.status]])]),s("div",null,[t[6]||(t[6]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN) *",-1)),m(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>i.value.description.en=a),class:"form-input"},null,512),[[_,i.value.description.en]])]),s("div",null,[t[7]||(t[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR) *",-1)),m(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>i.value.description.ar=a),class:"form-input",dir:"rtl"},null,512),[[_,i.value.description.ar]])]),s("div",ne,[s("button",{class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700",disabled:v.value||!j.value,onClick:D},b(v.value?"Saving…":"Save Phase"),9,ie)])]),k.value?(d(),c("div",re,b(k.value),1)):R("",!0)]),s("div",oe,[s("div",{class:"flex items-center justify-between mb-4"},[t[9]||(t[9]=s("h3",{class:"text-lg font-semibold text-gray-800"},"Existing Phases",-1)),s("button",{onClick:f,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),S.value?(d(),c("div",le,"Loading…")):(d(),c("div",de,[w.value.length?(d(),c("div",ce,[(d(!0),c(U,null,A(w.value,(a,B)=>(d(),c("div",{key:a.id,class:q(["rounded-xl p-5 border shadow-sm hover:shadow-md transition bg-white",B===0?"border-yellow-400":"border-gray-200"])},[s("div",pe,[s("span",ve,b(a.status_label),1)]),s("div",me,[s("div",null,[t[10]||(t[10]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Status *",-1)),m(s("select",{"onUpdate:modelValue":u=>p[a.id].status=u,class:"form-input"},[(d(!0),c(U,null,A(E(l),u=>(d(),c("option",{key:u.value,value:u.value},b(u.label),9,fe))),128))],8,be),[[P,p[a.id].status]])]),s("div",null,[t[11]||(t[11]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (EN)",-1)),m(s("textarea",{"onUpdate:modelValue":u=>p[a.id].description.en=u,class:"form-input min-h-[60px]"},null,8,ye),[[_,p[a.id].description.en]])]),s("div",null,[t[12]||(t[12]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (AR)",-1)),m(s("textarea",{"onUpdate:modelValue":u=>p[a.id].description.ar=u,class:"form-input min-h-[60px]",dir:"rtl"},null,8,xe),[[_,p[a.id].description.ar]])])]),s("div",ge,[s("button",{class:"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-60",disabled:g[a.id],onClick:u=>T(a.id)},b(g[a.id]?"Saving…":"Save Changes"),9,he),s("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-600 bg-red-50 hover:bg-red-100 ml-3",onClick:u=>$(a.id)}," Delete ",8,_e)])],2))),128))])):(d(),c("div",ue," No phases found. "))]))])])]),_:1}))}},Ce=J(ke,[["__scopeId","data-v-eb57f641"]]);export{Ce as default};
