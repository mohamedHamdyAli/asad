import{m as w,p as u,i as b,q as ne,c as F,o as i,w as I,b as e,j as P,f as d,h as g,k as ie,F as S,s as $,t as o,u as f,v as z,a as x,e as re,z as de}from"./app-CzdCp43o.js";import{_ as ue}from"./AuthenticatedLayout-J4lJL3KR.js";import{c as ce,e as O,b as K,F as ve,d as j,E as D}from"./index.esm-CKEvlbkd.js";import{U as me}from"./users-C0DL6arH.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function G(t){var l;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((l=t==null?void 0:t.data)==null?void 0:l.data)?t.data.data:[]}function H(t={}){var l,_;return{id:t.id,user_id:t.user_id,user_name:((l=t.user)==null?void 0:l.name)||"",user_email:((_=t.user)==null?void 0:_.email)||"",type:t.type||"all",title:t.title||"",body:t.body||"",is_seen:t.is_seen||!1,seen_time:t.seen_time,created_at:t.created_at,updated_at:t.updated_at,users:t.users||[],users_count:t.users_count||0}}const V={list:async()=>{const{data:t}=await w.get("/api/notifications");return G(t).map(H)},show:async t=>{const{data:l}=await w.get(`/api/notifications/show/${t}`);return G(l).map(H)},create:async t=>{const{data:l}=await w.post("/api/notifications/create",t);return l},remove:async t=>{const{data:l}=await w.delete(`/api/notifications/delete/${t}`);return l}};function fe(t={}){const l={title:t.title,body:t.body};return t.user_ids&&Array.isArray(t.user_ids)&&t.user_ids.length>0?l.user_ids=t.user_ids:t.user_id&&(l.user_id=t.user_id),l}const be={class:"p-6 space-y-6"},xe={class:"bg-white rounded-xl shadow border overflow-hidden"},_e={class:"w-full text-sm"},ye={class:"px-4 py-3"},he={class:"px-4 py-3"},ge={key:0},we=["onClick"],ke={key:1,class:"text-gray-400 italic"},Ce={class:"px-4 py-3 max-w-xs truncate"},Ue={class:"px-4 py-3 max-w-md truncate"},Ae={class:"px-4 py-3 text-xs text-gray-500"},Ne={class:"px-4 py-3 text-right space-x-2"},Me=["onClick"],Pe={class:"flex justify-between"},Se={class:"space-x-2"},$e=["disabled"],je=["disabled"],De={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},Ve={class:"bg-white w-full max-w-2xl rounded-xl p-6 max-h-[85vh] overflow-y-auto"},Le={class:"space-y-4"},Te={class:"flex items-center space-x-2 mb-2"},qe={key:0},Be={class:"border border-gray-300 rounded px-3 py-2 max-h-[300px] overflow-y-auto"},Ee={class:"space-y-2"},Re=["value"],Fe={class:"text-sm"},Ie={key:0,class:"text-xs text-gray-600 mt-1"},ze={key:1,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},Oe={class:"bg-white rounded-xl shadow-lg w-full max-w-md mx-4 p-6"},Ke={class:"text-lg font-bold mb-4"},Ge={class:"text-sm text-gray-500 font-normal"},He={class:"space-y-2 mb-4"},Je={class:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold"},Qe={class:"font-medium"},We={class:"text-xs text-gray-500"},Xe={key:0,class:"flex justify-between items-center mb-4 text-sm"},Ye={class:"text-gray-600"},Ze={class:"space-x-2"},et=["disabled"],tt=["disabled"],k=10,L=5,st={__name:"Index",setup(t){const{show:l}=de(),_=u([]),T=u([]),y=u(""),m=u(1),C=u(!1),U=u(!1),p=u(!0),q=u(0),c=u([]),h=u([]),v=u(1),A=u({}),J=b(()=>ce({title:K().required("Title is required"),body:K().required("Message body is required"),user_ids:p.value?O():O().min(1,"Please select at least one user").required("Please select at least one user")}));async function N(){_.value=await V.list()}async function Q(){T.value=await me.list()}const B=b(()=>_.value.filter(r=>{var s,a,n;return((s=r.title)==null?void 0:s.toLowerCase().includes(y.value.toLowerCase()))||((a=r.user_name)==null?void 0:a.toLowerCase().includes(y.value.toLowerCase()))||((n=r.body)==null?void 0:n.toLowerCase().includes(y.value.toLowerCase()))})),E=b(()=>Math.ceil(B.value.length/k)),W=b(()=>B.value.slice((m.value-1)*k,m.value*k)),M=b(()=>Math.ceil(h.value.length/L)),X=b(()=>h.value.slice((v.value-1)*L,v.value*L));function Y(){p.value=!0,c.value=[],A.value={title:"",body:"",user_ids:[]},q.value++,C.value=!0}function R(){C.value=!1,c.value=[]}function Z(){p.value&&(c.value=[],A.value.user_ids=[])}async function ee(r){var a;const s={title:r.title,body:r.body};!p.value&&c.value.length>0&&(s.user_ids=c.value.map(n=>parseInt(n)));try{await V.create(fe(s)),R(),N()}catch(n){console.error("SEND ERROR",((a=n.response)==null?void 0:a.data)||n),l(n)}}async function te(r){confirm("Delete notification?")&&(await V.remove(r),N())}function se(r){h.value=r.users||[],v.value=1,U.value=!0}function ae(){U.value=!1,v.value=1,h.value=[]}function le(r){return r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return ne(()=>{N(),Q()}),(r,s)=>(i(),F(ue,null,{default:I(()=>[e("div",be,[e("div",{class:"flex justify-between items-center"},[s[8]||(s[8]=e("h2",{class:"text-2xl font-bold"},"Notifications",-1)),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:Y}," + Send Notification ")]),P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>y.value=a),placeholder:"Search by title or user name",class:"form-input w-72"},null,512),[[ie,y.value]]),e("div",xe,[e("table",_e,[s[10]||(s[10]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"Users"),e("th",{class:"px-4 py-3"},"Title"),e("th",{class:"px-4 py-3"},"Body"),e("th",{class:"px-4 py-3"},"Date"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(i(!0),d(S,null,$(W.value,(a,n)=>(i(),d("tr",{key:a.id,class:"border-t"},[e("td",ye,o((m.value-1)*k+n+1),1),e("td",he,[a.users_count?(i(),d("div",ge,[e("button",{onClick:oe=>se(a),class:"text-blue-600 hover:underline flex items-center gap-1"},[e("span",null,o(a.users_count)+" user(s)",1),s[9]||(s[9]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))],8,we)])):(i(),d("div",ke,"No users"))]),e("td",Ce,o(a.title),1),e("td",Ue,o(a.body),1),e("td",Ae,o(le(a.created_at)),1),e("td",Ne,[e("button",{class:"text-red-600",onClick:oe=>te(a.id)},"Delete",8,Me)])]))),128))])])]),e("div",Pe,[e("span",null,"Page "+o(m.value)+" of "+o(E.value),1),e("div",Se,[e("button",{onClick:s[1]||(s[1]=a=>m.value--),disabled:m.value===1},"Prev",8,$e),e("button",{onClick:s[2]||(s[2]=a=>m.value++),disabled:m.value===E.value},"Next",8,je)])]),C.value?(i(),d("div",De,[e("div",Ve,[s[16]||(s[16]=e("h3",{class:"text-lg font-semibold mb-4"},"Send Notification",-1)),(i(),F(f(ve),{ref:"formRef","validate-on-mount":!1,key:q.value,"validation-schema":J.value,"initial-values":A.value,onSubmit:ee},{default:I(()=>[e("div",Le,[e("div",null,[e("label",Te,[P(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=a=>p.value=a),onChange:Z,class:"form-checkbox"},null,544),[[z,p.value]]),s[11]||(s[11]=e("span",{class:"text-sm font-medium"},"Send to All Users",-1))])]),p.value?g("",!0):(i(),d("div",qe,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium mb-2"},"Select Users",-1)),e("div",Be,[e("div",Ee,[(i(!0),d(S,null,$(T.value,a=>(i(),d("label",{key:a.id,class:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},[P(e("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":s[4]||(s[4]=n=>c.value=n),class:"form-checkbox h-4 w-4 text-blue-600"},null,8,Re),[[z,c.value]]),e("span",Fe,o(a.name)+" ("+o(a.email)+")",1)]))),128))])]),x(f(j),{name:"user_ids",modelValue:c.value,"onUpdate:modelValue":s[5]||(s[5]=a=>c.value=a),type:"hidden"},null,8,["modelValue"]),x(f(D),{name:"user_ids",class:"error"}),c.value.length>0?(i(),d("div",Ie,o(c.value.length)+" user(s) selected ",1)):g("",!0)])),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium mb-1"},"Title",-1)),x(f(j),{name:"title",class:"form-input",placeholder:"Notification Title"}),x(f(D),{name:"title",class:"error"})]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),x(f(j),{name:"body",as:"textarea",rows:"5",class:"form-input",placeholder:"Notification Message"}),x(f(D),{name:"body",class:"error"})])]),e("div",{class:"flex justify-end gap-2 mt-6"},[e("button",{type:"button",class:"border px-4 py-2 rounded",onClick:R}," Cancel "),s[15]||(s[15]=e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded"}," Send ",-1))])]),_:1},8,["validation-schema","initial-values"]))])])):g("",!0),U.value?(i(),d("div",ze,[e("div",Oe,[e("h3",Ke,[s[17]||(s[17]=re(" Users who received this notification ")),e("span",Ge,"("+o(h.value.length)+" total)",1)]),e("div",He,[(i(!0),d(S,null,$(X.value,a=>{var n;return i(),d("div",{key:a.id,class:"flex items-center gap-3 p-3 border rounded hover:bg-gray-50"},[e("div",Je,o((n=a.name)==null?void 0:n.charAt(0).toUpperCase()),1),e("div",null,[e("div",Qe,o(a.name),1),e("div",We,o(a.email),1)])])}),128))]),M.value>1?(i(),d("div",Xe,[e("span",Ye,"Page "+o(v.value)+" of "+o(M.value),1),e("div",Ze,[e("button",{onClick:s[6]||(s[6]=a=>v.value--),disabled:v.value===1,class:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Prev ",8,et),e("button",{onClick:s[7]||(s[7]=a=>v.value++),disabled:v.value===M.value,class:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,tt)])])):g("",!0),e("div",{class:"flex justify-end"},[e("button",{type:"button",class:"border px-4 py-2 rounded",onClick:ae}," Close ")])])])):g("",!0)])]),_:1}))}},rt=pe(st,[["__scopeId","data-v-382214ad"]]);export{rt as default};
