import{p as i,i as N,q as O,f as c,o as r,a as o,u as l,g as Y,w as x,b as e,j as G,c as L,k as H,h as C,F as A,s as J,t as d,n as Q,N as W}from"./app-4D-wkT_p.js";import{_ as X}from"./AuthenticatedLayout-CCBjItTP.js";import{c as Z,e as ee,f as te,a as g,F as ae,b as m,E as _}from"./index.esm-BzR9PCIV.js";import{V as P,b as se,a as le}from"./vendors-C0VakaHA.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"p-6 space-y-6"},re={class:"bg-white rounded-xl shadow border overflow-hidden"},ie={class:"w-full text-sm"},de={class:"px-4 py-3"},ue={class:"px-4 py-3"},ce=["src"],pe={key:1,class:"text-gray-400"},me={class:"px-4 py-3"},_e={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},ge={class:"px-4 py-3 text-right space-x-2"},ye=["onClick"],he=["onClick"],be={key:0},xe={class:"flex justify-between"},we={class:"text-sm"},ke={class:"space-x-2"},Ce=["disabled"],Pe=["disabled"],Me={key:0,class:"fixed inset-0 bg-black/40 z-[9999] flex items-center justify-center"},Ee={class:"bg-white w-full max-w-2xl rounded-xl p-6 relative"},Ve={class:"text-lg font-bold mb-4"},Fe={key:0,class:"mb-3 p-3 bg-red-50 text-red-700 rounded text-sm"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qe={class:"md:col-span-2"},Ne={class:"grid grid-cols-[100px_1fr] gap-2"},je={class:"flex items-center gap-2"},Se={class:"md:col-span-2"},De=["onChange"],Le=["src"],j=10,Ae={__name:"VendorsManagement",setup(Be){const S=i([]),M=i(""),f=i(1),w=i(!1),v=i(null),k=i(null),y=i(null),p=i(""),E=i(0),V=i({}),B=Z({name:g().required(),email:g().email().required(),country_code:g().required(),phone:g().required(),gender:g().required(),country_name:g().required(),password:g().min(8).nullable(),is_enabled:te(),profile_image:ee().nullable().test("required","Please select profile image",function(s){return v.value?!0:s instanceof File})});async function F(){S.value=await P.list()}const $=N(()=>{const s=M.value.toLowerCase();return S.value.filter(t=>{var a,n,h;return((a=t.name)==null?void 0:a.toLowerCase().includes(s))||((n=t.email)==null?void 0:n.toLowerCase().includes(s))||((h=t.phone)==null?void 0:h.includes(s))})}),D=N(()=>Math.ceil($.value.length/j)),R=N(()=>$.value.slice((f.value-1)*j,f.value*j));function U(){v.value=null,p.value="",V.value={name:"",email:"",phone:"",country_code:"",gender:"",country_name:"",is_enabled:!0,password:"",profile_image:null},k.value=null,y.value=null,E.value++,w.value=!0}function I(s){v.value=s.id,p.value="",V.value={name:s.name,email:s.email,phone:s.phone,country_code:s.country_code,gender:s.gender,country_name:s.country_name,is_enabled:!!s.is_enabled,password:"",profile_image:null},y.value=s.profile_image_url||null,E.value++,w.value=!0}function q(){w.value=!1}function K(s,t){var n;const a=((n=s.target.files)==null?void 0:n[0])||null;k.value=a,y.value=a?URL.createObjectURL(a):null,t("profile_image",a)}async function z(s){var t,a,n,h;p.value="";try{const b={...s,is_enabled:s.is_enabled?1:0,...k.value?{profile_image:k.value}:{}};let u;if(v.value?u=await P.update(v.value,se(b)):u=await P.create(le(b)),(u==null?void 0:u.code)===422||(u==null?void 0:u.key)==="Invalid data sent"){p.value=u.msg||"Validation error";return}q(),F()}catch(b){console.log(p),p.value=((a=(t=b.response)==null?void 0:t.data)==null?void 0:a.msg)||((h=(n=b.response)==null?void 0:n.data)==null?void 0:h.message)||"Something went wrong. Please try again."}}async function T(s){confirm(`Delete "${s.name}"?`)&&(await P.remove(s.id),F())}return O(F),(s,t)=>(r(),c(A,null,[o(l(Y),{title:"PMs Management"}),o(X,null,{default:x(()=>[e("div",ne,[e("div",{class:"flex justify-between items-center"},[t[3]||(t[3]=e("h2",{class:"text-2xl font-bold"},"Project Managers (PM)",-1)),e("button",{class:"px-4 py-2 bg-black text-white rounded",onClick:U}," + Add PM ")]),G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>M.value=a),placeholder:"Search name, email, or phone",class:"form-input w-80"},null,512),[[H,M.value]]),e("div",re,[e("table",ie,[t[5]||(t[5]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-3"},"#"),e("th",{class:"px-4 py-3"},"Avatar"),e("th",{class:"px-4 py-3"},"Name"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Phone"),e("th",{class:"px-4 py-3"},"Enabled"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(r(!0),c(A,null,J(R.value,a=>(r(),c("tr",{key:a.id,class:"border-t"},[e("td",de,d(a.id),1),e("td",ue,[a.profile_image_url?(r(),c("img",{key:0,src:a.profile_image_url,class:"w-10 h-10 rounded-full object-cover"},null,8,ce)):(r(),c("span",pe,"—"))]),e("td",me,d(a.name),1),e("td",_e,d(a.email),1),e("td",fe,d(a.country_code)+" "+d(a.phone),1),e("td",ve,[e("span",{class:Q(a.is_enabled?"text-green-600":"text-gray-400")},d(a.is_enabled?"Yes":"No"),3)]),e("td",ge,[e("button",{class:"text-blue-600",onClick:n=>I(a)},"Edit",8,ye),e("button",{class:"text-red-600",onClick:n=>T(a)},"Delete",8,he)])]))),128)),$.value.length===0?(r(),c("tr",be,t[4]||(t[4]=[e("td",{colspan:"7",class:"text-center py-6 text-gray-500"}," No PMs found ",-1)]))):C("",!0)])])]),e("div",xe,[e("span",we,"Page "+d(f.value)+" of "+d(D.value),1),e("div",ke,[e("button",{onClick:t[1]||(t[1]=a=>f.value--),disabled:f.value===1},"Prev",8,Ce),e("button",{onClick:t[2]||(t[2]=a=>f.value++),disabled:f.value===D.value},"Next",8,Pe)])]),(r(),L(W,{to:"body"},[w.value?(r(),c("div",Me,[e("div",Ee,[e("button",{class:"absolute top-3 right-3 text-gray-400",onClick:q},"✕"),e("h3",Ve,d(v.value?"Edit PM":"Add PM"),1),p.value?(r(),c("div",Fe,d(p.value),1)):C("",!0),(r(),L(l(ae),{key:E.value,"validation-schema":l(B),"initial-values":V.value,onSubmit:z},{default:x(({setFieldValue:a})=>[e("div",$e,[e("div",qe,[o(l(m),{name:"name",class:"form-input",placeholder:"Name"}),o(l(_),{name:"name",class:"error"})]),e("div",null,[o(l(m),{name:"email",class:"form-input",placeholder:"Email"}),o(l(_),{name:"email",class:"error"})]),e("div",Ne,[e("div",null,[o(l(m),{as:"select",name:"country_code",class:"form-input"},{default:x(()=>t[6]||(t[6]=[e("option",{value:""},"Code",-1),e("option",{value:"+20"},"+20",-1),e("option",{value:"+965"},"+965",-1)])),_:1}),o(l(_),{name:"country_code",class:"error"})]),e("div",null,[o(l(m),{name:"phone",class:"form-input",placeholder:"Phone number"}),o(l(_),{name:"phone",class:"error"})])]),e("div",null,[o(l(m),{name:"password",type:"password",class:"form-input",placeholder:v.value?"Password (optional)":"Password"},null,8,["placeholder"]),o(l(_),{name:"password",class:"error"})]),e("div",null,[o(l(m),{as:"select",name:"gender",class:"form-input"},{default:x(()=>t[7]||(t[7]=[e("option",{value:""},"Select gender",-1),e("option",{value:"male"},"Male",-1),e("option",{value:"female"},"Female",-1)])),_:1}),o(l(_),{name:"gender",class:"error"})]),e("div",null,[o(l(m),{as:"select",name:"country_name",class:"form-input"},{default:x(()=>t[8]||(t[8]=[e("option",{value:""},"Select country",-1),e("option",{value:"Egypt"},"Egypt",-1),e("option",{value:"Kuwait"},"Kuwait",-1)])),_:1}),o(l(_),{name:"country_name",class:"error"})]),e("div",je,[o(l(m),{type:"checkbox",name:"is_enabled",value:!0}),t[9]||(t[9]=e("span",{class:"text-sm"},"Enabled",-1))]),e("div",Se,[e("input",{type:"file",accept:"image/*",onChange:n=>K(n,a)},null,40,De),o(l(_),{name:"profile_image",class:"error"})]),y.value?(r(),c("img",{key:0,src:y.value,class:"w-24 h-24 rounded border"},null,8,Le)):C("",!0)]),e("div",{class:"flex justify-end gap-2 mt-6"},[e("button",{type:"button",class:"px-4 py-2 border rounded",onClick:q}," Cancel "),t[10]||(t[10]=e("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values"]))])])):C("",!0)]))])]),_:1})],64))}},Te=oe(Ae,[["__scopeId","data-v-8fe26341"]]);export{Te as default};
