import{l as V,m,i as j,r as S,p as G,c as H,o as c,w as K,b as n,a as R,j as _,s as x,f as p,h as N,F as T,q as E,t as D}from"./app-CdqcvLGQ.js";import{_ as Q}from"./AuthenticatedLayout-CjS34vnV.js";import{F as I,a as W}from"./FolderPicker-CHOADyCR.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Y(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return a}}function Z(a){var s;return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.message)?a.message:Array.isArray((s=a==null?void 0:a.data)==null?void 0:s.data)?a.data.data:[]}function ee(a){return a?`/storage/${a}`:""}function te(a={}){const s=Y(a.title),r=s&&typeof s=="object"?s:{en:s??"",ar:s??""};return{id:a.id,unit_id:a.unit_id,folder_id:a.folder_id,date:a.date??"",image:a.image??"",image_url:ee(a.image),title_en:r.en??"",title_ar:r.ar??"",created_at:a.created_at,updated_at:a.updated_at}}const C={list:async a=>{const{data:s}=await V.get(`/api/unit-drawing/${a}`);return Z(s).map(te)},create:async a=>{const{data:s}=await V.post("/api/unit-drawing/create",a,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async a=>{const{data:s}=await V.post("/api/unit-drawing/update",a,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async a=>{const{data:s}=await V.delete(`/api/unit-drawing/delete/${a}`);return s}};function ae(a,s=[]){const r=new FormData;return r.append("unit_id",String(a)),s.forEach((l,u)=>{var v,o;r.append(`data[${u}][folder_id]`,String(l.folder_id??"")),r.append(`data[${u}][date]`,l.date??""),r.append(`data[${u}][title][en]`,((v=l==null?void 0:l.title)==null?void 0:v.en)??""),r.append(`data[${u}][title][ar]`,((o=l==null?void 0:l.title)==null?void 0:o.ar)??""),l.image&&r.append(`data[${u}][image]`,l.image)}),r}function ne(a,s=[]){const r=new FormData;return r.append("unit_id",String(a)),s.forEach((l,u)=>{var v,o;r.append(`data[${u}][id]`,String(l.id??"")),r.append(`data[${u}][folder_id]`,String(l.folder_id??"")),l.date!==void 0&&r.append(`data[${u}][date]`,l.date??""),((v=l==null?void 0:l.title)==null?void 0:v.en)!==void 0&&r.append(`data[${u}][title][en]`,l.title.en??""),((o=l==null?void 0:l.title)==null?void 0:o.ar)!==void 0&&r.append(`data[${u}][title][ar]`,l.title.ar??""),l.image&&r.append(`data[${u}][image]`,l.image)}),r}const le={class:"p-6 space-y-6"},se={class:"flex items-center justify-between"},ie=["href"],de={class:"bg-white p-4 rounded shadow"},re={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},oe={class:"mt-4"},ue={key:0,class:"mt-3 flex flex-wrap gap-2"},ce=["src"],pe={class:"mt-4 flex items-center gap-3"},fe=["disabled"],me={key:0,class:"text-red-600 text-sm"},ge={class:"bg-white p-4 rounded shadow"},ve={key:0,class:"text-sm text-gray-500"},_e={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"},xe={class:"aspect-[4/3] bg-white flex items-center justify-center"},ye=["src"],be={key:1,class:"text-gray-400 text-sm"},we={class:"p-2 space-y-2 text-xs"},he={class:"flex items-center justify-between"},ke={class:"text-gray-500"},Ue=["onUpdate:modelValue"],Ve=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Ce={class:"text-[11px]"},Fe=["onChange"],$e={class:"flex gap-2 pt-1"},Ae=["onClick","disabled"],Se=["onClick"],Ne={key:0,class:"col-span-full text-center text-gray-500 py-8"},je={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(a){const s=m([]),r=m(!1);async function l(){r.value=!0;try{s.value=await W.list("drawing")}finally{r.value=!1}}const u=a,v=j(()=>"/units-management"),o=m({folder_id:null,date:"",title:{en:"",ar:""}}),b=m([]),w=m([]),h=m(!1),k=m(""),L=j(()=>{var i,e;return!!o.value.folder_id&&!!o.value.date&&!!((i=o.value.title.en)!=null&&i.trim())&&!!((e=o.value.title.ar)!=null&&e.trim())&&b.value.length>0});function B(i){const e=Array.from(i.target.files||[]);b.value=e,w.value=e.map(t=>URL.createObjectURL(t))}async function q(){var i,e;h.value=!0,k.value="";try{const t=b.value.map(g=>({folder_id:o.value.folder_id,date:o.value.date,title:{...o.value.title},image:g})),d=ae(u.unitId,t);await C.create(d),await y(),b.value=[],w.value=[],o.value.title={en:"",ar:""}}catch(t){console.error(t),k.value=((e=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Upload failed"}finally{h.value=!1}}const F=m([]),$=m(!1),f=S({}),A=S({}),U=S({});function O(i){i.forEach(e=>{f[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function y(){$.value=!0;try{const i=await C.list(u.unitId);F.value=i,O(i)}finally{$.value=!1}}function J(i,e){var d;const t=((d=e.target.files)==null?void 0:d[0])||null;t&&(A[i]=t)}async function M(i){var t,d;const e=f[i];if(e){U[i]=!0;try{const g=[{id:i,folder_id:e.folder_id,date:e.date,title:e.title,image:A[i]}],z=ne(u.unitId,g);await C.update(z),delete A[i],await y()}catch(g){console.error(g),alert(((d=(t=g==null?void 0:g.response)==null?void 0:t.data)==null?void 0:d.message)||"Update failed")}finally{U[i]=!1}}}async function P(i){confirm("Delete this drawing?")&&(await C.remove(i),await y())}return G(async()=>{await l(),await y()}),(i,e)=>(c(),H(Q,null,{default:K(()=>[n("div",le,[n("div",se,[e[6]||(e[6]=n("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Drawings",-1)),n("a",{href:v.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ie)]),n("div",de,[e[10]||(e[10]=n("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),n("div",re,[R(I,{type:"drawing",label:"Folder *",fileType:"drawing",modelValue:o.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.folder_id=t),options:s.value,onCreated:e[1]||(e[1]=t=>s.value.unshift(t)),onRefresh:l},null,8,["modelValue","options"]),n("div",null,[e[7]||(e[7]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),_(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.date=t),class:"form-input",type:"date",required:""},null,512),[[x,o.value.date]])]),n("div",null,[e[8]||(e[8]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),_(n("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title.en=t),class:"form-input",type:"text",required:""},null,512),[[x,o.value.title.en]])]),n("div",null,[e[9]||(e[9]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),_(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.title.ar=t),class:"form-input",type:"text",required:""},null,512),[[x,o.value.title.ar]])])]),n("div",oe,[n("input",{type:"file",multiple:"",onChange:B},null,32),w.value.length?(c(),p("div",ue,[(c(!0),p(T,null,E(w.value,(t,d)=>(c(),p("img",{key:d,src:t,class:"w-24 h-16 object-cover rounded border"},null,8,ce))),128))])):N("",!0)]),n("div",pe,[n("button",{disabled:h.value||!L.value,onClick:q,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},D(h.value?"Uploading…":"Upload"),9,fe),k.value?(c(),p("span",me,D(k.value),1)):N("",!0)])]),n("div",ge,[n("div",{class:"flex items-center justify-between mb-3"},[e[11]||(e[11]=n("h3",{class:"text-lg font-bold"},"Drawings",-1)),n("button",{onClick:y,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(c(),p("div",ve,"Loading…")):(c(),p("div",_e,[(c(!0),p(T,null,E(F.value,t=>(c(),p("div",{key:t.id,class:"rounded border overflow-hidden bg-gray-50"},[n("div",xe,[t.image_url?(c(),p("img",{key:0,src:t.image_url,class:"w-full h-full object-cover"},null,8,ye)):(c(),p("div",be,"No Image"))]),n("div",we,[n("div",he,[n("span",ke,"Folder: "+D(t.title_en),1)]),n("div",null,[e[12]||(e[12]=n("label",{class:"block text-[11px] text-gray-500"},"Date *",-1)),_(n("input",{"onUpdate:modelValue":d=>f[t.id].date=d,class:"form-input",type:"date"},null,8,Ue),[[x,f[t.id].date]])]),R(I,{type:"drawing",label:"Folder *",modelValue:f[t.id].folder_id,"onUpdate:modelValue":d=>f[t.id].folder_id=d,options:s.value,onCreated:e[5]||(e[5]=d=>s.value.unshift(d)),onRefresh:l},null,8,["modelValue","onUpdate:modelValue","options"]),n("div",null,[e[13]||(e[13]=n("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),_(n("input",{"onUpdate:modelValue":d=>f[t.id].title.en=d,class:"form-input",type:"text"},null,8,Ve),[[x,f[t.id].title.en]])]),n("div",null,[e[14]||(e[14]=n("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),_(n("input",{"onUpdate:modelValue":d=>f[t.id].title.ar=d,class:"form-input",type:"text"},null,8,De),[[x,f[t.id].title.ar]])]),n("div",Ce,[e[15]||(e[15]=n("label",{class:"block text-gray-500"},"Replace Image",-1)),n("input",{type:"file",accept:"image/*",onChange:d=>J(t.id,d)},null,40,Fe)]),n("div",$e,[n("button",{class:"px-2 py-1 border rounded",onClick:d=>M(t.id),disabled:U[t.id]},D(U[t.id]?"Saving…":"Save"),9,Ae),n("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>P(t.id)}," Delete ",8,Se)])])]))),128)),F.value.length?N("",!0):(c(),p("div",Ne," No drawings found. "))]))])])]),_:1}))}},Le=X(je,[["__scopeId","data-v-c85645fa"]]);export{Le as default};
