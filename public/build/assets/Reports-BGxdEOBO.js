import{m as y,i as $,p as v,r as R,q as O,c as q,o as p,w as J,b as s,j as h,k,f as m,h as w,t as _,F as M,s as z}from"./app-987s675R.js";import{_ as P}from"./AuthenticatedLayout-CFEjSJUM.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function G(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function H(t){var i;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((i=t==null?void 0:t.data)==null?void 0:i.data)?t.data.data:[]}function K(t){return t?`/storage/${t}`:""}function S(t){return(t||"").split("/").pop()||""}function Q(t){return(S(t).split(".").pop()||"").toLowerCase()}function W(t){const i=Q(t);return i==="pdf"?"📕 PDF":i==="doc"||i==="docx"?"📝 DOC":i==="xls"||i==="xlsx"?"📊 XLS":"📄"}function Y(t={}){const i=G(t.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""},a=K(t.file);return{id:t.id,unit_id:t.unit_id,file:t.file??"",file_url:a,file_name:S(t.file),file_icon:W(t.file),title_en:o.en??"",title_ar:o.ar??"",created_at:t.created_at,updated_at:t.updated_at}}const C={list:async t=>{const{data:i}=await y.get(`/api/unit-report/${t}`);return H(i).map(Y)},create:async t=>{const{data:i}=await y.post("/api/unit-report/create",t,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async t=>{const{data:i}=await y.post("/api/unit-report/update",t,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async t=>{const{data:i}=await y.delete(`/api/unit-report/delete/${t}`);return i}};function Z(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((a,r)=>{var c,u;o.append(`data[${r}][title][en]`,((c=a==null?void 0:a.title)==null?void 0:c.en)??""),o.append(`data[${r}][title][ar]`,((u=a==null?void 0:a.title)==null?void 0:u.ar)??""),a.file&&o.append(`data[${r}][file]`,a.file)}),o}function tt(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((a,r)=>{var c,u;o.append(`data[${r}][id]`,String(a.id??"")),((c=a==null?void 0:a.title)==null?void 0:c.en)!==void 0&&o.append(`data[${r}][title][en]`,a.title.en??""),((u=a==null?void 0:a.title)==null?void 0:u.ar)!==void 0&&o.append(`data[${r}][title][ar]`,a.title.ar??""),a.file&&o.append(`data[${r}][file]`,a.file)}),o}const et={class:"p-6 space-y-6"},st={class:"flex items-center justify-between"},nt=["href"],at={class:"bg-white p-4 rounded shadow"},it={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lt={class:"mt-4"},ot={key:0,class:"mt-3 text-sm text-gray-600"},rt={class:"mt-4 flex items-center gap-3"},dt=["disabled"],ct={key:0,class:"text-red-600 text-sm"},ut={class:"bg-white p-4 rounded shadow"},pt={key:0,class:"text-sm text-gray-500"},ft={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},mt={class:"h-32 bg-white flex items-center justify-center p-3 text-center"},xt={class:"text-gray-600"},vt={class:"text-3xl"},_t={class:"text-xs mt-1 break-all"},gt={class:"p-3 space-y-2 text-sm"},bt=["onUpdate:modelValue"],yt=["onUpdate:modelValue"],ht={class:"text-[11px]"},kt=["onChange"],wt={class:"flex gap-2 pt-1"},Ct=["href"],Ut=["onClick","disabled"],Ft=["onClick"],At={key:0,class:"col-span-full text-center text-gray-500 py-8"},D=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Rt={__name:"Reports",props:{unitId:{type:[Number,String],required:!0}},setup(t){const i=t,o=$(()=>"/units-management"),a=v({title:{en:"",ar:""}}),r=v([]),c=v(!1),u=v(""),N=$(()=>{var l,e;return!!((l=a.value.title.en)!=null&&l.trim())&&!!((e=a.value.title.ar)!=null&&e.trim())&&r.value.length>0});function E(l){const e=Array.from(l.target.files||[]);r.value=e}async function T(){var l,e;c.value=!0,u.value="";try{const n=r.value.map(f=>({title:{...a.value.title},file:f})),d=Z(i.unitId,n);await C.create(d),await g(),r.value=[],a.value.title={en:"",ar:""}}catch(n){console.error(n),u.value=((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||(n==null?void 0:n.message)||"Upload failed"}finally{c.value=!1}}const U=v([]),F=v(!1),x=R({}),A=R({}),b=R({});function V(l){l.forEach(e=>{x[e.id]={title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function g(){F.value=!0;try{const l=await C.list(i.unitId);U.value=l,V(l)}finally{F.value=!1}}function j(l,e){var d;const n=((d=e.target.files)==null?void 0:d[0])||null;n&&(A[l]=n)}async function B(l){var n,d;const e=x[l];if(e){b[l]=!0;try{const f=[{id:l,title:e.title,file:A[l]}],I=tt(i.unitId,f);await C.update(I),delete A[l],await g()}catch(f){console.error(f),alert(((d=(n=f==null?void 0:f.response)==null?void 0:n.data)==null?void 0:d.message)||"Update failed")}finally{b[l]=!1}}}async function L(l){confirm("Delete this report?")&&(await C.remove(l),await g())}return O(g),(l,e)=>(p(),q(P,null,{default:J(()=>[s("div",et,[s("div",st,[e[2]||(e[2]=s("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Reports",-1)),s("a",{href:o.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,nt)]),s("div",at,[e[5]||(e[5]=s("h3",{class:"text-lg font-bold mb-3"},"Add Reports",-1)),s("div",it,[s("div",null,[e[3]||(e[3]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),h(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[k,a.value.title.en]])]),s("div",null,[e[4]||(e[4]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),h(s("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[k,a.value.title.ar]])])]),s("div",lt,[s("input",{type:"file",multiple:"",accept:D,onChange:E},null,32),r.value.length?(p(),m("div",ot,_(r.value.length)+" file(s) selected ",1)):w("",!0)]),s("div",rt,[s("button",{disabled:c.value||!N.value,onClick:T,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},_(c.value?"Uploading…":"Upload"),9,dt),u.value?(p(),m("span",ct,_(u.value),1)):w("",!0)])]),s("div",ut,[s("div",{class:"flex items-center justify-between mb-3"},[e[6]||(e[6]=s("h3",{class:"text-lg font-bold"},"Reports",-1)),s("button",{onClick:g,class:"px-3 py-1 border rounded"},"Refresh")]),F.value?(p(),m("div",pt,"Loading…")):(p(),m("div",ft,[(p(!0),m(M,null,z(U.value,n=>(p(),m("div",{key:n.id,class:"rounded border bg-gray-50 overflow-hidden"},[s("div",mt,[s("div",xt,[s("div",vt,_(n.file_icon.split(" ")[0]),1),s("div",_t,_(n.file_name),1)])]),s("div",gt,[e[10]||(e[10]=s("div",{class:"flex items-center justify-between text-xs text-gray-500"},null,-1)),s("div",null,[e[7]||(e[7]=s("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),h(s("input",{"onUpdate:modelValue":d=>x[n.id].title.en=d,class:"form-input",type:"text"},null,8,bt),[[k,x[n.id].title.en]])]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),h(s("input",{"onUpdate:modelValue":d=>x[n.id].title.ar=d,class:"form-input",type:"text"},null,8,yt),[[k,x[n.id].title.ar]])]),s("div",ht,[e[9]||(e[9]=s("label",{class:"block text-gray-500"},"Replace File",-1)),s("input",{type:"file",accept:D,onChange:d=>j(n.id,d)},null,40,kt)]),s("div",wt,[n.file_url?(p(),m("a",{key:0,href:n.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Ct)):w("",!0),s("button",{class:"px-2 py-1 border rounded",onClick:d=>B(n.id),disabled:b[n.id]},_(b[n.id]?"Saving…":"Save"),9,Ut),s("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>L(n.id)}," Delete ",8,Ft)])])]))),128)),U.value.length?w("",!0):(p(),m("div",At," No reports found. "))]))])])]),_:1}))}},Nt=X(Rt,[["__scopeId","data-v-64d6878b"]]);export{Nt as default};
