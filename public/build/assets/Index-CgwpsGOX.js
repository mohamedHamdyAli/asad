import{i as se,p as $,A as ie,q as le,I as Y,f,o as g,h as q,b as n,t as _,m as P,a as N,u as F,g as Pe,w as M,F as B,s as Q,e as O,S as G,z as je,d as De,j as D,n as j,k as R,y as ee}from"./app-DC9ptktl.js";import{_ as Le}from"./AuthenticatedLayout-BmdhyIck.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ne}from"./vendors-CFF9_1qj.js";function Oe(e,r,l,d){function o(m){return m instanceof l?m:new l(function(p){p(m)})}return new(l||(l=Promise))(function(m,p){function h(w){try{x(d.next(w))}catch(k){p(k)}}function S(w){try{x(d.throw(w))}catch(k){p(k)}}function x(w){w.done?m(w.value):o(w.value).then(h,S)}x((d=d.apply(e,[])).next())})}function Re(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var te,ce;function Fe(){return ce||(ce=1,te=function e(r,l){if(r===l)return!0;if(r&&l&&typeof r=="object"&&typeof l=="object"){if(r.constructor!==l.constructor)return!1;var d,o,m;if(Array.isArray(r)){if(d=r.length,d!=l.length)return!1;for(o=d;o--!==0;)if(!e(r[o],l[o]))return!1;return!0}if(r.constructor===RegExp)return r.source===l.source&&r.flags===l.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===l.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===l.toString();if(m=Object.keys(r),d=m.length,d!==Object.keys(l).length)return!1;for(o=d;o--!==0;)if(!Object.prototype.hasOwnProperty.call(l,m[o]))return!1;for(o=d;o--!==0;){var p=m[o];if(!e(r[p],l[p]))return!1}return!0}return r!==r&&l!==l}),te}var Me=Fe(),Ve=Re(Me);const pe="__googleMapsScriptId";var Z;(function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"})(Z||(Z={}));class z{constructor({apiKey:r,authReferrerPolicy:l,channel:d,client:o,id:m=pe,language:p,libraries:h=[],mapIds:S,nonce:x,region:w,retries:k=3,url:U="https://maps.googleapis.com/maps/api/js",version:b}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=r,this.authReferrerPolicy=l,this.channel=d,this.client=o,this.id=m||pe,this.language=p,this.libraries=h,this.mapIds=S,this.nonce=x,this.region=w,this.retries=k,this.url=U,this.version=b,z.instance){if(!Ve(this.options,z.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(z.instance.options)}`);return z.instance}z.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Z.FAILURE:this.done?Z.SUCCESS:this.loading?Z.LOADING:Z.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let r=this.url;return r+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(r+=`&key=${this.apiKey}`),this.channel&&(r+=`&channel=${this.channel}`),this.client&&(r+=`&client=${this.client}`),this.libraries.length>0&&(r+=`&libraries=${this.libraries.join(",")}`),this.language&&(r+=`&language=${this.language}`),this.region&&(r+=`&region=${this.region}`),this.version&&(r+=`&v=${this.version}`),this.mapIds&&(r+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(r+=`&auth_referrer_policy=${this.authReferrerPolicy}`),r}deleteScript(){const r=document.getElementById(this.id);r&&r.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((r,l)=>{this.loadCallback(d=>{d?l(d.error):r(window.google)})})}importLibrary(r){return this.execute(),google.maps.importLibrary(r)}loadCallback(r){this.callbacks.push(r),this.execute()}setScript(){var r,l;if(document.getElementById(this.id)){this.callback();return}const d={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(d).forEach(m=>!d[m]&&delete d[m]),!((l=(r=window==null?void 0:window.google)===null||r===void 0?void 0:r.maps)===null||l===void 0)&&l.importLibrary||(m=>{let p,h,S,x="The Google Maps JavaScript API",w="google",k="importLibrary",U="__ib__",b=document,v=window;v=v[w]||(v[w]={});const E=v.maps||(v.maps={}),I=new Set,c=new URLSearchParams,y=()=>p||(p=new Promise((u,i)=>Oe(this,void 0,void 0,function*(){var A;yield h=b.createElement("script"),h.id=this.id,c.set("libraries",[...I]+"");for(S in m)c.set(S.replace(/[A-Z]/g,L=>"_"+L[0].toLowerCase()),m[S]);c.set("callback",w+".maps."+U),h.src=this.url+"?"+c,E[U]=u,h.onerror=()=>p=i(Error(x+" could not load.")),h.nonce=this.nonce||((A=b.querySelector("script[nonce]"))===null||A===void 0?void 0:A.nonce)||"",b.head.append(h)})));E[k]?console.warn(x+" only loads once. Ignoring:",m):E[k]=(u,...i)=>I.add(u)&&y().then(()=>E[k](u,...i))})(d);const o=this.libraries.map(m=>this.importLibrary(m));o.length||o.push(this.importLibrary("core")),Promise.all(o).then(()=>this.callback(),m=>{const p=new ErrorEvent("error",{error:m});this.loadErrorCallback(p)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(r){if(this.errors.push(r),this.errors.length<=this.retries){const l=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${l} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},l)}else this.onerrorEvent=r,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(r=>{r(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const Te={class:"space-y-2"},Ge={key:0,class:"block text-xs text-gray-500"},Ke={class:"flex gap-2"},ze=["placeholder"],Be={__name:"MapPicker",props:{label:{type:String,default:"Select location"},searchPlaceholder:{type:String,default:"Search placeâ€¦"},lat:{type:[Number,String],default:null},lng:{type:[Number,String],default:null},address:{type:String,default:""},fallbackCenter:{type:Object,default:()=>({lat:30.0444,lng:31.2357})},zoom:{type:Number,default:13},apiKey:{type:String,default:"AIzaSyD6l04ETuUP7BfQ7MqpL2vMWEalLxNj0d4"}},emits:["update:lat","update:lng","update:address"],setup(e,{emit:r}){const l=e,d=r,o=c=>{if(typeof c=="number")return Number.isFinite(c)?c:null;if(c===""||c==null)return null;const y=Number(c);return Number.isFinite(y)?y:null};se(()=>{const c=o(l.lat);return c==null?"-":c.toFixed(6)}),se(()=>{const c=o(l.lng);return c==null?"-":c.toFixed(6)});const m=$(null),p=$(null);let h,S,x,w,k=null;function U({lat:c,lng:y,address:u}){c!=null&&d("update:lat",c),y!=null&&d("update:lng",y),u!==void 0&&d("update:address",u)}function b(c,y){return new Promise(u=>{if(!w)return u("");w.geocode({location:{lat:c,lng:y}},(i,A)=>{A==="OK"&&i&&i.length?u(i[0].formatted_address||""):u("")})})}async function v(){try{k=await new z({apiKey:l.apiKey,version:"weekly",libraries:["places"]}).load()}catch(i){console.error("Google Maps failed to load:",i);return}w=new k.maps.Geocoder;const c=o(l.lat),y=o(l.lng),u=c!=null&&y!=null?{lat:c,lng:y}:l.fallbackCenter;h=new k.maps.Map(m.value,{center:u,zoom:l.zoom,mapTypeControl:!1,streetViewControl:!1}),S=new k.maps.Marker({position:u,map:h,draggable:!0}),h.addListener("click",i=>{const A=i.latLng;E(A.lat(),A.lng(),!0)}),S.addListener("dragend",()=>{const i=S.getPosition();E(i.lat(),i.lng(),!0)});try{x=new k.maps.places.Autocomplete(p.value,{fields:["geometry","formatted_address","name"]}),x.addListener("place_changed",()=>{var V;const i=x.getPlace();if(!((V=i==null?void 0:i.geometry)!=null&&V.location))return;const A=i.geometry.location;h.panTo(A),h.setZoom(15);const L=i.formatted_address||i.name||"";E(A.lat(),A.lng(),!1,L)})}catch{}if(c!=null&&y!=null&&!l.address){const i=await b(c,y);U({address:i||""})}}async function E(c,y,u=!0,i=""){if(!(!S||!h)){if(S.setPosition({lat:c,lng:y}),h.panTo({lat:c,lng:y}),U({lat:c,lng:y}),i)U({address:i});else if(u){const A=await b(c,y);U({address:A||""})}}}ie(()=>[l.lat,l.lng],([c,y])=>{if(!h)return;const u=o(c),i=o(y);u==null||i==null||(S.setPosition({lat:u,lng:i}),h.panTo({lat:u,lng:i}))});function I(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{const{latitude:y,longitude:u}=c.coords;E(y,u,!0),h&&h.setZoom(15)},()=>{},{enableHighAccuracy:!0,timeout:8e3})}return le(async()=>{await Y(),await v()}),(c,y)=>(g(),f("div",Te,[e.label?(g(),f("label",Ge,_(e.label),1)):q("",!0),n("div",Ke,[n("input",{ref_key:"searchEl",ref:p,type:"text",class:"form-input flex-1",placeholder:e.searchPlaceholder},null,8,ze),n("button",{type:"button",class:"px-3 py-2 border rounded",onClick:I},"ðŸ“")]),n("div",{ref_key:"mapEl",ref:m,class:"rounded border",style:{height:"320px"}},null,512)]))}},Ze=ve(Be,[["__scopeId","data-v-c24049d5"]]);function Je(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function fe(e){const r=Je(e);return r&&typeof r=="object"?{en:r.en??"",ar:r.ar??""}:{en:r??"",ar:r??""}}function re(e){var r;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((r=e==null?void 0:e.data)==null?void 0:r.data)?e.data.data:[]}function He(e){return(e==null?void 0:e.data)??(e==null?void 0:e.message)??e}function ne(e){return e?`/storage/${e}`:""}function ge(e){return e?String(e).slice(0,10):""}function X(e={}){const r=fe(e.name),l=fe(e.description),d=Array.isArray(e.home_unit_gallery)?e.home_unit_gallery.map(o=>({id:o.id??void 0,image:o.image,image_url:ne(o.image)})):Array.isArray(e.gallery)?e.gallery.map(o=>({id:o.id??void 0,image:o.image,image_url:ne(o.image)})):[];return{...e,name_en:r.en,name_ar:r.ar,description_en:l.en,description_ar:l.ar,location:e.location??"",lat:e.lat??null,long:e.long??null,start_date:ge(e.start_date),end_date:ge(e.end_date),status:e.status??"",user_id:e.user_id??null,vendor_id:e.vendor_id??null,cover_image_url:ne(e.cover_image),gallery:d}}const K={list:async(e={})=>{const{data:r}=await P.get("/api/units",{params:e});return re(r).map(X)},listByUser:async(e,r={})=>{const{data:l}=await P.get(`/api/units/user/${e}`,{params:r});return re(l).map(X)},listByVendor:async(e,r={})=>{const{data:l}=await P.get(`/api/units/vendor/${e}`,{params:r});return re(l).map(X)},show:async e=>{const{data:r}=await P.get(`/api/units/show/${e}`);return X(He(r))},create:async e=>{const{data:r}=await P.post("/api/units/create",e,{headers:{"Content-Type":"multipart/form-data"}});return r},update:async(e,r)=>{const{data:l}=await P.post(`/api/units/update/${e}`,r,{headers:{"Content-Type":"multipart/form-data"}});return l},remove:async e=>{const{data:r}=await P.delete(`/api/units/delete/${e}`);return r},deleteCover:async e=>{const{data:r}=await P.delete(`/api/units/${e}/cover`);return r},deleteGalleryImage:async(e,r)=>{const{data:l}=await P.delete(`/api/units/${e}/gallery/${r}`);return l}};function Qe({name:e={en:"",ar:""},description:r={en:"",ar:""},location:l,lat:d,long:o,start_date:m,end_date:p,cover_image:h,gallery:S=[],user_id:x,vendor_id:w,status:k,...U}){const b=new FormData;return b.append("name[en]",e.en??""),b.append("name[ar]",e.ar??""),b.append("description[en]",r.en??""),b.append("description[ar]",r.ar??""),b.append("location",l??""),b.append("lat",String(d??"")),b.append("long",String(o??"")),b.append("start_date",m??""),b.append("end_date",p??""),h&&b.append("cover_image",h),(S||[]).forEach((v,E)=>{v&&b.append(`gallery[${E}]`,v)}),b.append("user_id",String(x??"")),b.append("vendor_id",String(w??"")),k&&b.append("status",k),Object.entries(U).forEach(([v,E])=>{E!=null&&E!==""&&b.append(v,E)}),b}function We(e={}){const{name:r,description:l,location:d,lat:o,long:m,start_date:p,end_date:h,cover_image:S,gallery:x,user_id:w,vendor_id:k,status:U,...b}=e,v=new FormData;return r&&(r.en!==void 0&&v.append("name[en]",r.en??""),r.ar!==void 0&&v.append("name[ar]",r.ar??"")),l&&(l.en!==void 0&&v.append("description[en]",l.en??""),l.ar!==void 0&&v.append("description[ar]",l.ar??"")),d!==void 0&&v.append("location",d??""),o!==void 0&&v.append("lat",String(o??"")),m!==void 0&&v.append("long",String(m??"")),p!==void 0&&v.append("start_date",p??""),h!==void 0&&v.append("end_date",h??""),S&&v.append("cover_image",S),Array.isArray(x)&&x.length&&x.forEach((E,I)=>{E&&v.append(`gallery[${I}]`,E)}),w!==void 0&&v.append("user_id",String(w??"")),k!==void 0&&v.append("vendor_id",String(k??"")),U!==void 0&&U!==""&&v.append("status",U),Object.entries(b).forEach(([E,I])=>{I!=null&&I!==""&&v.append(E,I)}),v}function Xe(e){return e===!0||e===1||e==="1"}function ae(e={}){const r=e.profile_image||e.profileImage||null;return{id:e.id,name:e.name||"",email:e.email||"",phone:e.phone||"",gender:e.gender||"",country_code:e.country_code||"",country_name:e.country_name||"",role:e.role||"user",is_enabled:Xe(e.is_enabled),profile_image:r,profile_image_url:r?`/storage/${r}`:null,created_at:e.created_at,updated_at:e.updated_at}}function Ye(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:[]}function me(e){return(e==null?void 0:e.data)??e}const et={list:async()=>{const{data:e}=await P.get("/api/users");return Ye(e).map(ae)},show:async e=>{const{data:r}=await P.get(`/api/users/show/${e}`);return ae(me(r))},edit:async e=>{const{data:r}=await P.get(`/api/users/edit/${e}`);return ae(me(r))},create:async e=>{const{data:r}=await P.post("/api/users/create",e,{headers:{"Content-Type":"multipart/form-data"}});return r},update:async(e,r)=>{const l=typeof FormData<"u"&&r instanceof FormData,{data:d}=await P.post(`/api/users/update/${e}`,r,{headers:l?{"Content-Type":"multipart/form-data"}:void 0});return d},remove:async e=>{const{data:r}=await P.delete(`/api/users/delete/${e}`);return r}},tt={class:"p-6 space-y-6"},rt={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},nt={key:0,class:"text-sm text-gray-500"},at={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-5"},st={class:"relative aspect-[4/3] bg-gray-50"},it=["src"],lt={key:1,class:"absolute inset-0 flex items-center justify-center text-gray-400 text-sm"},ot={class:"absolute top-2 left-2 flex flex-wrap gap-2"},dt={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},ut={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},ct={class:"p-3.5 space-y-3"},pt={class:"text-sm font-semibold text-gray-900 whitespace-pre-wrap break-words"},ft={key:0,class:"text-gray-400"},gt={dir:"rtl"},mt={class:"text-xs text-gray-500"},vt={class:"grid grid-cols-3 gap-2 pt-2 text-xs"},ht={class:"flex gap-2 pt-2"},yt=["onClick"],bt=["onClick"],_t={key:0,class:"col-span-full text-center text-gray-500 py-8"},xt={class:"relative mx-auto w-full max-w-3xl p-4 sm:p-6 h-full flex items-center justify-center"},wt={class:"bg-white rounded-2xl shadow-lg w-full max-h-[min(88vh,900px)] overflow-y-auto focus:outline-none",role:"dialog","aria-modal":"true"},kt={class:"sticky top-0 z-10 bg-white border-b rounded-t-2xl"},Et={class:"flex items-center justify-between px-5 py-3"},Ct={class:"text-lg font-bold"},At={class:"px-5 py-4 space-y-4"},St={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt=["required"],Ut={key:0,class:"mt-1 text-xs text-red-600"},$t=["required"],It={key:0,class:"mt-1 text-xs text-red-600"},Pt={class:"md:col-span-2"},jt=["required"],Dt={key:0,class:"mt-1 text-xs text-red-600"},Lt={class:"md:col-span-2"},Nt=["required"],Ot={key:0,class:"mt-1 text-xs text-red-600"},Rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ft={class:"md:col-span-2"},Mt=["required"],Vt={key:0,class:"mt-1 text-xs text-red-600"},Tt=["required"],Gt={key:0,class:"mt-1 text-xs text-red-600"},Kt=["required"],zt={key:0,class:"mt-1 text-xs text-red-600"},Bt=["required"],Zt={key:0,class:"mt-1 text-xs text-red-600"},Jt=["required"],Ht={key:0,class:"mt-1 text-xs text-red-600"},Qt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Wt=["required"],Xt=["value"],Yt={key:0,class:"mt-1 text-xs text-red-600"},er=["required"],tr=["value"],rr={key:0,class:"mt-1 text-xs text-red-600"},nr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ar={class:"block text-xs text-gray-500 mb-1"},sr=["required"],ir={key:0,class:"mt-1 text-xs text-red-600"},lr={key:1,class:"mt-2 relative inline-block"},or=["src"],dr=["required"],ur={key:0,class:"mt-1 text-xs text-red-600"},cr={key:1,class:"mt-2 flex flex-wrap gap-2"},pr=["src"],fr=["onClick"],gr={key:2,class:"mt-2 flex flex-wrap gap-2"},mr=["src"],vr=["onClick"],hr={key:0,class:"rounded border border-red-200 bg-red-50 text-red-700 px-3 py-2"},yr={class:"sticky bottom-0 z-10 bg-white border-t rounded-b-2xl"},br={class:"px-5 py-3 flex items-center gap-3"},_r=["disabled"],xr={__name:"Index",setup(e){const r=se(()=>!u.value),l=$({}),d=(a,t)=>{if(!t||Array.isArray(t)&&t.length===0){delete l.value[a];return}l.value[a]=Array.isArray(t)?t:[String(t)]},o=a=>{var t;return((t=l.value[a])==null?void 0:t[0])||""},m=a=>!!l.value[a],p=a=>["form-input",m(a)?"border-red-400 focus:ring-red-500":""];function h(){const a=document.querySelector(".max-h-\\[min\\(88vh\\,900px\\)\\]"),t=a==null?void 0:a.querySelector("input.border-red-400, select.border-red-400, textarea.border-red-400");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}function S(){l.value={},T.value="";const a=i.value,t=s=>s!=null&&String(s).trim()!=="";return r.value?(t(a.name.en)||d("name.en","Name (EN) is required"),t(a.name.ar)||d("name.ar","Name (AR) is required"),t(a.description.en)||d("description.en","Description (EN) is required"),t(a.description.ar)||d("description.ar","Description (AR) is required"),t(a.location)||d("location","Location is required"),typeof a.lat=="number"&&a.lat>=-90&&a.lat<=90||d("lat","Latitude must be between -90 and 90"),typeof a.long=="number"&&a.long>=-180&&a.long<=180||d("long","Longitude must be between -180 and 180"),t(a.start_date)||d("start_date","Start date is required"),t(a.end_date)||d("end_date","End date is required"),t(a.start_date)&&t(a.end_date)&&new Date(a.end_date)<new Date(a.start_date)&&d("end_date","End date must be after or equal to start date"),t(a.user_id)||d("user_id","User is required"),t(a.vendor_id)||d("vendor_id","Vendor is required"),a.cover_image||d("cover_image","Cover image is required"),(!Array.isArray(a.gallery)||a.gallery.length===0)&&d("gallery","Add at least one gallery image")):(a.lat!==null&&(a.lat<-90||a.lat>90)&&d("lat","Latitude must be between -90 and 90"),a.long!==null&&(a.long<-180||a.long>180)&&d("long","Longitude must be between -180 and 180"),t(a.start_date)&&t(a.end_date)&&new Date(a.end_date)<new Date(a.start_date)&&d("end_date","End date must be after or equal to start date")),Object.keys(l.value).length?(T.value="Please fix the highlighted fields.",!1):!0}const x=$([]);async function w(a){confirm("Delete this image?")&&(await K.deleteGalleryImage(u.value,a),x.value=x.value.filter(t=>t.id!==a))}async function k(){confirm("Delete cover image?")&&(await K.deleteCover(u.value),A.value=null)}function U(a){var s,C,W,ue;const t=(C=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:C.errors;if(!t)return!1;l.value={};for(const[$e,Ie]of Object.entries(t))d($e,Ie);return T.value=((ue=(W=a==null?void 0:a.response)==null?void 0:W.data)==null?void 0:ue.message)||"Validation failed. Please review the fields below.",!0}const b=$([]),v=$([]);async function E(){const a=await et.list();b.value=a.map(s=>({id:s.id,name:s.name,email:s.email}));const t=await Ne.list();v.value=t.map(s=>({id:s.id,name:s.name,email:s.email}))}le(async()=>{await Promise.all([H(),E()])});const I=$([]),c=$(!1),y=$(!1),u=$(null),i=$({name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]}),A=$(null),L=$([]),V=$(!1),T=$(""),he=$({});function ye(a){return`/units-management/${a}/docs`}function be(a){return`/units-management/${a}/drawing`}function _e(a){return`/units-management/${a}/gallery`}function xe(a){return`/units-management/${a}/timeline`}function we(a){return`/units-management/${a}/reports`}function ke(a){return`/units-management/${a}/contractors`}function Ee(a){return`/units-management/${a}/phases`}function oe(){i.value={name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"under_construction",cover_image:null,gallery:[]},A.value=null,L.value=[],T.value="",he.value={},u.value=null}function Ce(){oe(),y.value=!0}async function Ae(a){oe(),u.value=a.id;const t=await K.show(a.id);i.value.name.en=t.name_en||"",i.value.name.ar=t.name_ar||"",i.value.description.en=t.description_en||"",i.value.description.ar=t.description_ar||"",i.value.location=t.location||"",i.value.lat=t.lat,i.value.long=t.long,i.value.start_date=t.start_date||"",i.value.end_date=t.end_date||"",i.value.user_id=t.user_id??null,i.value.vendor_id=t.vendor_id??null,i.value.status=t.status||"",A.value=t.cover_image_url||null,i.value.cover_image=null,x.value=Array.isArray(t.gallery)?t.gallery:[],L.value=[],i.value.gallery=[],y.value=!0}ie(()=>y.value,async a=>{a&&await Y()}),ie(()=>y.value,a=>{document.body.style.overflow=a?"hidden":""});function J(){y.value=!1}function Se(a){var s;const t=((s=a.target.files)==null?void 0:s[0])||null;i.value.cover_image=t,A.value=t?URL.createObjectURL(t):A.value}function qe(a){const t=Array.from(a.target.files||[]);i.value.gallery=t,L.value=t.map(s=>URL.createObjectURL(s))}async function H(){c.value=!0;try{I.value=await K.list()}finally{c.value=!1}}async function de(){var a,t,s;V.value=!0;try{if(!S()){await Y(),h();return}if(u.value){const C=We(i.value);await K.update(u.value,C)}else{const C=Qe(i.value);await K.create(C)}await H(),J()}catch(C){((a=C==null?void 0:C.response)==null?void 0:a.status)===422&&U(C)?(await Y(),h()):T.value=((s=(t=C==null?void 0:C.response)==null?void 0:t.data)==null?void 0:s.message)||(C==null?void 0:C.message)||"Request failed"}finally{V.value=!1}}async function Ue(a){confirm(`Delete unit #${a.id}?`)&&(await K.remove(a.id),await H())}return le(H),(a,t)=>(g(),f(B,null,[N(F(Pe),{title:"Units"}),N(Le,null,{default:M(()=>[n("div",tt,[n("div",{class:"flex items-center justify-between"},[t[15]||(t[15]=n("h2",{class:"text-2xl font-bold text-dash-title"},"Units",-1)),n("button",{onClick:Ce,class:"bg-black text-white px-3 py-2 rounded hover:bg-gray-700 disabled:opacity-50"}," + Add Unit ")]),n("div",rt,[n("div",{class:"flex items-center justify-between mb-4"},[t[16]||(t[16]=n("h3",{class:"text-lg font-semibold text-gray-800"},"All Units",-1)),n("button",{onClick:H,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),c.value?(g(),f("div",nt,"Loadingâ€¦")):(g(),f("div",at,[(g(!0),f(B,null,Q(I.value,s=>(g(),f("div",{key:s.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[n("div",st,[s.cover_image_url?(g(),f("img",{key:0,src:s.cover_image_url,class:"absolute inset-0 w-full h-full object-cover",alt:""},null,8,it)):(g(),f("div",lt," No Cover ")),t[17]||(t[17]=n("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1)),n("div",ot,[n("span",dt,_(s.status||"â€”"),1),n("span",ut,_(s.location||"No location"),1)])]),n("div",ct,[n("div",pt,[O(_(s.name_en||"â€”")+" ",1),s.name_ar?(g(),f("span",ft," / ")):q("",!0),n("span",gt,_(s.name_ar),1)]),n("div",mt,[t[18]||(t[18]=n("span",{class:"font-medium"},"Period:",-1)),O(" "+_(s.start_date||"â€”")+" â†’ "+_(s.end_date||"â€”"),1)]),n("div",vt,[N(F(G),{href:ye(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[19]||(t[19]=[O(" Docs ")])),_:2},1032,["href"]),N(F(G),{href:_e(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[20]||(t[20]=[O(" Gallery ")])),_:2},1032,["href"]),N(F(G),{href:be(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[21]||(t[21]=[O(" Drawing ")])),_:2},1032,["href"]),N(F(G),{href:we(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[22]||(t[22]=[O(" Reports ")])),_:2},1032,["href"]),N(F(G),{href:Ee(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[23]||(t[23]=[O(" Phases ")])),_:2},1032,["href"]),N(F(G),{href:xe(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[24]||(t[24]=[O(" Timeline ")])),_:2},1032,["href"]),N(F(G),{href:ke(s.id),class:"px-2 py-1.5 rounded-lg border text-center hover:bg-gray-50"},{default:M(()=>t[25]||(t[25]=[O(" Assignments ")])),_:2},1032,["href"])]),n("div",ht,[n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50",onClick:C=>Ae(s)}," Edit ",8,yt),n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:C=>Ue(s)}," Delete ",8,bt)])])]))),128)),I.value.length?q("",!0):(g(),f("div",_t," No units found. "))]))]),y.value?(g(),f("div",{key:0,class:"fixed inset-0 z-50",onKeydown:je(J,["esc"])},[n("div",{class:"absolute inset-0 bg-black/40 back-drop",onClick:J,"aria-hidden":"true"}),n("div",xt,[n("div",wt,[n("div",kt,[n("div",Et,[n("h3",Ct,_(u.value?"Edit Unit":"Add Unit"),1),n("button",{onClick:J,class:"text-gray-400 hover:text-gray-600","aria-label":"Close"}," âœ• ")])]),n("div",At,[n("form",{onSubmit:De(de,["prevent"]),class:"space-y-4"},[n("div",St,[n("div",null,[t[26]||(t[26]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN)*",-1)),D(n("input",{class:j(p("name.en")),"onUpdate:modelValue":t[0]||(t[0]=s=>i.value.name.en=s),type:"text",required:!u.value},null,10,qt),[[R,i.value.name.en]]),o("name.en")?(g(),f("p",Ut,_(o("name.en")),1)):q("",!0)]),n("div",null,[t[27]||(t[27]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR)*",-1)),D(n("input",{class:j(p("name.ar")),"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.name.ar=s),type:"text",required:!u.value},null,10,$t),[[R,i.value.name.ar]]),o("name.ar")?(g(),f("p",It,_(o("name.ar")),1)):q("",!0)]),n("div",Pt,[t[28]||(t[28]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)*",-1)),D(n("textarea",{class:j(p("description.en")),"onUpdate:modelValue":t[2]||(t[2]=s=>i.value.description.en=s),type:"text",required:!u.value},null,10,jt),[[R,i.value.description.en]]),o("description.en")?(g(),f("p",Dt,_(o("description.en")),1)):q("",!0)]),n("div",Lt,[t[29]||(t[29]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)*",-1)),D(n("textarea",{class:j(p("description.ar")),"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.description.ar=s),type:"text",required:!u.value},null,10,Nt),[[R,i.value.description.ar]]),o("description.ar")?(g(),f("p",Ot,_(o("description.ar")),1)):q("",!0)])]),n("div",Rt,[n("div",Ft,[N(Ze,{label:"Pick on map",lat:i.value.lat,"onUpdate:lat":t[4]||(t[4]=s=>i.value.lat=s),lng:i.value.long,"onUpdate:lng":t[5]||(t[5]=s=>i.value.long=s),address:i.value.location,"onUpdate:address":t[6]||(t[6]=s=>i.value.location=s)},null,8,["lat","lng","address"])]),n("div",null,[t[30]||(t[30]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Location*",-1)),D(n("input",{class:j(p("location")),"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.location=s),type:"text",required:!u.value,disabled:""},null,10,Mt),[[R,i.value.location]]),o("location")?(g(),f("p",Vt,_(o("location")),1)):q("",!0)]),n("div",null,[t[31]||(t[31]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Latitude (-90..90)*",-1)),D(n("input",{class:j(p("lat")),"onUpdate:modelValue":t[8]||(t[8]=s=>i.value.lat=s),type:"number",step:"any",min:"-90",max:"90",required:!u.value,disabled:""},null,10,Tt),[[R,i.value.lat,void 0,{number:!0}]]),o("lat")?(g(),f("p",Gt,_(o("lat")),1)):q("",!0)]),n("div",null,[t[32]||(t[32]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Longitude (-180..180)*",-1)),D(n("input",{class:j(p("long")),"onUpdate:modelValue":t[9]||(t[9]=s=>i.value.long=s),type:"number",step:"any",min:"-180",max:"180",required:!u.value,disabled:""},null,10,Kt),[[R,i.value.long,void 0,{number:!0}]]),o("long")?(g(),f("p",zt,_(o("long")),1)):q("",!0)]),n("div",null,[t[33]||(t[33]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Start Date*",-1)),D(n("input",{class:j(p("start_date")),"onUpdate:modelValue":t[10]||(t[10]=s=>i.value.start_date=s),type:"date",required:!u.value},null,10,Bt),[[R,i.value.start_date]]),o("start_date")?(g(),f("p",Zt,_(o("start_date")),1)):q("",!0)]),n("div",null,[t[34]||(t[34]=n("label",{class:"block text-xs text-gray-500 mb-1"},"End Date*",-1)),D(n("input",{class:j(p("end_date")),"onUpdate:modelValue":t[11]||(t[11]=s=>i.value.end_date=s),type:"date",required:!u.value},null,10,Jt),[[R,i.value.end_date]]),o("end_date")?(g(),f("p",Ht,_(o("end_date")),1)):q("",!0)])]),n("div",Qt,[n("div",null,[t[36]||(t[36]=n("label",{class:"block text-xs text-gray-500 mb-1"},"User *",-1)),D(n("select",{class:j(p("user_id")),"onUpdate:modelValue":t[12]||(t[12]=s=>i.value.user_id=s),required:!u.value},[t[35]||(t[35]=n("option",{value:"",disabled:""},"Select a user",-1)),(g(!0),f(B,null,Q(b.value,s=>(g(),f("option",{key:s.id,value:s.id},_(s.name)+" â€” "+_(s.email),9,Xt))),128))],10,Wt),[[ee,i.value.user_id,void 0,{number:!0}]]),o("user_id")?(g(),f("p",Yt,_(o("user_id")),1)):q("",!0)]),n("div",null,[t[38]||(t[38]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Project Manager *",-1)),D(n("select",{class:j(p("vendor_id")),"onUpdate:modelValue":t[13]||(t[13]=s=>i.value.vendor_id=s),required:!u.value},[t[37]||(t[37]=n("option",{value:"",disabled:""},"Select a Project Manager",-1)),(g(!0),f(B,null,Q(v.value,s=>(g(),f("option",{key:s.id,value:s.id},_(s.name)+" â€” "+_(s.email),9,tr))),128))],10,er),[[ee,i.value.vendor_id,void 0,{number:!0}]]),o("vendor_id")?(g(),f("p",rr,_(o("vendor_id")),1)):q("",!0)]),n("div",null,[t[40]||(t[40]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),D(n("select",{class:"form-input","onUpdate:modelValue":t[14]||(t[14]=s=>i.value.status=s)},t[39]||(t[39]=[n("option",{value:"under_construction",selected:""},"under_construction",-1),n("option",{value:"completed"},"completed",-1)]),512),[[ee,i.value.status]])])]),n("div",nr,[n("div",null,[n("label",ar," Cover Image* "+_(u.value?"(optional to replace)":""),1),n("input",{class:j(p("cover_image")),type:"file",accept:"image/*",onChange:Se,required:!u.value},null,42,sr),o("cover_image")?(g(),f("p",ir,_(o("cover_image")),1)):q("",!0),A.value?(g(),f("div",lr,[n("img",{src:A.value,class:"w-40 h-28 object-cover rounded border"},null,8,or),n("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow hover:bg-red-600",onClick:k}," âœ• ")])):q("",!0)]),n("div",null,[t[41]||(t[41]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Gallery* (multiple on create)",-1)),n("input",{class:j(p("gallery")),type:"file",accept:"image/*",multiple:"",onChange:qe,required:!u.value},null,42,dr),o("gallery")?(g(),f("p",ur,_(o("gallery")),1)):q("",!0),x.value.length?(g(),f("div",cr,[(g(!0),f(B,null,Q(x.value,s=>(g(),f("div",{key:s.id,class:"relative inline-block"},[n("img",{src:s.image_url,class:"w-24 h-16 object-cover rounded border"},null,8,pr),n("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center shadow hover:bg-red-600",onClick:C=>w(s.id)}," âœ• ",8,fr)]))),128))])):q("",!0),L.value.length?(g(),f("div",gr,[(g(!0),f(B,null,Q(L.value,(s,C)=>(g(),f("div",{key:C,class:"relative inline-block"},[n("img",{src:s,class:"w-24 h-16 object-cover rounded border"},null,8,mr),n("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center shadow hover:bg-red-600",onClick:W=>L.value.splice(C,1)}," âœ• ",8,vr)]))),128))])):q("",!0)])]),T.value?(g(),f("div",hr,_(T.value),1)):q("",!0)],32)]),n("div",yr,[n("div",br,[n("button",{disabled:V.value,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60",onClick:de},_(V.value?"Savingâ€¦":u.value?"Update":"Create"),9,_r),n("button",{type:"button",class:"px-3 py-2 border rounded",onClick:J},"Cancel")])])])])],32)):q("",!0)])]),_:1})],64))}},Ar=ve(xr,[["__scopeId","data-v-a37ec0d6"]]);export{Ar as default};
