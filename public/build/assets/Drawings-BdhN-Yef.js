import{m as F,p as g,i as T,r as j,q as X,c as Y,o as c,w as Z,b as a,a as N,j as b,k as _,f as p,h as V,F as E,s as L,t as h}from"./app-F6bKQEA1.js";import{_ as ee}from"./AuthenticatedLayout-BX6gmCjd.js";import{_ as te}from"./UnitNav-BymYBZZD.js";import{F as B,a as ae}from"./FolderPicker-xsnkLTyN.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";function se(n){try{return typeof n=="string"?JSON.parse(n):n}catch{return n}}function re(n){var l;return Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.message)?n.message:Array.isArray((l=n==null?void 0:n.data)==null?void 0:l.data)?n.data.data:[]}function le(n){return n?`/storage/${n}`:""}function ie(n={}){const l=se(n.title),o=l&&typeof l=="object"?l:{en:l??"",ar:l??""};return{id:n.id,unit_id:n.unit_id,folder_id:n.folder_id,date:n.date??"",image:n.image??"",image_url:le(n.image),title_en:o.en??"",title_ar:o.ar??"",created_at:n.created_at,updated_at:n.updated_at}}const C={list:async n=>{const{data:l}=await F.get(`/api/unit-drawing/${n}`);return re(l).map(ie)},create:async n=>{const{data:l}=await F.post("/api/unit-drawing/create",n,{headers:{"Content-Type":"multipart/form-data"}});return l},update:async n=>{const{data:l}=await F.post("/api/unit-drawing/update",n,{headers:{"Content-Type":"multipart/form-data"}});return l},remove:async n=>{const{data:l}=await F.delete(`/api/unit-drawing/delete/${n}`);return l}};function oe(n,l=[]){const o=new FormData;return o.append("unit_id",String(n)),l.forEach((r,u)=>{var v,d;o.append(`data[${u}][folder_id]`,String(r.folder_id??"")),o.append(`data[${u}][date]`,r.date??""),o.append(`data[${u}][title][en]`,((v=r==null?void 0:r.title)==null?void 0:v.en)??""),o.append(`data[${u}][title][ar]`,((d=r==null?void 0:r.title)==null?void 0:d.ar)??""),r.image&&o.append(`data[${u}][image]`,r.image)}),o}function de(n,l=[]){const o=new FormData;return o.append("unit_id",String(n)),l.forEach((r,u)=>{var v,d;o.append(`data[${u}][id]`,String(r.id??"")),o.append(`data[${u}][folder_id]`,String(r.folder_id??"")),r.date!==void 0&&o.append(`data[${u}][date]`,r.date??""),((v=r==null?void 0:r.title)==null?void 0:v.en)!==void 0&&o.append(`data[${u}][title][en]`,r.title.en??""),((d=r==null?void 0:r.title)==null?void 0:d.ar)!==void 0&&o.append(`data[${u}][title][ar]`,r.title.ar??""),r.image&&o.append(`data[${u}][image]`,r.image)}),o}const ue={class:"p-6 space-y-6"},ce={class:"flex items-center justify-between"},pe=["href"],fe={class:"bg-white p-4 rounded shadow"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ge={class:"mt-4"},ve={key:0,class:"mt-3 flex flex-wrap gap-2"},xe=["href"],be=["src"],_e={class:"mt-4 flex items-center gap-3"},ye=["disabled"],he={key:0,class:"text-red-600 text-sm"},we={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},ke={key:0,class:"text-sm text-gray-500"},Ue={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-5"},$e={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},De=["src"],Fe={key:1,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Ve=["href"],Ce={key:2,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Ae={class:"break-all px-2"},Ie=["href"],Se={class:"p-3.5 space-y-3 text-sm"},je=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],Te={class:"text-[11px]"},Ee=["onChange"],Le={key:0,class:"mt-1 text-[11px] text-gray-500"},Be={class:"flex items-center gap-2 pt-2"},qe=["onClick","disabled"],Oe=["onClick"],Pe={key:0,class:"col-span-full text-center text-gray-500 py-8"},ze={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(n){const l=g([]),o=g(!1);async function r(){o.value=!0;try{l.value=await ae.list("drawing",u.unitId)}finally{o.value=!1}}const u=n,v=T(()=>"/units-management"),d=g({folder_id:null,date:"",title:{en:"",ar:""}}),w=g([]),k=g([]),U=g(!1),$=g(""),q=T(()=>{var s,e;return!!d.value.folder_id&&!!d.value.date&&!!((s=d.value.title.en)!=null&&s.trim())&&!!((e=d.value.title.ar)!=null&&e.trim())&&w.value.length>0});function O(s){const e=Array.from(s.target.files||[]);w.value=e,k.value=e.map(t=>URL.createObjectURL(t))}function A(s){return s?`/storage/${s.image}`:""}function P(s){return s!=null&&s.image?/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|heic|heif|avif)$/i.test(s.image):!1}function z(s){return s!=null&&s.image?/\.pdf$/i.test(s.image):!1}function J(s){return s!=null&&s.image?decodeURIComponent(s.image.split("/").pop()):"Unknown file"}async function M(){var s,e;U.value=!0,$.value="";try{const t=w.value.map(i=>({folder_id:d.value.folder_id,date:d.value.date,title:{...d.value.title},image:i})),f=oe(u.unitId,t);await C.create(f),await y(),w.value=[],k.value=[],d.value.title={en:"",ar:""}}catch(t){console.error(t),$.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Upload failed"}finally{U.value=!1}}const I=g([]),S=g(!1),m=j({}),x=j({}),D=j({});function G(s){s.forEach(e=>{m[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function y(){S.value=!0;try{const s=await C.list(u.unitId);I.value=s,G(s)}finally{S.value=!1}}function R(s){const e=s==null?void 0:s.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}function H(s,e){var f;const t=((f=e.target.files)==null?void 0:f[0])||null;t&&(x[s]=t)}async function K(s){var t,f;const e=m[s];if(e){D[s]=!0;try{const i=[{id:s,folder_id:e.folder_id,date:e.date,title:e.title,image:x[s]}],W=de(u.unitId,i);await C.update(W),delete x[s],await y()}catch(i){console.error(i),alert(((f=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:f.message)||"Update failed")}finally{D[s]=!1}}}async function Q(s){confirm("Delete this drawing?")&&(await C.remove(s),await y())}return X(async()=>{await r(),await y()}),(s,e)=>(c(),Y(ee,null,{default:Z(()=>[a("div",ue,[a("div",ce,[e[8]||(e[8]=a("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Drawings",-1)),a("a",{href:v.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,pe)]),N(te,{"unit-id":Number(n.unitId),cols:2},null,8,["unit-id"]),a("div",fe,[e[12]||(e[12]=a("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),a("div",me,[N(B,{type:"drawing",label:"Folder *",fileType:"drawing",modelValue:d.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value.folder_id=t),options:l.value,unitId:u.unitId,onCreated:e[1]||(e[1]=t=>l.value.unshift(t)),onRefresh:r},null,8,["modelValue","options","unitId"]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),b(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.date=t),class:"form-input",type:"date",required:""},null,512),[[_,d.value.date]])]),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),b(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.title.en=t),class:"form-input",type:"text",required:""},null,512),[[_,d.value.title.en]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),b(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.title.ar=t),class:"form-input",type:"text",required:""},null,512),[[_,d.value.title.ar]])])]),a("div",ge,[a("input",{type:"file",multiple:"",onChange:O},null,32),k.value.length?(c(),p("div",ve,[(c(!0),p(E,null,L(k.value,(t,f)=>(c(),p("a",{key:f,href:t,target:"_blank",rel:"noopener"},[a("img",{src:t,class:"w-24 h-16 object-cover rounded border"},null,8,be)],8,xe))),128))])):V("",!0)]),a("div",_e,[a("button",{disabled:U.value||!q.value,onClick:M,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},h(U.value?"Uploadingâ€¦":"Upload"),9,ye),$.value?(c(),p("span",he,h($.value),1)):V("",!0)])]),a("div",we,[a("div",{class:"flex items-center justify-between mb-4"},[e[13]||(e[13]=a("h3",{class:"text-lg font-semibold text-gray-800"},"Drawings",-1)),a("button",{onClick:y,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),S.value?(c(),p("div",ke,"Loadingâ€¦")):(c(),p("div",Ue,[(c(!0),p(E,null,L(I.value,t=>{var f;return c(),p("div",{key:t.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[a("div",$e,[P(t)?(c(),p("img",{key:0,src:A(t),class:"absolute inset-0 w-full h-full object-cover"},null,8,De)):z(t)?(c(),p("div",Fe,[e[14]||(e[14]=a("div",{class:"text-4xl mb-2"},"ðŸ“•",-1)),e[15]||(e[15]=a("span",{class:"px-2"},"PDF Document",-1)),a("a",{href:A(t),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ve)])):(c(),p("div",Ce,[e[16]||(e[16]=a("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),a("span",Ae,h(J(t)),1),a("a",{href:A(t),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ie)])),e[17]||(e[17]=a("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1))]),a("div",Se,[a("div",null,[e[18]||(e[18]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date *",-1)),b(a("input",{"onUpdate:modelValue":i=>m[t.id].date=i,class:"form-input",type:"date"},null,8,je),[[_,m[t.id].date]])]),N(B,{type:"drawing",label:"Folder *",modelValue:m[t.id].folder_id,"onUpdate:modelValue":i=>m[t.id].folder_id=i,options:l.value,onCreated:e[5]||(e[5]=i=>l.value.unshift(i)),onRefresh:r},null,8,["modelValue","onUpdate:modelValue","options"]),a("div",null,[e[19]||(e[19]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),b(a("textarea",{"onUpdate:modelValue":i=>m[t.id].title.en=i,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[6]||(e[6]=i=>R(i))},null,40,Ne),[[_,m[t.id].title.en]])]),a("div",null,[e[20]||(e[20]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),b(a("textarea",{"onUpdate:modelValue":i=>m[t.id].title.ar=i,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[7]||(e[7]=i=>R(i))},null,40,Re),[[_,m[t.id].title.ar]])]),a("div",Te,[e[21]||(e[21]=a("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),a("input",{type:"file",onChange:i=>H(t.id,i)},null,40,Ee),x!=null&&x[t.id]?(c(),p("p",Le," Selected: "+h((f=x[t.id])==null?void 0:f.name),1)):V("",!0)]),a("div",Be,[a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:i=>K(t.id),disabled:D[t.id]},h(D[t.id]?"Savingâ€¦":"Save"),9,qe),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:i=>Q(t.id)}," Delete ",8,Oe)])])])}),128)),I.value.length?V("",!0):(c(),p("div",Pe," No drawings found. "))]))])])]),_:1}))}},Qe=ne(ze,[["__scopeId","data-v-ba88ed79"]]);export{Qe as default};
