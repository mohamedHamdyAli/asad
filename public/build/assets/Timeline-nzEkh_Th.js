import{m as C,r as S,i as j,p as w,q as Y,c as U,o as c,w as O,b as a,a as q,u as v,h as g,f as m,t as _,F as Z,s as ee,j as R,k as M}from"./app-unPPlrTv.js";import{_ as te}from"./AuthenticatedLayout-WDK6EzOR.js";import{_ as ae}from"./UnitNav-BggN1prt.js";import{c as E,a as ie,b as N,F as se,d as J,E as B}from"./index.esm-nJk38Dwr.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";function le(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function re(e){var l;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((l=e==null?void 0:e.data)==null?void 0:l.data)?e.data.data:[]}function oe(e){return e?`/storage/${e}`:""}function z(e){return(e||"").split("/").pop()||""}function de(e){return(z(e).split(".").pop()||"").toLowerCase()}function ce(e){const l=de(e);return l==="pdf"?"ðŸ“• PDF":l==="doc"||l==="docx"?"ðŸ“ DOC":l==="xls"||l==="xlsx"?"ðŸ“Š XLS":"ðŸ“„"}function ue(e={}){const l=le(e.title),o=l&&typeof l=="object"?l:{en:l??"",ar:l??""},s=oe(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:s,file_name:z(e.file),file_icon:ce(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const D={list:async e=>{const{data:l}=await C.get(`/api/unit-timeline/${e}`);return re(l).map(ue)},create:async e=>{const{data:l}=await C.post("/api/unit-timeline/create",e,{headers:{"Content-Type":"multipart/form-data"}});return l},update:async e=>{const{data:l}=await C.post("/api/unit-timeline/update",e,{headers:{"Content-Type":"multipart/form-data"}});return l},remove:async e=>{const{data:l}=await C.delete(`/api/unit-timeline/delete/${e}`);return l}};function fe(e,l=[]){const o=new FormData;return o.append("unit_id",String(e)),l.forEach((s,u)=>{var h,p;o.append(`data[${u}][title][en]`,((h=s==null?void 0:s.title)==null?void 0:h.en)??""),o.append(`data[${u}][title][ar]`,((p=s==null?void 0:s.title)==null?void 0:p.ar)??""),s.file&&o.append(`data[${u}][file]`,s.file)}),o}function me(e,l=[]){const o=new FormData;return o.append("unit_id",String(e)),l.forEach((s,u)=>{var h,p;o.append(`data[${u}][id]`,String(s.id??"")),((h=s==null?void 0:s.title)==null?void 0:h.en)!==void 0&&o.append(`data[${u}][title][en]`,s.title.en??""),((p=s==null?void 0:s.title)==null?void 0:p.ar)!==void 0&&o.append(`data[${u}][title][ar]`,s.title.ar??""),s.file&&o.append(`data[${u}][file]`,s.file)}),o}const pe={class:"p-6 space-y-6"},ge={class:"flex items-center justify-between"},xe=["href"],_e={class:"bg-white p-4 rounded shadow"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={class:"mt-4"},ve=["onChange"],ye={key:1,class:"mt-3 text-sm text-gray-600"},we={class:"mt-4 flex items-center gap-3"},ke=["disabled"],$e={key:0,class:"text-red-600 text-sm"},Ae={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},Te={key:0,class:"text-sm text-gray-500"},Fe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},Ce={class:"h-32 bg-gray-50 flex flex-col items-center justify-center text-center p-3 relative"},Se={class:"text-3xl text-gray-600"},Ue={class:"mt-2 text-xs text-gray-700 break-words max-w-[90%] whitespace-pre-wrap"},qe={class:"p-3.5 space-y-3 text-sm"},Ee=["onUpdate:modelValue"],Ne={key:0,class:"error"},De=["onUpdate:modelValue"],Ie={key:0,class:"error"},Ve={class:"text-[11px]"},Be=["onChange"],Le={key:0,class:"mt-1 text-[11px] text-gray-500"},je={class:"flex items-center gap-2 pt-2"},Oe=["href"],Re=["onClick","disabled"],Me=["onClick"],Je={key:0,class:"col-span-full text-center text-gray-500 py-8"},P=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Pe={__name:"Timeline",props:{unitId:{type:[Number,String],required:!0}},setup(e){const l=E({title:E({en:N().required("English title is required"),ar:N().required("Arabic title is required")}),files:ie().nullable().test("required","Please select at least one file",n=>Array.isArray(n)&&n.length>0)}),o=E({title:E({en:N().required("English title is required"),ar:N().required("Arabic title is required")})}),s=S({}),u=e,h=j(()=>"/units-management"),p=w({title:{en:"",ar:""},files:[]}),k=w([]),A=w(!1),T=w("");j(()=>{var n,t;return!!((n=p.value.title.en)!=null&&n.trim())&&!!((t=p.value.title.ar)!=null&&t.trim())&&k.value.length>0});function G(n,t){const i=Array.from(n.target.files||[]);k.value=i,t("files",i)}async function H(n){var t,i;A.value=!0,T.value="";try{const r=n.files.map(x=>({title:{...n.title},file:x})),d=fe(u.unitId,r);await D.create(d),await $(),k.value=[],p.value.title={en:"",ar:""}}catch(r){console.error(r),T.value=((i=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:i.message)||(r==null?void 0:r.message)||"Upload failed"}finally{A.value=!1}}const I=w([]),V=w(!1),y=S({}),b=S({}),F=S({});function X(n){n.forEach(t=>{y[t.id]={title:{en:t.title_en||"",ar:t.title_ar||""}}})}async function $(){V.value=!0;try{const n=await D.list(u.unitId);I.value=n,X(n)}finally{V.value=!1}}function K(n,t){var r;const i=((r=t.target.files)==null?void 0:r[0])||null;i&&(b[n]=i)}async function Q(n){var i,r;const t=y[n];if(t){s[n]={};try{await o.validate(t,{abortEarly:!1})}catch(d){d.inner.forEach(x=>{s[n][x.path]=x.message});return}F[n]=!0;try{const d=[{id:n,title:t.title,file:b[n]}],x=me(u.unitId,d);await D.update(x),delete b[n],await $()}catch(d){console.error(d),alert(((r=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:r.message)||"Update failed")}finally{F[n]=!1}}}function L(n){const t=n==null?void 0:n.target;t&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}async function W(n){confirm("Delete this timeline item?")&&(await D.remove(n),await $())}return Y($),(n,t)=>(c(),U(te,null,{default:O(()=>[a("div",pe,[a("div",ge,[t[2]||(t[2]=a("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Timeline",-1)),a("a",{href:h.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,xe)]),q(ae,{"unit-id":Number(e.unitId),cols:2},null,8,["unit-id"]),q(v(se),{"validation-schema":v(l),"validate-on-mount":!1,"initial-values":p.value,onSubmit:H},{default:O(({setFieldValue:i,submitCount:r})=>[a("div",_e,[t[5]||(t[5]=a("h3",{class:"text-lg font-bold mb-3"},"Add Timeline Items",-1)),a("div",he,[a("div",null,[t[3]||(t[3]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),q(v(J),{name:"title.en",class:"form-input"}),r>0?(c(),U(v(B),{key:0,name:"title.en",class:"error"})):g("",!0)]),a("div",null,[t[4]||(t[4]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),q(v(J),{name:"title.ar",class:"form-input"}),r>0?(c(),U(v(B),{key:0,name:"title.ar",class:"error"})):g("",!0)])]),a("div",be,[a("input",{type:"file",multiple:"",accept:P,onChange:d=>G(d,i)},null,40,ve),r>0?(c(),U(v(B),{key:0,name:"files",class:"error"})):g("",!0),k.value.length?(c(),m("div",ye,_(k.value.length)+" file(s) selected ",1)):g("",!0)]),a("div",we,[a("button",{type:"submit",disabled:A.value,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},_(A.value?"Uploadingâ€¦":"Upload"),9,ke),T.value?(c(),m("span",$e,_(T.value),1)):g("",!0)])])]),_:1},8,["validation-schema","initial-values"]),a("div",Ae,[a("div",{class:"flex items-center justify-between mb-4"},[t[6]||(t[6]=a("h3",{class:"text-lg font-semibold text-gray-800"},"Timeline Items",-1)),a("button",{onClick:$,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),V.value?(c(),m("div",Te,"Loadingâ€¦")):(c(),m("div",Fe,[(c(!0),m(Z,null,ee(I.value,i=>{var r,d,x;return c(),m("div",{key:i.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[a("div",Ce,[a("div",Se,_(i.file_icon.split(" ")[0]),1),a("div",Ue,_(i.file_name),1)]),a("div",qe,[a("div",null,[t[7]||(t[7]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),R(a("textarea",{"onUpdate:modelValue":f=>y[i.id].title.en=f,class:"form-input !h-auto min-h-9",rows:"1",onInput:t[0]||(t[0]=f=>L(f))},null,40,Ee),[[M,y[i.id].title.en]]),(r=s==null?void 0:s[i.id])!=null&&r["title.en"]?(c(),m("p",Ne,_(s[i.id]["title.en"]),1)):g("",!0)]),a("div",null,[t[8]||(t[8]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),R(a("textarea",{"onUpdate:modelValue":f=>y[i.id].title.ar=f,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:t[1]||(t[1]=f=>L(f))},null,40,De),[[M,y[i.id].title.ar]]),(d=s==null?void 0:s[i.id])!=null&&d["title.ar"]?(c(),m("p",Ie,_(s[i.id]["title.ar"]),1)):g("",!0)]),a("div",Ve,[t[9]||(t[9]=a("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),a("input",{type:"file",accept:P,onChange:f=>K(i.id,f)},null,40,Be),b!=null&&b[i.id]?(c(),m("p",Le," Selected: "+_((x=b[i.id])==null?void 0:x.name),1)):g("",!0)]),a("div",je,[i.file_url?(c(),m("a",{key:0,href:i.file_url,target:"_blank",class:"px-3 py-1.5 text-sm rounded-lg border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100"}," Open ",8,Oe)):g("",!0),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:f=>Q(i.id),disabled:F[i.id]},_(F[i.id]?"Savingâ€¦":"Save"),9,Re),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:f=>W(i.id)}," Delete ",8,Me)])])])}),128)),I.value.length?g("",!0):(c(),m("div",Je," No timeline items found. "))]))])])]),_:1}))}},Qe=ne(Pe,[["__scopeId","data-v-92a38978"]]);export{Qe as default};
