import{m as _,p as c,i as q,B as G,q as H,f as r,o as u,a as n,u as i,g as J,w as x,b as t,j as K,h as A,k as Q,F as w,s as N,t as p,n as W}from"./app-BrbL6Oim.js";import{_ as X}from"./AuthenticatedLayout-DsYQAd5H.js";import{U as Y}from"./units-BQbEMCUh.js";import{U as Z}from"./users--bHIiLBn.js";import{c as tt,a as S,d as B,F as et,b as y,E as k}from"./index.esm-DyduwyoQ.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={list:async()=>{const{data:o}=await _.get("/api/unit-issues");return o.data??[]},show:async o=>{const{data:l}=await _.get(`/api/unit-issues/show/${o}`);return l.data},create:async o=>{const{data:l}=await _.post("/api/unit-issues/create",{data:o});return l},update:async(o,l)=>{const{data:b}=await _.post(`/api/unit-issues/update/${o}`,{data:l});return b},remove:async o=>{const{data:l}=await _.delete(`/api/unit-issues/delete/${o}`);return l}},at={class:"p-6 space-y-6"},nt={class:"bg-white rounded-xl shadow border overflow-hidden"},it={class:"w-full text-sm"},ot={class:"px-4 py-3"},lt={class:"px-4 py-3"},rt={class:"px-4 py-3"},ut={class:"px-4 py-3"},dt={class:"px-4 py-3 text-right space-x-2"},ct=["onClick"],pt=["onClick"],mt={key:0},vt={class:"flex justify-between items-center"},ft={class:"text-sm text-gray-600"},_t={class:"flex gap-2"},xt=["disabled"],yt=["disabled"],bt={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},gt={class:"bg-white w-full max-w-lg rounded-xl p-6"},ht={class:"space-y-3"},wt=["value"],kt=["value"],P=10,Ct={__name:"UnitIssues",setup(o){const l=c([]),b=c([]),D=c([]),g=c(""),m=c(1),C=c(!1),F=c(null),U=c({}),V=tt({unit_id:B().required(),user_id:B().required(),title:S().required(),description:S().required(),status:S().oneOf(["open","close"]).required()});async function $(){const[a,s,e]=await Promise.all([E.list(),Y.list(),Z.list()]);l.value=a,b.value=s,D.value=e}const I=q(()=>{const a=g.value.toLowerCase();return l.value.filter(s=>{var e,d,v,f,h,j;return((e=s.title)==null?void 0:e.toLowerCase().includes(a))||((f=(v=(d=s.unit)==null?void 0:d.name)==null?void 0:v.en)==null?void 0:f.toLowerCase().includes(a))||((j=(h=s.user)==null?void 0:h.name)==null?void 0:j.toLowerCase().includes(a))})});G(g,()=>m.value=1);const L=q(()=>Math.ceil(I.value.length/P)),O=q(()=>{const a=(m.value-1)*P;return I.value.slice(a,a+P)});function R(a){F.value=a.id,U.value={unit_id:a.unit_id,user_id:a.user_id,title:a.title,description:a.description,status:a.status},C.value=!0}function M(){C.value=!1,U.value={}}async function T(a){await E.update(F.value,{...a,unit_id:Number(a.unit_id),user_id:Number(a.user_id)}),M(),$()}async function z(a){confirm("Delete this issue?")&&(await E.remove(a),$())}return H($),(a,s)=>(u(),r(w,null,[n(i(J),{title:"Unit Issues"}),n(X,null,{default:x(()=>[t("div",at,[s[10]||(s[10]=t("h2",{class:"text-2xl font-semibold"},"Unit Issues",-1)),K(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>g.value=e),class:"form-input w-72",placeholder:"Search by title, unit or user"},null,512),[[Q,g.value]]),t("div",nt,[t("table",it,[s[4]||(s[4]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Unit"),t("th",{class:"px-4 py-3 text-left"},"User"),t("th",{class:"px-4 py-3 text-left"},"Title"),t("th",{class:"px-4 py-3 text-left"},"Status"),t("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),t("tbody",null,[(u(!0),r(w,null,N(O.value,e=>{var d,v,f;return u(),r("tr",{key:e.id,class:"border-t"},[t("td",ot,p(((v=(d=e.unit)==null?void 0:d.name)==null?void 0:v.en)??e.unit_id),1),t("td",lt,p(((f=e.user)==null?void 0:f.name)??e.user_id),1),t("td",rt,p(e.title),1),t("td",ut,[t("span",{class:W(["px-2 py-1 rounded text-xs",e.status==="open"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"])},p(e.status),3)]),t("td",dt,[t("button",{class:"text-blue-600",onClick:h=>R(e)}," Edit ",8,ct),t("button",{class:"text-red-600",onClick:h=>z(e.id)}," Delete ",8,pt)])])}),128)),I.value.length===0?(u(),r("tr",mt,s[3]||(s[3]=[t("td",{colspan:"5",class:"text-center py-6 text-gray-500"}," No issues found ",-1)]))):A("",!0)])])]),t("div",vt,[t("span",ft," Page "+p(m.value)+" of "+p(L.value),1),t("div",_t,[t("button",{class:"px-3 py-1 border rounded",disabled:m.value===1,onClick:s[1]||(s[1]=e=>m.value--)}," Prev ",8,xt),t("button",{class:"px-3 py-1 border rounded",disabled:m.value===L.value,onClick:s[2]||(s[2]=e=>m.value++)}," Next ",8,yt)])]),C.value?(u(),r("div",bt,[t("div",gt,[s[9]||(s[9]=t("h3",{class:"text-lg font-semibold mb-4"},"Edit Issue",-1)),n(i(et),{"validation-schema":i(V),"initial-values":U.value,onSubmit:T},{default:x(()=>[t("div",ht,[n(i(y),{name:"unit_id",as:"select",class:"form-input"},{default:x(()=>[s[5]||(s[5]=t("option",{value:""},"Select Unit",-1)),(u(!0),r(w,null,N(b.value,e=>{var d;return u(),r("option",{key:e.id,value:e.id},p(((d=e.name)==null?void 0:d.en)??`Unit #${e.id}`),9,wt)}),128))]),_:1}),n(i(k),{name:"unit_id",class:"error"}),n(i(y),{name:"user_id",as:"select",class:"form-input"},{default:x(()=>[s[6]||(s[6]=t("option",{value:""},"Select User",-1)),(u(!0),r(w,null,N(D.value,e=>(u(),r("option",{key:e.id,value:e.id},p(e.name??`User #${e.id}`),9,kt))),128))]),_:1}),n(i(k),{name:"user_id",class:"error"}),n(i(y),{name:"title",class:"form-input",placeholder:"Title"}),n(i(k),{name:"title",class:"error"}),n(i(y),{name:"description",as:"textarea",rows:"3",class:"form-input",placeholder:"Description"}),n(i(k),{name:"description",class:"error"}),n(i(y),{name:"status",as:"select",class:"form-input"},{default:x(()=>s[7]||(s[7]=[t("option",{value:"open"},"Open",-1),t("option",{value:"close"},"Close",-1)])),_:1})]),t("div",{class:"flex justify-end gap-2 mt-4"},[t("button",{type:"button",class:"px-4 py-2 border rounded",onClick:M}," Cancel "),s[8]||(s[8]=t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values"])])])):A("",!0)])]),_:1})],64))}},Et=st(Ct,[["__scopeId","data-v-c152dbfc"]]);export{Et as default};
