import{m as A,p as v,i as ee,r as N,q as te,c as ae,o as p,w as ne,b as n,a as L,j as b,k as h,f,h as w,F as q,s as B,t as U}from"./app-Y0-e7yD3.js";import{_ as le}from"./AuthenticatedLayout-C13Ajq7k.js";import{F as O,a as se}from"./FolderPicker-D3h2UAdf.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ie(l){try{return typeof l=="string"?JSON.parse(l):l}catch{return l}}function oe(l){var i;return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l==null?void 0:l.message)?l.message:Array.isArray((i=l==null?void 0:l.data)==null?void 0:i.data)?l.data.data:[]}function de(l){return l?`/storage/${l}`:""}function ue(l={}){const i=ie(l.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""};return{id:l.id,unit_id:l.unit_id,folder_id:l.folder_id,date:l.date??"",image:l.image??"",image_url:de(l.image),title_en:o.en??"",title_ar:o.ar??"",created_at:l.created_at,updated_at:l.updated_at}}const D={list:async l=>{const{data:i}=await A.get(`/api/unit-gallery/${l}`);return oe(i).map(ue)},create:async l=>{const{data:i}=await A.post("/api/unit-gallery/create",l,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async l=>{const{data:i}=await A.post("/api/unit-gallery/update",l,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async l=>{const{data:i}=await A.delete(`/api/unit-gallery/delete/${l}`);return i}};function ce(l,i=[]){const o=new FormData;return o.append("unit_id",String(l)),i.forEach((r,u)=>{var y,d;o.append(`data[${u}][folder_id]`,String(r.folder_id??"")),o.append(`data[${u}][date]`,r.date??""),o.append(`data[${u}][title][en]`,((y=r==null?void 0:r.title)==null?void 0:y.en)??""),o.append(`data[${u}][title][ar]`,((d=r==null?void 0:r.title)==null?void 0:d.ar)??""),r.image&&o.append(`data[${u}][image]`,r.image)}),o}function pe(l,i=[]){const o=new FormData;return o.append("unit_id",String(l)),i.forEach((r,u)=>{var y,d;o.append(`data[${u}][id]`,String(r.id??"")),o.append(`data[${u}][folder_id]`,String(r.folder_id??"")),r.date!==void 0&&o.append(`data[${u}][date]`,r.date??""),((y=r==null?void 0:r.title)==null?void 0:y.en)!==void 0&&o.append(`data[${u}][title][en]`,r.title.en??""),((d=r==null?void 0:r.title)==null?void 0:d.ar)!==void 0&&o.append(`data[${u}][title][ar]`,r.title.ar??""),r.image&&o.append(`data[${u}][image]`,r.image)}),o}const fe={class:"p-6 space-y-6"},me={class:"flex items-center justify-between"},ge=["href"],ve={class:"bg-white p-4 rounded shadow"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ye={class:"mt-4"},_e={key:0,class:"mt-3 flex flex-wrap gap-2"},be=["src"],he={class:"mt-4 flex items-center gap-3"},ke=["disabled"],we={key:0,class:"text-red-600 text-sm"},Ue={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},$e={key:0,class:"text-sm text-gray-500"},Ie={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 2xl:grid-cols-4 gap-5"},Ve={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},Fe=["src"],Ce={key:1,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Ae=["href"],De={key:2,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Ee={class:"break-all px-2"},Se=["href"],je={class:"p-3.5 space-y-3"},Ne=["onUpdate:modelValue"],Re=["onUpdate:modelValue","placeholder"],Te=["onUpdate:modelValue","placeholder"],Ge={class:"text-[11px]"},Le=["onChange"],qe={key:0,class:"mt-1 text-[11px] text-gray-500"},Be={class:"flex items-center gap-2 pt-1"},Oe=["onClick","disabled"],Pe=["onClick"],ze={key:0,class:"ml-auto inline-flex items-center rounded-full bg-amber-50 text-amber-700 px-2.5 py-0.5 text-[11px] border border-amber-200"},Je={key:0,class:"col-span-full text-center text-gray-500 py-8"},Me={__name:"Gallery",props:{unitId:{type:[Number,String],required:!0}},setup(l){const i=v([]),o=v(!1);async function r(){o.value=!0;try{i.value=await se.list("gallery",u.unitId)}finally{o.value=!1}}const u=l,y=ee(()=>"/units-management"),d=v({folder_id:null,date:"",title:{en:"",ar:""}}),$=v([]),I=v([]),V=v(!1),F=v("");function P(t){const e=Array.from(t.target.files||[]);$.value=e,I.value=e.map(s=>URL.createObjectURL(s))}function E(t){return t?`/storage/${t.image}`:""}function z(t){return t!=null&&t.image?/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|heic|heif|avif)$/i.test(t.image):!1}function J(t){return t!=null&&t.image?/\.pdf$/i.test(t.image):!1}function M(t){return t!=null&&t.image?decodeURIComponent(t.image.split("/").pop()):"Unknown file"}async function H(){var t,e;V.value=!0,F.value="";try{const s=$.value.map(a=>({folder_id:d.value.folder_id,date:d.value.date,title:{...d.value.title},image:a})),m=ce(u.unitId,s);await D.create(m),await k(),$.value=[],I.value=[],d.value.title={en:"",ar:""}}catch(s){console.error(s),F.value=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Upload failed"}finally{V.value=!1}}const S=v([]),j=v(!1),R=v({});function K(t){const e={};t.forEach(s=>{e[s.id]={date:s.date||"",folder_id:s.folder_id??null,title:{en:s.title_en||"",ar:s.title_ar||""}}}),R.value=e}function Q(t,e){var s,m,a,x;return(t==null?void 0:t.date)===(e==null?void 0:e.date)&&(t==null?void 0:t.folder_id)===(e==null?void 0:e.folder_id)&&((s=t==null?void 0:t.title)==null?void 0:s.en)===((m=e==null?void 0:e.title)==null?void 0:m.en)&&((a=t==null?void 0:t.title)==null?void 0:a.ar)===((x=e==null?void 0:e.title)==null?void 0:x.ar)}function T(t){const e=g[t.id],s=R.value[t.id];return!Q(e,s)||!!_[t.id]}function G(t){const e=t==null?void 0:t.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}const g=N({}),_=N({}),C=N({});function W(t){t.forEach(e=>{g[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function k(){j.value=!0;try{const t=await D.list(u.unitId);S.value=t,W(t),K(t)}finally{j.value=!1}}function X(t,e){var m;const s=((m=e.target.files)==null?void 0:m[0])||null;s&&(_[t]=s)}async function Y(t){var s,m;const e=g[t];if(e){C[t]=!0;try{const a=[{id:t,folder_id:e.folder_id,date:e.date,title:e.title,image:_[t]}],x=pe(u.unitId,a);await D.update(x),delete _[t],await k()}catch(a){console.error(a),alert(((m=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:m.message)||"Update failed")}finally{C[t]=!1}}}async function Z(t){confirm("Delete this image?")&&(await D.remove(t),await k())}return te(async()=>{await r(),await k()}),(t,e)=>(p(),ae(le,null,{default:ne(()=>{var s,m;return[n("div",fe,[n("div",me,[e[8]||(e[8]=n("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Gallery",-1)),n("a",{href:y.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,ge)]),n("div",ve,[e[12]||(e[12]=n("h3",{class:"text-lg font-bold mb-3"},"Add Images",-1)),n("div",xe,[L(O,{type:"gallery",label:"Folder *",modelValue:d.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value.folder_id=a),options:i.value,unitId:u.unitId,onCreated:e[1]||(e[1]=a=>i.value.unshift(a)),onRefresh:r},null,8,["modelValue","options","unitId"]),n("div",null,[e[9]||(e[9]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),b(n("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.date=a),class:"form-input",type:"date",required:""},null,512),[[h,d.value.date]])]),n("div",null,[e[10]||(e[10]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),b(n("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.title.en=a),class:"form-input",type:"text",required:""},null,512),[[h,d.value.title.en]])]),n("div",null,[e[11]||(e[11]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),b(n("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.title.ar=a),class:"form-input",type:"text",required:""},null,512),[[h,d.value.title.ar]])])]),n("div",ye,[n("input",{type:"file",multiple:"",onChange:P},null,32),I.value.length?(p(),f("div",_e,[(p(!0),f(q,null,B(I.value,(a,x)=>(p(),f("img",{key:x,src:a,class:"w-24 h-16 object-cover rounded border"},null,8,be))),128))])):w("",!0)]),n("div",he,[n("button",{disabled:V.value||!$.value.length||!d.value.folder_id||!d.value.date||!((s=d.value.title.en)!=null&&s.trim())||!((m=d.value.title.ar)!=null&&m.trim()),onClick:H,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},U(V.value?"Uploadingâ€¦":"Upload"),9,ke),F.value?(p(),f("span",we,U(F.value),1)):w("",!0)])]),n("div",Ue,[n("div",{class:"flex items-center justify-between mb-4"},[e[13]||(e[13]=n("h3",{class:"text-lg font-semibold text-gray-800"},"Images",-1)),n("button",{onClick:k,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),j.value?(p(),f("div",$e,"Loadingâ€¦")):(p(),f("div",Ie,[(p(!0),f(q,null,B(S.value,a=>{var x;return p(),f("div",{key:a.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[n("div",Ve,[z(a)?(p(),f("img",{key:0,src:E(a),class:"absolute inset-0 w-full h-full object-cover"},null,8,Fe)):J(a)?(p(),f("div",Ce,[e[14]||(e[14]=n("div",{class:"text-4xl mb-2"},"ðŸ“•",-1)),e[15]||(e[15]=n("span",{class:"px-2"},"PDF Document",-1)),n("a",{href:E(a),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ae)])):(p(),f("div",De,[e[16]||(e[16]=n("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),n("span",Ee,U(M(a)),1),n("a",{href:E(a),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Se)])),e[17]||(e[17]=n("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1))]),n("div",je,[e[22]||(e[22]=n("div",{class:"text-xs text-gray-500"},[n("span",{class:"font-medium text-gray-700"},"Folder")],-1)),L(O,{type:"gallery",label:" ",modelValue:g[a.id].folder_id,"onUpdate:modelValue":c=>g[a.id].folder_id=c,options:i.value,unitId:u.unitId,onCreated:e[5]||(e[5]=c=>i.value.unshift(c)),onRefresh:r},null,8,["modelValue","onUpdate:modelValue","options","unitId"]),n("div",null,[e[18]||(e[18]=n("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date",-1)),b(n("input",{"onUpdate:modelValue":c=>g[a.id].date=c,class:"form-input",type:"date"},null,8,Ne),[[h,g[a.id].date]])]),n("div",null,[e[19]||(e[19]=n("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),b(n("textarea",{"onUpdate:modelValue":c=>g[a.id].title.en=c,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[6]||(e[6]=c=>G(c)),placeholder:a.title_en?"":"Enter English title"},null,40,Re),[[h,g[a.id].title.en]])]),n("div",null,[e[20]||(e[20]=n("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),b(n("textarea",{"onUpdate:modelValue":c=>g[a.id].title.ar=c,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[7]||(e[7]=c=>G(c)),placeholder:a.title_ar?"":"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"},null,40,Te),[[h,g[a.id].title.ar]])]),n("div",Ge,[e[21]||(e[21]=n("label",{class:"block text-gray-500 mb-1"},"Replace Image",-1)),n("input",{type:"file",onChange:c=>X(a.id,c)},null,40,Le),_[a.id]?(p(),f("p",qe," Selected: "+U((x=_[a.id])==null?void 0:x.name),1)):w("",!0)]),n("div",Be,[n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:c=>Y(a.id),disabled:C[a.id]||!T(a)},U(C[a.id]?"Savingâ€¦":"Save"),9,Oe),n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:c=>Z(a.id)}," Delete ",8,Pe),T(a)?(p(),f("span",ze," Unsaved changes ")):w("",!0)])])])}),128)),S.value.length?w("",!0):(p(),f("div",Je," No images found. "))]))])])]}),_:1}))}},Xe=re(Me,[["__scopeId","data-v-6830a712"]]);export{Xe as default};
