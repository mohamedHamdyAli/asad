import{m,p as u,i as I,C as R,q as A,f as x,o as _,a as y,u as f,g as T,w as $,b as t,j as G,h as b,k as H,F as L,s as J,t as o,n as K,z as Q}from"./app-BzxX0dK2.js";import{_ as W}from"./AuthenticatedLayout-Ci_ZkNzf.js";import{c as X,b as Y,F as Z,d as tt,E as et}from"./index.esm-BJqBHimS.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={list:async()=>{const{data:l}=await m.get("/api/unit-issues");return l.data??[]},show:async l=>{const{data:i}=await m.get(`/api/unit-issues/show/${l}`);return i.data},create:async l=>{const{data:i}=await m.post("/api/unit-issues/create",{data:l});return i},update:async(l,i)=>{const{data:n}=await m.post(`/api/unit-issues/update/${l}`,{data:i});return n},remove:async l=>{const{data:i}=await m.delete(`/api/unit-issues/delete/${l}`);return i}},at={class:"p-6 space-y-6"},nt={class:"bg-white rounded-xl shadow border overflow-hidden"},ot={class:"w-full text-sm"},lt={class:"px-4 py-3"},it={class:"px-4 py-3"},ut={class:"px-4 py-3"},rt={class:"px-4 py-3"},dt={class:"px-4 py-3 text-right space-x-2"},ct=["onClick"],pt=["onClick"],vt={key:0},xt={class:"flex justify-between items-center"},_t={class:"text-sm text-gray-600"},mt={class:"flex gap-2"},yt=["disabled"],ft=["disabled"],gt={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 back-drop"},bt={class:"bg-white w-full max-w-lg rounded-xl p-6"},ht={class:"space-y-4"},wt={key:0,class:"border rounded-lg p-3 bg-gray-50"},kt={class:"flex gap-4 items-start"},Ct=["src"],It={class:"space-y-1 text-sm"},$t={class:"font-semibold"},Ut={class:"text-gray-500 text-xs"},St={class:"text-xs text-gray-600"},Et={class:"text-xs text-gray-500"},Pt={class:"text-sm"},jt={class:"text-gray-600"},Dt={class:"text-sm"},Ft={class:"text-gray-600 whitespace-pre-line"},S=10,Lt={__name:"UnitIssues",setup(l){const{show:i}=Q(),n=u(null),E=u([]),M=u([]),N=u([]),g=u(""),p=u(1),h=u(!1),P=u(null),w=u({}),V=X({status:Y().oneOf(["open","close"]).required()});async function k(){const[a,e,s]=await Promise.all([U.list()]);E.value=a,M.value=e,N.value=s}const C=I(()=>{const a=g.value.toLowerCase();return E.value.filter(e=>{var s,r,d,c,v,F;return((s=e.title)==null?void 0:s.toLowerCase().includes(a))||((c=(d=(r=e.unit)==null?void 0:r.name)==null?void 0:d.en)==null?void 0:c.toLowerCase().includes(a))||((F=(v=e.user)==null?void 0:v.name)==null?void 0:F.toLowerCase().includes(a))})});R(g,()=>p.value=1);const j=I(()=>Math.ceil(C.value.length/S)),q=I(()=>{const a=(p.value-1)*S;return C.value.slice(a,a+S)});function z(a){P.value=a.id,n.value=a,w.value={title:a.title,description:a.description,status:a.status},h.value=!0}function D(){h.value=!1,w.value={},n.value=null}async function B(a){try{await U.update(P.value,{status:a.status}),D(),k()}catch(e){i(e)}}async function O(a){confirm("Delete this issue?")&&(await U.remove(a),k())}return A(k),(a,e)=>(_(),x(L,null,[y(f(T),{title:"Unit Issues"}),y(W,null,{default:$(()=>[t("div",at,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold"},"Unit Issues",-1)),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"form-input w-72",placeholder:"Search by title, unit or user"},null,512),[[H,g.value]]),t("div",nt,[t("table",ot,[e[4]||(e[4]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Unit"),t("th",{class:"px-4 py-3 text-left"},"User"),t("th",{class:"px-4 py-3 text-left"},"Title"),t("th",{class:"px-4 py-3 text-left"},"Status"),t("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),t("tbody",null,[(_(!0),x(L,null,J(q.value,s=>{var r,d,c;return _(),x("tr",{key:s.id,class:"border-t"},[t("td",lt,o(((d=(r=s.unit)==null?void 0:r.name)==null?void 0:d.en)??s.unit_id),1),t("td",it,o(((c=s.user)==null?void 0:c.name)??s.user_id),1),t("td",ut,o(s.title),1),t("td",rt,[t("span",{class:K(["px-2 py-1 rounded text-xs",s.status==="open"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"])},o(s.status),3)]),t("td",dt,[t("button",{class:"text-blue-600",onClick:v=>z(s)}," Edit ",8,ct),t("button",{class:"text-red-600",onClick:v=>O(s.id)}," Delete ",8,pt)])])}),128)),C.value.length===0?(_(),x("tr",vt,e[3]||(e[3]=[t("td",{colspan:"5",class:"text-center py-6 text-gray-500"}," No issues found ",-1)]))):b("",!0)])])]),t("div",xt,[t("span",_t," Page "+o(p.value)+" of "+o(j.value),1),t("div",mt,[t("button",{class:"px-3 py-1 border rounded",disabled:p.value===1,onClick:e[1]||(e[1]=s=>p.value--)}," Prev ",8,yt),t("button",{class:"px-3 py-1 border rounded",disabled:p.value===j.value,onClick:e[2]||(e[2]=s=>p.value++)}," Next ",8,ft)])]),h.value?(_(),x("div",gt,[t("div",bt,[y(f(Z),{"validation-schema":f(V),"initial-values":w.value,onSubmit:B},{default:$(()=>{var s,r,d,c,v;return[t("div",ht,[(s=n.value)!=null&&s.unit?(_(),x("div",wt,[t("div",kt,[n.value.unit.cover_image?(_(),x("img",{key:0,src:`/storage/${n.value.unit.cover_image}`,class:"w-28 h-20 object-cover rounded border"},null,8,Ct)):b("",!0),t("div",It,[t("div",$t,o((r=n.value.unit.name)==null?void 0:r.en),1),t("div",Ut,o((d=n.value.unit.name)==null?void 0:d.ar),1),t("div",St," ðŸ“ "+o(n.value.unit.location),1),t("div",Et,o(n.value.unit.start_date)+" â†’ "+o(n.value.unit.end_date),1)])])])):b("",!0),t("div",Pt,[e[5]||(e[5]=t("div",{class:"font-medium"},"Issue title",-1)),t("div",jt,o((c=n.value)==null?void 0:c.title),1)]),t("div",Dt,[e[6]||(e[6]=t("div",{class:"font-medium"},"Description",-1)),t("div",Ft,o((v=n.value)==null?void 0:v.description),1)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),y(f(tt),{name:"status",as:"select",class:"form-input"},{default:$(()=>e[7]||(e[7]=[t("option",{value:"open"},"Open",-1),t("option",{value:"close"},"Close",-1)])),_:1}),y(f(et),{name:"status",class:"error"})])]),t("div",{class:"flex justify-end gap-2 mt-4"},[t("button",{type:"button",class:"px-4 py-2 border rounded",onClick:D}," Cancel "),e[9]||(e[9]=t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded"}," Save ",-1))])]}),_:1},8,["validation-schema","initial-values"])])])):b("",!0)])]),_:1})],64))}},zt=st(Lt,[["__scopeId","data-v-04ceb875"]]);export{zt as default};
