import{m as y,p as u,A as j,q as L,f as d,o as c,h as x,b as r,t as v,F as D,s as I,j as A,k as N}from"./app-Y0-e7yD3.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";function U(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function F(e={}){const a=U(e.name),n=a&&typeof a=="object"?a:{en:a??"",ar:a??""};return{id:e.id,file_type:e.file_type,name_en:n.en??"",name_ar:n.ar??"",label:n.en||n.ar||`Folder #${e.id}`,folder_image:e.folder_image?`/storage/${e.folder_image}`:null,unit_id:e.unit_id??null}}function q(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}const w={list:async(e,a=null)=>{const{data:n}=await y.get(`/api/folder/${e}`,{params:a?{unit_id:a}:{}});return q(n).map(F)},create:async e=>{const{data:a}=await y.post("/api/folder/create",e,{headers:{"Content-Type":"multipart/form-data"}}),n=(a==null?void 0:a.data)??a;return F(n)},update:async(e,a)=>{const{data:n}=await y.post(`/api/folder/update/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}});return F((n==null?void 0:n.data)??n)},remove:async e=>{const{data:a}=await y.delete(`/api/folder/delete/${e}`);return a}};function B({file_type:e,name:a={en:"",ar:""},folder_image:n=null,unit_id:m=null}){const s=new FormData;return s.append("file_type",e),s.append("name[en]",a.en??""),s.append("name[ar]",a.ar??""),m&&s.append("unit_id",m),n&&s.append("folder_image",n),s}const R={key:0,class:"block text-xs text-gray-500 mb-1"},T={class:"flex gap-2"},z=["disabled","value"],E={value:"",disabled:""},J=["value"],O={key:1,class:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center"},P={class:"bg-white rounded-xl p-4 w-full max-w-md relative"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},H={class:"md:col-span-2"},K=["src"],Q={class:"mt-4 flex justify-end gap-2"},W=["disabled"],X={key:0,class:"mt-2 text-sm text-red-600"},Y={__name:"FolderPicker",props:{type:{type:String,required:!0},modelValue:{type:[Number,String,null],default:null},label:{type:String,default:"Folder"},options:{type:Array,default:null},unitId:{type:[Number,String],required:!0}},emits:["update:modelValue","created","refresh"],setup(e,{emit:a}){const n=e,m=a,s=u(!1),f=u(n.options??[]);j(()=>n.options,i=>{Array.isArray(i)&&(f.value=i)}),L(()=>{n.options||S()});const _=u(!1),g=u(!1),p=u(""),o=u({name:{en:"",ar:""},folder_image:null}),b=u(null);function C(i){var l;const t=((l=i.target.files)==null?void 0:l[0])||null;o.value.folder_image=t,b.value=t?URL.createObjectURL(t):null}function k(){_.value=!1,p.value="",o.value={name:{en:"",ar:""},folder_image:null},b.value=null}function V(i){const t=Number(i);return Number.isNaN(t)?null:t}async function S(){if(n.options){m("refresh");return}s.value=!0;try{f.value=await w.list(n.type,n.unitId)}finally{s.value=!1}}async function $(){var i,t;g.value=!0,p.value="";try{const l=B({file_type:n.type,unit_id:n.unitId,name:o.value.name,folder_image:o.value.folder_image}),h=await w.create(l);f.value=[h,...f.value],m("created",h),m("update:modelValue",h.id),k()}catch(l){p.value=((t=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Create failed"}finally{g.value=!1}}return(i,t)=>(c(),d("div",null,[e.label?(c(),d("label",R,v(e.label),1)):x("",!0),r("div",T,[r("select",{class:"form-input flex-1",disabled:s.value,value:e.modelValue??"",onChange:t[0]||(t[0]=l=>i.$emit("update:modelValue",V(l.target.value)))},[r("option",E,v(s.value?"Loading folders…":"Select folder"),1),(c(!0),d(D,null,I(f.value,l=>(c(),d("option",{key:l.id,value:l.id},v(l.label),9,J))),128))],40,z),r("button",{type:"button",class:"px-2 py-1 border rounded",onClick:t[1]||(t[1]=l=>_.value=!0)}," + New ")]),_.value?(c(),d("div",O,[r("div",P,[r("button",{class:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",onClick:k}," ✕ "),t[7]||(t[7]=r("h3",{class:"text-lg font-semibold mb-3"},"Create Folder",-1)),r("div",G,[r("div",null,[t[4]||(t[4]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN) *",-1)),A(r("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.name.en=l),type:"text",class:"form-input"},null,512),[[N,o.value.name.en]])]),r("div",null,[t[5]||(t[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR) *",-1)),A(r("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.name.ar=l),type:"text",class:"form-input"},null,512),[[N,o.value.name.ar]])]),r("div",H,[t[6]||(t[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Image (optional)",-1)),r("input",{type:"file",accept:"image/*",onChange:C},null,32),b.value?(c(),d("img",{key:0,src:b.value,class:"mt-2 w-24 h-16 object-cover rounded border"},null,8,K)):x("",!0)])]),r("div",Q,[r("button",{class:"px-3 py-1 border rounded",onClick:k}," Cancel "),r("button",{class:"px-3 py-1 bg-green-600 text-white rounded disabled:opacity-60",disabled:g.value||!o.value.name.en.trim()||!o.value.name.ar.trim(),onClick:$},v(g.value?"Saving…":"Create"),9,W)]),p.value?(c(),d("div",X,v(p.value),1)):x("",!0)])])):x("",!0)]))}},te=M(Y,[["__scopeId","data-v-6b7e957a"]]);export{te as F,w as a};
