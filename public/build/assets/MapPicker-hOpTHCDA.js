import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as O,p as x,B as R,q as D,A as F,f as M,o as N,h as T,b as _,t as q}from"./app-BWauP3u0.js";function $(a,e,t,n){function o(s){return s instanceof t?s:new t(function(h){h(s)})}return new(t||(t=Promise))(function(s,h){function c(d){try{m(n.next(d))}catch(p){h(p)}}function f(d){try{m(n.throw(d))}catch(p){h(p)}}function m(d){d.done?s(d.value):o(d.value).then(c,f)}m((n=n.apply(a,[])).next())})}function K(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var P,A;function U(){return A||(A=1,P=function a(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(o=n;o--!==0;)if(!a(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[o]))return!1;for(o=n;o--!==0;){var h=s[o];if(!a(e[h],t[h]))return!1}return!0}return e!==e&&t!==t}),P}var G=U(),B=K(G);const j="__googleMapsScriptId";var k;(function(a){a[a.INITIALIZED=0]="INITIALIZED",a[a.LOADING=1]="LOADING",a[a.SUCCESS=2]="SUCCESS",a[a.FAILURE=3]="FAILURE"})(k||(k={}));class E{constructor({apiKey:e,authReferrerPolicy:t,channel:n,client:o,id:s=j,language:h,libraries:c=[],mapIds:f,nonce:m,region:d,retries:p=3,url:y="https://maps.googleapis.com/maps/api/js",version:w}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=n,this.client=o,this.id=s||j,this.language=h,this.libraries=c,this.mapIds=f,this.nonce=m,this.region=d,this.retries=p,this.url=y,this.version=w,E.instance){if(!B(this.options,E.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(E.instance.options)}`);return E.instance}E.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?k.FAILURE:this.done?k.SUCCESS:this.loading?k.LOADING:k.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(n=>{n?t(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}const n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(s=>!n[s]&&delete n[s]),!((t=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||t===void 0)&&t.importLibrary||(s=>{let h,c,f,m="The Google Maps JavaScript API",d="google",p="importLibrary",y="__ib__",w=document,v=window;v=v[d]||(v[d]={});const b=v.maps||(v.maps={}),I=new Set,r=new URLSearchParams,l=()=>h||(h=new Promise((u,i)=>$(this,void 0,void 0,function*(){var g;yield c=w.createElement("script"),c.id=this.id,r.set("libraries",[...I]+"");for(f in s)r.set(f.replace(/[A-Z]/g,S=>"_"+S[0].toLowerCase()),s[f]);r.set("callback",d+".maps."+y),c.src=this.url+"?"+r,b[y]=u,c.onerror=()=>h=i(Error(m+" could not load.")),c.nonce=this.nonce||((g=w.querySelector("script[nonce]"))===null||g===void 0?void 0:g.nonce)||"",w.head.append(c)})));b[p]?console.warn(m+" only loads once. Ignoring:",s):b[p]=(u,...i)=>I.add(u)&&l().then(()=>b[p](u,...i))})(n);const o=this.libraries.map(s=>this.importLibrary(s));o.length||o.push(this.importLibrary("core")),Promise.all(o).then(()=>this.callback(),s=>{const h=new ErrorEvent("error",{error:s});this.loadErrorCallback(h)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const Z={class:"space-y-2"},z={key:0,class:"block text-xs text-gray-500"},J={class:"flex gap-2"},V=["placeholder"],H={__name:"MapPicker",props:{label:{type:String,default:"Select location"},searchPlaceholder:{type:String,default:"Search place‚Ä¶"},lat:{type:[Number,String],default:null},lng:{type:[Number,String],default:null},address:{type:String,default:""},fallbackCenter:{type:Object,default:()=>({lat:30.0444,lng:31.2357})},zoom:{type:Number,default:13},apiKey:{type:String,default:"AIzaSyD6l04ETuUP7BfQ7MqpL2vMWEalLxNj0d4"}},emits:["update:lat","update:lng","update:address"],setup(a,{emit:e}){const t=a,n=e,o=r=>{if(typeof r=="number")return Number.isFinite(r)?r:null;if(r===""||r==null)return null;const l=Number(r);return Number.isFinite(l)?l:null};O(()=>{const r=o(t.lat);return r==null?"-":r.toFixed(6)}),O(()=>{const r=o(t.lng);return r==null?"-":r.toFixed(6)});const s=x(null),h=x(null);let c,f,m,d,p=null;function y({lat:r,lng:l,address:u}){r!=null&&n("update:lat",r),l!=null&&n("update:lng",l),u!==void 0&&n("update:address",u)}function w(r,l){return new Promise(u=>{if(!d)return u("");d.geocode({location:{lat:r,lng:l}},(i,g)=>{g==="OK"&&i&&i.length?u(i[0].formatted_address||""):u("")})})}async function v(){try{p=await new E({apiKey:t.apiKey,version:"weekly",libraries:["places"]}).load()}catch(i){console.error("Google Maps failed to load:",i);return}d=new p.maps.Geocoder;const r=o(t.lat),l=o(t.lng),u=r!=null&&l!=null?{lat:r,lng:l}:t.fallbackCenter;c=new p.maps.Map(s.value,{center:u,zoom:t.zoom,mapTypeControl:!1,streetViewControl:!1}),f=new p.maps.Marker({position:u,map:c,draggable:!0}),c.addListener("click",i=>{const g=i.latLng;b(g.lat(),g.lng(),!0)}),f.addListener("dragend",()=>{const i=f.getPosition();b(i.lat(),i.lng(),!0)});try{m=new p.maps.places.Autocomplete(h.value,{fields:["geometry","formatted_address","name"]}),m.addListener("place_changed",()=>{var C;const i=m.getPlace();if(!((C=i==null?void 0:i.geometry)!=null&&C.location))return;const g=i.geometry.location;c.panTo(g),c.setZoom(15);const S=i.formatted_address||i.name||"";b(g.lat(),g.lng(),!1,S)})}catch{}if(r!=null&&l!=null&&!t.address){const i=await w(r,l);y({address:i||""})}}async function b(r,l,u=!0,i=""){if(!(!f||!c)){if(f.setPosition({lat:r,lng:l}),c.panTo({lat:r,lng:l}),y({lat:r,lng:l}),i)y({address:i});else if(u){const g=await w(r,l);y({address:g||""})}}}R(()=>[t.lat,t.lng],([r,l])=>{if(!c)return;const u=o(r),i=o(l);u==null||i==null||(f.setPosition({lat:u,lng:i}),c.panTo({lat:u,lng:i}))});function I(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(r=>{const{latitude:l,longitude:u}=r.coords;b(l,u,!0),c&&c.setZoom(15)},()=>{},{enableHighAccuracy:!0,timeout:8e3})}return D(async()=>{await F(),await v()}),(r,l)=>(N(),M("div",Z,[a.label?(N(),M("label",z,q(a.label),1)):T("",!0),_("div",J,[_("input",{ref_key:"searchEl",ref:h,type:"text",class:"form-input flex-1",placeholder:a.searchPlaceholder},null,8,V),_("button",{type:"button",class:"px-3 py-2 border rounded",onClick:I},"üìç")]),_("div",{ref_key:"mapEl",ref:s,class:"rounded border",style:{height:"320px"}},null,512)]))}},X=L(H,[["__scopeId","data-v-c24049d5"]]);export{X as M};
