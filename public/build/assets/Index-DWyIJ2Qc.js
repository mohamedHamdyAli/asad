import{m as _,p as d,i as y,q as X,c as P,o as r,w as T,b as e,j as k,f as c,h as C,k as Y,F as q,s as E,t as u,u as p,v as R,a as f,z as Z}from"./app-BzxX0dK2.js";import{_ as ee}from"./AuthenticatedLayout-Ci_ZkNzf.js";import{c as te,e as j,b as B,F as se,d as A,E as N}from"./index.esm-BJqBHimS.js";import{U as ae}from"./users-3R9Q0Ztg.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";function F(t){var l;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((l=t==null?void 0:t.data)==null?void 0:l.data)?t.data.data:[]}function I(t={}){var l,x;return{id:t.id,user_id:t.user_id,user_name:((l=t.user)==null?void 0:l.name)||"",user_email:((x=t.user)==null?void 0:x.email)||"",type:t.type||"all",title:t.title||"",body:t.body||"",is_seen:t.is_seen||!1,seen_time:t.seen_time,created_at:t.created_at,updated_at:t.updated_at}}const U={list:async()=>{const{data:t}=await _.get("/api/notifications");return F(t).map(I)},show:async t=>{const{data:l}=await _.get(`/api/notifications/show/${t}`);return F(l).map(I)},create:async t=>{const{data:l}=await _.post("/api/notifications/create",t);return l},remove:async t=>{const{data:l}=await _.delete(`/api/notifications/delete/${t}`);return l}};function oe(t={}){const l={title:t.title,body:t.body};return t.user_ids&&Array.isArray(t.user_ids)&&t.user_ids.length>0?l.user_ids=t.user_ids:t.user_id&&(l.user_id=t.user_id),l}const ie={class:"p-6 space-y-6"},ne={class:"bg-white rounded-xl shadow border overflow-hidden"},re={class:"w-full text-sm"},ue={class:"px-4 py-3"},de={class:"px-4 py-3"},ce={key:0},me={key:1,class:"text-gray-400 italic"},ve={class:"px-4 py-3 max-w-xs truncate"},pe={class:"px-4 py-3 max-w-md truncate"},fe={class:"px-4 py-3 text-xs text-gray-500"},xe={class:"px-4 py-3 text-right space-x-2"},be=["onClick"],_e={class:"flex justify-between"},ye={class:"space-x-2"},he=["disabled"],ge=["disabled"],we={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},ke={class:"bg-white w-full max-w-2xl rounded-xl p-6 max-h-[85vh] overflow-y-auto"},Ce={class:"space-y-4"},Ae={class:"flex items-center space-x-2 mb-2"},Ne={key:0},Ue={class:"border border-gray-300 rounded px-3 py-2 max-h-[300px] overflow-y-auto"},Se={class:"space-y-2"},De=["value"],Le={class:"text-sm"},Me={key:0,class:"text-xs text-gray-600 mt-1"},S=10,Ve={__name:"Index",setup(t){const{show:l}=Z(),x=d([]),D=d([]),b=d(""),m=d(1),h=d(!1),v=d(!0),L=d(0),i=d([]),g=d({}),z=y(()=>te({title:B().required("Title is required"),body:B().required("Message body is required"),user_ids:v.value?j():j().min(1,"Please select at least one user").required("Please select at least one user")}));async function w(){x.value=await U.list()}async function O(){D.value=await ae.list()}const M=y(()=>x.value.filter(o=>{var s,a,n;return((s=o.title)==null?void 0:s.toLowerCase().includes(b.value.toLowerCase()))||((a=o.user_name)==null?void 0:a.toLowerCase().includes(b.value.toLowerCase()))||((n=o.body)==null?void 0:n.toLowerCase().includes(b.value.toLowerCase()))})),V=y(()=>Math.ceil(M.value.length/S)),K=y(()=>M.value.slice((m.value-1)*S,m.value*S));function G(){v.value=!0,i.value=[],g.value={title:"",body:"",user_ids:[]},L.value++,h.value=!0}function $(){h.value=!1,i.value=[]}function H(){v.value&&(i.value=[],g.value.user_ids=[])}async function J(o){var a;const s={title:o.title,body:o.body};!v.value&&i.value.length>0&&(s.user_ids=i.value.map(n=>parseInt(n)));try{await U.create(oe(s)),$(),w()}catch(n){console.error("SEND ERROR",((a=n.response)==null?void 0:a.data)||n),l(n)}}async function Q(o){confirm("Delete notification?")&&(await U.remove(o),w())}function W(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return X(()=>{w(),O()}),(o,s)=>(r(),P(ee,null,{default:T(()=>[e("div",ie,[e("div",{class:"flex justify-between items-center"},[s[6]||(s[6]=e("h2",{class:"text-2xl font-bold"},"Notifications",-1)),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:G}," + Send Notification ")]),k(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>b.value=a),placeholder:"Search by title or user name",class:"form-input w-72"},null,512),[[Y,b.value]]),e("div",ne,[e("table",re,[s[7]||(s[7]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"User Name"),e("th",{class:"px-4 py-3"},"Title"),e("th",{class:"px-4 py-3"},"Body"),e("th",{class:"px-4 py-3"},"Date"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(r(!0),c(q,null,E(K.value,a=>(r(),c("tr",{key:a.id,class:"border-t"},[e("td",ue,u(a.id),1),e("td",de,[a.user_name?(r(),c("div",ce,u(a.user_name),1)):(r(),c("div",me,"All Users"))]),e("td",ve,u(a.title),1),e("td",pe,u(a.body),1),e("td",fe,u(W(a.created_at)),1),e("td",xe,[e("button",{class:"text-red-600",onClick:n=>Q(a.id)},"Delete",8,be)])]))),128))])])]),e("div",_e,[e("span",null,"Page "+u(m.value)+" of "+u(V.value),1),e("div",ye,[e("button",{onClick:s[1]||(s[1]=a=>m.value--),disabled:m.value===1},"Prev",8,he),e("button",{onClick:s[2]||(s[2]=a=>m.value++),disabled:m.value===V.value},"Next",8,ge)])]),h.value?(r(),c("div",we,[e("div",ke,[s[13]||(s[13]=e("h3",{class:"text-lg font-semibold mb-4"},"Send Notification",-1)),(r(),P(p(se),{ref:"formRef","validate-on-mount":!1,key:L.value,"validation-schema":z.value,"initial-values":g.value,onSubmit:J},{default:T(()=>[e("div",Ce,[e("div",null,[e("label",Ae,[k(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=a=>v.value=a),onChange:H,class:"form-checkbox"},null,544),[[R,v.value]]),s[8]||(s[8]=e("span",{class:"text-sm font-medium"},"Send to All Users",-1))])]),v.value?C("",!0):(r(),c("div",Ne,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium mb-2"},"Select Users",-1)),e("div",Ue,[e("div",Se,[(r(!0),c(q,null,E(D.value,a=>(r(),c("label",{key:a.id,class:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},[k(e("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":s[4]||(s[4]=n=>i.value=n),class:"form-checkbox h-4 w-4 text-blue-600"},null,8,De),[[R,i.value]]),e("span",Le,u(a.name)+" ("+u(a.email)+")",1)]))),128))])]),f(p(A),{name:"user_ids",modelValue:i.value,"onUpdate:modelValue":s[5]||(s[5]=a=>i.value=a),type:"hidden"},null,8,["modelValue"]),f(p(N),{name:"user_ids",class:"error"}),i.value.length>0?(r(),c("div",Me,u(i.value.length)+" user(s) selected ",1)):C("",!0)])),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium mb-1"},"Title",-1)),f(p(A),{name:"title",class:"form-input",placeholder:"Notification Title"}),f(p(N),{name:"title",class:"error"})]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),f(p(A),{name:"body",as:"textarea",rows:"5",class:"form-input",placeholder:"Notification Message"}),f(p(N),{name:"body",class:"error"})])]),e("div",{class:"flex justify-end gap-2 mt-6"},[e("button",{type:"button",class:"border px-4 py-2 rounded",onClick:$}," Cancel "),s[12]||(s[12]=e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded"}," Send ",-1))])]),_:1},8,["validation-schema","initial-values"]))])])):C("",!0)])]),_:1}))}},Re=le(Ve,[["__scopeId","data-v-8b0fb42c"]]);export{Re as default};
