import{m as k,p as _,i as C,B as E,q as le,c as oe,o as d,w as re,b as e,f as u,h as U,j as D,k as B,t as l,F as $,s as N,y as de,n as z,e as f}from"./app-KlDn5v0D.js";import{_ as ue}from"./AuthenticatedLayout-CIKrmh8G.js";import{U as pe}from"./unitQuotes-VKXJhaVr.js";import{V as ce}from"./vendors-CJSQkF0w.js";import{U as _e}from"./users-uWjhU9wi.js";import{T as J,a as G}from"./typeOfPrice-C-opW5H7.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";function X(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function fe(t){var a;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray((a=t==null?void 0:t.data)==null?void 0:a.data)?t.data.data:[]}function H(t={}){const a=X(t.title),r=X(t.time_line);return{id:t.id,unit_quote_id:t.unit_quote_id,vendor_id:t.vendor_id,user_id:t.user_id,title_en:(a==null?void 0:a.en)??"",title_ar:(a==null?void 0:a.ar)??"",price:t.price??"",time_line_en:(r==null?void 0:r.en)??"",time_line_ar:(r==null?void 0:r.ar)??"",created_at:t.created_at,updated_at:t.updated_at}}const Q={list:async()=>{const{data:t}=await k.get("/api/unit-quote-responses");return fe(t).map(H)},show:async t=>{const{data:a}=await k.get(`/api/unit-quote-responses/show/${t}`),r=(a==null?void 0:a.data)??a;return H(r)},create:async t=>{const{data:a}=await k.post("/api/unit-quote-responses/create",t,{headers:{"Content-Type":"multipart/form-data"}});return a},update:async(t,a)=>{const{data:r}=await k.post(`/api/unit-quote-responses/update/${t}`,a,{headers:{"Content-Type":"multipart/form-data"}});return r},remove:async t=>{const{data:a}=await k.delete(`/api/unit-quote-responses/delete/${t}`);return a}};function me(t={}){var r,g;const a=new FormData;return a.append("data[unit_quote_id]",t.unit_quote_id??""),a.append("data[vendor_id]",t.vendor_id??""),a.append("data[user_id]",t.user_id??""),a.append("data[title][en]",((r=t.title)==null?void 0:r.en)??""),a.append("data[title][ar]",((g=t.title)==null?void 0:g.ar)??""),t.price!==void 0&&a.append("data[price]",t.price),t.time_line&&(a.append("data[time_line][en]",t.time_line.en??""),a.append("data[time_line][ar]",t.time_line.ar??"")),a}function ge(t={}){const a=new FormData;return t.unit_quote_id!==void 0&&a.append("data[unit_quote_id]",t.unit_quote_id),t.vendor_id!==void 0&&a.append("data[vendor_id]",t.vendor_id),t.user_id!==void 0&&a.append("data[user_id]",t.user_id),t.title&&(a.append("data[title][en]",t.title.en??""),a.append("data[title][ar]",t.title.ar??"")),t.price!==void 0&&a.append("data[price]",t.price),t.time_line&&(a.append("data[time_line][en]",t.time_line.en??""),a.append("data[time_line][ar]",t.time_line.ar??"")),a}const ye={class:"p-6 space-y-8"},xe={class:"flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"},be={class:"text-sm text-gray-500"},he={class:"bg-white p-6 rounded-2xl shadow"},we={key:0,class:"text-sm text-gray-500"},ke={key:1,class:"text-center text-gray-500 py-6"},Ce={key:2,class:"overflow-x-auto"},Ue={class:"min-w-full border border-gray-200 text-sm"},Te={class:"py-2 px-3 font-medium"},Ae={class:"py-2 px-3"},Pe={class:"font-semibold text-gray-900"},De={class:"text-xs text-gray-500"},$e={class:"py-2 px-3 text-gray-700"},Qe={class:"py-2 px-3"},Re=["onUpdate:modelValue","disabled"],Ve=["value"],Be={class:"py-2 px-3"},Ne=["onUpdate:modelValue","disabled"],Se={class:"py-2 px-3"},Ie=["onUpdate:modelValue","disabled"],Le={class:"py-2 px-3"},Fe={class:"py-2 px-3 text-center space-x-2"},Me=["onClick"],Oe=["onClick"],Ee=["onClick"],ze=["onClick"],Je=["onClick"],Ge={key:0,class:"flex justify-between items-center mt-6 text-sm"},Xe={class:"text-gray-600"},He={class:"space-x-2"},Ke=["disabled"],We=["onClick"],Ye=["disabled"],Ze={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-[200]"},je={class:"bg-white w-full max-w-lg rounded-xl shadow-lg p-6 space-y-5"},qe={class:"space-y-3 text-sm text-gray-700"},et={key:0},tt=["href"],st=["src"],nt={class:"flex justify-end pt-4"},it={__name:"UnitQuoteResponses",setup(t){const a=_([]),r=_([]),g=_([]),S=_([]),I=_([]),T=_(""),R=_(!1),A=_("—"),P=_("—"),V=_(!1),c=_(null);function K(n){c.value=n,V.value=!0;const s=S.value.find(i=>i.id===n.type_of_building_id);A.value=s?M(s.title).en:"—";const p=I.value.find(i=>i.id===n.type_of_price_id);P.value=p?M(p.title).en:"—"}const v=_(1),y=_(7),x=C(()=>{const n=T.value.toLowerCase();return a.value.filter(s=>s.title.toLowerCase().includes(n)||s.user_name&&s.user_name.toLowerCase().includes(n)).sort((s,p)=>p.id-s.id)}),b=C(()=>Math.ceil(x.value.length/y.value)),W=C(()=>(v.value-1)*y.value+1),Y=C(()=>Math.min(v.value*y.value,x.value.length)),L=C(()=>{const n=(v.value-1)*y.value;return x.value.slice(n,n+y.value)});E(T,()=>v.value=1);async function h(){R.value=!0;try{const[n,s,p,i,w,o]=await Promise.all([pe.list(),Q.list(),_e.list(),ce.list(),J.list(),G.list()]);a.value=n.map(O=>{const m=s.find(ae=>ae.unit_quote_id===O.id);return{...O,has_response:!!m,editing:!1,response:m?{id:m.id,vendor_id:m.vendor_id,user_id:m.user_id,price:m.price,time_line:m.time_line_en||""}:{vendor_id:"",user_id:"",price:"",time_line:""}}}),r.value=p,g.value=i,S.value=w.data??[],I.value=o.data??[]}finally{R.value=!1}}function Z(n){n.editing=!0}async function j(n){const s=me({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await Q.create(s),await h()}async function q(n){const s=ge({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await Q.update(n.response.id,s),n.editing=!1,await h()}async function ee(n){confirm("Delete this response?")&&(await Q.remove(n.response.id),await h())}function te(n){var s;return((s=g.value.find(p=>p.id===n))==null?void 0:s.name)||"—"}function se(n){n>=1&&n<=b.value&&(v.value=n)}function ne(){v.value<b.value&&v.value++}function ie(){v.value>1&&v.value--}function F(n){return n?new Date(n).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}E(c,async n=>{var s,p;if(n){if(A.value="—",P.value="—",n.type_of_building_id){const i=await J.show(n.type_of_building_id);console.log("BUILDING API FIXED:",i),A.value=((s=i==null?void 0:i.title)==null?void 0:s.en)||"—"}if(n.type_of_price_id){const i=await G.show(n.type_of_price_id);P.value=((p=i==null?void 0:i.title)==null?void 0:p.en)||"—"}}});function M(n){try{return JSON.parse(n)}catch{return{en:"",ar:""}}}return le(h),(n,s)=>(d(),oe(ue,null,{default:re(()=>{var p;return[e("div",ye,[e("div",{class:"flex items-center justify-between"},[s[2]||(s[2]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Quote Responses",-1)),e("button",{onClick:h,class:"px-3 py-1.5 border rounded-lg text-sm hover:bg-gray-50"}," Refresh ")]),e("div",xe,[D(e("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>T.value=i),type:"text",placeholder:"Search quotes by title or user…",class:"form-input w-1/2"},null,512),[[B,T.value]]),e("span",be,l(x.value.length)+" quote(s) found ",1)]),e("div",he,[s[5]||(s[5]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Quotes & Responses",-1)),R.value?(d(),u("div",we,"Loading…")):L.value.length?(d(),u("div",Ce,[e("table",Ue,[s[4]||(s[4]=e("thead",{class:"bg-gray-100 text-gray-700"},[e("tr",null,[e("th",{class:"py-2 px-3 text-left"}),e("th",{class:"py-2 px-3 text-left"},"Title"),e("th",{class:"py-2 px-3 text-left"},"User"),e("th",{class:"py-2 px-3 text-left"},"Vendor"),e("th",{class:"py-2 px-3 text-left"},"Price"),e("th",{class:"py-2 px-3 text-left"},"Timeline"),e("th",{class:"py-2 px-3 text-left"},"Status"),e("th",{class:"py-2 px-3 text-center"},"Actions")])],-1)),e("tbody",null,[(d(!0),u($,null,N(L.value,i=>{var w;return d(),u("tr",{key:i.id,class:"border-t hover:bg-gray-50 transition"},[e("td",Te,l(i.id),1),e("td",Ae,[e("div",Pe,l(i.title),1),e("div",De,l(F(i.created_at)),1)]),e("td",$e,l(((w=r.value.find(o=>o.id===i.user_id))==null?void 0:w.name)||`User ${i.user_id}`),1),e("td",Qe,[D(e("select",{"onUpdate:modelValue":o=>i.response.vendor_id=o,class:"form-input",disabled:!i.editing&&i.has_response},[s[3]||(s[3]=e("option",{value:"",disabled:""},"Select Vendor",-1)),(d(!0),u($,null,N(g.value,o=>(d(),u("option",{key:o.id,value:o.id},l(o.name),9,Ve))),128))],8,Re),[[de,i.response.vendor_id]])]),e("td",Be,[D(e("input",{"onUpdate:modelValue":o=>i.response.price=o,type:"number",class:"form-input",disabled:!i.editing&&i.has_response},null,8,Ne),[[B,i.response.price,void 0,{number:!0}]])]),e("td",Se,[D(e("input",{"onUpdate:modelValue":o=>i.response.time_line=o,type:"text",class:"form-input",disabled:!i.editing&&i.has_response},null,8,Ie),[[B,i.response.time_line]])]),e("td",Le,[e("span",{class:z(["px-2 py-0.5 rounded-full text-xs border",i.has_response?"bg-green-100 text-green-700 border-green-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},l(i.has_response?"Responded":"Pending"),3)]),e("td",Fe,[e("button",{class:"px-2 py-1 text-xs border rounded-lg text-gray-700 hover:bg-gray-100",onClick:o=>K(i)}," Details ",8,Me),i.has_response?(d(),u($,{key:1},[i.editing?U("",!0):(d(),u("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:o=>Z(i)}," Edit ",8,Ee)),i.editing?(d(),u("button",{key:1,class:"px-3 py-1 text-xs border rounded-lg text-green-700 border-green-200 hover:bg-green-50",onClick:o=>q(i)}," Update ",8,ze)):U("",!0),e("button",{class:"px-3 py-1 text-xs border rounded-lg text-red-700 border-red-200 hover:bg-red-50",onClick:o=>ee(i)}," Delete ",8,Je)],64)):(d(),u("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:o=>j(i)}," Save ",8,Oe))])])}),128))])]),b.value>1?(d(),u("div",Ge,[e("span",Xe," Showing "+l(W.value)+"–"+l(Y.value)+" of "+l(x.value.length),1),e("div",He,[e("button",{onClick:ie,disabled:v.value===1,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"},"Prev",8,Ke),(d(!0),u($,null,N(b.value,i=>(d(),u("button",{key:i,onClick:w=>se(i),class:z(["px-3 py-1 border rounded-lg",i===v.value?"bg-blue-600 text-white":"hover:bg-gray-50"])},l(i),11,We))),128)),e("button",{onClick:ne,disabled:v.value===b.value,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"},"Next",8,Ye)])])):U("",!0)])):(d(),u("div",ke," No quotes found. "))])]),V.value?(d(),u("div",Ze,[e("div",je,[s[16]||(s[16]=e("h3",{class:"text-xl font-bold text-gray-800"},"Quote Details",-1)),e("div",qe,[e("div",null,[s[6]||(s[6]=e("b",null,"Title:",-1)),f(" "+l(c.value.title),1)]),e("div",null,[s[7]||(s[7]=e("b",null,"Other Title:",-1)),f(" "+l(c.value.other_title||"—"),1)]),e("div",null,[e("p",null,[s[8]||(s[8]=e("strong",null,"Building Type:",-1)),f(" "+l(A.value),1)])]),e("div",null,[e("p",null,[s[9]||(s[9]=e("strong",null,"Price Type:",-1)),f(" "+l(P.value),1)])]),e("div",null,[s[10]||(s[10]=e("b",null,"User:",-1)),f(" "+l(((p=r.value.find(i=>i.id===c.value.user_id))==null?void 0:p.name)||`User ${c.value.user_id}`),1)]),e("div",null,[s[11]||(s[11]=e("b",null,"Vendor:",-1)),f(" "+l(te(c.value.response.vendor_id)),1)]),e("div",null,[s[12]||(s[12]=e("b",null,"Price:",-1)),f(" "+l(c.value.response.price||"—"),1)]),e("div",null,[s[13]||(s[13]=e("b",null,"Timeline:",-1)),f(" "+l(c.value.response.time_line||"—"),1)]),c.value.pay_image?(d(),u("div",et,[s[14]||(s[14]=e("b",null,"Payment Image:",-1)),e("a",{href:`/storage/${c.value.pay_image}`,target:"_blank"},[e("img",{src:`/storage/${c.value.pay_image}`,class:"h-24 w-24 object-cover rounded shadow mt-1"},null,8,st)],8,tt)])):U("",!0),e("div",null,[s[15]||(s[15]=e("b",null,"Created At:",-1)),f(" "+l(F(c.value.created_at)),1)])]),e("div",nt,[e("button",{class:"px-4 py-2 border rounded-lg hover:bg-gray-50",onClick:s[1]||(s[1]=i=>V.value=!1)}," Close ")])])])):U("",!0)]}),_:1}))}},ct=ve(it,[["__scopeId","data-v-2c870bd1"]]);export{ct as default};
