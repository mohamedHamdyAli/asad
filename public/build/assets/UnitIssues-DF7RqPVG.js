import{m as x,p as l,i as k,B as z,q as A,f as m,o as f,a as r,u,g as T,w as I,b as t,j as G,h as L,k as H,F as M,s as J,t as d,n as K}from"./app-4D-wkT_p.js";import{_ as Q}from"./AuthenticatedLayout-CCBjItTP.js";import{c as W,a as N,F as X,b as S,E as Y}from"./index.esm-BzR9PCIV.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={list:async()=>{const{data:n}=await x.get("/api/unit-issues");return n.data??[]},show:async n=>{const{data:o}=await x.get(`/api/unit-issues/show/${n}`);return o.data},create:async n=>{const{data:o}=await x.post("/api/unit-issues/create",{data:n});return o},update:async(n,o)=>{const{data:b}=await x.post(`/api/unit-issues/update/${n}`,{data:o});return b},remove:async n=>{const{data:o}=await x.delete(`/api/unit-issues/delete/${n}`);return o}},tt={class:"p-6 space-y-6"},et={class:"bg-white rounded-xl shadow border overflow-hidden"},st={class:"w-full text-sm"},at={class:"px-4 py-3"},nt={class:"px-4 py-3"},ot={class:"px-4 py-3"},lt={class:"px-4 py-3"},it={class:"px-4 py-3 text-right space-x-2"},rt=["onClick"],ut=["onClick"],dt={key:0},ct={class:"flex justify-between items-center"},pt={class:"text-sm text-gray-600"},vt={class:"flex gap-2"},xt=["disabled"],mt=["disabled"],ft={key:0,class:"fixed back-drop inset-0 bg-black/40 flex items-center justify-center z-50"},yt={class:"bg-white w-full max-w-lg rounded-xl p-6"},_t={class:"space-y-3"},U=10,bt={__name:"UnitIssues",setup(n){const o=l([]),b=l([]),j=l([]),y=l(""),i=l(1),g=l(!1),E=l(null),h=l({}),q=W({description:N().required(),status:N().oneOf(["open","close"]).required()});async function w(){const[a,e,s]=await Promise.all([$.list()]);o.value=a,b.value=e,j.value=s}const C=k(()=>{const a=y.value.toLowerCase();return o.value.filter(e=>{var s,c,p,v,_,F;return((s=e.title)==null?void 0:s.toLowerCase().includes(a))||((v=(p=(c=e.unit)==null?void 0:c.name)==null?void 0:p.en)==null?void 0:v.toLowerCase().includes(a))||((F=(_=e.user)==null?void 0:_.name)==null?void 0:F.toLowerCase().includes(a))})});z(y,()=>i.value=1);const P=k(()=>Math.ceil(C.value.length/U)),B=k(()=>{const a=(i.value-1)*U;return C.value.slice(a,a+U)});function V(a){E.value=a.id,h.value={title:a.title,description:a.description,status:a.status},g.value=!0}function D(){g.value=!1,h.value={}}async function O(a){await $.update(E.value,{...a}),D(),w()}async function R(a){confirm("Delete this issue?")&&(await $.remove(a),w())}return A(w),(a,e)=>(f(),m(M,null,[r(u(T),{title:"Unit Issues"}),r(Q,null,{default:I(()=>[t("div",tt,[e[8]||(e[8]=t("h2",{class:"text-2xl font-semibold"},"Unit Issues",-1)),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),class:"form-input w-72",placeholder:"Search by title, unit or user"},null,512),[[H,y.value]]),t("div",et,[t("table",st,[e[4]||(e[4]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Unit"),t("th",{class:"px-4 py-3 text-left"},"User"),t("th",{class:"px-4 py-3 text-left"},"Title"),t("th",{class:"px-4 py-3 text-left"},"Status"),t("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),t("tbody",null,[(f(!0),m(M,null,J(B.value,s=>{var c,p,v;return f(),m("tr",{key:s.id,class:"border-t"},[t("td",at,d(((p=(c=s.unit)==null?void 0:c.name)==null?void 0:p.en)??s.unit_id),1),t("td",nt,d(((v=s.user)==null?void 0:v.name)??s.user_id),1),t("td",ot,d(s.title),1),t("td",lt,[t("span",{class:K(["px-2 py-1 rounded text-xs",s.status==="open"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"])},d(s.status),3)]),t("td",it,[t("button",{class:"text-blue-600",onClick:_=>V(s)}," Edit ",8,rt),t("button",{class:"text-red-600",onClick:_=>R(s.id)}," Delete ",8,ut)])])}),128)),C.value.length===0?(f(),m("tr",dt,e[3]||(e[3]=[t("td",{colspan:"5",class:"text-center py-6 text-gray-500"}," No issues found ",-1)]))):L("",!0)])])]),t("div",ct,[t("span",pt," Page "+d(i.value)+" of "+d(P.value),1),t("div",vt,[t("button",{class:"px-3 py-1 border rounded",disabled:i.value===1,onClick:e[1]||(e[1]=s=>i.value--)}," Prev ",8,xt),t("button",{class:"px-3 py-1 border rounded",disabled:i.value===P.value,onClick:e[2]||(e[2]=s=>i.value++)}," Next ",8,mt)])]),g.value?(f(),m("div",ft,[t("div",yt,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold mb-4"},"Edit Issue",-1)),r(u(X),{"validation-schema":u(q),"initial-values":h.value,onSubmit:O},{default:I(()=>[t("div",_t,[r(u(S),{name:"description",as:"textarea",rows:"3",class:"form-input",placeholder:"Description"}),r(u(Y),{name:"description",class:"error"}),r(u(S),{name:"status",as:"select",class:"form-input"},{default:I(()=>e[5]||(e[5]=[t("option",{value:"open"},"Open",-1),t("option",{value:"close"},"Close",-1)])),_:1})]),t("div",{class:"flex justify-end gap-2 mt-4"},[t("button",{type:"button",class:"px-4 py-2 border rounded",onClick:D}," Cancel "),e[6]||(e[6]=t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values"])])])):L("",!0)])]),_:1})],64))}},kt=Z(bt,[["__scopeId","data-v-88e25b93"]]);export{kt as default};
