import{m as w,i as N,p as b,r as A,q,c as J,o as f,w as M,b as n,a as z,j as k,k as C,f as m,h,t as g,F as G,s as H}from"./app-F6bKQEA1.js";import{_ as P}from"./AuthenticatedLayout-BX6gmCjd.js";import{_ as X}from"./UnitNav-BymYBZZD.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Q(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function W(e){var s;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((s=e==null?void 0:e.data)==null?void 0:s.data)?e.data.data:[]}function Y(e){return e?`/storage/${e}`:""}function D(e){return(e||"").split("/").pop()||""}function Z(e){return(D(e).split(".").pop()||"").toLowerCase()}function ee(e){const s=Z(e);return s==="pdf"?"📕 PDF":s==="doc"||s==="docx"?"📝 DOC":s==="xls"||s==="xlsx"?"📊 XLS":"📄"}function te(e={}){const s=Q(e.title),o=s&&typeof s=="object"?s:{en:s??"",ar:s??""},i=Y(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:i,file_name:D(e.file),file_icon:ee(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const T={list:async e=>{const{data:s}=await w.get(`/api/unit-timeline/${e}`);return W(s).map(te)},create:async e=>{const{data:s}=await w.post("/api/unit-timeline/create",e,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async e=>{const{data:s}=await w.post("/api/unit-timeline/update",e,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async e=>{const{data:s}=await w.delete(`/api/unit-timeline/delete/${e}`);return s}};function ne(e,s=[]){const o=new FormData;return o.append("unit_id",String(e)),s.forEach((i,d)=>{var c,u;o.append(`data[${d}][title][en]`,((c=i==null?void 0:i.title)==null?void 0:c.en)??""),o.append(`data[${d}][title][ar]`,((u=i==null?void 0:i.title)==null?void 0:u.ar)??""),i.file&&o.append(`data[${d}][file]`,i.file)}),o}function ae(e,s=[]){const o=new FormData;return o.append("unit_id",String(e)),s.forEach((i,d)=>{var c,u;o.append(`data[${d}][id]`,String(i.id??"")),((c=i==null?void 0:i.title)==null?void 0:c.en)!==void 0&&o.append(`data[${d}][title][en]`,i.title.en??""),((u=i==null?void 0:i.title)==null?void 0:u.ar)!==void 0&&o.append(`data[${d}][title][ar]`,i.title.ar??""),i.file&&o.append(`data[${d}][file]`,i.file)}),o}const ie={class:"p-6 space-y-6"},se={class:"flex items-center justify-between"},le=["href"],re={class:"bg-white p-4 rounded shadow"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"mt-4"},ce={key:0,class:"mt-3 text-sm text-gray-600"},ue={class:"mt-4 flex items-center gap-3"},pe=["disabled"],fe={key:0,class:"text-red-600 text-sm"},me={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},xe={key:0,class:"text-sm text-gray-500"},ge={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},ve={class:"h-32 bg-gray-50 flex flex-col items-center justify-center text-center p-3 relative"},be={class:"text-3xl text-gray-600"},_e={class:"mt-2 text-xs text-gray-700 break-words max-w-[90%] whitespace-pre-wrap"},he={class:"p-3.5 space-y-3 text-sm"},ye=["onUpdate:modelValue"],we=["onUpdate:modelValue"],ke={class:"text-[11px]"},Ce=["onChange"],Te={key:0,class:"mt-1 text-[11px] text-gray-500"},Ue={class:"flex items-center gap-2 pt-2"},$e=["href"],Ae=["onClick","disabled"],Fe=["onClick"],Ne={key:0,class:"col-span-full text-center text-gray-500 py-8"},S=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Se={__name:"Timeline",props:{unitId:{type:[Number,String],required:!0}},setup(e){const s=e,o=N(()=>"/units-management"),i=b({title:{en:"",ar:""}}),d=b([]),c=b(!1),u=b(""),I=N(()=>{var l,t;return!!((l=i.value.title.en)!=null&&l.trim())&&!!((t=i.value.title.ar)!=null&&t.trim())&&d.value.length>0});function V(l){const t=Array.from(l.target.files||[]);d.value=t}async function E(){var l,t;c.value=!0,u.value="";try{const a=d.value.map(r=>({title:{...i.value.title},file:r})),p=ne(s.unitId,a);await T.create(p),await _(),d.value=[],i.value.title={en:"",ar:""}}catch(a){console.error(a),u.value=((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Upload failed"}finally{c.value=!1}}const U=b([]),$=b(!1),v=A({}),x=A({}),y=A({});function B(l){l.forEach(t=>{v[t.id]={title:{en:t.title_en||"",ar:t.title_ar||""}}})}async function _(){$.value=!0;try{const l=await T.list(s.unitId);U.value=l,B(l)}finally{$.value=!1}}function L(l,t){var p;const a=((p=t.target.files)==null?void 0:p[0])||null;a&&(x[l]=a)}async function j(l){var a,p;const t=v[l];if(t){y[l]=!0;try{const r=[{id:l,title:t.title,file:x[l]}],R=ae(s.unitId,r);await T.update(R),delete x[l],await _()}catch(r){console.error(r),alert(((p=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:p.message)||"Update failed")}finally{y[l]=!1}}}function F(l){const t=l==null?void 0:l.target;t&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}async function O(l){confirm("Delete this timeline item?")&&(await T.remove(l),await _())}return q(_),(l,t)=>(f(),J(P,null,{default:M(()=>[n("div",ie,[n("div",se,[t[4]||(t[4]=n("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Timeline",-1)),n("a",{href:o.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,le)]),z(X,{"unit-id":Number(e.unitId),cols:2},null,8,["unit-id"]),n("div",re,[t[7]||(t[7]=n("h3",{class:"text-lg font-bold mb-3"},"Add Timeline Items",-1)),n("div",oe,[n("div",null,[t[5]||(t[5]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),k(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.value.title.en=a),class:"form-input",type:"text",required:""},null,512),[[C,i.value.title.en]])]),n("div",null,[t[6]||(t[6]=n("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),k(n("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>i.value.title.ar=a),class:"form-input",type:"text",required:""},null,512),[[C,i.value.title.ar]])])]),n("div",de,[n("input",{type:"file",multiple:"",accept:S,onChange:V},null,32),d.value.length?(f(),m("div",ce,g(d.value.length)+" file(s) selected ",1)):h("",!0)]),n("div",ue,[n("button",{disabled:c.value||!I.value,onClick:E,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},g(c.value?"Uploading…":"Upload"),9,pe),u.value?(f(),m("span",fe,g(u.value),1)):h("",!0)])]),n("div",me,[n("div",{class:"flex items-center justify-between mb-4"},[t[8]||(t[8]=n("h3",{class:"text-lg font-semibold text-gray-800"},"Timeline Items",-1)),n("button",{onClick:_,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),$.value?(f(),m("div",xe,"Loading…")):(f(),m("div",ge,[(f(!0),m(G,null,H(U.value,a=>{var p;return f(),m("div",{key:a.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[n("div",ve,[n("div",be,g(a.file_icon.split(" ")[0]),1),n("div",_e,g(a.file_name),1)]),n("div",he,[n("div",null,[t[9]||(t[9]=n("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),k(n("textarea",{"onUpdate:modelValue":r=>v[a.id].title.en=r,class:"form-input !h-auto min-h-9",rows:"1",onInput:t[2]||(t[2]=r=>F(r))},null,40,ye),[[C,v[a.id].title.en]])]),n("div",null,[t[10]||(t[10]=n("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),k(n("textarea",{"onUpdate:modelValue":r=>v[a.id].title.ar=r,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:t[3]||(t[3]=r=>F(r))},null,40,we),[[C,v[a.id].title.ar]])]),n("div",ke,[t[11]||(t[11]=n("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),n("input",{type:"file",accept:S,onChange:r=>L(a.id,r)},null,40,Ce),x!=null&&x[a.id]?(f(),m("p",Te," Selected: "+g((p=x[a.id])==null?void 0:p.name),1)):h("",!0)]),n("div",Ue,[a.file_url?(f(),m("a",{key:0,href:a.file_url,target:"_blank",class:"px-3 py-1.5 text-sm rounded-lg border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100"}," Open ",8,$e)):h("",!0),n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:r=>j(a.id),disabled:y[a.id]},g(y[a.id]?"Saving…":"Save"),9,Ae),n("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:r=>O(a.id)}," Delete ",8,Fe)])])])}),128)),U.value.length?h("",!0):(f(),m("div",Ne," No timeline items found. "))]))])])]),_:1}))}},Be=K(Se,[["__scopeId","data-v-903366f9"]]);export{Be as default};
