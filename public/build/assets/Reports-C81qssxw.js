import{m as $,r as C,i as T,p as b,q as Q,c as R,o as d,w as B,b as t,a as S,u as x,h as _,f as m,t as g,F as W,s as Y,j as L,k as O}from"./app-BzxX0dK2.js";import{_ as Z}from"./AuthenticatedLayout-Ci_ZkNzf.js";import{_ as ee}from"./UnitNav-U2QT2UhI.js";import{c as U,a as te,b as q,F as ae,d as I,E as j}from"./index.esm-BJqBHimS.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ne(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function ie(e){var n;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.data)?e.data.data:[]}function le(e){return e?`/storage/${e}`:""}function M(e){return(e||"").split("/").pop()||""}function re(e){return(M(e).split(".").pop()||"").toLowerCase()}function oe(e){const n=re(e);return n==="pdf"?"ðŸ“• PDF":n==="doc"||n==="docx"?"ðŸ“ DOC":n==="xls"||n==="xlsx"?"ðŸ“Š XLS":"ðŸ“„"}function de(e={}){const n=ne(e.title),l=n&&typeof n=="object"?n:{en:n??"",ar:n??""},r=le(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:r,file_name:M(e.file),file_icon:oe(e.file),title_en:l.en??"",title_ar:l.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const N={list:async e=>{const{data:n}=await $.get(`/api/unit-report/${e}`);return ie(n).map(de)},create:async e=>{const{data:n}=await $.post("/api/unit-report/create",e,{headers:{"Content-Type":"multipart/form-data"}});return n},update:async e=>{const{data:n}=await $.post("/api/unit-report/update",e,{headers:{"Content-Type":"multipart/form-data"}});return n},remove:async e=>{const{data:n}=await $.delete(`/api/unit-report/delete/${e}`);return n}};function ce(e,n=[]){const l=new FormData;return l.append("unit_id",String(e)),n.forEach((r,c)=>{var v,p;l.append(`data[${c}][title][en]`,((v=r==null?void 0:r.title)==null?void 0:v.en)??""),l.append(`data[${c}][title][ar]`,((p=r==null?void 0:r.title)==null?void 0:p.ar)??""),r.file&&l.append(`data[${c}][file]`,r.file)}),l}function ue(e,n=[]){const l=new FormData;return l.append("unit_id",String(e)),n.forEach((r,c)=>{var v,p;l.append(`data[${c}][id]`,String(r.id??"")),((v=r==null?void 0:r.title)==null?void 0:v.en)!==void 0&&l.append(`data[${c}][title][en]`,r.title.en??""),((p=r==null?void 0:r.title)==null?void 0:p.ar)!==void 0&&l.append(`data[${c}][title][ar]`,r.title.ar??""),r.file&&l.append(`data[${c}][file]`,r.file)}),l}const fe={class:"p-6 space-y-6"},pe={class:"flex items-center justify-between"},me=["href"],_e={class:"bg-white p-4 rounded shadow"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"mt-4"},xe=["onChange"],he={key:1,class:"mt-3 text-sm text-gray-600"},be={class:"mt-4 flex items-center gap-3"},ye=["disabled"],ke={key:0,class:"text-red-600 text-sm"},we={class:"bg-white p-4 rounded shadow"},Ae={key:0,class:"text-sm text-gray-500"},Fe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},$e={class:"h-32 bg-white flex items-center justify-center p-3 text-center"},Ce={class:"text-gray-600"},Re={class:"text-3xl"},Se={class:"text-xs mt-1 break-all"},Ue={class:"p-3 space-y-2 text-sm"},qe=["onUpdate:modelValue"],Ne={key:0,class:"error"},De=["onUpdate:modelValue"],Ee={key:0,class:"error"},Ve={class:"text-[11px]"},Te=["onChange"],je={class:"flex gap-2 pt-1"},Be=["href"],Le=["onClick","disabled"],Oe=["onClick"],Ie={key:0,class:"col-span-full text-center text-gray-500 py-8"},P=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Pe={__name:"Reports",props:{unitId:{type:[Number,String],required:!0}},setup(e){const n=U({title:U({en:q().required("English title is required"),ar:q().required("Arabic title is required")}),files:te().nullable().test("required","Please select at least one file",i=>Array.isArray(i)&&i.length>0)});U({title:U({en:q().required("English title is required"),ar:q().required("Arabic title is required")})});const l=C({}),r=e,c=T(()=>r.unitId),v=T(()=>"/units-management"),p=b({title:{en:"",ar:""},files:[]}),y=b([]),w=b(!1),A=b("");T(()=>{var i,a;return!!((i=p.value.title.en)!=null&&i.trim())&&!!((a=p.value.title.ar)!=null&&a.trim())&&y.value.length>0});function J(i,a){const s=Array.from(i.target.files||[]);y.value=s,a("files",s)}async function z(i){var a,s;w.value=!0,A.value="";try{const o=i.files.map(f=>({title:{...i.title},file:f})),u=ce(c.value,o);await N.create(u),await k(),y.value=[],p.value.title={en:"",ar:""}}catch(o){console.error(o),A.value=((s=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:s.message)||(o==null?void 0:o.message)||"Upload failed"}finally{w.value=!1}}const D=b([]),E=b(!1),h=C({}),V=C({}),F=C({});function X(i){i.forEach(a=>{h[a.id]={title:{en:a.title_en||"",ar:a.title_ar||""}}})}async function k(){E.value=!0;try{const i=await N.list(c.value);D.value=i,X(i)}finally{E.value=!1}}function G(i,a){var o;const s=((o=a.target.files)==null?void 0:o[0])||null;s&&(V[i]=s)}async function H(i){var s,o;const a=h[i];if(a){F[i]=!0;try{const u=[{id:i,title:a.title,file:V[i]}],f=ue(c.value,u);await N.update(f),delete V[i],await k()}catch(u){console.error(u),alert(((o=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:o.message)||"Update failed")}finally{F[i]=!1}}}async function K(i){confirm("Delete this report?")&&(await N.remove(i),await k())}return Q(k),(i,a)=>(d(),R(Z,null,{default:B(()=>[t("div",fe,[t("div",pe,[a[0]||(a[0]=t("h2",{class:"text-2xl font-bold text-dash-title"},"Project Reports",-1)),t("a",{href:v.value,class:"px-3 py-1 border rounded text-black"},"Back to Projects",8,me)]),S(ee,{"unit-id":Number(c.value),cols:2},null,8,["unit-id"]),S(x(ae),{"validation-schema":x(n),"validate-on-mount":!1,"initial-values":p.value,onSubmit:z},{default:B(({setFieldValue:s,submitCount:o})=>[t("div",_e,[a[3]||(a[3]=t("h3",{class:"text-lg font-bold mb-3"},"Add Reports",-1)),t("div",ge,[t("div",null,[a[1]||(a[1]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),S(x(I),{name:"title.en",class:"form-input"}),o>0?(d(),R(x(j),{key:0,name:"title.en",class:"error"})):_("",!0)]),t("div",null,[a[2]||(a[2]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),S(x(I),{name:"title.ar",class:"form-input"}),o>0?(d(),R(x(j),{key:0,name:"title.ar",class:"error"})):_("",!0)])]),t("div",ve,[t("input",{type:"file",multiple:"",accept:P,onChange:u=>J(u,s)},null,40,xe),o>0?(d(),R(x(j),{key:0,name:"files",class:"error"})):_("",!0),y.value.length?(d(),m("div",he,g(y.value.length)+" file(s) selected ",1)):_("",!0)]),t("div",be,[t("button",{type:"submit",disabled:w.value,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},g(w.value?"Uploadingâ€¦":"Upload"),9,ye),A.value?(d(),m("span",ke,g(A.value),1)):_("",!0)])])]),_:1},8,["validation-schema","initial-values"]),t("div",we,[t("div",{class:"flex items-center justify-between mb-3"},[a[4]||(a[4]=t("h3",{class:"text-lg font-bold"},"Reports",-1)),t("button",{onClick:k,class:"px-3 py-1 border rounded"},"Refresh")]),E.value?(d(),m("div",Ae,"Loadingâ€¦")):(d(),m("div",Fe,[(d(!0),m(W,null,Y(D.value,s=>{var o,u;return d(),m("div",{key:s.id,class:"rounded border bg-gray-50 overflow-hidden"},[t("div",$e,[t("div",Ce,[t("div",Re,g(s.file_icon.split(" ")[0]),1),t("div",Se,g(s.file_name),1)])]),t("div",Ue,[t("div",null,[a[5]||(a[5]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),L(t("input",{"onUpdate:modelValue":f=>h[s.id].title.en=f,class:"form-input",type:"text"},null,8,qe),[[O,h[s.id].title.en]]),(o=l==null?void 0:l[s.id])!=null&&o["title.en"]?(d(),m("p",Ne,g(l[s.id]["title.en"]),1)):_("",!0)]),t("div",null,[a[6]||(a[6]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),L(t("input",{"onUpdate:modelValue":f=>h[s.id].title.ar=f,class:"form-input",type:"text"},null,8,De),[[O,h[s.id].title.ar]]),(u=l==null?void 0:l[s.id])!=null&&u["title.ar"]?(d(),m("p",Ee,g(l[s.id]["title.ar"]),1)):_("",!0)]),t("div",Ve,[a[7]||(a[7]=t("label",{class:"block text-gray-500"},"Replace File",-1)),t("input",{type:"file",accept:P,onChange:f=>G(s.id,f)},null,40,Te)]),t("div",je,[s.file_url?(d(),m("a",{key:0,href:s.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Be)):_("",!0),t("button",{class:"px-2 py-1 border rounded",onClick:f=>H(s.id),disabled:F[s.id]},g(F[s.id]?"Savingâ€¦":"Save"),9,Le),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:f=>K(s.id)}," Delete ",8,Oe)])])])}),128)),D.value.length?_("",!0):(d(),m("div",Ie," No reports found. "))]))])])]),_:1}))}},He=se(Pe,[["__scopeId","data-v-af1b2af8"]]);export{He as default};
