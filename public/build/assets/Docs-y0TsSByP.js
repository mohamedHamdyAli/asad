import{m as C,i as E,p as v,r as S,q as z,c as G,o as c,w as H,b as l,a as N,j as F,k as D,f,h as k,t as y,F as K,s as Q}from"./app-B5oUatUK.js";import{_ as W}from"./AuthenticatedLayout-YO06gPm3.js";import{_ as X}from"./UnitNav-CAc05oDG.js";import{F as T,a as Y}from"./FolderPicker-BzqeH_Rv.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ee(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function te(e){var i;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((i=e==null?void 0:e.data)==null?void 0:i.data)?e.data.data:[]}function ae(e){return e?`/storage/${e}`:""}function le(e){return(e||"").split("/").pop()||""}function ne(e){return/\.pdf$/i.test(e||"")}function se(e={}){const i=ee(e.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""},s=ae(e.file);return{id:e.id,unit_id:e.unit_id,folder_id:e.folder_id,file:e.file??"",file_url:s,file_name:le(e.file),is_pdf:ne(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const V={list:async e=>{const{data:i}=await C.get(`/api/unit-docs/${e}`);return te(i).map(se)},create:async e=>{const{data:i}=await C.post("/api/unit-docs/create",e,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async e=>{const{data:i}=await C.post("/api/unit-docs/update",e,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async e=>{const{data:i}=await C.delete(`/api/unit-docs/delete/${e}`);return i}};function ie(e,i=[]){const o=new FormData;return o.append("unit_id",String(e)),i.forEach((s,d)=>{var m,g;o.append(`data[${d}][folder_id]`,String(s.folder_id??"")),o.append(`data[${d}][title][en]`,((m=s==null?void 0:s.title)==null?void 0:m.en)??""),o.append(`data[${d}][title][ar]`,((g=s==null?void 0:s.title)==null?void 0:g.ar)??""),s.file&&o.append(`data[${d}][file]`,s.file)}),o}function re(e,i=[]){const o=new FormData;return o.append("unit_id",String(e)),i.forEach((s,d)=>{var m,g;o.append(`data[${d}][id]`,String(s.id??"")),o.append(`data[${d}][folder_id]`,String(s.folder_id??"")),((m=s==null?void 0:s.title)==null?void 0:m.en)!==void 0&&o.append(`data[${d}][title][en]`,s.title.en??""),((g=s==null?void 0:s.title)==null?void 0:g.ar)!==void 0&&o.append(`data[${d}][title][ar]`,s.title.ar??""),s.file&&o.append(`data[${d}][file]`,s.file)}),o}const oe={class:"p-6 space-y-6"},de={class:"flex items-center justify-between"},ue=["href"],ce={class:"bg-white p-4 rounded shadow"},fe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},pe={class:"mt-4"},me={key:0,class:"mt-3 text-sm text-gray-600"},ge={class:"mt-4 flex items-center gap-3"},_e=["disabled"],ve={key:0,class:"text-red-600 text-sm"},xe={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},be={key:0,class:"text-sm text-gray-500"},ye={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-5"},he={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},ke=["src"],we={key:1,class:"flex flex-col items-center text-gray-500 text-xs"},Ue={class:"mt-2 break-all max-w-[90%]"},$e=["href"],Ce={class:"p-3.5 space-y-3 text-sm"},Fe=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Ve={class:"text-[11px]"},Ie=["onChange"],Ae={key:0,class:"mt-1 text-[11px] text-gray-500"},Se={class:"flex items-center gap-2 pt-2"},Ne=["onClick","disabled"],je=["onClick"],Ee={key:0,class:"col-span-full text-center text-gray-500 py-8"},Te={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(e){const i=e,o=E(()=>"/units-management"),s=v([]),d=v(!1);async function m(){d.value=!0;try{s.value=await Y.list("document",i.unitId)}finally{d.value=!1}}function g(n){s.value.unshift(n)}const u=v({folder_id:null,title:{en:"",ar:""}}),b=v([]),w=v(!1),U=v(""),R=E(()=>{var n,t;return!!u.value.folder_id&&!!((n=u.value.title.en)!=null&&n.trim())&&!!((t=u.value.title.ar)!=null&&t.trim())&&b.value.length>0});function B(n){const t=Array.from(n.target.files||[]);b.value=t}async function L(){var n,t;w.value=!0,U.value="";try{const a=b.value.map(r=>({folder_id:u.value.folder_id,title:{...u.value.title},file:r})),p=ie(i.unitId,a);await V.create(p),await h(),b.value=[],u.value.title={en:"",ar:""}}catch(a){console.error(a),U.value=((t=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Upload failed"}finally{w.value=!1}}const I=v([]),A=v(!1),_=S({}),x=S({}),$=S({});function q(n){n.forEach(t=>{_[t.id]={folder_id:t.folder_id??null,title:{en:t.title_en||"",ar:t.title_ar||""}}})}function j(n){const t=n==null?void 0:n.target;t&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}async function h(){A.value=!0;try{const n=await V.list(i.unitId);I.value=n,q(n)}finally{A.value=!1}}function P(n,t){var p;const a=((p=t.target.files)==null?void 0:p[0])||null;a&&(x[n]=a)}async function O(n){var a,p;const t=_[n];if(t){$[n]=!0;try{const r=[{id:n,folder_id:t.folder_id,title:t.title||{en:"",ar:""},file:x[n]}],M=re(i.unitId,r);await V.update(M),delete x[n],await h()}catch(r){console.error(r),alert(((p=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:p.message)||"Update failed")}finally{$[n]=!1}}}async function J(n){confirm("Delete this document?")&&(await V.remove(n),await h())}return z(async()=>{await m(),await h()}),(n,t)=>(c(),G(W,null,{default:H(()=>[l("div",oe,[l("div",de,[t[5]||(t[5]=l("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Documents",-1)),l("a",{href:o.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,ue)]),N(X,{"unit-id":Number(e.unitId),cols:2},null,8,["unit-id"]),l("div",ce,[t[8]||(t[8]=l("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),l("div",fe,[N(T,{type:"document",label:"Folder *",modelValue:u.value.folder_id,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value.folder_id=a),options:s.value,unitId:i.unitId,onCreated:g,onRefresh:m},null,8,["modelValue","options","unitId"]),l("div",null,[t[6]||(t[6]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),F(l("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.title.en=a),class:"form-input",type:"text",required:""},null,512),[[D,u.value.title.en]])]),l("div",null,[t[7]||(t[7]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),F(l("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.title.ar=a),class:"form-input",type:"text",required:""},null,512),[[D,u.value.title.ar]])])]),l("div",pe,[l("input",{type:"file",multiple:"",onChange:B},null,32),b.value.length?(c(),f("div",me,y(b.value.length)+" file(s) selected ",1)):k("",!0)]),l("div",ge,[l("button",{disabled:w.value||!R.value,onClick:L,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},y(w.value?"Uploadingâ€¦":"Upload"),9,_e),U.value?(c(),f("span",ve,y(U.value),1)):k("",!0)])]),l("div",xe,[l("div",{class:"flex items-center justify-between mb-4"},[t[9]||(t[9]=l("h3",{class:"text-lg font-semibold text-gray-800"},"Documents",-1)),l("button",{onClick:h,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),A.value?(c(),f("div",be,"Loadingâ€¦")):(c(),f("div",ye,[(c(!0),f(K,null,Q(I.value,a=>{var p;return c(),f("div",{key:a.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[l("div",he,[a.file_url&&/\.(jpg|jpeg|png|gif|webp)$/i.test(a.file_url)?(c(),f("img",{key:0,src:a.file_url,class:"absolute inset-0 w-full h-full object-cover",alt:"Document Preview"},null,8,ke)):(c(),f("div",we,[t[10]||(t[10]=l("div",{class:"text-4xl"},"ðŸ“„",-1)),l("span",Ue,y(a.file_name),1),a.file_url?(c(),f("a",{key:0,href:a.file_url,target:"_blank",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,$e)):k("",!0)]))]),l("div",Ce,[l("div",null,[t[11]||(t[11]=l("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),F(l("textarea",{"onUpdate:modelValue":r=>_[a.id].title.en=r,class:"form-input !h-auto min-h-9",rows:"1",onInput:t[3]||(t[3]=r=>j(r))},null,40,Fe),[[D,_[a.id].title.en]])]),l("div",null,[t[12]||(t[12]=l("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),F(l("textarea",{"onUpdate:modelValue":r=>_[a.id].title.ar=r,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:t[4]||(t[4]=r=>j(r))},null,40,De),[[D,_[a.id].title.ar]])]),N(T,{type:"document",label:"Folder *",modelValue:_[a.id].folder_id,"onUpdate:modelValue":r=>_[a.id].folder_id=r,options:s.value,unitId:i.unitId,onCreated:g,onRefresh:m},null,8,["modelValue","onUpdate:modelValue","options","unitId"]),l("div",Ve,[t[13]||(t[13]=l("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),l("input",{type:"file",onChange:r=>P(a.id,r)},null,40,Ie),x!=null&&x[a.id]?(c(),f("p",Ae," Selected: "+y((p=x[a.id])==null?void 0:p.name),1)):k("",!0)]),l("div",Se,[l("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:r=>O(a.id),disabled:$[a.id]},y($[a.id]?"Savingâ€¦":"Save"),9,Ne),l("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:r=>J(a.id)}," Delete ",8,je)])])])}),128)),I.value.length?k("",!0):(c(),f("div",Ee," No documents found. "))]))])])]),_:1}))}},Oe=Z(Te,[["__scopeId","data-v-358809d2"]]);export{Oe as default};
