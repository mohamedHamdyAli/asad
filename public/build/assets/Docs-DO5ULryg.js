import{m as U,p as g,i as T,r as S,q as M,c as z,o as c,w as G,b as a,a as j,j as $,k as D,f,h as x,t as y,F as H,s as K}from"./app-hVErxZBb.js";import{_ as Q}from"./AuthenticatedLayout-D7Gb01l7.js";import{F as E,a as W}from"./FolderPicker-D283kkHL.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Y(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function Z(t){var i;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((i=t==null?void 0:t.data)==null?void 0:i.data)?t.data.data:[]}function ee(t){return t?`/storage/${t}`:""}function te(t){return(t||"").split("/").pop()||""}function le(t){return/\.pdf$/i.test(t||"")}function ae(t={}){const i=Y(t.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""},n=ee(t.file);return{id:t.id,unit_id:t.unit_id,folder_id:t.folder_id,file:t.file??"",file_url:n,file_name:te(t.file),is_pdf:le(t.file),title_en:o.en??"",title_ar:o.ar??"",created_at:t.created_at,updated_at:t.updated_at}}const F={list:async t=>{const{data:i}=await U.get(`/api/unit-docs/${t}`);return Z(i).map(ae)},create:async t=>{const{data:i}=await U.post("/api/unit-docs/create",t,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async t=>{const{data:i}=await U.post("/api/unit-docs/update",t,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async t=>{const{data:i}=await U.delete(`/api/unit-docs/delete/${t}`);return i}};function se(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((n,u)=>{var _,d;o.append(`data[${u}][folder_id]`,String(n.folder_id??"")),o.append(`data[${u}][title][en]`,((_=n==null?void 0:n.title)==null?void 0:_.en)??""),o.append(`data[${u}][title][ar]`,((d=n==null?void 0:n.title)==null?void 0:d.ar)??""),n.file&&o.append(`data[${u}][file]`,n.file)}),o}function ne(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((n,u)=>{var _,d;o.append(`data[${u}][id]`,String(n.id??"")),o.append(`data[${u}][folder_id]`,String(n.folder_id??"")),((_=n==null?void 0:n.title)==null?void 0:_.en)!==void 0&&o.append(`data[${u}][title][en]`,n.title.en??""),((d=n==null?void 0:n.title)==null?void 0:d.ar)!==void 0&&o.append(`data[${u}][title][ar]`,n.title.ar??""),n.file&&o.append(`data[${u}][file]`,n.file)}),o}const ie={class:"p-6 space-y-6"},re={class:"flex items-center justify-between"},oe=["href"],de={class:"bg-white p-4 rounded shadow"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce={class:"mt-4"},fe={key:0,class:"mt-3 text-sm text-gray-600"},pe={class:"mt-4 flex items-center gap-3"},me=["disabled"],ge={key:0,class:"text-red-600 text-sm"},_e={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},ve={key:0,class:"text-sm text-gray-500"},be={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},xe={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},ye=["src"],he={key:1,class:"flex flex-col items-center text-gray-500 text-xs"},ke={class:"mt-2 break-all max-w-[90%]"},we=["href"],Ce={class:"p-3.5 space-y-3 text-sm"},Ue=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],De={class:"text-[11px]"},Fe=["onChange"],Ve={key:0,class:"mt-1 text-[11px] text-gray-500"},Ae={class:"flex items-center gap-2 pt-2"},Se=["onClick"],Ne=["onClick","disabled"],Te=["onClick"],je={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ee={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(t){const i=g([]),o=g(!1);async function n(){o.value=!0;try{i.value=await W.list("document")}finally{o.value=!1}}const u=t,_=T(()=>"/units-management"),d=g({folder_id:null,title:{en:"",ar:""}}),b=g([]),k=g(!1),w=g(""),I=T(()=>{var s,e;return!!d.value.folder_id&&!!((s=d.value.title.en)!=null&&s.trim())&&!!((e=d.value.title.ar)!=null&&e.trim())&&b.value.length>0});function R(s){const e=Array.from(s.target.files||[]);b.value=e}async function B(){var s,e;k.value=!0,w.value="";try{const l=b.value.map(r=>({folder_id:d.value.folder_id,title:{...d.value.title},file:r})),p=se(u.unitId,l);await F.create(p),await h(),b.value=[],d.value.title={en:"",ar:""}}catch(l){console.error(l),w.value=((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)||(l==null?void 0:l.message)||"Upload failed"}finally{k.value=!1}}const V=g([]),A=g(!1),m=S({}),v=S({}),C=S({});function L(s){s.forEach(e=>{m[e.id]={folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}function N(s){const e=s==null?void 0:s.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}async function h(){A.value=!0;try{const s=await F.list(u.unitId);V.value=s,L(s)}finally{A.value=!1}}function q(s,e){var p;const l=((p=e.target.files)==null?void 0:p[0])||null;l&&(v[s]=l)}async function O(s){var l,p;const e=m[s];if(e){C[s]=!0;try{const r=[{id:s,folder_id:e.folder_id,title:e.title,file:v[s]}],J=ne(u.unitId,r);await F.update(J),delete v[s],await h()}catch(r){console.error(r),alert(((p=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:p.message)||"Update failed")}finally{C[s]=!1}}}async function P(s){confirm("Delete this document?")&&(await F.remove(s),await h())}return M(async()=>{await n(),await h()}),(s,e)=>(c(),z(Q,null,{default:G(()=>[a("div",ie,[a("div",re,[e[7]||(e[7]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Documents",-1)),a("a",{href:_.value,class:"px-3 py-1 border rounded"},"Back to Units",8,oe)]),a("div",de,[e[10]||(e[10]=a("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),a("div",ue,[j(E,{type:"document",label:"Folder *",fileType:"document",modelValue:d.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.folder_id=l),options:i.value,onCreated:e[1]||(e[1]=l=>i.value.unshift(l)),onRefresh:n},null,8,["modelValue","options"]),a("div",null,[e[8]||(e[8]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),$(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.title.en=l),class:"form-input",type:"text",required:""},null,512),[[D,d.value.title.en]])]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),$(a("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>d.value.title.ar=l),class:"form-input",type:"text",required:""},null,512),[[D,d.value.title.ar]])])]),a("div",ce,[a("input",{type:"file",multiple:"",onChange:R},null,32),b.value.length?(c(),f("div",fe,y(b.value.length)+" file(s) selected ",1)):x("",!0)]),a("div",pe,[a("button",{disabled:k.value||!I.value,onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},y(k.value?"Uploadingâ€¦":"Upload"),9,me),w.value?(c(),f("span",ge,y(w.value),1)):x("",!0)])]),a("div",_e,[a("div",{class:"flex items-center justify-between mb-4"},[e[11]||(e[11]=a("h3",{class:"text-lg font-semibold text-gray-800"},"Documents",-1)),a("button",{onClick:h,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),A.value?(c(),f("div",ve,"Loadingâ€¦")):(c(),f("div",be,[(c(!0),f(H,null,K(V.value,l=>{var p;return c(),f("div",{key:l.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[a("div",xe,[l.file_url&&!l.is_pdf&&/\.(jpg|jpeg|png|gif|webp)$/i.test(l.file_url)?(c(),f("img",{key:0,src:l.file_url,class:"absolute inset-0 w-full h-full object-cover",alt:"Document Preview"},null,8,ye)):(c(),f("div",he,[e[12]||(e[12]=a("div",{class:"text-4xl"},"ðŸ“„",-1)),a("span",ke,y(l.file_name),1),l.file_url?(c(),f("a",{key:0,href:l.file_url,target:"_blank",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,we)):x("",!0)]))]),a("div",Ce,[a("div",null,[e[13]||(e[13]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),$(a("textarea",{"onUpdate:modelValue":r=>m[l.id].title.en=r,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[4]||(e[4]=r=>N(r))},null,40,Ue),[[D,m[l.id].title.en]])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),$(a("textarea",{"onUpdate:modelValue":r=>m[l.id].title.ar=r,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[5]||(e[5]=r=>N(r))},null,40,$e),[[D,m[l.id].title.ar]])]),j(E,{type:"document",label:"Folder *",modelValue:m[l.id].folder_id,"onUpdate:modelValue":r=>m[l.id].folder_id=r,options:i.value,onCreated:e[6]||(e[6]=r=>i.value.unshift(r)),onRefresh:n},null,8,["modelValue","onUpdate:modelValue","options"]),a("div",De,[e[15]||(e[15]=a("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),a("input",{type:"file",accept:"image/*,application/pdf",onChange:r=>q(l.id,r)},null,40,Fe),v!=null&&v[l.id]?(c(),f("p",Ve," Selected: "+y((p=v[l.id])==null?void 0:p.name),1)):x("",!0)]),a("div",Ae,[l.file_url?(c(),f("button",{key:0,onClick:r=>s.window.open(l.file_url,"_blank"),class:"px-3 py-1.5 text-sm rounded-lg border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100"}," Open ",8,Se)):x("",!0),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:r=>O(l.id),disabled:C[l.id]},y(C[l.id]?"Savingâ€¦":"Save"),9,Ne),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:r=>P(l.id)}," Delete ",8,Te)])])])}),128)),V.value.length?x("",!0):(c(),f("div",je," No documents found. "))]))])])]),_:1}))}},qe=X(Ee,[["__scopeId","data-v-0a30c4db"]]);export{qe as default};
