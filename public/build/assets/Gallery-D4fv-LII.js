import{m as A,p as v,i as W,r as N,q as X,c as Y,o as p,w as Z,b as a,a as G,j as b,k as h,f as m,h as U,F as L,s as q,t as w}from"./app-DfJxAqit.js";import{_ as ee}from"./AuthenticatedLayout-CfxJujCa.js";import{F as B,a as te}from"./FolderPicker-DKZ5plju.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";function le(l){try{return typeof l=="string"?JSON.parse(l):l}catch{return l}}function ne(l){var i;return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l==null?void 0:l.message)?l.message:Array.isArray((i=l==null?void 0:l.data)==null?void 0:i.data)?l.data.data:[]}function se(l){return l?`/storage/${l}`:""}function re(l={}){const i=le(l.title),d=i&&typeof i=="object"?i:{en:i??"",ar:i??""};return{id:l.id,unit_id:l.unit_id,folder_id:l.folder_id,date:l.date??"",image:l.image??"",image_url:se(l.image),title_en:d.en??"",title_ar:d.ar??"",created_at:l.created_at,updated_at:l.updated_at}}const E={list:async l=>{const{data:i}=await A.get(`/api/unit-gallery/${l}`);return ne(i).map(re)},create:async l=>{const{data:i}=await A.post("/api/unit-gallery/create",l,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async l=>{const{data:i}=await A.post("/api/unit-gallery/update",l,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async l=>{const{data:i}=await A.delete(`/api/unit-gallery/delete/${l}`);return i}};function ie(l,i=[]){const d=new FormData;return d.append("unit_id",String(l)),i.forEach((r,u)=>{var y,o;d.append(`data[${u}][folder_id]`,String(r.folder_id??"")),d.append(`data[${u}][date]`,r.date??""),d.append(`data[${u}][title][en]`,((y=r==null?void 0:r.title)==null?void 0:y.en)??""),d.append(`data[${u}][title][ar]`,((o=r==null?void 0:r.title)==null?void 0:o.ar)??""),r.image&&d.append(`data[${u}][image]`,r.image)}),d}function de(l,i=[]){const d=new FormData;return d.append("unit_id",String(l)),i.forEach((r,u)=>{var y,o;d.append(`data[${u}][id]`,String(r.id??"")),d.append(`data[${u}][folder_id]`,String(r.folder_id??"")),r.date!==void 0&&d.append(`data[${u}][date]`,r.date??""),((y=r==null?void 0:r.title)==null?void 0:y.en)!==void 0&&d.append(`data[${u}][title][en]`,r.title.en??""),((o=r==null?void 0:r.title)==null?void 0:o.ar)!==void 0&&d.append(`data[${u}][title][ar]`,r.title.ar??""),r.image&&d.append(`data[${u}][image]`,r.image)}),d}const oe={class:"p-6 space-y-6"},ue={class:"flex items-center justify-between"},ce=["href"],pe={class:"bg-white p-4 rounded shadow"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},me={class:"mt-4"},ge={key:0,class:"mt-3 flex flex-wrap gap-2"},ve=["src"],xe={class:"mt-4 flex items-center gap-3"},ye=["disabled"],_e={key:0,class:"text-red-600 text-sm"},be={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},he={key:0,class:"text-sm text-gray-500"},we={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 2xl:grid-cols-4 gap-5"},ke={class:"relative aspect-[4/3] bg-white"},Ue=["src"],Ie={key:1,class:"absolute inset-0 flex items-center justify-center text-gray-400 text-sm"},Ve={class:"absolute top-2 left-2 flex flex-wrap items-center gap-2"},$e={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},Ce={class:"inline-flex items-center rounded-full bg-white/90 backdrop-blur px-2 py-0.5 text-[11px] font-medium text-gray-700 border border-gray-200"},Fe={class:"p-3.5 space-y-3"},Ae=["onUpdate:modelValue"],Ee=["onUpdate:modelValue","placeholder"],Se=["onUpdate:modelValue","placeholder"],De={class:"text-[11px]"},Ne=["onChange"],Re={key:0,class:"mt-1 text-[11px] text-gray-500"},je={class:"flex items-center gap-2 pt-1"},Te=["onClick","disabled"],Ge=["onClick"],Le={key:0,class:"ml-auto inline-flex items-center rounded-full bg-amber-50 text-amber-700 px-2.5 py-0.5 text-[11px] border border-amber-200"},qe={key:0,class:"col-span-full text-center text-gray-500 py-8"},Be={__name:"Gallery",props:{unitId:{type:[Number,String],required:!0}},setup(l){const i=v([]),d=v(!1);async function r(){d.value=!0;try{i.value=await te.list("gallery",u.unitId)}finally{d.value=!1}}const u=l,y=W(()=>"/units-management"),o=v({folder_id:null,date:"",title:{en:"",ar:""}}),I=v([]),V=v([]),$=v(!1),C=v("");function O(n){const e=Array.from(n.target.files||[]);I.value=e,V.value=e.map(s=>URL.createObjectURL(s))}async function J(){var n,e;$.value=!0,C.value="";try{const s=I.value.map(t=>({folder_id:o.value.folder_id,date:o.value.date,title:{...o.value.title},image:t})),f=ie(u.unitId,s);await E.create(f),await k(),I.value=[],V.value=[],o.value.title={en:"",ar:""}}catch(s){console.error(s),C.value=((e=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Upload failed"}finally{$.value=!1}}const S=v([]),D=v(!1),R=v({});function M(n){const e={};n.forEach(s=>{e[s.id]={date:s.date||"",folder_id:s.folder_id??null,title:{en:s.title_en||"",ar:s.title_ar||""}}}),R.value=e}function P(n,e){var s,f,t,x;return(n==null?void 0:n.date)===(e==null?void 0:e.date)&&(n==null?void 0:n.folder_id)===(e==null?void 0:e.folder_id)&&((s=n==null?void 0:n.title)==null?void 0:s.en)===((f=e==null?void 0:e.title)==null?void 0:f.en)&&((t=n==null?void 0:n.title)==null?void 0:t.ar)===((x=e==null?void 0:e.title)==null?void 0:x.ar)}function j(n){const e=g[n.id],s=R.value[n.id];return!P(e,s)||!!_[n.id]}function T(n){const e=n==null?void 0:n.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}const g=N({}),_=N({}),F=N({});function z(n){n.forEach(e=>{g[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function k(){D.value=!0;try{const n=await E.list(u.unitId);S.value=n,z(n),M(n)}finally{D.value=!1}}function H(n,e){var f;const s=((f=e.target.files)==null?void 0:f[0])||null;s&&(_[n]=s)}async function K(n){var s,f;const e=g[n];if(e){F[n]=!0;try{const t=[{id:n,folder_id:e.folder_id,date:e.date,title:e.title,image:_[n]}],x=de(u.unitId,t);await E.update(x),delete _[n],await k()}catch(t){console.error(t),alert(((f=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:f.message)||"Update failed")}finally{F[n]=!1}}}async function Q(n){confirm("Delete this image?")&&(await E.remove(n),await k())}return X(async()=>{await r(),await k()}),(n,e)=>(p(),Y(ee,null,{default:Z(()=>{var s,f;return[a("div",oe,[a("div",ue,[e[8]||(e[8]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Gallery",-1)),a("a",{href:y.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ce)]),a("div",pe,[e[12]||(e[12]=a("h3",{class:"text-lg font-bold mb-3"},"Add Images",-1)),a("div",fe,[G(B,{type:"gallery",label:"Folder *",modelValue:o.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.folder_id=t),options:i.value,unitId:u.unitId,onCreated:e[1]||(e[1]=t=>i.value.unshift(t)),onRefresh:r},null,8,["modelValue","options","unitId"]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),b(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.date=t),class:"form-input",type:"date",required:""},null,512),[[h,o.value.date]])]),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),b(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title.en=t),class:"form-input",type:"text",required:""},null,512),[[h,o.value.title.en]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),b(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.title.ar=t),class:"form-input",type:"text",required:""},null,512),[[h,o.value.title.ar]])])]),a("div",me,[a("input",{type:"file",multiple:"",onChange:O},null,32),V.value.length?(p(),m("div",ge,[(p(!0),m(L,null,q(V.value,(t,x)=>(p(),m("img",{key:x,src:t,class:"w-24 h-16 object-cover rounded border"},null,8,ve))),128))])):U("",!0)]),a("div",xe,[a("button",{disabled:$.value||!I.value.length||!o.value.folder_id||!o.value.date||!((s=o.value.title.en)!=null&&s.trim())||!((f=o.value.title.ar)!=null&&f.trim()),onClick:J,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},w($.value?"Uploading…":"Upload"),9,ye),C.value?(p(),m("span",_e,w(C.value),1)):U("",!0)])]),a("div",be,[a("div",{class:"flex items-center justify-between mb-4"},[e[13]||(e[13]=a("h3",{class:"text-lg font-semibold text-gray-800"},"Images",-1)),a("button",{onClick:k,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),D.value?(p(),m("div",he,"Loading…")):(p(),m("div",we,[(p(!0),m(L,null,q(S.value,t=>{var x;return p(),m("div",{key:t.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[a("div",ke,[t.image_url?(p(),m("img",{key:0,src:t.image_url,class:"absolute inset-0 w-full h-full object-cover",alt:""},null,8,Ue)):(p(),m("div",Ie," No Image ")),e[14]||(e[14]=a("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1)),a("div",Ve,[a("span",$e,w(t.title_en||"—"),1),a("span",Ce,w(g[t.id].date||"No date"),1)])]),a("div",Fe,[e[19]||(e[19]=a("div",{class:"text-xs text-gray-500"},[a("span",{class:"font-medium text-gray-700"},"Folder")],-1)),G(B,{type:"gallery",label:" ",modelValue:g[t.id].folder_id,"onUpdate:modelValue":c=>g[t.id].folder_id=c,options:i.value,unitId:u.unitId,onCreated:e[5]||(e[5]=c=>i.value.unshift(c)),onRefresh:r},null,8,["modelValue","onUpdate:modelValue","options","unitId"]),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date",-1)),b(a("input",{"onUpdate:modelValue":c=>g[t.id].date=c,class:"form-input",type:"date"},null,8,Ae),[[h,g[t.id].date]])]),a("div",null,[e[16]||(e[16]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),b(a("textarea",{"onUpdate:modelValue":c=>g[t.id].title.en=c,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[6]||(e[6]=c=>T(c)),placeholder:t.title_en?"":"Enter English title"},null,40,Ee),[[h,g[t.id].title.en]])]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),b(a("textarea",{"onUpdate:modelValue":c=>g[t.id].title.ar=c,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[7]||(e[7]=c=>T(c)),placeholder:t.title_ar?"":"أدخل العنوان بالعربية"},null,40,Se),[[h,g[t.id].title.ar]])]),a("div",De,[e[18]||(e[18]=a("label",{class:"block text-gray-500 mb-1"},"Replace Image",-1)),a("input",{type:"file",accept:"image/*",onChange:c=>H(t.id,c)},null,40,Ne),_[t.id]?(p(),m("p",Re," Selected: "+w((x=_[t.id])==null?void 0:x.name),1)):U("",!0)]),a("div",je,[a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:c=>K(t.id),disabled:F[t.id]||!j(t)},w(F[t.id]?"Saving…":"Save"),9,Te),a("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:c=>Q(t.id)}," Delete ",8,Ge),j(t)?(p(),m("span",Le," Unsaved changes ")):U("",!0)])])])}),128)),S.value.length?U("",!0):(p(),m("div",qe," No images found. "))]))])])]}),_:1}))}},ze=ae(Be,[["__scopeId","data-v-c5113be3"]]);export{ze as default};
