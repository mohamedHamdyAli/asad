import{m as _,p as d,i as k,q as z,f,o as x,a as n,u as o,g as A,w as C,b as t,h as M,j as G,k as H,F,s as J,t as c,n as K}from"./app-BsdlFPdH.js";import{_ as Q}from"./AuthenticatedLayout-gjezUEVK.js";import{c as R,a as I,d as P,F as W,b as v,E as y}from"./index.esm-CN2oZHZ4.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={list:async()=>{const{data:i}=await _.get("/api/unit-issues");return i.data??[]},show:async i=>{const{data:l}=await _.get(`/api/unit-issues/show/${i}`);return l.data},create:async i=>{const{data:l}=await _.post("/api/unit-issues/create",{data:i});return l},update:async(i,l)=>{const{data:p}=await _.post(`/api/unit-issues/update/${i}`,{data:l});return p},remove:async i=>{const{data:l}=await _.delete(`/api/unit-issues/delete/${i}`);return l}},Y={class:"p-6 space-y-6"},Z={class:"flex gap-4"},tt={class:"bg-white rounded-xl shadow border overflow-hidden"},et={class:"w-full text-sm"},st={class:"px-4 py-3"},at={class:"px-4 py-3"},nt={class:"px-4 py-3"},ot={class:"px-4 py-3"},it={class:"px-4 py-3 text-right space-x-2"},lt=["onClick"],rt=["onClick"],dt={key:0},ut={class:"flex justify-between items-center"},ct={class:"text-sm text-gray-600"},pt={class:"flex gap-2"},mt=["disabled"],_t=["disabled"],ft={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},xt={class:"bg-white w-full max-w-lg rounded-xl p-6"},vt={class:"space-y-3"},U=10,yt={__name:"UnitIssues",setup(i){const l=d([]),p=d(""),u=d(1),b=d(!1),S=d(null),D=d({}),g=d("");d(!1);const V=R({unit_id:P().required(),user_id:P().required(),title:I().required(),description:I().required(),status:I().oneOf(["open","close"]).nullable()});async function h(){l.value=await $.list()}const w=k(()=>{const s=p.value.toLowerCase();return l.value.filter(e=>{var a;return((a=e.title)==null?void 0:a.toLowerCase().includes(s))||String(e.unit_id).includes(s)||String(e.user_id).includes(s)})}),N=k(()=>Math.ceil(w.value.length/U)),j=k(()=>{const s=(u.value-1)*U;return w.value.slice(s,s+U)});function B(s){S.value=s.id,D.value={unit_id:s.unit_id,user_id:s.user_id,title:s.title,description:s.description,status:s.status},b.value=!0}function q(){b.value=!1}async function L(s){var a,m;g.value="";const e={unit_id:Number(s.unit_id),user_id:Number(s.user_id),title:s.title,description:s.description,status:s.status||"open"};try{await $.update(S.value,e),q(),await h()}catch(r){console.error(r),((a=r==null?void 0:r.response)==null?void 0:a.status)===422?g.value=((m=r.response.data)==null?void 0:m.message)||"Validation error":g.value="Server error"}}async function O(s){confirm("Delete this issue?")&&(await $.remove(s),h())}return z(h),(s,e)=>(x(),f(F,null,[n(o(A),{title:"Unit Issues"}),n(Q,null,{default:C(()=>[t("div",Y,[e[8]||(e[8]=t("h2",{class:"text-2xl font-semibold"},"Unit Issues",-1)),t("div",Z,[G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),class:"form-input w-72",placeholder:"Search by title, unit or user"},null,512),[[H,p.value]])]),t("div",tt,[t("table",et,[e[4]||(e[4]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Unit"),t("th",{class:"px-4 py-3 text-left"},"User"),t("th",{class:"px-4 py-3 text-left"},"Title"),t("th",{class:"px-4 py-3 text-left"},"Status"),t("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),t("tbody",null,[(x(!0),f(F,null,J(j.value,a=>{var m,r,E;return x(),f("tr",{key:a.id,class:"border-t"},[t("td",st,c(((r=(m=a.unit)==null?void 0:m.name)==null?void 0:r.en)??a.unit_id),1),t("td",at,c(((E=a.user)==null?void 0:E.name)??a.user_id),1),t("td",nt,c(a.title),1),t("td",ot,[t("span",{class:K(["px-2 py-1 rounded text-xs",a.status==="open"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"])},c(a.status),3)]),t("td",it,[t("button",{class:"text-blue-600 text-sm",onClick:T=>B(a)}," Edit ",8,lt),t("button",{class:"text-red-600 text-sm",onClick:T=>O(a.id)}," Delete ",8,rt)])])}),128)),w.value.length===0?(x(),f("tr",dt,e[3]||(e[3]=[t("td",{colspan:"5",class:"text-center py-6 text-gray-500"}," No issues found ",-1)]))):M("",!0)])])]),t("div",ut,[t("span",ct," Page "+c(u.value)+" of "+c(N.value),1),t("div",pt,[t("button",{class:"px-3 py-1 border rounded",disabled:u.value===1,onClick:e[1]||(e[1]=a=>u.value--)}," Prev ",8,mt),t("button",{class:"px-3 py-1 border rounded",disabled:u.value===N.value,onClick:e[2]||(e[2]=a=>u.value++)}," Next ",8,_t)])]),b.value?(x(),f("div",ft,[t("div",xt,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold mb-4"}," Edit Issue ",-1)),n(o(W),{"validation-schema":o(V),"initial-values":D.value,onSubmit:L},{default:C(()=>[t("div",vt,[n(o(v),{name:"unit_id",class:"form-input",placeholder:"Unit ID"}),n(o(y),{name:"unit_id",class:"error"}),n(o(v),{name:"user_id",class:"form-input",placeholder:"User ID"}),n(o(y),{name:"user_id",class:"error"}),n(o(v),{name:"title",class:"form-input",placeholder:"Title"}),n(o(y),{name:"title",class:"error"}),n(o(v),{name:"description",as:"textarea",rows:"3",class:"form-input",placeholder:"Description"}),n(o(y),{name:"description",class:"error"}),n(o(v),{name:"status",as:"select",class:"form-input"},{default:C(()=>e[5]||(e[5]=[t("option",{value:"open"},"Open",-1),t("option",{value:"close"},"Close",-1)])),_:1})]),t("div",{class:"flex justify-end gap-2 mt-4"},[t("button",{type:"button",class:"px-4 py-2 border rounded",onClick:q}," Cancel "),e[6]||(e[6]=t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded"}," Save ",-1))])]),_:1},8,["validation-schema","initial-values"])])])):M("",!0)])]),_:1})],64))}},kt=X(yt,[["__scopeId","data-v-26330f83"]]);export{kt as default};
