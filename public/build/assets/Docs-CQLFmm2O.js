import{l as w,m as _,i as N,r as S,p as J,c as M,o as c,w as z,b as a,a as T,j as U,s as F,f,h as C,t as y,F as G,q as H}from"./app-CdqcvLGQ.js";import{_ as K}from"./AuthenticatedLayout-CjS34vnV.js";import{F as E,a as Q}from"./FolderPicker-CHOADyCR.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";function X(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function Y(e){var s;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((s=e==null?void 0:e.data)==null?void 0:s.data)?e.data.data:[]}function Z(e){return e?`/storage/${e}`:""}function ee(e){return(e||"").split("/").pop()||""}function te(e){return/\.pdf$/i.test(e||"")}function le(e={}){const s=X(e.title),o=s&&typeof s=="object"?s:{en:s??"",ar:s??""},n=Z(e.file);return{id:e.id,unit_id:e.unit_id,folder_id:e.folder_id,file:e.file??"",file_url:n,file_name:ee(e.file),is_pdf:te(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const D={list:async e=>{const{data:s}=await w.get(`/api/unit-docs/${e}`);return Y(s).map(le)},create:async e=>{const{data:s}=await w.post("/api/unit-docs/create",e,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async e=>{const{data:s}=await w.post("/api/unit-docs/update",e,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async e=>{const{data:s}=await w.delete(`/api/unit-docs/delete/${e}`);return s}};function ae(e,s=[]){const o=new FormData;return o.append("unit_id",String(e)),s.forEach((n,u)=>{var v,d;o.append(`data[${u}][folder_id]`,String(n.folder_id??"")),o.append(`data[${u}][title][en]`,((v=n==null?void 0:n.title)==null?void 0:v.en)??""),o.append(`data[${u}][title][ar]`,((d=n==null?void 0:n.title)==null?void 0:d.ar)??""),n.file&&o.append(`data[${u}][file]`,n.file)}),o}function ne(e,s=[]){const o=new FormData;return o.append("unit_id",String(e)),s.forEach((n,u)=>{var v,d;o.append(`data[${u}][id]`,String(n.id??"")),o.append(`data[${u}][folder_id]`,String(n.folder_id??"")),((v=n==null?void 0:n.title)==null?void 0:v.en)!==void 0&&o.append(`data[${u}][title][en]`,n.title.en??""),((d=n==null?void 0:n.title)==null?void 0:d.ar)!==void 0&&o.append(`data[${u}][title][ar]`,n.title.ar??""),n.file&&o.append(`data[${u}][file]`,n.file)}),o}const se={class:"p-6 space-y-6"},ie={class:"flex items-center justify-between"},oe=["href"],re={class:"bg-white p-4 rounded shadow"},de={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ue={class:"mt-4"},ce={key:0,class:"mt-3 text-sm text-gray-600"},fe={class:"mt-4 flex items-center gap-3"},pe=["disabled"],me={key:0,class:"text-red-600 text-sm"},_e={class:"bg-white p-4 rounded shadow"},ve={key:0,class:"text-sm text-gray-500"},ge={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},xe={class:"aspect-[4/3] bg-white flex items-center justify-center"},ye=["src"],be={key:1,class:"text-gray-500 text-sm flex flex-col items-center"},he={class:"mt-1"},ke={class:"p-3 space-y-2 text-sm"},we=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],Fe={class:"text-[11px]"},Ce=["onChange"],De={class:"flex gap-2 pt-1"},Ve=["href"],$e=["onClick","disabled"],Ae=["onClick"],Se={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ne={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(e){const s=_([]),o=_(!1);async function n(){o.value=!0;try{s.value=await Q.list("document")}finally{o.value=!1}}const u=e,v=N(()=>"/units-management"),d=_({folder_id:null,title:{en:"",ar:""}}),g=_([]),b=_(!1),h=_(""),R=N(()=>{var i,t;return!!d.value.folder_id&&!!((i=d.value.title.en)!=null&&i.trim())&&!!((t=d.value.title.ar)!=null&&t.trim())&&g.value.length>0});function j(i){const t=Array.from(i.target.files||[]);g.value=t}async function B(){var i,t;b.value=!0,h.value="";try{const l=g.value.map(m=>({folder_id:d.value.folder_id,title:{...d.value.title},file:m})),r=ae(u.unitId,l);await D.create(r),await x(),g.value=[],d.value.title={en:"",ar:""}}catch(l){console.error(l),h.value=((t=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Upload failed"}finally{b.value=!1}}const V=_([]),$=_(!1),p=S({}),A=S({}),k=S({});function I(i){i.forEach(t=>{p[t.id]={folder_id:t.folder_id??null,title:{en:t.title_en||"",ar:t.title_ar||""}}})}async function x(){$.value=!0;try{const i=await D.list(u.unitId);V.value=i,I(i)}finally{$.value=!1}}function L(i,t){var r;const l=((r=t.target.files)==null?void 0:r[0])||null;l&&(A[i]=l)}async function q(i){var l,r;const t=p[i];if(t){k[i]=!0;try{const m=[{id:i,folder_id:t.folder_id,title:t.title,file:A[i]}],P=ne(u.unitId,m);await D.update(P),delete A[i],await x()}catch(m){console.error(m),alert(((r=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:r.message)||"Update failed")}finally{k[i]=!1}}}async function O(i){confirm("Delete this document?")&&(await D.remove(i),await x())}return J(async()=>{await n(),await x()}),(i,t)=>(c(),M(K,null,{default:z(()=>[a("div",se,[a("div",ie,[t[5]||(t[5]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Documents",-1)),a("a",{href:v.value,class:"px-3 py-1 border rounded"},"Back to Units",8,oe)]),a("div",re,[t[8]||(t[8]=a("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),a("div",de,[T(E,{type:"document",label:"Folder *",fileType:"document",modelValue:d.value.folder_id,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value.folder_id=l),options:s.value,onCreated:t[1]||(t[1]=l=>s.value.unshift(l)),onRefresh:n},null,8,["modelValue","options"]),a("div",null,[t[6]||(t[6]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),U(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.value.title.en=l),class:"form-input",type:"text",required:""},null,512),[[F,d.value.title.en]])]),a("div",null,[t[7]||(t[7]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),U(a("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>d.value.title.ar=l),class:"form-input",type:"text",required:""},null,512),[[F,d.value.title.ar]])])]),a("div",ue,[a("input",{type:"file",multiple:"",onChange:j},null,32),g.value.length?(c(),f("div",ce,y(g.value.length)+" file(s) selected ",1)):C("",!0)]),a("div",fe,[a("button",{disabled:b.value||!R.value,onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},y(b.value?"Uploadingâ€¦":"Upload"),9,pe),h.value?(c(),f("span",me,y(h.value),1)):C("",!0)])]),a("div",_e,[a("div",{class:"flex items-center justify-between mb-3"},[t[9]||(t[9]=a("h3",{class:"text-lg font-bold"},"Documents",-1)),a("button",{onClick:x,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(c(),f("div",ve,"Loadingâ€¦")):(c(),f("div",ge,[(c(!0),f(G,null,H(V.value,l=>(c(),f("div",{key:l.id,class:"rounded border bg-gray-50 overflow-hidden"},[a("div",xe,[l.file_url&&!l.is_pdf?(c(),f("img",{key:0,src:l.file_url,class:"w-full h-full object-cover"},null,8,ye)):(c(),f("div",be,[t[10]||(t[10]=a("span",{class:"text-4xl"},"ðŸ“„",-1)),a("span",he,y(l.file_name),1)]))]),a("div",ke,[a("div",null,[t[11]||(t[11]=a("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),U(a("input",{"onUpdate:modelValue":r=>p[l.id].title.en=r,class:"form-input",type:"text"},null,8,we),[[F,p[l.id].title.en]])]),a("div",null,[t[12]||(t[12]=a("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),U(a("input",{"onUpdate:modelValue":r=>p[l.id].title.ar=r,class:"form-input",type:"text"},null,8,Ue),[[F,p[l.id].title.ar]])]),T(E,{type:"document",label:"Folder *",modelValue:p[l.id].folder_id,"onUpdate:modelValue":r=>p[l.id].folder_id=r,options:s.value,onCreated:t[4]||(t[4]=r=>s.value.unshift(r)),onRefresh:n},null,8,["modelValue","onUpdate:modelValue","options"]),a("div",Fe,[t[13]||(t[13]=a("label",{class:"block text-gray-500"},"Replace file",-1)),a("input",{type:"file",accept:"image/*,application/pdf",onChange:r=>L(l.id,r)},null,40,Ce)]),a("div",De,[l.file_url?(c(),f("a",{key:0,href:l.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Ve)):C("",!0),a("button",{class:"px-2 py-1 border rounded",onClick:r=>q(l.id),disabled:k[l.id]},y(k[l.id]?"Savingâ€¦":"Save"),9,$e),a("button",{class:"px-2 py-1 border rounded text-red-600",onClick:r=>O(l.id)},"Delete",8,Ae)])])]))),128)),V.value.length?C("",!0):(c(),f("div",Se," No documents found. "))]))])])]),_:1}))}},Be=W(Ne,[["__scopeId","data-v-74534538"]]);export{Be as default};
