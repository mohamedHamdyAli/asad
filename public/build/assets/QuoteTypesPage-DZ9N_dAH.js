import{p as r,C as Q,c as M,o as d,b as t,f as m,h as x,a as S,t as u,w as z,u as $,O as X,i as A,q as Y,j as C,k as Z,y as D,F as I,s as U,v as ee,n as te}from"./app-b49FIgF_.js";import{_ as le}from"./AuthenticatedLayout-CXpuQU13.js";import{T as B,a as E}from"./typeOfPrice-jRwAEMmG.js";import{c as se,f as ie,a as ae,b as L,d as F,F as ne}from"./index.esm-BU1ouKGs.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"fixed back-drop inset-0 z-50 flex items-center justify-center bg-black/50"},re={class:"bg-white rounded-xl shadow-xl w-full max-w-lg p-6 relative"},de={class:"text-xl font-semibold mb-4"},ue={key:0,class:"bg-red-100 text-red-700 p-3 rounded mb-4 text-sm"},ce={class:"mb-3"},pe={class:"error"},ve={class:"mb-3"},be={class:"error"},me={key:0,class:"mb-3"},fe={class:"error"},ye={class:"flex justify-end mt-6 gap-3"},ge=["disabled"],_e={__name:"QuoteTypeModal",props:{mode:String,type:String,item:Object},emits:["close","saved"],setup(P,{emit:T}){const n=P,y=T,o=r(!1),p=r(""),c=se({title_en:L().required("English title is required"),title_ar:L().required("Arabic title is required"),price:n.type==="building"?ie().nullable().min(0,"Price must be >= 0"):ae().nullable()}),g=r({title_en:"",title_ar:"",price:null});Q(()=>n.item,a=>{if(!a)return;const i=f(a.title);g.value={title_en:i.en,title_ar:i.ar,price:a.price??null}},{immediate:!0});function f(a){if(!a)return{en:"",ar:""};try{const i=JSON.parse(a);return{en:i.en??"",ar:i.ar??""}}catch{return{en:"",ar:""}}}async function v(a){var b,k;o.value=!0,p.value="";const i=n.mode==="add"?{data:[{title:{en:a.title_en,ar:a.title_ar},price:n.type==="building"?a.price:null}]}:{data:{title:{en:a.title_en,ar:a.title_ar},price:n.type==="building"?a.price:null}};try{n.mode==="add"?n.type==="building"?await B.create(i):await E.create(i):n.type==="building"?await B.update(n.item.id,i):await E.update(n.item.id,i),y("saved"),y("close")}catch(w){console.error(w),p.value=((k=(b=w.response)==null?void 0:b.data)==null?void 0:k.message)||"Server error. Please try again."}finally{o.value=!1}}return(a,i)=>(d(),M(X,{to:"body"},[t("div",oe,[t("div",re,[t("button",{onClick:i[0]||(i[0]=b=>a.$emit("close")),class:"absolute top-3 right-4 text-gray-500 hover:text-black"}," ✕ "),t("h3",de,u(P.mode==="add"?"Add Item":"Edit Item"),1),p.value?(d(),m("div",ue,u(p.value),1)):x("",!0),S($(ne),{onSubmit:v,"validation-schema":$(c)},{default:z(({errors:b})=>[t("div",ce,[i[2]||(i[2]=t("label",{class:"label"},"Title (EN) *",-1)),S($(F),{name:"title_en",class:"form-input"}),t("span",pe,u(b.title_en),1)]),t("div",ve,[i[3]||(i[3]=t("label",{class:"label"},"Title (AR) *",-1)),S($(F),{name:"title_ar",class:"form-input",dir:"rtl"}),t("span",be,u(b.title_ar),1)]),P.type==="building"?(d(),m("div",me,[i[4]||(i[4]=t("label",{class:"label"},"Price",-1)),S($(F),{name:"price",type:"number",class:"form-input"}),t("span",fe,u(b.price),1)])):x("",!0),t("div",ye,[t("button",{type:"button",onClick:i[1]||(i[1]=k=>a.$emit("close")),class:"px-4 py-2 border rounded"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",disabled:o.value},u(o.value?"Saving…":"Save"),9,ge)])]),_:1},8,["validation-schema"])])])]))}},he=J(_e,[["__scopeId","data-v-c4e7ce96"]]),xe={class:"p-6 space-y-10"},ke={class:"bg-white p-4 rounded-xl shadow flex flex-wrap gap-4 items-center"},we={class:"ml-auto flex gap-3"},$e={class:"bg-white rounded-xl shadow p-6"},Ce={class:"min-w-full border text-sm"},Pe={class:"bg-gray-100"},Te={class:"table-header w-10 text-center"},Se=["checked"],Ae={class:"table-cell text-center"},Be=["value"],Ee={class:"table-cell font-medium text-gray-700"},Ne={class:"table-cell"},Ve={class:"font-semibold text-gray-900"},De={class:"text-gray-500 text-xs"},Fe={key:0,class:"table-cell"},Me={key:1,class:"table-cell text-gray-400"},Oe={class:"table-cell text-center"},je={class:"p-3 text-center"},qe={class:"action-buttons"},Ie=["onClick"],Ue=["onClick"],Le={class:"flex justify-between items-center mt-4"},Qe={class:"space-x-2"},ze=["disabled"],Je=["disabled"],Re={__name:"QuoteTypesPage",setup(P){const T=r([]),n=r([]),y=r(""),o=r(""),p=r(""),c=r(1),g=r(10),f=r({open:!1,mode:"add",type:null,item:null}),v=r([]),a=r({key:"id",dir:"desc"});function i(l){if(!l)return{en:"",ar:""};if(typeof l=="string")try{const e=JSON.parse(l);return{en:(e==null?void 0:e.en)??"",ar:(e==null?void 0:e.ar)??""}}catch{return{en:"",ar:""}}return{en:(l==null?void 0:l.en)??"",ar:(l==null?void 0:l.ar)??""}}function b(l){f.value={open:!0,mode:"add",type:l,item:null}}function k(l){f.value={open:!0,mode:"edit",type:l.type,item:l}}function w(l){confirm("Delete this item?")&&(l.type==="building"?B.remove(l.id):E.remove(l.id),V())}function R(l){l.target.checked?v.value=N.value.map(e=>e.uid):v.value=[]}function W(){confirm("Delete selected items?")&&(v.value.forEach(l=>{const e=N.value.find(s=>s.uid===l);w(e)}),v.value=[])}const N=A(()=>{const l=T.value.map(s=>({...s,type:"building",uid:"b"+s.id})),e=n.value.map(s=>({...s,type:"price",uid:"p"+s.id}));return[...l,...e]}),O=A(()=>{let l=N.value;if(o.value&&(l=l.filter(e=>e.type===o.value)),p.value==="has_price"&&(l=l.filter(e=>e.type==="building"&&e.price)),p.value==="no_price"&&(l=l.filter(e=>e.type==="building"&&!e.price)),y.value){const e=y.value.toLowerCase();l=l.filter(s=>{const _=i(s.title);return _.en.toLowerCase().includes(e)||_.ar.toLowerCase().includes(e)})}return l=[...l].sort((e,s)=>{let _=e[a.value.key],h=s[a.value.key];return a.value.key==="title"&&(_=i(e.title).en,h=i(s.title).en),a.value.dir==="asc"?_>h?1:-1:_<h?1:-1}),l}),j=A(()=>Math.ceil(O.value.length/g.value)),G=A(()=>{const l=(c.value-1)*g.value;return O.value.slice(l,l+g.value)});function q(l){a.value.key===l?a.value.dir=a.value.dir==="asc"?"desc":"asc":(a.value.key=l,a.value.dir="asc")}function H(){c.value<j.value&&c.value++}function K(){c.value>1&&c.value--}async function V(){T.value=await B.list(),n.value=await E.list()}return Q([y,o,p],()=>{c.value=1}),Y(V),(l,e)=>(d(),M(le,null,{default:z(()=>[t("div",xe,[t("div",ke,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),placeholder:"Search by EN/AR title…",class:"form-input w-64"},null,512),[[Z,y.value]]),C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value=s),class:"form-input w-40"},e[10]||(e[10]=[t("option",{value:""},"All Types",-1),t("option",{value:"building"},"Building",-1),t("option",{value:"price"},"Price",-1)]),512),[[D,o.value]]),o.value==="building"?C((d(),m("select",{key:0,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),class:"form-input w-40"},e[11]||(e[11]=[t("option",{value:""},"All",-1),t("option",{value:"has_price"},"With Price",-1),t("option",{value:"no_price"},"No Price",-1)]),512)),[[D,p.value]]):x("",!0),v.value.length?(d(),m("button",{key:1,onClick:W,class:"px-4 py-2 bg-red-600 text-white rounded"}," Delete Selected ("+u(v.value.length)+") ",1)):x("",!0),t("div",we,[t("button",{onClick:e[3]||(e[3]=s=>b("building")),class:"btn-green"},"+ Building"),t("button",{onClick:e[4]||(e[4]=s=>b("price")),class:"btn-blue"},"+ Price")])]),t("div",$e,[t("table",Ce,[t("thead",Pe,[t("tr",null,[t("th",Te,[t("input",{type:"checkbox",onChange:R,checked:l.allSelected},null,40,Se)]),e[12]||(e[12]=t("th",{class:"table-header w-16 text-center"}," # ",-1)),t("th",{class:"table-header cursor-pointer",onClick:e[5]||(e[5]=s=>q("title"))}," Title "),o.value!=="price"?(d(),m("th",{key:0,class:"table-header w-24 cursor-pointer",onClick:e[6]||(e[6]=s=>q("price"))}," Price ")):x("",!0),e[13]||(e[13]=t("th",{class:"table-header w-24 text-center"},"Type",-1)),e[14]||(e[14]=t("th",{class:"table-header w-32 text-center"},"Actions",-1))])]),t("tbody",null,[(d(!0),m(I,null,U(G.value,(s,_)=>(d(),m("tr",{key:s.uid,class:"border-b hover:bg-gray-50 transition"},[t("td",Ae,[C(t("input",{type:"checkbox",value:s.uid,"onUpdate:modelValue":e[7]||(e[7]=h=>v.value=h)},null,8,Be),[[ee,v.value]])]),t("td",Ee,u((c.value-1)*g.value+_+1),1),t("td",Ne,[t("div",Ve,u(i(s.title).en||"—"),1),t("div",De,u(i(s.title).ar||"—"),1)]),s.type==="building"?(d(),m("td",Fe,u(s.price??"—"),1)):o.value!=="price"?(d(),m("td",Me,"—")):x("",!0),t("td",Oe,[t("span",{class:te(["px-2 py-1 rounded text-xs font-medium",s.type==="building"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"])},u(s.type),3)]),t("td",je,[t("div",qe,[t("button",{onClick:h=>k(s),class:"btn-edit"},"Edit",8,Ie),t("button",{onClick:h=>w(s),class:"btn-delete"},"Delete",8,Ue)])])]))),128))])]),t("div",Le,[C(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>g.value=s),class:"form-input w-24"},[(d(),m(I,null,U([10,25,50],s=>t("option",{key:s},u(s),1)),64))],512),[[D,g.value]]),t("div",Qe,[t("button",{onClick:K,class:"btn-gray",disabled:c.value===1},"Prev",8,ze),t("button",{onClick:H,class:"btn-gray",disabled:c.value===j.value},"Next",8,Je)])])]),f.value.open?(d(),M(he,{key:0,mode:f.value.mode,type:f.value.type,item:f.value.item,onClose:e[9]||(e[9]=s=>f.value.open=!1),onSaved:V},null,8,["mode","type","item"])):x("",!0)])]),_:1}))}},Ye=J(Re,[["__scopeId","data-v-f245767d"]]);export{Ye as default};
