import{k,i as A,l as g,m as F,p as q,c as R,o as u,w as L,b as l,j as x,s as b,f as p,h as w,t as v,F as O,q as J}from"./app-CANqHqHd.js";import{_ as M}from"./AuthenticatedLayout-X_Uj5J9y.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";function z(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function G(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}function H(e){return e?`/storage/${e}`:""}function K(e){return(e||"").split("/").pop()||""}function Q(e){return/\.pdf$/i.test(e||"")}function W(e={}){const a=z(e.title),r=a&&typeof a=="object"?a:{en:a??"",ar:a??""},s=H(e.file);return{id:e.id,unit_id:e.unit_id,folder_id:e.folder_id,file:e.file??"",file_url:s,file_name:K(e.file),is_pdf:Q(e.file),title_en:r.en??"",title_ar:r.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const U={list:async e=>{const{data:a}=await k.get(`/api/unit-docs/${e}`);return G(a).map(W)},create:async e=>{const{data:a}=await k.post("/api/unit-docs/create",e,{headers:{"Content-Type":"multipart/form-data"}});return a},update:async e=>{const{data:a}=await k.post("/api/unit-docs/update",e,{headers:{"Content-Type":"multipart/form-data"}});return a},remove:async e=>{const{data:a}=await k.delete(`/api/unit-docs/delete/${e}`);return a}};function X(e,a=[]){const r=new FormData;return r.append("unit_id",String(e)),a.forEach((s,o)=>{var c,f;r.append(`data[${o}][folder_id]`,String(s.folder_id??"")),r.append(`data[${o}][title][en]`,((c=s==null?void 0:s.title)==null?void 0:c.en)??""),r.append(`data[${o}][title][ar]`,((f=s==null?void 0:s.title)==null?void 0:f.ar)??""),s.file&&r.append(`data[${o}][file]`,s.file)}),r}function Y(e,a=[]){const r=new FormData;return r.append("unit_id",String(e)),a.forEach((s,o)=>{var c,f;r.append(`data[${o}][id]`,String(s.id??"")),r.append(`data[${o}][folder_id]`,String(s.folder_id??"")),((c=s==null?void 0:s.title)==null?void 0:c.en)!==void 0&&r.append(`data[${o}][title][en]`,s.title.en??""),((f=s==null?void 0:s.title)==null?void 0:f.ar)!==void 0&&r.append(`data[${o}][title][ar]`,s.title.ar??""),s.file&&r.append(`data[${o}][file]`,s.file)}),r}const Z={class:"p-6 space-y-6"},ee={class:"flex items-center justify-between"},te=["href"],le={class:"bg-white p-4 rounded shadow"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},se={class:"mt-4"},ae={key:0,class:"mt-3 text-sm text-gray-600"},ie={class:"mt-4 flex items-center gap-3"},re=["disabled"],oe={key:0,class:"text-red-600 text-sm"},de={class:"bg-white p-4 rounded shadow"},ue={key:0,class:"text-sm text-gray-500"},ce={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},fe={class:"aspect-[4/3] bg-white flex items-center justify-center"},pe=["src"],me={key:1,class:"text-gray-500 text-sm flex flex-col items-center"},_e={class:"mt-1"},ve={class:"p-3 space-y-2 text-sm"},ge={class:"flex items-center justify-between text-xs text-gray-500"},xe=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],he={class:"text-[11px]"},ke=["onChange"],we={class:"flex gap-2 pt-1"},Ue=["href"],De=["onClick","disabled"],$e=["onClick"],Ce={key:0,class:"col-span-full text-center text-gray-500 py-8"},Fe={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(e){const a=e,r=A(()=>"/units-management"),s=g({folder_id:null,title:{en:"",ar:""}}),o=g([]),c=g(!1),f=g(""),S=A(()=>{var i,t;return!!s.value.folder_id&&!!((i=s.value.title.en)!=null&&i.trim())&&!!((t=s.value.title.ar)!=null&&t.trim())&&o.value.length>0});function V(i){const t=Array.from(i.target.files||[]);o.value=t}async function N(){var i,t;c.value=!0,f.value="";try{const n=o.value.map(_=>({folder_id:s.value.folder_id,title:{...s.value.title},file:_})),d=X(a.unitId,n);await U.create(d),await y(),o.value=[],s.value.title={en:"",ar:""}}catch(n){console.error(n),f.value=((t=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:t.message)||(n==null?void 0:n.message)||"Upload failed"}finally{c.value=!1}}const D=g([]),$=g(!1),m=F({}),C=F({}),h=F({});function E(i){i.forEach(t=>{m[t.id]={folder_id:t.folder_id??null,title:{en:t.title_en||"",ar:t.title_ar||""}}})}async function y(){$.value=!0;try{const i=await U.list(a.unitId);D.value=i,E(i)}finally{$.value=!1}}function T(i,t){var d;const n=((d=t.target.files)==null?void 0:d[0])||null;n&&(C[i]=n)}async function j(i){var n,d;const t=m[i];if(t){h[i]=!0;try{const _=[{id:i,folder_id:t.folder_id,title:t.title,file:C[i]}],B=Y(a.unitId,_);await U.update(B),delete C[i],await y()}catch(_){console.error(_),alert(((d=(n=_==null?void 0:_.response)==null?void 0:n.data)==null?void 0:d.message)||"Update failed")}finally{h[i]=!1}}}async function I(i){confirm("Delete this document?")&&(await U.remove(i),await y())}return q(y),(i,t)=>(u(),R(M,null,{default:L(()=>[l("div",Z,[l("div",ee,[t[3]||(t[3]=l("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Documents",-1)),l("a",{href:r.value,class:"px-3 py-1 border rounded"},"Back to Units",8,te)]),l("div",le,[t[7]||(t[7]=l("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),l("div",ne,[l("div",null,[t[4]||(t[4]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Folder ID *",-1)),x(l("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.folder_id=n),class:"form-input",type:"number",min:"1",required:""},null,512),[[b,s.value.folder_id,void 0,{number:!0}]])]),l("div",null,[t[5]||(t[5]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),x(l("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[b,s.value.title.en]])]),l("div",null,[t[6]||(t[6]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),x(l("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[b,s.value.title.ar]])])]),l("div",se,[l("input",{type:"file",multiple:"",accept:"image/*,application/pdf",onChange:V},null,32),o.value.length?(u(),p("div",ae,v(o.value.length)+" file(s) selected ",1)):w("",!0)]),l("div",ie,[l("button",{disabled:c.value||!S.value,onClick:N,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},v(c.value?"Uploadingâ€¦":"Upload"),9,re),f.value?(u(),p("span",oe,v(f.value),1)):w("",!0)])]),l("div",de,[l("div",{class:"flex items-center justify-between mb-3"},[t[8]||(t[8]=l("h3",{class:"text-lg font-bold"},"Documents",-1)),l("button",{onClick:y,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(u(),p("div",ue,"Loadingâ€¦")):(u(),p("div",ce,[(u(!0),p(O,null,J(D.value,n=>(u(),p("div",{key:n.id,class:"rounded border bg-gray-50 overflow-hidden"},[l("div",fe,[n.file_url&&!n.is_pdf?(u(),p("img",{key:0,src:n.file_url,class:"w-full h-full object-cover"},null,8,pe)):(u(),p("div",me,[t[9]||(t[9]=l("span",{class:"text-4xl"},"ðŸ“„",-1)),l("span",_e,v(n.file_name),1)]))]),l("div",ve,[l("div",ge,[l("span",null,"#"+v(n.id),1),l("span",null,"Folder: "+v(n.folder_id),1)]),l("div",null,[t[10]||(t[10]=l("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),x(l("input",{"onUpdate:modelValue":d=>m[n.id].title.en=d,class:"form-input",type:"text"},null,8,xe),[[b,m[n.id].title.en]])]),l("div",null,[t[11]||(t[11]=l("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),x(l("input",{"onUpdate:modelValue":d=>m[n.id].title.ar=d,class:"form-input",type:"text"},null,8,be),[[b,m[n.id].title.ar]])]),l("div",null,[t[12]||(t[12]=l("label",{class:"block text-[11px] text-gray-500"},"Folder ID *",-1)),x(l("input",{"onUpdate:modelValue":d=>m[n.id].folder_id=d,class:"form-input",type:"number",min:"1"},null,8,ye),[[b,m[n.id].folder_id,void 0,{number:!0}]])]),l("div",he,[t[13]||(t[13]=l("label",{class:"block text-gray-500"},"Replace file",-1)),l("input",{type:"file",accept:"image/*,application/pdf",onChange:d=>T(n.id,d)},null,40,ke)]),l("div",we,[n.file_url?(u(),p("a",{key:0,href:n.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Ue)):w("",!0),l("button",{class:"px-2 py-1 border rounded",onClick:d=>j(n.id),disabled:h[n.id]},v(h[n.id]?"Savingâ€¦":"Save"),9,De),l("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>I(n.id)},"Delete",8,$e)])])]))),128)),D.value.length?w("",!0):(u(),p("div",Ce," No documents found. "))]))])])]),_:1}))}},Ne=P(Fe,[["__scopeId","data-v-08a6dcb5"]]);export{Ne as default};
