import{k,i as F,l as x,m as V,p as O,c as J,o as u,w as M,b as t,j as v,s as _,f as c,h as A,F as S,q as I,t as y}from"./app-BDxSfDqD.js";import{_ as z}from"./AuthenticatedLayout-B0GFBMmA.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";function G(a){try{return typeof a=="string"?JSON.parse(a):a}catch{return a}}function H(a){var s;return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.message)?a.message:Array.isArray((s=a==null?void 0:a.data)==null?void 0:s.data)?a.data.data:[]}function K(a){return a?`/storage/${a}`:""}function Q(a={}){const s=G(a.title),d=s&&typeof s=="object"?s:{en:s??"",ar:s??""};return{id:a.id,unit_id:a.unit_id,folder_id:a.folder_id,date:a.date??"",image:a.image??"",image_url:K(a.image),title_en:d.en??"",title_ar:d.ar??"",created_at:a.created_at,updated_at:a.updated_at}}const U={list:async a=>{const{data:s}=await k.get(`/api/unit-drawing/${a}`);return H(s).map(Q)},create:async a=>{const{data:s}=await k.post("/api/unit-drawing/create",a,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async a=>{const{data:s}=await k.post("/api/unit-drawing/update",a,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async a=>{const{data:s}=await k.delete(`/api/unit-drawing/delete/${a}`);return s}};function W(a,s=[]){const d=new FormData;return d.append("unit_id",String(a)),s.forEach((l,o)=>{var p,f;d.append(`data[${o}][folder_id]`,String(l.folder_id??"")),d.append(`data[${o}][date]`,l.date??""),d.append(`data[${o}][title][en]`,((p=l==null?void 0:l.title)==null?void 0:p.en)??""),d.append(`data[${o}][title][ar]`,((f=l==null?void 0:l.title)==null?void 0:f.ar)??""),l.image&&d.append(`data[${o}][image]`,l.image)}),d}function X(a,s=[]){const d=new FormData;return d.append("unit_id",String(a)),s.forEach((l,o)=>{var p,f;d.append(`data[${o}][id]`,String(l.id??"")),d.append(`data[${o}][folder_id]`,String(l.folder_id??"")),l.date!==void 0&&d.append(`data[${o}][date]`,l.date??""),((p=l==null?void 0:l.title)==null?void 0:p.en)!==void 0&&d.append(`data[${o}][title][en]`,l.title.en??""),((f=l==null?void 0:l.title)==null?void 0:f.ar)!==void 0&&d.append(`data[${o}][title][ar]`,l.title.ar??""),l.image&&d.append(`data[${o}][image]`,l.image)}),d}const Y={class:"p-6 space-y-6"},Z={class:"flex items-center justify-between"},ee=["href"],te={class:"bg-white p-4 rounded shadow"},ae={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ne={class:"mt-4"},le={key:0,class:"mt-3 flex flex-wrap gap-2"},se=["src"],ie={class:"mt-4 flex items-center gap-3"},de=["disabled"],re={key:0,class:"text-red-600 text-sm"},oe={class:"bg-white p-4 rounded shadow"},ue={key:0,class:"text-sm text-gray-500"},ce={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"},pe={class:"aspect-[4/3] bg-white flex items-center justify-center"},fe=["src"],me={key:1,class:"text-gray-400 text-sm"},ge={class:"p-2 space-y-2 text-xs"},ve={class:"flex items-center justify-between"},_e={class:"text-gray-500"},xe=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],we=["onUpdate:modelValue"],he={class:"text-[11px]"},ke=["onChange"],Ue={class:"flex gap-2 pt-1"},De=["onClick","disabled"],$e=["onClick"],Ce={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ve={__name:"Drawings",props:{unitId:{type:[Number,String],required:!0}},setup(a){const s=a,d=F(()=>"/units-management"),l=x({folder_id:null,date:"",title:{en:"",ar:""}}),o=x([]),p=x([]),f=x(!1),w=x(""),j=F(()=>{var i,e;return!!l.value.folder_id&&!!l.value.date&&!!((i=l.value.title.en)!=null&&i.trim())&&!!((e=l.value.title.ar)!=null&&e.trim())&&o.value.length>0});function N(i){const e=Array.from(i.target.files||[]);o.value=e,p.value=e.map(n=>URL.createObjectURL(n))}async function E(){var i,e;f.value=!0,w.value="";try{const n=o.value.map(g=>({folder_id:l.value.folder_id,date:l.value.date,title:{...l.value.title},image:g})),r=W(s.unitId,n);await U.create(r),await b(),o.value=[],p.value=[],l.value.title={en:"",ar:""}}catch(n){console.error(n),w.value=((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||(n==null?void 0:n.message)||"Upload failed"}finally{f.value=!1}}const D=x([]),$=x(!1),m=V({}),C=V({}),h=V({});function T(i){i.forEach(e=>{m[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function b(){$.value=!0;try{const i=await U.list(s.unitId);D.value=i,T(i)}finally{$.value=!1}}function R(i,e){var r;const n=((r=e.target.files)==null?void 0:r[0])||null;n&&(C[i]=n)}async function q(i){var n,r;const e=m[i];if(e){h[i]=!0;try{const g=[{id:i,folder_id:e.folder_id,date:e.date,title:e.title,image:C[i]}],L=X(s.unitId,g);await U.update(L),delete C[i],await b()}catch(g){console.error(g),alert(((r=(n=g==null?void 0:g.response)==null?void 0:n.data)==null?void 0:r.message)||"Update failed")}finally{h[i]=!1}}}async function B(i){confirm("Delete this drawing?")&&(await U.remove(i),await b())}return O(b),(i,e)=>(u(),J(z,null,{default:M(()=>[t("div",Y,[t("div",Z,[e[4]||(e[4]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Drawings",-1)),t("a",{href:d.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ee)]),t("div",te,[e[9]||(e[9]=t("h3",{class:"text-lg font-bold mb-3"},"Add Drawings",-1)),t("div",ae,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Folder ID *",-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.folder_id=n),class:"form-input",type:"number",min:"1",required:""},null,512),[[_,l.value.folder_id,void 0,{number:!0}]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.date=n),class:"form-input",type:"date",required:""},null,512),[[_,l.value.date]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[_,l.value.title.en]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[_,l.value.title.ar]])])]),t("div",ne,[t("input",{type:"file",multiple:"",accept:"image/*",onChange:N},null,32),p.value.length?(u(),c("div",le,[(u(!0),c(S,null,I(p.value,(n,r)=>(u(),c("img",{key:r,src:n,class:"w-24 h-16 object-cover rounded border"},null,8,se))),128))])):A("",!0)]),t("div",ie,[t("button",{disabled:f.value||!j.value,onClick:E,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},y(f.value?"Uploading…":"Upload"),9,de),w.value?(u(),c("span",re,y(w.value),1)):A("",!0)])]),t("div",oe,[t("div",{class:"flex items-center justify-between mb-3"},[e[10]||(e[10]=t("h3",{class:"text-lg font-bold"},"Drawings",-1)),t("button",{onClick:b,class:"px-3 py-1 border rounded"},"Refresh")]),$.value?(u(),c("div",ue,"Loading…")):(u(),c("div",ce,[(u(!0),c(S,null,I(D.value,n=>(u(),c("div",{key:n.id,class:"rounded border overflow-hidden bg-gray-50"},[t("div",pe,[n.image_url?(u(),c("img",{key:0,src:n.image_url,class:"w-full h-full object-cover"},null,8,fe)):(u(),c("div",me,"No Image"))]),t("div",ge,[t("div",ve,[t("span",null,"#"+y(n.id),1),t("span",_e,"Folder: "+y(n.folder_id),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-[11px] text-gray-500"},"Date *",-1)),v(t("input",{"onUpdate:modelValue":r=>m[n.id].date=r,class:"form-input",type:"date"},null,8,xe),[[_,m[n.id].date]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-[11px] text-gray-500"},"Folder ID *",-1)),v(t("input",{"onUpdate:modelValue":r=>m[n.id].folder_id=r,class:"form-input",type:"number",min:"1"},null,8,be),[[_,m[n.id].folder_id,void 0,{number:!0}]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),v(t("input",{"onUpdate:modelValue":r=>m[n.id].title.en=r,class:"form-input",type:"text"},null,8,ye),[[_,m[n.id].title.en]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),v(t("input",{"onUpdate:modelValue":r=>m[n.id].title.ar=r,class:"form-input",type:"text"},null,8,we),[[_,m[n.id].title.ar]])]),t("div",he,[e[15]||(e[15]=t("label",{class:"block text-gray-500"},"Replace Image",-1)),t("input",{type:"file",accept:"image/*",onChange:r=>R(n.id,r)},null,40,ke)]),t("div",Ue,[t("button",{class:"px-2 py-1 border rounded",onClick:r=>q(n.id),disabled:h[n.id]},y(h[n.id]?"Saving…":"Save"),9,De),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:r=>B(n.id)}," Delete ",8,$e)])])]))),128)),D.value.length?A("",!0):(u(),c("div",Ce," No drawings found. "))]))])])]),_:1}))}},Ie=P(Ve,[["__scopeId","data-v-d2603085"]]);export{Ie as default};
