import{m as b,i as $,p as v,r as R,q as O,c as q,o as p,w as J,b as t,j as h,k,f as m,h as w,t as x,F as M,s as z}from"./app-DucLZU7F.js";import{_ as P}from"./AuthenticatedLayout-Cuai63CQ.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function G(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function H(e){var i;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((i=e==null?void 0:e.data)==null?void 0:i.data)?e.data.data:[]}function K(e){return e?`/storage/${e}`:""}function S(e){return(e||"").split("/").pop()||""}function Q(e){return(S(e).split(".").pop()||"").toLowerCase()}function W(e){const i=Q(e);return i==="pdf"?"ðŸ“• PDF":i==="doc"||i==="docx"?"ðŸ“ DOC":i==="xls"||i==="xlsx"?"ðŸ“Š XLS":"ðŸ“„"}function Y(e={}){const i=G(e.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""},a=K(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:a,file_name:S(e.file),file_icon:W(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const C={list:async e=>{const{data:i}=await b.get(`/api/unit-report/${e}`);return H(i).map(Y)},create:async e=>{const{data:i}=await b.post("/api/unit-report/create",e,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async e=>{const{data:i}=await b.post("/api/unit-report/update",e,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async e=>{const{data:i}=await b.delete(`/api/unit-report/delete/${e}`);return i}};function Z(e,i=[]){const o=new FormData;return o.append("unit_id",String(e)),i.forEach((a,r)=>{var c,u;o.append(`data[${r}][title][en]`,((c=a==null?void 0:a.title)==null?void 0:c.en)??""),o.append(`data[${r}][title][ar]`,((u=a==null?void 0:a.title)==null?void 0:u.ar)??""),a.file&&o.append(`data[${r}][file]`,a.file)}),o}function ee(e,i=[]){const o=new FormData;return o.append("unit_id",String(e)),i.forEach((a,r)=>{var c,u;o.append(`data[${r}][id]`,String(a.id??"")),((c=a==null?void 0:a.title)==null?void 0:c.en)!==void 0&&o.append(`data[${r}][title][en]`,a.title.en??""),((u=a==null?void 0:a.title)==null?void 0:u.ar)!==void 0&&o.append(`data[${r}][title][ar]`,a.title.ar??""),a.file&&o.append(`data[${r}][file]`,a.file)}),o}const te={class:"p-6 space-y-6"},se={class:"flex items-center justify-between"},ne=["href"],ae={class:"bg-white p-4 rounded shadow"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"mt-4"},oe={key:0,class:"mt-3 text-sm text-gray-600"},re={class:"mt-4 flex items-center gap-3"},de=["disabled"],ce={key:0,class:"text-red-600 text-sm"},ue={class:"bg-white p-4 rounded shadow"},pe={key:0,class:"text-sm text-gray-500"},fe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},me={class:"h-32 bg-white flex items-center justify-center p-3 text-center"},xe={class:"text-gray-600"},_e={class:"text-3xl"},ve={class:"text-xs mt-1 break-all"},ge={class:"p-3 space-y-2 text-sm"},ye={class:"flex items-center justify-between text-xs text-gray-500"},be=["onUpdate:modelValue"],he=["onUpdate:modelValue"],ke={class:"text-[11px]"},we=["onChange"],Ce={class:"flex gap-2 pt-1"},Ue=["href"],Fe=["onClick","disabled"],Ae=["onClick"],Re={key:0,class:"col-span-full text-center text-gray-500 py-8"},D=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$e={__name:"Reports",props:{unitId:{type:[Number,String],required:!0}},setup(e){const i=e,o=$(()=>"/units-management"),a=v({title:{en:"",ar:""}}),r=v([]),c=v(!1),u=v(""),N=$(()=>{var l,s;return!!((l=a.value.title.en)!=null&&l.trim())&&!!((s=a.value.title.ar)!=null&&s.trim())&&r.value.length>0});function E(l){const s=Array.from(l.target.files||[]);r.value=s}async function T(){var l,s;c.value=!0,u.value="";try{const n=r.value.map(f=>({title:{...a.value.title},file:f})),d=Z(i.unitId,n);await C.create(d),await g(),r.value=[],a.value.title={en:"",ar:""}}catch(n){console.error(n),u.value=((s=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:s.message)||(n==null?void 0:n.message)||"Upload failed"}finally{c.value=!1}}const U=v([]),F=v(!1),_=R({}),A=R({}),y=R({});function V(l){l.forEach(s=>{_[s.id]={title:{en:s.title_en||"",ar:s.title_ar||""}}})}async function g(){F.value=!0;try{const l=await C.list(i.unitId);U.value=l,V(l)}finally{F.value=!1}}function j(l,s){var d;const n=((d=s.target.files)==null?void 0:d[0])||null;n&&(A[l]=n)}async function B(l){var n,d;const s=_[l];if(s){y[l]=!0;try{const f=[{id:l,title:s.title,file:A[l]}],I=ee(i.unitId,f);await C.update(I),delete A[l],await g()}catch(f){console.error(f),alert(((d=(n=f==null?void 0:f.response)==null?void 0:n.data)==null?void 0:d.message)||"Update failed")}finally{y[l]=!1}}}async function L(l){confirm("Delete this report?")&&(await C.remove(l),await g())}return O(g),(l,s)=>(p(),q(P,null,{default:J(()=>[t("div",te,[t("div",se,[s[2]||(s[2]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Reports",-1)),t("a",{href:o.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ne)]),t("div",ae,[s[5]||(s[5]=t("h3",{class:"text-lg font-bold mb-3"},"Add Reports",-1)),t("div",ie,[t("div",null,[s[3]||(s[3]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),h(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.value.title.en=n),class:"form-input",type:"text",required:""},null,512),[[k,a.value.title.en]])]),t("div",null,[s[4]||(s[4]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),h(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>a.value.title.ar=n),class:"form-input",type:"text",required:""},null,512),[[k,a.value.title.ar]])])]),t("div",le,[t("input",{type:"file",multiple:"",accept:D,onChange:E},null,32),r.value.length?(p(),m("div",oe,x(r.value.length)+" file(s) selected ",1)):w("",!0)]),t("div",re,[t("button",{disabled:c.value||!N.value,onClick:T,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},x(c.value?"Uploadingâ€¦":"Upload"),9,de),u.value?(p(),m("span",ce,x(u.value),1)):w("",!0)])]),t("div",ue,[t("div",{class:"flex items-center justify-between mb-3"},[s[6]||(s[6]=t("h3",{class:"text-lg font-bold"},"Reports",-1)),t("button",{onClick:g,class:"px-3 py-1 border rounded"},"Refresh")]),F.value?(p(),m("div",pe,"Loadingâ€¦")):(p(),m("div",fe,[(p(!0),m(M,null,z(U.value,n=>(p(),m("div",{key:n.id,class:"rounded border bg-gray-50 overflow-hidden"},[t("div",me,[t("div",xe,[t("div",_e,x(n.file_icon.split(" ")[0]),1),t("div",ve,x(n.file_name),1)])]),t("div",ge,[t("div",ye,[t("span",null,"#"+x(n.id),1)]),t("div",null,[s[7]||(s[7]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),h(t("input",{"onUpdate:modelValue":d=>_[n.id].title.en=d,class:"form-input",type:"text"},null,8,be),[[k,_[n.id].title.en]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),h(t("input",{"onUpdate:modelValue":d=>_[n.id].title.ar=d,class:"form-input",type:"text"},null,8,he),[[k,_[n.id].title.ar]])]),t("div",ke,[s[9]||(s[9]=t("label",{class:"block text-gray-500"},"Replace File",-1)),t("input",{type:"file",accept:D,onChange:d=>j(n.id,d)},null,40,we)]),t("div",Ce,[n.file_url?(p(),m("a",{key:0,href:n.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Ue)):w("",!0),t("button",{class:"px-2 py-1 border rounded",onClick:d=>B(n.id),disabled:y[n.id]},x(y[n.id]?"Savingâ€¦":"Save"),9,Fe),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>L(n.id)}," Delete ",8,Ae)])])]))),128)),U.value.length?w("",!0):(p(),m("div",Re," No reports found. "))]))])])]),_:1}))}},Ee=X($e,[["__scopeId","data-v-249c7009"]]);export{Ee as default};
