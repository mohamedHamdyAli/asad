import{m as u,p as I,f as i,o as r,a as N,u as O,g as z,w as T,b as e,h as f,F as M,q as D,t as d,n as G,d as Y,j as c,s as x,y as H,v as J,e as K}from"./app-CdqcvLGQ.js";import{_ as Q}from"./AuthenticatedLayout-CjS34vnV.js";import{V as w,b as W,a as X}from"./vendors-OUjTicXz.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"p-6 space-y-6"},te={class:"flex items-center justify-between"},se={class:"bg-white shadow rounded-lg p-4"},le={key:0,class:"text-sm text-gray-500"},ae={key:1,class:"overflow-x-auto"},oe={class:"w-full text-sm text-left text-gray-700"},ne={class:"px-3 py-2"},ie={class:"px-3 py-2"},re={class:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center"},de=["src"],ue={key:1,class:"text-xs text-gray-400"},ce={class:"px-3 py-2 font-medium"},pe={class:"px-3 py-2"},me={class:"px-3 py-2"},ve={class:"px-3 py-2"},xe={class:"px-3 py-2 text-right space-x-2"},ge=["onClick"],fe=["onClick"],ye={key:0},_e={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},be={class:"bg-white rounded-2xl shadow-lg w-full max-w-2xl p-5 relative"},he={class:"text-lg font-bold mb-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"md:col-span-2"},Ve=["required"],Ce=["required"],qe=["required"],Me={class:"block text-xs text-gray-500 mb-1"},je=["required"],Pe=["required"],Ue=["required"],Ee={class:"flex items-center gap-2"},Ne={class:"md:col-span-2"},De={class:"block text-xs text-gray-500 mb-1"},Fe=["required"],Ae={key:0,class:"mt-2"},Se=["src"],$e={class:"mt-4 flex items-center gap-3"},Le=["disabled"],Re={key:0,class:"text-sm text-red-600 mt-2"},Be={key:1,class:"mt-2 text-sm text-red-600 list-disc pl-6"},Ie={__name:"VendorsManagement",setup(Oe){const k=u([]),V=u(!1),y=u(!1),n=u(null),C=u(null),l=u({name:"",email:"",phone:"",password:"",gender:"",country_code:"",country_name:"",is_enabled:!0,profile_image:null}),m=u(null),_=u(!1),v=u(""),g=u({});function j(){l.value={name:"",email:"",phone:"",password:"",gender:"",country_code:"",country_name:"",is_enabled:!0,profile_image:null},m.value=null,v.value="",g.value={},n.value=null,C.value=null}function F(){j(),y.value=!0}function A(o){j(),n.value=o.id,C.value={...o},Object.assign(l.value,{name:o.name,email:o.email,phone:o.phone,gender:o.gender||"",country_code:o.country_code||"",country_name:o.country_name||"",is_enabled:!!o.is_enabled}),m.value=o.profile_image_url||null,y.value=!0}function q(){y.value=!1}function S(o){var s;const t=((s=o.target.files)==null?void 0:s[0])||null;l.value.profile_image=t,m.value=t?URL.createObjectURL(t):m.value}async function b(){V.value=!0;try{k.value=await w.list()}finally{V.value=!1}}async function $(){var o,t,s,p,P;_.value=!0,v.value="",g.value={};try{if(n.value){const a={};["name","email","phone","gender","country_code","country_name","is_enabled"].forEach(h=>{var U,E;(((U=C.value)==null?void 0:U[h])??"")!==(((E=l.value)==null?void 0:E[h])??"")&&(a[h]=l.value[h])}),l.value.password&&l.value.password.trim()!==""&&(a.password=l.value.password),l.value.profile_image&&(a.profile_image=l.value.profile_image);const B=W(a);await w.update(n.value,B)}else{const a=X(l.value);await w.create(a)}await b(),q()}catch(a){((o=a==null?void 0:a.response)==null?void 0:o.status)===422&&((s=(t=a==null?void 0:a.response)==null?void 0:t.data)!=null&&s.errors)?(g.value=a.response.data.errors,v.value=a.response.data.message||"Validation error"):v.value=((P=(p=a==null?void 0:a.response)==null?void 0:p.data)==null?void 0:P.message)||(a==null?void 0:a.message)||"Request failed"}finally{_.value=!1}}async function L(o){confirm(`Delete vendor "${o.name}"?`)&&(await w.remove(o.id),await b())}return I(b),(o,t)=>(r(),i(M,null,[N(O(z),{title:"Vendors Management"}),N(Q,null,{default:T(()=>[e("div",ee,[e("div",te,[t[9]||(t[9]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Project Managers (PM)",-1)),e("button",{onClick:t[0]||(t[0]=s=>F()),class:"inline-flex items-center rounded-md bg-gray-800 px-4 py-2 text-xs font-semibold uppercase tracking-widest text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"}," + Add PM ")]),e("div",se,[e("div",{class:"flex items-center justify-between mb-3"},[t[10]||(t[10]=e("h3",{class:"text-lg font-bold"},"Project Managers",-1)),e("button",{onClick:b,class:"px-3 py-1 border rounded"},"Refresh")]),V.value?(r(),i("div",le,"Loading…")):(r(),i("div",ae,[e("table",oe,[t[12]||(t[12]=e("thead",{class:"text-xs uppercase bg-gray-50 text-gray-500"},[e("tr",null,[e("th",{class:"px-3 py-2"},"#"),e("th",{class:"px-3 py-2"},"Avatar"),e("th",{class:"px-3 py-2"},"Name"),e("th",{class:"px-3 py-2"},"Email"),e("th",{class:"px-3 py-2"},"Phone"),e("th",{class:"px-3 py-2"},"Enabled"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(r(!0),i(M,null,D(k.value,s=>(r(),i("tr",{key:s.id,class:"border-b"},[e("td",ne,d(s.id),1),e("td",ie,[e("div",re,[s.profile_image_url?(r(),i("img",{key:0,src:s.profile_image_url,class:"w-full h-full object-cover"},null,8,de)):(r(),i("span",ue,"—"))])]),e("td",ce,d(s.name),1),e("td",pe,d(s.email),1),e("td",me,d(s.phone||"—"),1),e("td",ve,[e("span",{class:G(s.is_enabled?"text-green-600":"text-gray-400")},d(s.is_enabled?"Yes":"No"),3)]),e("td",xe,[e("button",{class:"text-blue-600 hover:underline",onClick:p=>A(s)},"Edit",8,ge),e("button",{class:"text-red-600 hover:underline",onClick:p=>L(s)},"Delete",8,fe)])]))),128)),k.value.length?f("",!0):(r(),i("tr",ye,t[11]||(t[11]=[e("td",{colspan:"7",class:"px-3 py-6 text-center text-gray-500"},"No vendors found.",-1)])))])])]))]),y.value?(r(),i("div",_e,[e("div",be,[e("button",{onClick:q,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600"},"✕"),e("h3",he,d(n.value?"Edit PM":"Add PM"),1),e("form",{onSubmit:Y($,["prevent"])},[e("div",we,[e("div",ke,[t[13]||(t[13]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Name",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),class:"form-input",type:"text",required:""},null,512),[[x,l.value.name,void 0,{trim:!0}]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Email",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.email=s),class:"form-input",type:"email",required:!n.value},null,8,Ve),[[x,l.value.email,void 0,{trim:!0}]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Country Code",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.country_code=s),class:"form-input",type:"text",placeholder:"+20",required:!n.value},null,8,Ce),[[x,l.value.country_code,void 0,{trim:!0}]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Phone",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.phone=s),class:"form-input",type:"text",required:!n.value},null,8,qe),[[x,l.value.phone,void 0,{trim:!0}]])]),e("div",null,[e("label",Me,d(n.value?"Password (optional)":"Password"),1),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.password=s),class:"form-input",type:"password",required:!n.value,minlength:"8"},null,8,je),[[x,l.value.password]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Gender",-1)),c(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.gender=s),class:"form-input",required:!n.value},t[17]||(t[17]=[e("option",{value:"",disabled:""},"Select gender",-1),e("option",{value:"male"},"male",-1),e("option",{value:"female"},"female",-1),e("option",{value:"other"},"other",-1)]),8,Pe),[[H,l.value.gender]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Country Name",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.country_name=s),class:"form-input",type:"text",placeholder:"Egypt",required:!n.value},null,8,Ue),[[x,l.value.country_name,void 0,{trim:!0}]])]),e("div",Ee,[c(e("input",{id:"enabled",type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=s=>l.value.is_enabled=s)},null,512),[[J,l.value.is_enabled]]),t[20]||(t[20]=e("label",{for:"enabled",class:"text-sm"},"Enabled",-1))]),e("div",Ne,[e("label",De," Profile Image "+d(n.value?"(optional; select to replace)":"(required)"),1),e("input",{type:"file",accept:"image/*",onChange:S,required:!n.value},null,40,Fe),m.value?(r(),i("div",Ae,[e("img",{src:m.value,class:"w-32 h-32 object-cover rounded border"},null,8,Se)])):f("",!0)])]),e("div",$e,[e("button",{disabled:_.value,class:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-60"},d(_.value?"Saving…":n.value?"Update":"Create"),9,Le),e("button",{type:"button",class:"px-3 py-2 border rounded",onClick:q},"Cancel")]),v.value?(r(),i("div",Re,d(v.value),1)):f("",!0),Object.keys(g.value).length?(r(),i("ul",Be,[(r(!0),i(M,null,D(g.value,(s,p)=>(r(),i("li",{key:p},[e("strong",null,d(p)+":",1),K(" "+d(s.join(", ")),1)]))),128))])):f("",!0)],32)])])):f("",!0)])]),_:1})],64))}},He=Z(Ie,[["__scopeId","data-v-08ee4d85"]]);export{He as default};
