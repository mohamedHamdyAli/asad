import{m,p as d,i as V,B as J,q as K,f as o,o as n,a as B,u as O,g as Q,w as W,b as e,j as $,k as D,F as v,s as b,t as c,e as X,h as E,y as F}from"./app-DOfkk8yu.js";import{_ as Y}from"./AuthenticatedLayout-B3yp0fF4.js";import{U as L}from"./users-Br72ZLzy.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={list:async()=>{const{data:i}=await m.get("/api/roles");return i.data},show:async i=>{const{data:r}=await m.get(`/api/roles/show/${i}`);return r.data},create:async i=>m.post("/api/roles/create",i),update:async(i,r)=>m.post(`/api/roles/update/${i}`,r),remove:async i=>m.delete(`/api/roles/delete/${i}`)},I={list:async()=>{const{data:i}=await m.get("/api/permissions");return i.data}},ee={class:"p-6 space-y-10"},te={class:"bg-white p-6 rounded shadow space-y-4"},se={class:"flex gap-2"},ae={class:"w-full text-sm border"},le={class:"p-2 font-medium"},oe={class:"p-2"},ne={class:"grid grid-cols-3 gap-2"},ie=["checked","onChange"],de={class:"p-2"},ce=["onClick"],re={class:"bg-white p-6 rounded shadow space-y-4"},ue={class:"flex flex-wrap gap-4 items-center"},pe=["value"],ve={class:"w-full text-sm"},me={class:"px-4 py-3"},fe={class:"px-4 py-3"},_e={class:"px-4 py-3"},ge=["onUpdate:modelValue"],ye=["value"],he={class:"px-4 py-3 text-right"},xe=["disabled","onClick"],be={class:"flex justify-between items-center mt-4"},we={class:"text-sm text-gray-600"},ke={class:"flex gap-2"},Re=["disabled"],Ce=["disabled"],$e={key:0,class:"text-green-600 text-sm"},Ue={key:1,class:"text-red-600 text-sm"},Pe={__name:"RolesManagement",setup(i){const r=d([]),A=d([]),w=d([]),f=d(""),p=d({}),_=d({}),k=d(""),R=d(""),g=d(""),y=d(""),u=d(1),P=d(10);async function C(){const a=await U.list(),s=await I.list(),t=await L.list();r.value=a.data??a,A.value=s.data??s,w.value=t.data??t,w.value.forEach(l=>{var x,S;const h=((S=(x=l.roles)==null?void 0:x[0])==null?void 0:S.name)||"";r.value.some(H=>H.name===h)?p.value[l.id]=h:p.value[l.id]="",_.value[l.id]=!1})}const M=V(()=>{let a=w.value;if(g.value){const s=g.value.toLowerCase();a=a.filter(t=>t.name.toLowerCase().includes(s)||t.email.toLowerCase().includes(s))}return y.value&&(a=a.filter(s=>{var t;return(t=s.roles)==null?void 0:t.some(l=>l.name===y.value)})),a}),N=V(()=>Math.ceil(M.value.length/P.value)),j=V(()=>{const a=(u.value-1)*P.value;return M.value.slice(a,a+P.value)});J([g,y],()=>{u.value=1});async function q(){f.value&&(await U.create({name:f.value}),f.value="",await C())}async function T(a){confirm("Delete role?")&&(await U.remove(a),await C())}async function z(a,s){await U.update(a.id,{name:s}),await C()}async function G(a){k.value="",R.value="",_.value[a]=!0;try{await L.assignRole(a,{roles:[p.value[a]]});const s=w.value.find(t=>t.id===a);s&&(s.roles=[{name:p.value[a]}]),k.value="Role assigned successfully"}catch{R.value="Failed to assign role"}finally{_.value[a]=!1}}return K(C),(a,s)=>(n(),o(v,null,[B(O(Q),{title:"Roles & Permissions"}),B(Y,null,{default:W(()=>[e("div",ee,[e("section",te,[s[6]||(s[6]=e("h2",{class:"text-xl font-semibold"},"Roles",-1)),e("div",se,[$(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),placeholder:"Role name",class:"form-input w-64"},null,512),[[D,f.value]]),e("button",{class:"btn-primary",onClick:q}," Add Role ")]),e("table",ae,[s[5]||(s[5]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2 text-left"},"Role"),e("th",{class:"p-2"},"Permissions"),e("th",{class:"p-2"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(v,null,b(r.value,t=>(n(),o("tr",{key:t.id,class:"border-t"},[e("td",le,c(t.name),1),e("td",oe,[e("div",ne,[(n(!0),o(v,null,b(A.value,l=>{var h;return n(),o("label",{key:l.id,class:"flex items-center gap-1 text-xs"},[e("input",{type:"checkbox",checked:(h=t.permissions)==null?void 0:h.some(x=>x.name===l.name),onChange:x=>z(t,l.name)},null,40,ie),X(" "+c(l.name),1)])}),128))])]),e("td",de,[e("button",{class:"btn-danger",onClick:l=>T(t.id)}," Delete ",8,ce)])]))),128))])])]),e("section",re,[s[10]||(s[10]=e("h2",{class:"text-xl font-semibold"},"Users",-1)),e("div",ue,[$(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>g.value=t),placeholder:"Search name or email",class:"form-input w-64"},null,512),[[D,g.value]]),$(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>y.value=t),class:"form-input w-48"},[s[7]||(s[7]=e("option",{value:""},"All roles",-1)),(n(!0),o(v,null,b(r.value,t=>(n(),o("option",{key:t.id,value:t.name},c(t.name),9,pe))),128))],512),[[F,y.value]])]),e("table",ve,[s[9]||(s[9]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Name"),e("th",{class:"px-4 py-3"},"Email"),e("th",{class:"px-4 py-3"},"Role"),e("th",{class:"px-4 py-3 text-right"},"Action")])],-1)),e("tbody",null,[(n(!0),o(v,null,b(j.value,t=>(n(),o("tr",{key:t.id,class:"border-t"},[e("td",me,c(t.name),1),e("td",fe,c(t.email),1),e("td",_e,[$((n(),o("select",{key:`role-select-${t.id}-${r.value.length}`,"onUpdate:modelValue":l=>p.value[t.id]=l,class:"form-input"},[s[8]||(s[8]=e("option",{value:""},"— Select role —",-1)),(n(!0),o(v,null,b(r.value,l=>(n(),o("option",{key:l.id,value:l.name},c(l.name),9,ye))),128))],8,ge)),[[F,p.value[t.id]]])]),e("td",he,[e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",disabled:_.value[t.id],onClick:l=>G(t.id)},c(_.value[t.id]?"Saving…":"Save"),9,xe)])]))),128))])]),e("div",be,[e("span",we," Page "+c(u.value)+" of "+c(N.value),1),e("div",ke,[e("button",{class:"px-3 py-1 border rounded",disabled:u.value===1,onClick:s[3]||(s[3]=t=>u.value--)}," Prev ",8,Re),e("button",{class:"px-3 py-1 border rounded",disabled:u.value===N.value,onClick:s[4]||(s[4]=t=>u.value++)}," Next ",8,Ce)])]),k.value?(n(),o("p",$e,c(k.value),1)):E("",!0),R.value?(n(),o("p",Ue,c(R.value),1)):E("",!0)])])]),_:1})],64))}},Se=Z(Pe,[["__scopeId","data-v-e0592cfc"]]);export{Se as default};
