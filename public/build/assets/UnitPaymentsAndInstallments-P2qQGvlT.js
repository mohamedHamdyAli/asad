import{p,c as M,o as n,b as t,t as u,j as v,k,y as j,v as at,N as K,m as F,q as W,f as o,a as ot,h as $,F as E,s as O,e as X,n as z,w as Y,T as it,d as dt}from"./app-DRIePbG3.js";import{_ as rt}from"./AuthenticatedLayout-MFNb3plu.js";import{U as R,b as ut,a as ct}from"./unitPayments-CqPsrM6J.js";import{b as mt,U as B,a as pt}from"./unitInstallments-ClHEfsAw.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const vt={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},bt={class:"bg-white rounded-xl shadow-xl w-full max-w-3xl p-6 relative animate-fadeIn"},yt={class:"text-xl font-semibold mb-4"},gt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xt={class:"md:col-span-2"},ft={class:"md:col-span-2"},_t={class:"space-y-4"},kt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wt={class:"flex items-center gap-2"},ht={class:"md:col-span-2"},$t={class:"flex justify-end mt-6 gap-3"},It=["disabled"],Ct={__name:"InstallmentModal",props:{mode:String,data:Object,paymentId:[String,Number]},emits:["close","saved"],setup(g,{emit:c}){var U,V,I,S,D,w,h,m,P,b,N,T;const i=g,y=c,x=p(!1);function _(f,e={}){if(!f)return structuredClone(e);if(typeof f=="string")try{return JSON.parse(f)}catch{return structuredClone(e)}return f}const a=p({title:_((U=i.data)==null?void 0:U.title,{en:"",ar:""}),description:_((V=i.data)==null?void 0:V.description,{en:"",ar:""}),amount:((I=i.data)==null?void 0:I.amount)??"",percentage:((S=i.data)==null?void 0:S.percentage)??"",milestone_date:((D=i.data)==null?void 0:D.milestone_date)??"",submission_date:((w=i.data)==null?void 0:w.submission_date)??"",consultant_approval_date:((h=i.data)==null?void 0:h.consultant_approval_date)??"",due_date:((m=i.data)==null?void 0:m.due_date)??"",status:((P=i.data)==null?void 0:P.status)??"pending",admin_approved:((b=i.data)==null?void 0:b.admin_approved)??!1,approval_date:((N=i.data)==null?void 0:N.approval_date)??"",admin_comment:((T=i.data)==null?void 0:T.admin_comment)??""});async function A(){x.value=!0;try{if(i.mode==="add"){const f=mt(i.paymentId,a.value);await B.create(f)}else{const f=pt(a.value);await B.update(i.data.id,f)}y("saved"),y("close")}catch(f){console.error(f),alert("Failed to save installment")}finally{x.value=!1}}return(f,e)=>(n(),M(K,{to:"body"},[t("div",vt,[t("div",bt,[t("button",{onClick:e[0]||(e[0]=d=>f.$emit("close")),class:"absolute top-3 right-4 text-gray-500 hover:text-black"}," ✕ "),t("h3",yt,u(g.mode==="add"?"Add Installment":"Edit Installment"),1),t("div",gt,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>a.value.title.en=d),class:"form-input"},null,512),[[k,a.value.title.en]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>a.value.title.ar=d),class:"form-input",dir:"rtl"},null,512),[[k,a.value.title.ar]])]),t("div",xt,[e[18]||(e[18]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)",-1)),v(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=d=>a.value.description.en=d),class:"form-input",rows:"2"},null,512),[[k,a.value.description.en]])]),t("div",ft,[e[19]||(e[19]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)",-1)),v(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=d=>a.value.description.ar=d),class:"form-input",rows:"2",dir:"rtl"},null,512),[[k,a.value.description.ar]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Amount *",-1)),v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=d=>a.value.amount=d),type:"number",class:"form-input"},null,512),[[k,a.value.amount,void 0,{number:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Percentage",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=d=>a.value.percentage=d),type:"number",step:"0.01",class:"form-input"},null,512),[[k,a.value.percentage,void 0,{number:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Milestone Date",-1)),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=d=>a.value.milestone_date=d),type:"date",class:"form-input"},null,512),[[k,a.value.milestone_date]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Submission Date",-1)),v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=d=>a.value.submission_date=d),type:"date",class:"form-input"},null,512),[[k,a.value.submission_date]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Consultant Approval Date",-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=d=>a.value.consultant_approval_date=d),type:"date",class:"form-input"},null,512),[[k,a.value.consultant_approval_date]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Due Date",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=d=>a.value.due_date=d),type:"date",class:"form-input"},null,512),[[k,a.value.due_date]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),v(t("select",{"onUpdate:modelValue":e[11]||(e[11]=d=>a.value.status=d),class:"form-input"},e[26]||(e[26]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"paid"},"Paid",-1),t("option",{value:"overdue"},"Overdue",-1)]),512),[[j,a.value.status]])])]),e[32]||(e[32]=t("hr",{class:"my-6 border-gray-200"},null,-1)),t("div",_t,[e[31]||(e[31]=t("h4",{class:"font-semibold text-gray-800 text-base"},"Admin Invoice Approval",-1)),t("div",kt,[t("div",wt,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=d=>a.value.admin_approved=d),id:"admin_approved",class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"},null,512),[[at,a.value.admin_approved]]),e[28]||(e[28]=t("label",{for:"admin_approved",class:"text-sm text-gray-700"},"Mark as Approved",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Approval Date",-1)),v(t("input",{"onUpdate:modelValue":e[13]||(e[13]=d=>a.value.approval_date=d),type:"date",class:"form-input"},null,512),[[k,a.value.approval_date]])]),t("div",ht,[e[30]||(e[30]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Admin Comment",-1)),v(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=d=>a.value.admin_comment=d),class:"form-input",rows:"2",placeholder:"Add approval notes..."},null,512),[[k,a.value.admin_comment]])])])]),t("div",$t,[t("button",{class:"px-4 py-2 border rounded hover:bg-gray-100",onClick:e[15]||(e[15]=d=>f.$emit("close"))}," Cancel "),t("button",{class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:A,disabled:x.value},u(x.value?"Saving…":"Save"),9,It)])])])]))}},Ut=Z(Ct,[["__scopeId","data-v-bb3fd775"]]),H={list:async g=>{const{data:c}=await F.get(`/api/unit-payments/installments/${g}/invoices`);return Array.isArray(c)?c:(c==null?void 0:c.data)??[]},updateStatus:async(g,c)=>{const{data:i}=await F.post(`/api/unit-payments/installments/${g}/status`,{status:c});return i},confirmInvoice:async(g,c)=>{const{data:i}=await F.post("/api/unit-payments/invoices/confirm",{invoice_id:g,action:c});return i}},Pt={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},At={class:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 relative animate-fadeIn"},Vt={key:0,class:"text-sm text-gray-500"},Dt={key:1},Et={class:"flex justify-between items-start"},Mt={class:"font-semibold text-gray-800"},St={class:"text-blue-600"},Nt={class:"mt-2"},jt={class:"mt-3"},Tt=["src","onClick"],Lt={class:"flex flex-col gap-2"},Ft=["onClick","disabled"],Ot=["onClick","disabled"],zt={key:0,class:"text-center text-gray-500 text-sm mt-6"},Rt={class:"bg-white rounded-xl shadow-2xl p-4 w-full max-w-lg"},Bt=["src"],Gt={__name:"InvoiceModal",props:{installment:Object},emits:["close"],setup(g,{emit:c}){const i=g,y=p([]),x=p(!1),_=p(""),a=p(""),A=p(!1),U=p(null);W(async()=>{x.value=!0,y.value=await H.list(i.installment.id),x.value=!1});async function V(w,h){var m,P;if(_.value="",a.value="",!!confirm(`Mark invoice #${w.id} as ${h}?`))try{const b=await H.confirmInvoice(w.id,h);(b==null?void 0:b.status)==="error"?(a.value="error",_.value=b.message||"Action failed."):(b==null?void 0:b.status)==="success"&&(a.value="success",_.value=b.message||"Action successful."),y.value=await H.list(i.installment.id),setTimeout(()=>_.value="",4e3)}catch(b){a.value="error",_.value=((P=(m=b.response)==null?void 0:m.data)==null?void 0:P.message)||"Something went wrong.",setTimeout(()=>_.value="",4e3)}}function I(w){return w?`/storage/${w}`:""}function S(w){U.value=w,A.value=!0}function D(){U.value=null,A.value=!1}return(w,h)=>(n(),M(K,{to:"body"},[t("div",Pt,[t("div",At,[t("button",{onClick:h[0]||(h[0]=m=>w.$emit("close")),class:"absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-xl"}," ✕ "),h[2]||(h[2]=t("h3",{class:"text-2xl font-semibold text-gray-800 mb-6 border-b pb-2"}," Invoices ",-1)),x.value?(n(),o("div",Vt,"Loading...")):(n(),o("div",Dt,[(n(!0),o(E,null,O(y.value,m=>(n(),o("div",{key:m.id,class:"p-4 mb-3 border rounded-xl hover:shadow transition bg-gray-50"},[t("div",Et,[t("div",null,[t("p",Mt,[X(" Invoice #"+u(m.id)+" — ",1),t("span",St,u(m.paid_amount)+" EGP",1)]),t("div",Nt,[t("span",{class:z(["inline-block px-3 py-1 text-xs rounded-full font-medium border",m.status==="confirmed"?"bg-green-100 text-green-700 border-green-200":m.status==="rejected"?"bg-red-100 text-red-700 border-red-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},u(m.status?m.status.toUpperCase():"PENDING"),3)]),t("div",jt,[t("img",{src:I(m.invoice_file),alt:"Invoice File",class:"rounded-lg shadow-sm border object-contain max-h-40 cursor-pointer hover:scale-105 transition",onClick:P=>S(m.invoice_file)},null,8,Tt)])]),t("div",Lt,[t("button",{onClick:P=>V(m,"confirm"),class:z(["px-4 py-1.5 rounded-lg text-sm font-medium text-white transition",m.status==="confirmed"?"bg-green-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"]),disabled:m.status==="confirmed"},u(m.status==="confirmed"?"Approved":"Approve"),11,Ft),t("button",{onClick:P=>V(m,"reject"),class:"px-4 py-1.5 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition",disabled:m.status==="rejected"},u(m.status==="rejected"?"Rejected":"Reject"),9,Ot)])])]))),128)),y.value.length?$("",!0):(n(),o("div",zt," No invoices found. "))])),ot(it,{name:"fade"},{default:Y(()=>[_.value?(n(),o("div",{key:0,class:z(["mt-5 p-3 rounded-lg text-sm font-medium border text-center",a.value==="error"?"bg-red-50 text-red-700 border-red-200":"bg-green-50 text-green-700 border-green-200"])},u(_.value),3)):$("",!0)]),_:1}),A.value?(n(),o("div",{key:2,class:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100]",onClick:dt(D,["self"])},[t("div",Rt,[t("div",{class:"flex justify-between items-center mb-2"},[h[1]||(h[1]=t("h4",{class:"font-semibold text-gray-700 text-lg"},"Invoice Preview",-1)),t("button",{onClick:D,class:"text-gray-500 hover:text-gray-700 text-xl"}," ✕ ")]),t("img",{src:I(U.value),alt:"Invoice",class:"rounded-lg object-contain max-h-[75vh] w-full"},null,8,Bt)])])):$("",!0)])])]))}},qt=Z(Gt,[["__scopeId","data-v-0ced344b"]]),Jt={class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},Ht={class:"bg-white w-full max-w-2xl rounded-lg p-6 relative shadow-xl animate-fadeIn"},Kt={key:0,class:"text-center text-gray-500 py-8"},Qt={key:1,class:"divide-y divide-gray-200 max-h-96 overflow-y-auto"},Wt={class:"flex justify-between items-center"},Xt={class:"font-medium text-gray-800"},Yt={class:"text-sm text-gray-600 mt-1"},Zt={class:"text-sm text-gray-500"},te={class:"text-xs text-gray-400"},ee={key:0,class:"text-sm text-gray-600 mt-1"},se={__name:"PaymentLogsModal",props:{logs:{type:Array,default:()=>[]}},setup(g){return(c,i)=>(n(),M(K,{to:"body"},[t("div",Jt,[t("div",Ht,[t("button",{onClick:i[0]||(i[0]=y=>c.$emit("close")),class:"absolute right-4 top-3 text-gray-500 hover:text-black"},"✕"),i[1]||(i[1]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-800"},"Payment Logs",-1)),g.logs.length?(n(),o("ul",Qt,[(n(!0),o(E,null,O(g.logs,y=>(n(),o("li",{key:y.id,class:"py-3"},[t("div",Wt,[t("div",null,[t("p",Xt,u(y.action||"Action"),1),t("p",Yt,u(y.description||"Description"),1),t("p",Zt,"By: "+u(y.created_by_name||"System Admin"),1)]),t("span",te,u(new Date(y.created_at).toLocaleString()),1)]),y.notes?(n(),o("p",ee,u(y.notes),1)):$("",!0)]))),128))])):(n(),o("div",Kt,"No logs found."))])])]))}},le={unitLogs:async g=>{const{data:c}=await F.get(`/api/unit-payments/logs/${g}`);return(c==null?void 0:c.data)??[]},installmentLogs:async g=>{const{data:c}=await F.get(`/api/unit-payments/installment/${g}/logs`);return(c==null?void 0:c.data)??[]}},ne={class:"container mx-auto p-6"},ae={class:"flex border-b mb-6"},oe={key:0,class:"bg-white p-6 rounded shadow mb-6"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},de={class:"mt-4 text-right"},re=["disabled"],ue={key:1,class:"bg-white p-6 rounded shadow"},ce={key:0,class:"text-sm text-gray-500"},me={key:1,class:"text-center text-gray-500 py-6"},pe={key:2,class:"overflow-x-auto"},ve={class:"min-w-full border text-sm"},be={class:"p-2"},ye={class:"p-2"},ge=["onUpdate:modelValue"],xe={key:1},fe={class:"p-2"},_e=["onUpdate:modelValue"],ke={key:1},we={class:"p-2"},he=["onUpdate:modelValue"],$e={key:1},Ie={class:"p-2"},Ce=["onUpdate:modelValue"],Ue={key:1},Pe={class:"p-2 text-center"},Ae={class:"flex justify-center gap-2"},Ve=["onClick"],De=["onClick"],Ee=["onClick"],Me=["onClick"],Se={key:2,class:"space-y-4"},Ne={class:"flex gap-3 items-end"},je={class:"flex-1"},Te=["value"],Le=["disabled"],Fe={key:0,class:"bg-white rounded-xl shadow-sm p-4"},Oe={class:"min-w-full text-sm text-left border"},ze={class:"p-2 border"},Re={class:"p-2 border"},Be={class:"p-2 border"},Ge={class:"p-2 border"},qe={class:"p-2 border"},Je={class:"p-2 border"},He={class:"p-2 border text-center"},Ke=["onClick"],Qe={class:"p-2 border flex gap-2"},We=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze={key:0,class:"text-center py-4 text-gray-500"},as={__name:"UnitPaymentsAndInstallments",props:{unitId:Number},setup(g){const c=g,i=p("payments"),y=p([]),x=p({total_price:"",installments_count:"",payment_type:"",overall_status:"pending"}),_=p(!1),a=p(!1),A=p(!1),U=p([]);async function V(r){b.value=r,A.value=!0;try{const s=await le.installmentLogs(r);U.value=s}catch{U.value=[],alert("Failed to fetch logs")}}async function I(){a.value=!0;try{const r=await R.list(c.unitId);y.value=r.map(s=>({...s,total_price:Number(s.total_price)||0,installments_count:Number(s.installments_count)||0,isEditing:!1,editable:{...s}}))}finally{a.value=!1}}async function S(){_.value=!0;const r=ut(c.unitId,[x.value]);await R.create(r),await I(),x.value={total_price:"",installments_count:"",payment_type:"",overall_status:"pending"},_.value=!1}function D(r){r.isEditing=!0,r.editable={...r}}function w(r){r.isEditing=!1}async function h(r){const s=ct(r.editable);await R.update(r.id,s),r.isEditing=!1,await I()}async function m(r){confirm("Delete this payment?")&&(await R.remove(r),await I())}function P(r){const s=Number(r);return isNaN(s)?"0.00":s.toFixed(2)}const b=p(""),N=p([]),T=p(!1);async function f(){if(b.value){T.value=!0;try{N.value=await B.list(b.value)}finally{T.value=!1}}}async function e(r){confirm("Delete this installment?")&&(await B.remove(r),await f())}const d=p(!1),G=p("add"),q=p(null);function tt(){G.value="add",q.value=null,d.value=!0}function et(r){G.value="edit",q.value=r,d.value=!0}function st(){d.value=!1}const J=p(!1),Q=p(null);function lt(r){Q.value=r,J.value=!0}function nt(){J.value=!1}return W(I),(r,s)=>(n(),M(rt,null,{default:Y(()=>[t("div",ne,[t("div",ae,[t("button",{class:z([i.value==="payments"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600","px-4 py-2 font-medium"]),onClick:s[0]||(s[0]=l=>i.value="payments")}," Payments ",2),t("button",{class:z([i.value==="installments"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600","px-4 py-2 font-medium"]),onClick:s[1]||(s[1]=l=>i.value="installments")}," Installments ",2)]),i.value==="payments"?(n(),o("div",oe,[s[14]||(s[14]=t("h3",{class:"text-lg font-semibold mb-4"},"Add Payment",-1)),t("div",ie,[t("div",null,[s[8]||(s[8]=t("label",{class:"block text-sm font-medium mb-1"},"Total Price *",-1)),v(t("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>x.value.total_price=l),type:"number",class:"form-control w-full border p-2 rounded"},null,512),[[k,x.value.total_price,void 0,{number:!0}]])]),t("div",null,[s[9]||(s[9]=t("label",{class:"block text-sm font-medium mb-1"},"Installments Count *",-1)),v(t("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>x.value.installments_count=l),type:"number",class:"form-control w-full border p-2 rounded"},null,512),[[k,x.value.installments_count,void 0,{number:!0}]])]),t("div",null,[s[11]||(s[11]=t("label",{class:"block text-sm font-medium mb-1"},"Payment Type *",-1)),v(t("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>x.value.payment_type=l),class:"form-control w-full border p-2 rounded"},s[10]||(s[10]=[t("option",{disabled:"",value:""},"Select type",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"installments"},"Installments",-1)]),512),[[j,x.value.payment_type]])]),t("div",null,[s[13]||(s[13]=t("label",{class:"block text-sm font-medium mb-1"},"Overall Status *",-1)),v(t("select",{"onUpdate:modelValue":s[5]||(s[5]=l=>x.value.overall_status=l),class:"form-control w-full border p-2 rounded"},s[12]||(s[12]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"in_progress"},"In Progress",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"overdue"},"Overdue",-1)]),512),[[j,x.value.overall_status]])])]),t("div",de,[t("button",{onClick:S,disabled:_.value,class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50"},u(_.value?"Saving…":"Save"),9,re)])])):$("",!0),i.value==="payments"?(n(),o("div",ue,[t("div",{class:"flex items-center justify-between mb-4"},[s[15]||(s[15]=t("h3",{class:"text-lg font-semibold"},"Existing Payments",-1)),t("button",{onClick:I,class:"border px-3 py-1 rounded hover:bg-gray-100"},"Refresh")]),a.value?(n(),o("div",ce,"Loading…")):y.value.length?(n(),o("div",pe,[t("table",ve,[s[18]||(s[18]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2 text-left"}),t("th",{class:"p-2 text-left"},"Total Price"),t("th",{class:"p-2 text-left"},"Installments"),t("th",{class:"p-2 text-left"},"Type"),t("th",{class:"p-2 text-left"},"Status"),t("th",{class:"p-2 text-center"},"Actions")])],-1)),t("tbody",null,[(n(!0),o(E,null,O(y.value,(l,L)=>(n(),o("tr",{key:l.id,class:"border-t"},[t("td",be,u(L+1),1),t("td",ye,[l.isEditing?v((n(),o("input",{key:0,"onUpdate:modelValue":C=>l.editable.total_price=C,type:"number",class:"w-full border p-1 rounded"},null,8,ge)),[[k,l.editable.total_price,void 0,{number:!0}]]):(n(),o("span",xe,u(P(l.total_price)),1))]),t("td",fe,[l.isEditing?v((n(),o("input",{key:0,"onUpdate:modelValue":C=>l.editable.installments_count=C,type:"number",class:"w-full border p-1 rounded"},null,8,_e)),[[k,l.editable.installments_count,void 0,{number:!0}]]):(n(),o("span",ke,u(l.installments_count),1))]),t("td",we,[l.isEditing?v((n(),o("select",{key:0,"onUpdate:modelValue":C=>l.editable.payment_type=C,class:"w-full border p-1 rounded"},s[16]||(s[16]=[t("option",{value:"cash"},"Cash",-1),t("option",{value:"installments"},"Installments",-1)]),8,he)),[[j,l.editable.payment_type]]):(n(),o("span",$e,u(l.payment_type),1))]),t("td",Ie,[l.isEditing?v((n(),o("select",{key:0,"onUpdate:modelValue":C=>l.editable.overall_status=C,class:"w-full border p-1 rounded"},s[17]||(s[17]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"in_progress"},"In Progress",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"overdue"},"Overdue",-1)]),8,Ce)),[[j,l.editable.overall_status]]):(n(),o("span",Ue,u(l.overall_status),1))]),t("td",Pe,[t("div",Ae,[l.isEditing?(n(),o(E,{key:0},[t("button",{class:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded",onClick:C=>h(l)}," Save ",8,Ve),t("button",{class:"bg-gray-300 hover:bg-gray-400 text-xs px-3 py-1 rounded",onClick:C=>w(l)}," Cancel ",8,De)],64)):(n(),o(E,{key:1},[t("button",{class:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded",onClick:C=>D(l)}," Edit ",8,Ee),t("button",{class:"bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded",onClick:C=>m(l.id)}," Delete ",8,Me)],64))])])]))),128))])])])):(n(),o("div",me,"No payments found."))])):$("",!0),i.value==="installments"?(n(),o("div",Se,[t("div",Ne,[t("div",je,[s[20]||(s[20]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Select Payment",-1)),v(t("select",{"onUpdate:modelValue":s[6]||(s[6]=l=>b.value=l),class:"form-input",onChange:f},[s[19]||(s[19]=t("option",{value:""},"-- Choose Payment --",-1)),(n(!0),o(E,null,O(y.value,l=>(n(),o("option",{key:l.id,value:l.id}," Payment "+u(l.total_price)+" EGP ",9,Te))),128))],544),[[j,b.value]])]),t("button",{disabled:!b.value,onClick:tt,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"}," + Add Installment ",8,Le)]),b.value?(n(),o("div",Fe,[t("div",{class:"flex justify-between items-center mb-3"},[s[21]||(s[21]=t("h3",{class:"font-semibold text-lg text-gray-800"},"Installments",-1)),t("button",{onClick:f,class:"px-3 py-1 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),t("table",Oe,[s[23]||(s[23]=t("thead",{class:"bg-gray-50 text-gray-700 uppercase text-xs"},[t("tr",null,[t("th",{class:"p-2 border"}),t("th",{class:"p-2 border"},"Title"),t("th",{class:"p-2 border"},"Amount"),t("th",{class:"p-2 border"},"Percentage"),t("th",{class:"p-2 border"},"Status"),t("th",{class:"p-2 border"},"Due Date"),t("th",{class:"p-2 border"},"Invoices"),t("th",{class:"p-2 border"},"Actions")])],-1)),t("tbody",null,[(n(!0),o(E,null,O(N.value,l=>(n(),o("tr",{key:l.id,class:"hover:bg-gray-50 transition"},[t("td",ze,u(l.id),1),t("td",Re,u(l.title_en),1),t("td",Be,u(l.amount),1),t("td",Ge,u(l.percentage),1),t("td",qe,u(l.status),1),t("td",Je,u(l.due_date||"-"),1),t("td",He,[t("button",{onClick:L=>lt(l),class:"text-blue-600 underline text-xs hover:text-blue-800"}," View ",8,Ke)]),t("td",Qe,[t("button",{onClick:L=>et(l),class:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700"}," Edit ",8,We),t("button",{onClick:L=>e(l.id),class:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700"}," Delete ",8,Xe),t("button",{onClick:L=>V(l.id),class:"px-3 py-1 text-xs border rounded text-gray-700 border-gray-200 hover:bg-gray-50 flex items-center gap-1"},s[22]||(s[22]=[t("i",{class:"fa fa-clock text-blue-500"},null,-1),X(" Logs ")]),8,Ye)])]))),128))])]),N.value.length?$("",!0):(n(),o("div",Ze," No installments found. "))])):$("",!0)])):$("",!0)]),d.value?(n(),M(Ut,{key:0,mode:G.value,data:q.value,paymentId:b.value,onClose:st,onSaved:f},null,8,["mode","data","paymentId"])):$("",!0),J.value?(n(),M(qt,{key:1,installment:Q.value,onClose:nt},null,8,["installment"])):$("",!0),A.value?(n(),M(se,{key:2,logs:U.value,onClose:s[7]||(s[7]=l=>A.value=!1)},null,8,["logs"])):$("",!0)]),_:1}))}};export{as as default};
