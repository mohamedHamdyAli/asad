import{k as V,l as U,p as Y,c as Z,o as p,w as E,b as t,f as m,h as D,F,q as O,e as C,t as f,a as I,u as M,S as P,d as ee,j as _,s as y,y as te}from"./app-CANqHqHd.js";import{_ as ne}from"./AuthenticatedLayout-X_Uj5J9y.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ae(n){try{return typeof n=="string"?JSON.parse(n):n}catch{return n}}function z(n){const r=ae(n);return r&&typeof r=="object"?{en:r.en??"",ar:r.ar??""}:{en:r??"",ar:r??""}}function B(n){var r;return Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.message)?n.message:Array.isArray((r=n==null?void 0:n.data)==null?void 0:r.data)?n.data.data:[]}function re(n){return(n==null?void 0:n.data)??(n==null?void 0:n.message)??n}function T(n){return n?`/storage/${n}`:""}function J(n){return n?String(n).slice(0,10):""}function N(n={}){const r=z(n.name),d=z(n.description),x=Array.isArray(n.home_unit_gallery)?n.home_unit_gallery.map(l=>({id:l.id??void 0,image:l.image,image_url:T(l.image)})):Array.isArray(n.gallery)?n.gallery.map(l=>({id:l.id??void 0,image:l.image,image_url:T(l.image)})):[];return{...n,name_en:r.en,name_ar:r.ar,description_en:d.en,description_ar:d.ar,location:n.location??"",lat:n.lat??null,long:n.long??null,start_date:J(n.start_date),end_date:J(n.end_date),status:n.status??"",user_id:n.user_id??null,vendor_id:n.vendor_id??null,cover_image_url:T(n.cover_image),gallery:x}}const $={list:async(n={})=>{const{data:r}=await V.get("/api/units",{params:n});return B(r).map(N)},listByUser:async(n,r={})=>{const{data:d}=await V.get(`/api/units/user/${n}`,{params:r});return B(d).map(N)},listByVendor:async(n,r={})=>{const{data:d}=await V.get(`/api/units/vendor/${n}`,{params:r});return B(d).map(N)},show:async n=>{const{data:r}=await V.get(`/api/units/show/${n}`);return N(re(r))},create:async n=>{const{data:r}=await V.post("/api/units/create",n,{headers:{"Content-Type":"multipart/form-data"}});return r},update:async(n,r)=>{const{data:d}=await V.post(`/api/units/update/${n}`,r,{headers:{"Content-Type":"multipart/form-data"}});return d},remove:async n=>{const{data:r}=await V.delete(`/api/units/delete/${n}`);return r}};function le({name:n={en:"",ar:""},description:r={en:"",ar:""},location:d,lat:x,long:l,start_date:a,end_date:b,cover_image:h,gallery:q=[],user_id:v,vendor_id:w,status:k,...S}){const u=new FormData;return u.append("name[en]",n.en??""),u.append("name[ar]",n.ar??""),u.append("description[en]",r.en??""),u.append("description[ar]",r.ar??""),u.append("location",d??""),u.append("lat",String(x??"")),u.append("long",String(l??"")),u.append("start_date",a??""),u.append("end_date",b??""),h&&u.append("cover_image",h),(q||[]).forEach(i=>i&&u.append("gallery[]",i)),u.append("user_id",String(v??"")),u.append("vendor_id",String(w??"")),k&&u.append("status",k),Object.entries(S).forEach(([i,g])=>{g!=null&&g!==""&&u.append(i,g)}),u}function ie(n={}){const{name:r,description:d,location:x,lat:l,long:a,start_date:b,end_date:h,cover_image:q,gallery:v,user_id:w,vendor_id:k,status:S,...u}=n,i=new FormData;return r&&(r.en!==void 0&&i.append("name[en]",r.en??""),r.ar!==void 0&&i.append("name[ar]",r.ar??"")),d&&(d.en!==void 0&&i.append("description[en]",d.en??""),d.ar!==void 0&&i.append("description[ar]",d.ar??"")),x!==void 0&&i.append("location",x??""),l!==void 0&&i.append("lat",String(l??"")),a!==void 0&&i.append("long",String(a??"")),b!==void 0&&i.append("start_date",b??""),h!==void 0&&i.append("end_date",h??""),q&&i.append("cover_image",q),Array.isArray(v)&&v.length&&v.forEach(g=>g&&i.append("gallery[]",g)),w!==void 0&&i.append("user_id",String(w??"")),k!==void 0&&i.append("vendor_id",String(k??"")),S!==void 0&&S!==""&&i.append("status",S),Object.entries(u).forEach(([g,j])=>{j!=null&&j!==""&&i.append(g,j)}),i}const oe={class:"p-6 space-y-6"},de={class:"bg-white shadow rounded-lg p-4"},ue={key:0,class:"text-sm text-gray-500"},ce={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},pe={class:"aspect-[4/3] bg-white flex items-center justify-center"},me=["src"],ve={key:1,class:"text-gray-400 text-sm"},ge={class:"p-3 space-y-2"},fe={class:"font-semibold truncate"},_e={key:0,class:"text-gray-400"},xe={class:"text-xs text-gray-500"},be={class:"text-xs text-gray-500"},ye={class:"text-xs text-gray-500"},he={class:"grid grid-cols-3 gap-2 pt-2 text-xs"},we=["href"],ke=["href"],Ue=["href"],qe=["href"],Ae={class:"flex gap-2 pt-2"},Ce=["onClick"],Se=["onClick"],Ve={key:0,class:"col-span-full text-center text-gray-500 py-8"},De={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},je={class:"bg-white rounded-2xl shadow-lg w-full max-w-3xl p-5 relative"},$e={class:"text-lg font-bold mb-4"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee=["required"],Ne=["required"],Re={class:"md:col-span-2"},Fe=["required"],Oe={class:"md:col-span-2"},Ie=["required"],Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Pe=["required"],Be=["required"],Te=["required"],Ge=["required"],ze=["required"],Je={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4"},He=["required"],Ke=["required"],Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},We={class:"block text-xs text-gray-500 mb-1"},Xe=["required"],Ye={key:0,class:"mt-2"},Ze=["src"],et=["required"],tt={key:0,class:"mt-2 flex flex-wrap gap-2"},nt=["src"],st={class:"mt-5 flex items-center gap-3"},at=["disabled"],rt={key:0,class:"text-sm text-red-600 mt-2"},lt={key:1,class:"mt-2 text-sm text-red-600 list-disc pl-6"},it={__name:"Index",setup(n){const r=U([]),d=U(!1),x=U(!1),l=U(null),a=U({name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]}),b=U(null),h=U([]),q=U(!1),v=U(""),w=U({});function k(o,e){return`/units/${o}/${e}`}function S(o){return`/units-management/${o}/docs`}function u(o){return`/units-management/${o}/drawing`}function i(o){return`/units-management/${o}/gallery`}function g(){a.value={name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"",cover_image:null,gallery:[]},b.value=null,h.value=[],v.value="",w.value={},l.value=null}function j(){g(),x.value=!0}async function H(o){g(),l.value=o.id;const e=await $.show(o.id);a.value.name.en=e.name_en||"",a.value.name.ar=e.name_ar||"",a.value.description.en=e.description_en||"",a.value.description.ar=e.description_ar||"",a.value.location=e.location||"",a.value.lat=e.lat,a.value.long=e.long,a.value.start_date=e.start_date||"",a.value.end_date=e.end_date||"",a.value.user_id=e.user_id??null,a.value.vendor_id=e.vendor_id??null,a.value.status=e.status||"",b.value=e.cover_image_url||null,x.value=!0}function R(){x.value=!1}function K(o){var s;const e=((s=o.target.files)==null?void 0:s[0])||null;a.value.cover_image=e,b.value=e?URL.createObjectURL(e):b.value}function Q(o){const e=Array.from(o.target.files||[]);a.value.gallery=e,h.value=e.map(s=>URL.createObjectURL(s))}async function L(){d.value=!0;try{r.value=await $.list()}finally{d.value=!1}}async function W(){var o,e,s,A,G;q.value=!0,v.value="",w.value={};try{if(l.value){const c=ie(a.value);await $.update(l.value,c)}else{const c=le(a.value);await $.create(c)}await L(),R()}catch(c){((o=c==null?void 0:c.response)==null?void 0:o.status)===422&&((s=(e=c==null?void 0:c.response)==null?void 0:e.data)!=null&&s.errors)?(w.value=c.response.data.errors,v.value=c.response.data.message||"Validation error"):v.value=((G=(A=c==null?void 0:c.response)==null?void 0:A.data)==null?void 0:G.message)||(c==null?void 0:c.message)||"Request failed"}finally{q.value=!1}}async function X(o){confirm(`Delete unit #${o.id}?`)&&(await $.remove(o.id),await L())}return Y(L),(o,e)=>(p(),Z(ne,null,{default:E(()=>[t("div",oe,[t("div",{class:"flex items-center justify-between"},[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Units",-1)),t("button",{onClick:j,class:"inline-flex items-center rounded-md bg-gray-800 px-4 py-2 text-xs font-semibold uppercase tracking-widest text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"}," + Add Unit ")]),t("div",de,[t("div",{class:"flex items-center justify-between mb-3"},[e[13]||(e[13]=t("h3",{class:"text-lg font-bold"},"All Units",-1)),t("button",{onClick:L,class:"px-3 py-1 border rounded"},"Refresh")]),d.value?(p(),m("div",ue,"Loading…")):(p(),m("div",ce,[(p(!0),m(F,null,O(r.value,s=>(p(),m("div",{key:s.id,class:"rounded border overflow-hidden bg-gray-50"},[t("div",pe,[s.cover_image_url?(p(),m("img",{key:0,src:s.cover_image_url,class:"w-full h-full object-cover"},null,8,me)):(p(),m("div",ve,"No Cover"))]),t("div",ge,[t("div",fe,[C(f(s.name_en||"—")+" ",1),s.name_ar?(p(),m("span",_e,"/")):D("",!0),C(" "+f(s.name_ar),1)]),t("div",xe,[e[14]||(e[14]=t("span",{class:"font-medium"},"Location:",-1)),C(" "+f(s.location||"—"),1)]),t("div",be,[e[15]||(e[15]=t("span",{class:"font-medium"},"Period:",-1)),C(" "+f(s.start_date||"—")+" → "+f(s.end_date||"—"),1)]),t("div",ye,[e[16]||(e[16]=t("span",{class:"font-medium"},"Status:",-1)),C(" "+f(s.status||"—"),1)]),t("div",he,[t("a",{href:k(s.id,"folders"),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},"Folders",8,we),I(M(P),{href:S(s.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:E(()=>e[17]||(e[17]=[C(" Docs ")])),_:2},1032,["href"]),I(M(P),{href:i(s.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:E(()=>e[18]||(e[18]=[C(" Gallery ")])),_:2},1032,["href"]),I(M(P),{href:u(s.id),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},{default:E(()=>e[19]||(e[19]=[C(" Drawing ")])),_:2},1032,["href"]),t("a",{href:k(s.id,"reports"),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},"Reports",8,ke),t("a",{href:k(s.id,"phases"),class:"px-2 py-1 border rounded text-center hover:bg-gray-100"},"Phases",8,Ue),t("a",{href:k(s.id,"timeline"),class:"px-2 py-1 border rounded text-center hover:bg-gray-100 col-span-3"},"TimeLine",8,qe)]),t("div",Ae,[t("button",{class:"px-3 py-1 border rounded text-sm",onClick:A=>H(s)},"Edit",8,Ce),t("button",{class:"px-3 py-1 border rounded text-sm text-red-600",onClick:A=>X(s)},"Delete",8,Se)])])]))),128)),r.value.length?D("",!0):(p(),m("div",Ve," No units found. "))]))]),x.value?(p(),m("div",De,[t("div",je,[t("button",{onClick:R,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600"},"✕"),t("h3",$e,f(l.value?"Edit Unit":"Add Unit"),1),t("form",{onSubmit:ee(W,["prevent"])},[t("div",Le,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN)*",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.name.en=s),class:"form-input",type:"text",required:!l.value},null,8,Ee),[[y,a.value.name.en]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR)*",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.name.ar=s),class:"form-input",type:"text",required:!l.value},null,8,Ne),[[y,a.value.name.ar]])]),t("div",Re,[e[22]||(e[22]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)*",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.description.en=s),class:"form-input",type:"text",required:!l.value},null,8,Fe),[[y,a.value.description.en]])]),t("div",Oe,[e[23]||(e[23]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)*",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.description.ar=s),class:"form-input",type:"text",required:!l.value},null,8,Ie),[[y,a.value.description.ar]])])]),t("div",Me,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Location*",-1)),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.location=s),class:"form-input",type:"text",required:!l.value},null,8,Pe),[[y,a.value.location]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Latitude (-90..90)*",-1)),_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.lat=s),class:"form-input",type:"number",step:"any",min:"-90",max:"90",required:!l.value},null,8,Be),[[y,a.value.lat,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Longitude (-180..180)*",-1)),_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.long=s),class:"form-input",type:"number",step:"any",min:"-180",max:"180",required:!l.value},null,8,Te),[[y,a.value.long,void 0,{number:!0}]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Start Date*",-1)),_(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.start_date=s),class:"form-input",type:"date",required:!l.value},null,8,Ge),[[y,a.value.start_date]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs text-gray-500 mb-1"},"End Date* (>= start)",-1)),_(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.end_date=s),class:"form-input",type:"date",required:!l.value},null,8,ze),[[y,a.value.end_date]])])]),t("div",Je,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-xs text-gray-500 mb-1"},"User ID*",-1)),_(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.user_id=s),class:"form-input",type:"number",min:"1",required:!l.value},null,8,He),[[y,a.value.user_id,void 0,{number:!0}]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Vendor ID*",-1)),_(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.vendor_id=s),class:"form-input",type:"number",min:"1",required:!l.value},null,8,Ke),[[y,a.value.vendor_id,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),_(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.status=s),class:"form-input"},e[31]||(e[31]=[t("option",{value:""},"(none)",-1),t("option",{value:"under_construction"},"under_construction",-1),t("option",{value:"completed"},"completed",-1)]),512),[[te,a.value.status]])])]),t("div",Qe,[t("div",null,[t("label",We,"Cover Image* "+f(l.value?"(optional to replace)":""),1),t("input",{type:"file",accept:"image/*",onChange:K,required:!l.value},null,40,Xe),b.value?(p(),m("div",Ye,[t("img",{src:b.value,class:"w-40 h-28 object-cover rounded border"},null,8,Ze)])):D("",!0)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Gallery* (multiple on create)",-1)),t("input",{type:"file",accept:"image/*",multiple:"",onChange:Q,required:!l.value},null,40,et),h.value.length?(p(),m("div",tt,[(p(!0),m(F,null,O(h.value,(s,A)=>(p(),m("img",{key:A,src:s,class:"w-24 h-16 object-cover rounded border"},null,8,nt))),128))])):D("",!0)])]),t("div",st,[t("button",{disabled:q.value,class:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-60"},f(q.value?"Saving…":l.value?"Update":"Create"),9,at),t("button",{type:"button",class:"px-3 py-2 border rounded",onClick:R},"Cancel")]),v.value?(p(),m("div",rt,f(v.value),1)):D("",!0),Object.keys(w.value).length?(p(),m("ul",lt,[(p(!0),m(F,null,O(w.value,(s,A)=>(p(),m("li",{key:A},[t("strong",null,f(A)+":",1),C(" "+f(s.join(", ")),1)]))),128))])):D("",!0)],32)])])):D("",!0)])]),_:1}))}},pt=se(it,[["__scopeId","data-v-92060881"]]);export{pt as default};
