import{m as f,p as _,i as w,A as Y,q as Z,c as j,o,w as q,b as t,j as A,k as T,t as u,f as l,h as D,F as P,s as B,n as S,y as ee}from"./app-DRIePbG3.js";import{_ as te}from"./AuthenticatedLayout-MFNb3plu.js";import{U as se}from"./unitQuotes-lWs9Y8IH.js";import{V as ne}from"./vendors-TksU6lbR.js";import{U as ie}from"./users-BmamUqe8.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";function M(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function re(e){var i;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((i=e==null?void 0:e.data)==null?void 0:i.data)?e.data.data:[]}function N(e={}){const i=M(e.title),d=M(e.time_line);return{id:e.id,unit_quote_id:e.unit_quote_id,vendor_id:e.vendor_id,user_id:e.user_id,title_en:(i==null?void 0:i.en)??"",title_ar:(i==null?void 0:i.ar)??"",price:e.price??"",time_line_en:(d==null?void 0:d.en)??"",time_line_ar:(d==null?void 0:d.ar)??"",created_at:e.created_at,updated_at:e.updated_at}}const V={list:async()=>{const{data:e}=await f.get("/api/unit-quote-responses");return re(e).map(N)},show:async e=>{const{data:i}=await f.get(`/api/unit-quote-responses/show/${e}`),d=(i==null?void 0:i.data)??i;return N(d)},create:async e=>{const{data:i}=await f.post("/api/unit-quote-responses/create",e,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async(e,i)=>{const{data:d}=await f.post(`/api/unit-quote-responses/update/${e}`,i,{headers:{"Content-Type":"multipart/form-data"}});return d},remove:async e=>{const{data:i}=await f.delete(`/api/unit-quote-responses/delete/${e}`);return i}};function oe(e={}){var d,y;const i=new FormData;return i.append("data[unit_quote_id]",e.unit_quote_id??""),i.append("data[vendor_id]",e.vendor_id??""),i.append("data[user_id]",e.user_id??""),i.append("data[title][en]",((d=e.title)==null?void 0:d.en)??""),i.append("data[title][ar]",((y=e.title)==null?void 0:y.ar)??""),e.price!==void 0&&i.append("data[price]",e.price),e.time_line&&(i.append("data[time_line][en]",e.time_line.en??""),i.append("data[time_line][ar]",e.time_line.ar??"")),i}function de(e={}){const i=new FormData;return e.unit_quote_id!==void 0&&i.append("data[unit_quote_id]",e.unit_quote_id),e.vendor_id!==void 0&&i.append("data[vendor_id]",e.vendor_id),e.user_id!==void 0&&i.append("data[user_id]",e.user_id),e.title&&(i.append("data[title][en]",e.title.en??""),i.append("data[title][ar]",e.title.ar??"")),e.price!==void 0&&i.append("data[price]",e.price),e.time_line&&(i.append("data[time_line][en]",e.time_line.en??""),i.append("data[time_line][ar]",e.time_line.ar??"")),i}const le={list:async()=>{const{data:e}=await f.get("/api/type-of-buildings");return e.data||e}},ue={list:async()=>{const{data:e}=await f.get("/api/type-of-prices");return e.data||e}},pe={class:"p-6 space-y-8"},ce={class:"flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"},_e={class:"text-sm text-gray-500"},fe={class:"bg-white p-6 rounded-2xl shadow"},ye={key:0,class:"text-sm text-gray-500"},me={key:1,class:"text-center text-gray-500 py-6"},xe={key:2,class:"overflow-x-auto"},ge={class:"min-w-full border border-gray-200 text-sm"},ve={class:"py-2 px-3 font-medium"},he={class:"py-2 px-3"},be={class:"font-medium text-gray-900"},we={class:"text-xs text-gray-500 mt-0.5"},ke={class:"py-2 px-3"},Ce={class:"py-2 px-3 text-gray-700"},Ue={class:"py-2 px-3 text-gray-700"},Ae={class:"py-2 px-3 text-gray-700"},Pe={class:"py-2 px-3"},Ve=["onUpdate:modelValue","disabled"],Re=["value"],$e={class:"py-2 px-3"},Qe=["onUpdate:modelValue","disabled"],Te={class:"py-2 px-3"},De=["onUpdate:modelValue","disabled"],Be={class:"py-2 px-3"},Se=["href"],Le=["src"],Fe={key:1,class:"text-gray-400"},Me={class:"py-2 px-3"},Ne={class:"py-2 px-3 text-center space-x-1"},Ee=["onClick"],Oe=["onClick"],Ie=["onClick"],ze=["onClick"],Je={key:0,class:"flex justify-between items-center mt-6 text-sm"},Ge={class:"text-gray-600"},He={class:"space-x-2"},Ke=["disabled"],We=["onClick"],Xe=["disabled"],Ye={__name:"UnitQuoteResponses",setup(e){const i=_([]),d=_([]),y=_([]),R=_([]),$=_([]),k=_(""),Q=_(!1),p=_(1),m=_(7),x=w(()=>{const n=k.value.toLowerCase();return i.value.filter(r=>r.title.toLowerCase().includes(n)||r.user_name&&r.user_name.toLowerCase().includes(n)).sort((r,s)=>s.id-r.id)}),g=w(()=>Math.ceil(x.value.length/m.value)),E=w(()=>(p.value-1)*m.value+1),O=w(()=>Math.min(p.value*m.value,x.value.length)),L=w(()=>{const n=(p.value-1)*m.value;return x.value.slice(n,n+m.value)});Y(k,()=>p.value=1);async function v(){Q.value=!0;try{const[n,r,s,h,C,U]=await Promise.all([se.list(),V.list(),ie.list(),ne.list(),le.list(),ue.list()]);i.value=n.map(b=>{const c=r.find(a=>a.unit_quote_id===b.id);return{...b,has_response:!!c,editing:!1,response:c?{id:c.id,vendor_id:c.vendor_id,user_id:c.user_id,price:c.price,time_line:c.time_line_en||""}:{vendor_id:"",user_id:"",price:"",time_line:""}}}),d.value=s,y.value=h,R.value=C,$.value=U}finally{Q.value=!1}}function I(n){n.editing=!0}async function z(n){const r=oe({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await V.create(r),await v()}async function J(n){const r=de({unit_quote_id:n.id,vendor_id:n.response.vendor_id,user_id:n.response.user_id,title:{en:n.title,ar:n.title},price:n.response.price,time_line:{en:n.response.time_line,ar:n.response.time_line}});await V.update(n.response.id,r),n.editing=!1,await v()}async function G(n){confirm("Delete this response?")&&(await V.remove(n.response.id),await v())}function H(n){return n?new Date(n).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function K(n){n>=1&&n<=g.value&&(p.value=n)}function W(){p.value<g.value&&p.value++}function X(){p.value>1&&p.value--}function F(n){return n?typeof n=="object"&&n.en?n.en:n:"—"}return Z(v),(n,r)=>(o(),j(te,null,{default:q(()=>[t("div",pe,[t("div",{class:"flex items-center justify-between"},[r[1]||(r[1]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Quote Responses",-1)),t("button",{onClick:v,class:"px-3 py-1.5 border rounded-lg text-sm hover:bg-gray-50"}," Refresh ")]),t("div",ce,[A(t("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>k.value=s),type:"text",placeholder:"Search quotes by title or user…",class:"form-input w-1/2"},null,512),[[T,k.value]]),t("span",_e,u(x.value.length)+" quote(s) found ",1)]),t("div",fe,[r[4]||(r[4]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"}," Quotes & Responses ",-1)),Q.value?(o(),l("div",ye,"Loading…")):L.value.length?(o(),l("div",xe,[t("table",ge,[r[3]||(r[3]=t("thead",{class:"bg-gray-100 text-gray-700"},[t("tr",null,[t("th",{class:"py-2 px-3 text-left"}),t("th",{class:"py-2 px-3 text-left"},"Title"),t("th",{class:"py-2 px-3 text-left"},"Other Title"),t("th",{class:"py-2 px-3 text-left"},"Building Type"),t("th",{class:"py-2 px-3 text-left"},"Price Type"),t("th",{class:"py-2 px-3 text-left"},"User"),t("th",{class:"py-2 px-3 text-left"},"Vendor"),t("th",{class:"py-2 px-3 text-left"},"Price"),t("th",{class:"py-2 px-3 text-left"},"Timeline"),t("th",{class:"py-2 px-3 text-left"},"Payment"),t("th",{class:"py-2 px-3 text-left"},"Status"),t("th",{class:"py-2 px-3 text-center"},"Actions")])],-1)),t("tbody",null,[(o(!0),l(P,null,B(L.value,s=>{var h,C,U,b,c;return o(),l("tr",{key:s.id,class:S(["border-t hover:bg-gray-50 transition",{"bg-blue-50/40":s.editing}])},[t("td",ve,u(s.id),1),t("td",he,[t("div",be,u(s.title),1),t("div",we,u(H(s.created_at)),1)]),t("td",ke,u(s.other_title||"—"),1),t("td",Ce,u(F(((h=R.value.find(a=>a.id===s.type_of_building_id))==null?void 0:h.name)||((C=R.value.find(a=>a.id===s.type_of_building_id))==null?void 0:C.title))),1),t("td",Ue,u(F(((U=$.value.find(a=>a.id===s.type_of_price_id))==null?void 0:U.name)||((b=$.value.find(a=>a.id===s.type_of_price_id))==null?void 0:b.title))),1),t("td",Ae,u(((c=d.value.find(a=>a.id===s.user_id))==null?void 0:c.name)||`User ${s.user_id}`),1),t("td",Pe,[A(t("select",{"onUpdate:modelValue":a=>s.response.vendor_id=a,class:"form-input",disabled:!s.editing&&s.has_response},[r[2]||(r[2]=t("option",{value:"",disabled:""},"Select Vendor",-1)),(o(!0),l(P,null,B(y.value,a=>(o(),l("option",{key:a.id,value:a.id},u(a.name),9,Re))),128))],8,Ve),[[ee,s.response.vendor_id]])]),t("td",$e,[A(t("input",{"onUpdate:modelValue":a=>s.response.price=a,type:"number",class:"form-input",disabled:!s.editing&&s.has_response},null,8,Qe),[[T,s.response.price,void 0,{number:!0}]])]),t("td",Te,[A(t("input",{"onUpdate:modelValue":a=>s.response.time_line=a,type:"text",class:"form-input",disabled:!s.editing&&s.has_response},null,8,De),[[T,s.response.time_line]])]),t("td",Be,[s.pay_image?(o(),l("a",{key:0,href:`/storage/${s.pay_image}`,target:"_blank",class:"text-blue-600 hover:underline"},[t("img",{src:`/storage/${s.pay_image}`,alt:"Preview",class:"h-10 w-10 object-cover rounded shadow-sm"},null,8,Le)],8,Se)):(o(),l("span",Fe,"—"))]),t("td",Me,[t("span",{class:S(["px-2 py-0.5 rounded-full text-xs border",s.has_response?"bg-green-100 text-green-700 border-green-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},u(s.has_response?"Responded":"Pending"),3)]),t("td",Ne,[s.has_response?(o(),l(P,{key:1},[s.editing?D("",!0):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:a=>I(s)}," Edit ",8,Oe)),s.editing?(o(),l("button",{key:1,class:"px-3 py-1 text-xs border rounded-lg text-green-700 border-green-200 hover:bg-green-50",onClick:a=>J(s)}," Update ",8,Ie)):D("",!0),t("button",{class:"px-3 py-1 text-xs border rounded-lg text-red-700 border-red-200 hover:bg-red-50",onClick:a=>G(s)}," Delete ",8,ze)],64)):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:a=>z(s)}," Save ",8,Ee))])],2)}),128))])]),g.value>1?(o(),l("div",Je,[t("span",Ge," Showing "+u(E.value)+"–"+u(O.value)+" of "+u(x.value.length),1),t("div",He,[t("button",{onClick:X,disabled:p.value===1,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Prev ",8,Ke),(o(!0),l(P,null,B(g.value,s=>(o(),l("button",{key:s,onClick:h=>K(s),class:S(["px-3 py-1 border rounded-lg",s===p.value?"bg-blue-600 text-white":"hover:bg-gray-50"])},u(s),11,We))),128)),t("button",{onClick:W,disabled:p.value===g.value,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Next ",8,Xe)])])):D("",!0)])):(o(),l("div",me," No quotes found. "))])])]),_:1}))}},nt=ae(Ye,[["__scopeId","data-v-f7253efc"]]);export{nt as default};
