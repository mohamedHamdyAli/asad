import{m as x,p as b,i as S,r as $,q as I,c as O,o as u,w as B,b as s,j as p,k as m,f as g,h as D,t as C,F as J,s as M}from"./app-hVErxZBb.js";import{_ as q}from"./AuthenticatedLayout-D7Gb01l7.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";function j(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function P(e){var n;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.data)?e.data.data:[]}function G(e){return e?`/storage/${e}`:""}function E(e={}){const n=j(e.title),a=j(e.description),d=n&&typeof n=="object"?n:{en:n??"",ar:n??""},c=a&&typeof a=="object"?a:{en:a??"",ar:a??""};return{id:e.id,email:e.email||"",image:e.image||"",image_url:G(e.image),title_en:d.en??"",title_ar:d.ar??"",description_en:c.en??"",description_ar:c.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const U={list:async()=>{const{data:e}=await x.get("/api/contractors");return P(e).map(E)},show:async e=>{const{data:n}=await x.get(`/api/contractors/show/${e}`),a=(n==null?void 0:n.data)??n;return E(a)},edit:async e=>{const{data:n}=await x.get(`/api/contractors/edit/${e}`),a=(n==null?void 0:n.data)??n;return E(a)},create:async e=>{const{data:n}=await x.post("/api/contractors/create",e,{headers:{"Content-Type":"multipart/form-data"}});return n},update:async(e,n)=>{const{data:a}=await x.post(`/api/contractors/update/${e}`,n,{headers:{"Content-Type":"multipart/form-data"}});return a},remove:async e=>{const{data:n}=await x.delete(`/api/contractors/delete/${e}`);return n}};function H(e=[]){const n=new FormData;return e.forEach((a,d)=>{var c,v,_,k;n.append(`data[${d}][title][en]`,((c=a==null?void 0:a.title)==null?void 0:c.en)??""),n.append(`data[${d}][title][ar]`,((v=a==null?void 0:a.title)==null?void 0:v.ar)??""),n.append(`data[${d}][description][en]`,((_=a==null?void 0:a.description)==null?void 0:_.en)??""),n.append(`data[${d}][description][ar]`,((k=a==null?void 0:a.description)==null?void 0:k.ar)??""),n.append(`data[${d}][email]`,(a==null?void 0:a.email)??""),a!=null&&a.image&&n.append(`data[${d}][image]`,a.image)}),n}function K(e={}){const n=new FormData;return e!=null&&e.title&&(e.title.en!==void 0&&n.append("data[title][en]",e.title.en),e.title.ar!==void 0&&n.append("data[title][ar]",e.title.ar)),e!=null&&e.description&&(e.description.en!==void 0&&n.append("data[description][en]",e.description.en),e.description.ar!==void 0&&n.append("data[description][ar]",e.description.ar)),(e==null?void 0:e.email)!==void 0&&n.append("data[email]",e.email),e!=null&&e.image&&n.append("data[image]",e.image),n}const Q={class:"p-6 space-y-6"},W={class:"bg-white p-4 rounded shadow"},X={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Y={class:"md:col-span-1"},Z=["src"],ee={class:"md:col-span-2"},te={class:"md:col-span-2"},ne={class:"mt-4 flex items-center gap-3"},se=["disabled"],ie={key:0,class:"text-sm text-red-600"},ae={class:"bg-white p-4 rounded shadow"},le={key:0,class:"text-sm text-gray-500"},oe={key:1,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},re={class:"h-40 bg-white flex items-center justify-center"},de=["src"],ce={key:1,class:"text-gray-400"},ue={class:"p-3 space-y-3 text-sm"},pe={class:"flex items-center justify-between"},me={class:"font-semibold"},fe=["onClick"],ge={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ve=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],be={class:"md:col-span-2"},ye=["onUpdate:modelValue"],_e={class:"md:col-span-2"},ke=["onUpdate:modelValue"],we=["onUpdate:modelValue"],he=["onChange"],Ce=["disabled","onClick"],Ue={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ve={__name:"Index",setup(e){const n=b({title:{en:"",ar:""},description:{en:"",ar:""},email:"",image:null}),a=b(null);function d(o){var i;const t=((i=o.target.files)==null?void 0:i[0])||null;n.value.image=t,a.value=t?URL.createObjectURL(t):null}const c=b(!1),v=b(""),_=S(()=>{var o,t,i,l,f;return!!((o=n.value.title.en)!=null&&o.trim())&&!!((t=n.value.title.ar)!=null&&t.trim())&&!!((i=n.value.description.en)!=null&&i.trim())&&!!((l=n.value.description.ar)!=null&&l.trim())&&!!((f=n.value.email)!=null&&f.trim())&&!!n.value.image});async function k(){var o,t;c.value=!0,v.value="";try{const i=H([n.value]);await U.create(i),await y(),n.value={title:{en:"",ar:""},description:{en:"",ar:""},email:"",image:null},a.value=null}catch(i){console.error(i),v.value=((t=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:t.message)||(i==null?void 0:i.message)||"Create failed"}finally{c.value=!1}}const w=b([]),V=b(!1),r=$({}),h=$({}),A=$({});function F(o){Object.keys(r).forEach(t=>delete r[t]),o.forEach(t=>{r[t.id]={title:{en:t.title_en||"",ar:t.title_ar||""},description:{en:t.description_en||"",ar:t.description_ar||""},email:t.email||""}})}async function y(){V.value=!0;try{w.value=await U.list(),F(w.value)}finally{V.value=!1}}function N(o,t){var l;const i=((l=t.target.files)==null?void 0:l[0])||null;i&&(A[o]=i)}async function R(o){var i,l;const t=r[o];if(t){h[o]=!0;try{const f={title:t.title,description:t.description,email:t.email,image:A[o]},L=K(f);await U.update(o,L),delete A[o],await y()}catch(f){console.error(f),alert(((l=(i=f==null?void 0:f.response)==null?void 0:i.data)==null?void 0:l.message)||"Update failed")}finally{h[o]=!1}}}async function T(o){confirm("Delete this contractor?")&&(await U.remove(o),await y())}return I(y),(o,t)=>(u(),O(q,null,{default:B(()=>[s("div",Q,[s("div",{class:"flex items-center justify-between"},[t[5]||(t[5]=s("h2",{class:"text-2xl font-bold text-gray-800"},"Contractors",-1)),s("button",{class:"px-3 py-1 border rounded",onClick:y},"Refresh")]),s("div",W,[t[12]||(t[12]=s("h3",{class:"text-lg font-bold mb-3"},"Add Contractor",-1)),s("div",X,[s("div",null,[t[6]||(t[6]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),p(s("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>n.value.title.en=i),type:"text",class:"form-input"},null,512),[[m,n.value.title.en]])]),s("div",null,[t[7]||(t[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),p(s("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>n.value.title.ar=i),type:"text",class:"form-input"},null,512),[[m,n.value.title.ar]])]),s("div",null,[t[8]||(t[8]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Email *",-1)),p(s("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>n.value.email=i),type:"email",class:"form-input"},null,512),[[m,n.value.email]])]),s("div",Y,[t[9]||(t[9]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Image *",-1)),s("input",{type:"file",accept:"image/*",onChange:d},null,32),a.value?(u(),g("img",{key:0,src:a.value,class:"mt-2 w-24 h-16 object-cover rounded border"},null,8,Z)):D("",!0)]),s("div",ee,[t[10]||(t[10]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN) *",-1)),p(s("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>n.value.description.en=i),type:"text",class:"form-input"},null,512),[[m,n.value.description.en]])]),s("div",te,[t[11]||(t[11]=s("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR) *",-1)),p(s("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>n.value.description.ar=i),type:"text",class:"form-input"},null,512),[[m,n.value.description.ar]])])]),s("div",ne,[s("button",{class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60",disabled:c.value||!_.value,onClick:k},C(c.value?"Saving…":"Add"),9,se),v.value?(u(),g("span",ie,C(v.value),1)):D("",!0)])]),s("div",ae,[t[19]||(t[19]=s("h3",{class:"text-lg font-bold mb-3"},"All Contractors",-1)),V.value?(u(),g("div",le,"Loading…")):(u(),g("div",oe,[(u(!0),g(J,null,M(w.value,i=>(u(),g("div",{key:i.id,class:"border rounded bg-gray-50 overflow-hidden"},[s("div",re,[i.image_url?(u(),g("img",{key:0,src:i.image_url,class:"max-h-40 object-contain"},null,8,de)):(u(),g("div",ce,"No image"))]),s("div",ue,[s("div",pe,[s("div",me,"#"+C(i.id),1),s("button",{class:"px-2 py-1 border rounded text-red-600",onClick:l=>T(i.id)},"Delete",8,fe)]),s("div",ge,[s("div",null,[t[13]||(t[13]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),p(s("input",{"onUpdate:modelValue":l=>r[i.id].title.en=l,class:"form-input",type:"text"},null,8,ve),[[m,r[i.id].title.en]])]),s("div",null,[t[14]||(t[14]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),p(s("input",{"onUpdate:modelValue":l=>r[i.id].title.ar=l,class:"form-input",type:"text"},null,8,xe),[[m,r[i.id].title.ar]])]),s("div",be,[t[15]||(t[15]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (EN)",-1)),p(s("input",{"onUpdate:modelValue":l=>r[i.id].description.en=l,class:"form-input",type:"text"},null,8,ye),[[m,r[i.id].description.en]])]),s("div",_e,[t[16]||(t[16]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Description (AR)",-1)),p(s("input",{"onUpdate:modelValue":l=>r[i.id].description.ar=l,class:"form-input",type:"text"},null,8,ke),[[m,r[i.id].description.ar]])]),s("div",null,[t[17]||(t[17]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Email",-1)),p(s("input",{"onUpdate:modelValue":l=>r[i.id].email=l,class:"form-input",type:"email"},null,8,we),[[m,r[i.id].email]])]),s("div",null,[t[18]||(t[18]=s("label",{class:"block text-[11px] text-gray-500 mb-1"},"Replace Image",-1)),s("input",{type:"file",accept:"image/*",onChange:l=>N(i.id,l)},null,40,he)])]),s("div",null,[s("button",{class:"px-3 py-1 border rounded",disabled:h[i.id],onClick:l=>R(i.id)},C(h[i.id]?"Saving…":"Save"),9,Ce)])])]))),128)),w.value.length?D("",!0):(u(),g("div",Ue," No contractors found. "))]))])])]),_:1}))}},Ee=z(Ve,[["__scopeId","data-v-c6b7dba3"]]);export{Ee as default};
