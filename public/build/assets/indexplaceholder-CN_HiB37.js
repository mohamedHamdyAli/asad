import{p as c,i as A,C as ce,q as me,f as d,o as i,a as m,u as g,g as ge,w as y,b as e,h as b,j as w,k as q,y as D,F as C,s as V,t as a,e as v,n as ye,S as _,A as fe,d as xe}from"./app-Ddo0-UJ6.js";import{_ as be}from"./AuthenticatedLayout-CTeKgYcY.js";import{U as P,b as _e,a as he}from"./units-BTKrMhDY.js";import{U as we}from"./users-DMinzGr5.js";import{V as ke}from"./vendors-86LNeoEq.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"p-6 space-y-6"},Ue={class:"bg-white rounded-2xl border border-gray-200 p-4"},Ae={class:"grid gap-3 md:grid-cols-5"},Me={class:"md:col-span-2"},$e=["value"],je=["value"],De={class:"bg-white rounded-2xl border border-gray-200"},Ve={key:0,class:"px-4 pb-4 text-sm text-gray-500"},Se={key:1},Ne={class:"overflow-x-auto"},qe={class:"min-w-full text-sm"},Fe={class:"px-4 py-2"},Le={class:"px-4 py-2"},Te={class:"font-medium text-gray-900"},Ee={key:0,class:"text-gray-400"},ze={dir:"rtl"},Re={class:"px-4 py-2"},Oe={class:"px-4 py-2"},Be={class:"px-4 py-2"},Ge={class:"px-4 py-2"},Ie={class:"text-gray-900"},Ke={class:"text-xs text-gray-500"},He={class:"px-4 py-2"},Je={class:"text-gray-900"},Qe={class:"text-xs text-gray-500"},We={class:"px-4 py-2"},Xe={class:"flex items-center justify-end gap-2"},Ye=["onClick"],Ze=["onClick"],et=["onClick"],tt={key:0},st={class:"flex items-center justify-between px-4 py-3 border-t text-sm"},lt={class:"text-gray-600"},at={class:"font-medium"},ot={class:"font-medium"},nt={class:"font-medium"},rt={class:"flex items-center gap-2"},dt=["disabled"],it={class:"px-2"},ut=["disabled"],vt={key:0,class:"fixed inset-0 z-50"},pt={class:"relative mx-auto w-full max-w-5xl p-4 sm:p-6 h-full flex items-center justify-center"},ct={class:"bg-white rounded-2xl shadow-xl w-full max-h-[90vh] overflow-y-auto"},mt={key:0,class:"p-5 text-sm text-gray-500"},gt={key:1,class:"p-5 space-y-5"},yt={class:"grid md:grid-cols-3 gap-4"},ft={class:"md:col-span-2 space-y-3"},xt={class:"text-xl font-semibold text-gray-900"},bt={key:0,class:"text-gray-400"},_t={dir:"rtl"},ht={class:"text-sm text-gray-600"},wt={class:"space-y-1"},kt={class:"text-sm text-gray-700 whitespace-pre-wrap"},Ct={class:"space-y-1"},Pt={class:"text-sm text-gray-700 whitespace-pre-wrap",dir:"rtl"},Ut={class:"grid grid-cols-2 gap-2"},At={class:"space-y-3"},Mt={class:"aspect-[4/3] bg-gray-50 rounded border relative"},$t=["src"],jt={key:1,class:"absolute inset-0 flex items-center justify-center text-gray-400 text-sm"},Dt={class:"grid grid-cols-3 gap-2"},Vt=["src"],St={key:0,class:"text-xs text-gray-500"},Nt={class:"text-xs text-gray-500"},qt={class:"relative mx-auto w-full max-w-3xl p-4 sm:p-6 h-full flex items-center justify-center"},Ft={class:"bg-white rounded-2xl shadow-lg w-full max-h-[min(88vh,900px)] overflow-y-auto focus:outline-none",role:"dialog","aria-modal":"true"},Lt={class:"sticky top-0 z-10 bg-white border-b rounded-t-2xl"},Tt={class:"flex items-center justify-between px-5 py-3"},Et={class:"text-lg font-bold"},zt={class:"px-5 py-4 space-y-4"},Rt={key:0,class:"rounded border border-red-200 bg-red-50 text-red-700 px-3 py-2"},Ot={class:"sticky bottom-0 z-10 bg-white border-t rounded-b-2xl"},Bt={class:"px-5 py-3 flex items-center gap-3"},Gt=["disabled"],It={__name:"indexplaceholder",setup(Kt){const o=c({q:"",status:"",user_id:null,vendor_id:null,date_from:"",date_to:""}),f=c({page:1,perPage:10}),r=c(null),K=A(()=>r.value?r.value.current_page>1:!1),H=A(()=>r.value?r.value.current_page<r.value.last_page:!1),J=A(()=>r.value?(r.value.current_page-1)*r.value.per_page+1:0),Q=A(()=>r.value?Math.min(r.value.current_page*r.value.per_page,r.value.total):0);function F(l){r.value&&(l<1||l>r.value.last_page||(f.value.page=l,x()))}const U=c([]),S=c(!1),L=c([]),T=c([]);let E=null;ce(()=>[o.value.q,o.value.status,o.value.user_id,o.value.vendor_id,o.value.date_from,o.value.date_to,f.value.perPage],()=>{f.value.page=1,clearTimeout(E),E=setTimeout(x,300)});function W(){o.value={q:"",status:"",user_id:null,vendor_id:null,date_from:"",date_to:""},f.value.page=1,x()}async function X(){const l=await we.list();L.value=l.map(u=>({id:u.id,name:u.name,email:u.email}));const t=await ke.list();T.value=t.map(u=>({id:u.id,name:u.name,email:u.email}))}async function x(){S.value=!0;try{const l={page:f.value.page,per_page:f.value.perPage,q:o.value.q||void 0,status:o.value.status||void 0,user_id:o.value.user_id||void 0,vendor_id:o.value.vendor_id||void 0,date_from:o.value.date_from||void 0,date_to:o.value.date_to||void 0},t=await P.list(l);t&&t.data&&t.meta?(U.value=t.data,r.value=t.meta):Array.isArray(t)?(U.value=t,r.value={current_page:1,last_page:1,per_page:t.length,total:t.length}):(U.value=[],r.value={current_page:1,last_page:1,per_page:10,total:0})}finally{S.value=!1}}me(async()=>{await Promise.all([X(),x()])});function Y(l){return`/units-management/${l}/docs`}function Z(l){return`/units-management/${l}/drawing`}function ee(l){return`/units-management/${l}/gallery`}function te(l){return`/units-management/${l}/timeline`}function se(l){return`/units-management/${l}/reports`}function le(l){return`/units-management/${l}/contractors`}function ae(l){return`/units-management/${l}/payments`}function oe(l){return`/units-management/${l}/phases`}const h=c({open:!1,loading:!1,id:null,data:null}),n=A(()=>h.value.data||{});async function ne(l){h.value={open:!0,loading:!0,id:l,data:null};try{const t=await P.show(l);h.value.data=t}catch(t){console.error(t)}finally{h.value.loading=!1}}function N(){h.value={open:!1,loading:!1,id:null,data:null}}const M=c(!1),k=c(null),$=c(!1),j=c(""),re=c({});function de(){O(),M.value=!0}async function ie(l){await pe(l),M.value=!0}async function ue(l){confirm(`Delete unit #${l.id}?`)&&(await P.remove(l.id),await x())}const p=c({name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"under_construction",cover_image:null,gallery:[]}),z=c(null),R=c([]),ve=c([]);function O(){p.value={name:{en:"",ar:""},description:{en:"",ar:""},location:"",lat:null,long:null,start_date:"",end_date:"",user_id:null,vendor_id:null,status:"under_construction",cover_image:null,gallery:[]},z.value=null,R.value=[],j.value="",re.value={},k.value=null}async function pe(l){O(),k.value=l.id;const t=await P.show(l.id);p.value.name.en=t.name_en||"",p.value.name.ar=t.name_ar||"",p.value.description.en=t.description_en||"",p.value.description.ar=t.description_ar||"",p.value.location=t.location||"",p.value.lat=t.lat,p.value.long=t.long,p.value.start_date=t.start_date||"",p.value.end_date=t.end_date||"",p.value.user_id=t.user_id??null,p.value.vendor_id=t.vendor_id??null,p.value.status=t.status||"",z.value=t.cover_image_url||null,p.value.cover_image=null,ve.value=Array.isArray(t.gallery)?t.gallery:[],R.value=[],p.value.gallery=[]}async function B(){var l,t;$.value=!0;try{if(k.value){const u=_e(p.value);await P.update(k.value,u)}else{const u=he(p.value);await P.create(u)}await x(),M.value=!1}catch(u){j.value=((t=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:t.message)||(u==null?void 0:u.message)||"Request failed"}finally{$.value=!1}}return(l,t)=>(i(),d(C,null,[m(g(ge),{title:"Units"}),m(be,null,{default:y(()=>{var u,G;return[e("div",Pe,[e("div",{class:"flex items-center justify-between"},[t[13]||(t[13]=e("h2",{class:"text-2xl font-bold text-dash-title"},"Units",-1)),e("button",{onClick:de,class:"bg-black text-white px-3 py-2 rounded hover:bg-gray-700"}," + Add Unit ")]),e("div",Ue,[e("div",Ae,[e("div",Me,[t[14]||(t[14]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"Search",-1)),w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.q=s),type:"text",placeholder:"Search by name or location…",class:"form-input"},null,512),[[q,o.value.q,void 0,{trim:!0}]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"Status",-1)),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.status=s),class:"form-input"},t[15]||(t[15]=[e("option",{value:""},"All",-1),e("option",{value:"under_construction"},"under_construction",-1),e("option",{value:"completed"},"completed",-1)]),512),[[D,o.value.status]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"User",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.user_id=s),class:"form-input"},[t[17]||(t[17]=e("option",{value:null},"All",-1)),(i(!0),d(C,null,V(L.value,s=>(i(),d("option",{key:s.id,value:s.id},a(s.name)+" — "+a(s.email),9,$e))),128))],512),[[D,o.value.user_id,void 0,{number:!0}]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"Project Manager",-1)),w(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.vendor_id=s),class:"form-input"},[t[19]||(t[19]=e("option",{value:null},"All",-1)),(i(!0),d(C,null,V(T.value,s=>(i(),d("option",{key:s.id,value:s.id},a(s.name)+" — "+a(s.email),9,je))),128))],512),[[D,o.value.vendor_id,void 0,{number:!0}]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"From",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.date_from=s),type:"date",class:"form-input"},null,512),[[q,o.value.date_from]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"To",-1)),w(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.date_to=s),type:"date",class:"form-input"},null,512),[[q,o.value.date_to]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"text-xs text-gray-500 mb-1 block"},"Per Page",-1)),w(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>f.value.perPage=s),class:"form-input"},t[23]||(t[23]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1)]),512),[[D,f.value.perPage,void 0,{number:!0}]])]),e("div",{class:"md:col-span-2 flex items-end gap-2"},[e("button",{onClick:W,class:"px-3 py-2 border rounded-lg"},"Reset"),e("button",{onClick:x,class:"px-3 py-2 border rounded-lg hover:bg-gray-50"},"Apply")])])]),e("div",De,[e("div",{class:"p-4 flex items-center justify-between"},[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-gray-800"},"All Units",-1)),e("button",{onClick:x,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"},"Refresh")]),S.value?(i(),d("div",Ve,"Loading…")):(i(),d("div",Se,[e("div",Ne,[e("table",qe,[t[27]||(t[27]=e("thead",{class:"bg-gray-50 text-gray-600"},[e("tr",null,[e("th",{class:"text-left font-semibold px-4 py-2"},"#"),e("th",{class:"text-left font-semibold px-4 py-2"},"Name"),e("th",{class:"text-left font-semibold px-4 py-2"},"Location"),e("th",{class:"text-left font-semibold px-4 py-2"},"Period"),e("th",{class:"text-left font-semibold px-4 py-2"},"Status"),e("th",{class:"text-left font-semibold px-4 py-2"},"User"),e("th",{class:"text-left font-semibold px-4 py-2"},"Project Manager"),e("th",{class:"text-right font-semibold px-4 py-2"},"Actions")])],-1)),e("tbody",null,[(i(!0),d(C,null,V(U.value,s=>(i(),d("tr",{key:s.id,class:"border-t last:border-b"},[e("td",Fe,a(s.id),1),e("td",Le,[e("div",Te,[v(a(s.name_en||"—")+" ",1),s.name_ar?(i(),d("span",Ee,"/")):b("",!0),e("span",ze,a(s.name_ar),1)])]),e("td",Re,a(s.location||"—"),1),e("td",Oe,[e("div",null,a(s.start_date||"—")+" → "+a(s.end_date||"—"),1)]),e("td",Be,[e("span",{class:ye(["inline-flex items-center rounded-full border px-2 py-0.5 text-[11px]",s.status==="completed"?"border-green-200 text-green-700 bg-green-50":"border-gray-200 text-gray-700 bg-gray-50"])},a(s.status||"—"),3)]),e("td",Ge,[e("div",Ie,a(s.user_name||"—"),1),e("div",Ke,a(s.user_email||""),1)]),e("td",He,[e("div",Je,a(s.vendor_name||"—"),1),e("div",Qe,a(s.vendor_email||""),1)]),e("td",We,[e("div",Xe,[e("button",{onClick:I=>ne(s.id),class:"px-2 py-1.5 border rounded hover:bg-gray-50"},"Details",8,Ye),e("button",{onClick:I=>ie(s),class:"px-2 py-1.5 border rounded hover:bg-gray-50"},"Edit",8,Ze),e("button",{onClick:I=>ue(s),class:"px-2 py-1.5 border border-red-200 text-red-600 rounded hover:bg-red-50"},"Delete",8,et)])])]))),128)),U.value.length?b("",!0):(i(),d("tr",tt,t[26]||(t[26]=[e("td",{colspan:"8",class:"px-4 py-8 text-center text-gray-500"},"No units found.",-1)])))])])]),e("div",st,[e("div",lt,[r.value?(i(),d(C,{key:0},[t[28]||(t[28]=v(" Showing ")),e("span",at,a(J.value),1),t[29]||(t[29]=v("– ")),e("span",ot,a(Q.value),1),t[30]||(t[30]=v(" of ")),e("span",nt,a(r.value.total),1)],64)):b("",!0)]),e("div",rt,[e("button",{class:"px-2 py-1.5 border rounded disabled:opacity-50",disabled:!K.value,onClick:t[7]||(t[7]=s=>F(r.value.current_page-1))}," Prev ",8,dt),e("div",it,"Page "+a(((u=r.value)==null?void 0:u.current_page)||1)+" / "+a(((G=r.value)==null?void 0:G.last_page)||1),1),e("button",{class:"px-2 py-1.5 border rounded disabled:opacity-50",disabled:!H.value,onClick:t[8]||(t[8]=s=>F(r.value.current_page+1))}," Next ",8,ut)])])]))]),h.value.open?(i(),d("div",vt,[e("div",{class:"absolute inset-0 bg-black/40",onClick:N}),e("div",pt,[e("div",ct,[e("div",{class:"sticky top-0 bg-white border-b px-5 py-3 rounded-t-2xl flex items-center justify-between"},[t[31]||(t[31]=e("h3",{class:"text-lg font-bold"},"Unit Details",-1)),e("button",{onClick:N,class:"text-gray-500 hover:text-gray-800"},"✕")]),h.value.loading?(i(),d("div",mt,"Loading…")):(i(),d("div",gt,[e("div",yt,[e("div",ft,[e("div",xt,[v(a(n.value.name_en||"—")+" ",1),n.value.name_ar?(i(),d("span",bt,"/")):b("",!0),e("span",_t,a(n.value.name_ar),1)]),e("div",ht,[e("div",null,[t[32]||(t[32]=e("span",{class:"font-medium"},"Location:",-1)),v(" "+a(n.value.location||"—"),1)]),e("div",null,[t[33]||(t[33]=e("span",{class:"font-medium"},"Period:",-1)),v(" "+a(n.value.start_date||"—")+" → "+a(n.value.end_date||"—"),1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"font-medium"},"Status:",-1)),v(" "+a(n.value.status||"—"),1)])]),e("div",wt,[t[35]||(t[35]=e("div",{class:"text-sm text-gray-800 font-semibold"},"Description (EN)",-1)),e("div",kt,a(n.value.description_en||"—"),1)]),e("div",Ct,[t[36]||(t[36]=e("div",{class:"text-sm text-gray-800 font-semibold"},"Description (AR)",-1)),e("div",Pt,a(n.value.description_ar||"—"),1)]),e("div",Ut,[m(g(_),{href:Y(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[37]||(t[37]=[v("Docs")])),_:1},8,["href"]),m(g(_),{href:ee(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[38]||(t[38]=[v("Gallery")])),_:1},8,["href"]),m(g(_),{href:Z(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[39]||(t[39]=[v("Drawing")])),_:1},8,["href"]),m(g(_),{href:se(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[40]||(t[40]=[v("Reports")])),_:1},8,["href"]),m(g(_),{href:oe(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[41]||(t[41]=[v("Phases")])),_:1},8,["href"]),m(g(_),{href:te(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[42]||(t[42]=[v("Timeline")])),_:1},8,["href"]),m(g(_),{href:le(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[43]||(t[43]=[v("Assignments")])),_:1},8,["href"]),m(g(_),{href:ae(n.value.id),class:"px-3 py-2 border rounded text-center hover:bg-gray-50"},{default:y(()=>t[44]||(t[44]=[v("Payments & Installments")])),_:1},8,["href"])])]),e("div",At,[e("div",Mt,[n.value.cover_image_url?(i(),d("img",{key:0,src:n.value.cover_image_url,class:"absolute inset-0 w-full h-full object-cover rounded"},null,8,$t)):(i(),d("div",jt,"No Cover"))]),e("div",null,[t[45]||(t[45]=e("div",{class:"text-sm font-semibold text-gray-800 mb-2"},"Gallery",-1)),e("div",Dt,[(i(!0),d(C,null,V(n.value.gallery||[],s=>(i(),d("div",{key:s.id,class:"aspect-[4/3] bg-gray-50 rounded border relative"},[e("img",{src:s.image_url,class:"absolute inset-0 w-full h-full object-cover rounded"},null,8,Vt)]))),128)),n.value.gallery&&n.value.gallery.length?b("",!0):(i(),d("div",St,"No images"))])]),e("div",Nt,[e("div",null,[t[46]||(t[46]=e("span",{class:"font-medium"},"Lat:",-1)),v(" "+a(n.value.lat??"—"),1)]),e("div",null,[t[47]||(t[47]=e("span",{class:"font-medium"},"Lng:",-1)),v(" "+a(n.value.long??"—"),1)])])])])])),e("div",{class:"sticky bottom-0 bg-white border-t px-5 py-3 rounded-b-2xl text-right"},[e("button",{onClick:N,class:"px-3 py-2 border rounded"},"Close")])])])])):b("",!0),M.value?(i(),d("div",{key:1,class:"fixed inset-0 z-50",onKeydown:t[12]||(t[12]=fe((...s)=>l.closeModal&&l.closeModal(...s),["esc"]))},[e("div",{class:"absolute inset-0 bg-black/40 back-drop",onClick:t[9]||(t[9]=(...s)=>l.closeModal&&l.closeModal(...s)),"aria-hidden":"true"}),e("div",qt,[e("div",Ft,[e("div",Lt,[e("div",Tt,[e("h3",Et,a(k.value?"Edit Unit":"Add Unit"),1),e("button",{onClick:t[10]||(t[10]=(...s)=>l.closeModal&&l.closeModal(...s)),class:"text-gray-400 hover:text-gray-600","aria-label":"Close"},"✕")])]),e("div",zt,[e("form",{onSubmit:xe(B,["prevent"]),class:"space-y-4"},[j.value?(i(),d("div",Rt,a(j.value),1)):b("",!0)],32)]),e("div",Ot,[e("div",Bt,[e("button",{disabled:$.value,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60",onClick:B},a($.value?"Saving…":k.value?"Update":"Create"),9,Gt),e("button",{type:"button",class:"px-3 py-2 border rounded",onClick:t[11]||(t[11]=(...s)=>l.closeModal&&l.closeModal(...s))},"Cancel")])])])])],32)):b("",!0)])]}),_:1})],64))}},Zt=Ce(It,[["__scopeId","data-v-44e8a89d"]]);export{Zt as default};
