import{k as b,i as $,l as v,m as A,p as R,c as q,o as f,w as J,b as t,j as h,s as k,f as m,h as w,t as x,F as M,q as z}from"./app-Cz439Bzo.js";import{_ as P}from"./AuthenticatedLayout-BYgS9ozV.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";function G(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function H(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}function K(e){return e?`/storage/${e}`:""}function S(e){return(e||"").split("/").pop()||""}function Q(e){return(S(e).split(".").pop()||"").toLowerCase()}function W(e){const a=Q(e);return a==="pdf"?"📕 PDF":a==="doc"||a==="docx"?"📝 DOC":a==="xls"||a==="xlsx"?"📊 XLS":"📄"}function Y(e={}){const a=G(e.title),o=a&&typeof a=="object"?a:{en:a??"",ar:a??""},s=K(e.file);return{id:e.id,unit_id:e.unit_id,file:e.file??"",file_url:s,file_name:S(e.file),file_icon:W(e.file),title_en:o.en??"",title_ar:o.ar??"",created_at:e.created_at,updated_at:e.updated_at}}const C={list:async e=>{const{data:a}=await b.get(`/api/unit-timeline/${e}`);return H(a).map(Y)},create:async e=>{const{data:a}=await b.post("/api/unit-timeline/create",e,{headers:{"Content-Type":"multipart/form-data"}});return a},update:async e=>{const{data:a}=await b.post("/api/unit-timeline/update",e,{headers:{"Content-Type":"multipart/form-data"}});return a},remove:async e=>{const{data:a}=await b.delete(`/api/unit-timeline/delete/${e}`);return a}};function Z(e,a=[]){const o=new FormData;return o.append("unit_id",String(e)),a.forEach((s,r)=>{var c,u;o.append(`data[${r}][title][en]`,((c=s==null?void 0:s.title)==null?void 0:c.en)??""),o.append(`data[${r}][title][ar]`,((u=s==null?void 0:s.title)==null?void 0:u.ar)??""),s.file&&o.append(`data[${r}][file]`,s.file)}),o}function ee(e,a=[]){const o=new FormData;return o.append("unit_id",String(e)),a.forEach((s,r)=>{var c,u;o.append(`data[${r}][id]`,String(s.id??"")),((c=s==null?void 0:s.title)==null?void 0:c.en)!==void 0&&o.append(`data[${r}][title][en]`,s.title.en??""),((u=s==null?void 0:s.title)==null?void 0:u.ar)!==void 0&&o.append(`data[${r}][title][ar]`,s.title.ar??""),s.file&&o.append(`data[${r}][file]`,s.file)}),o}const te={class:"p-6 space-y-6"},ne={class:"flex items-center justify-between"},ie=["href"],se={class:"bg-white p-4 rounded shadow"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"mt-4"},oe={key:0,class:"mt-3 text-sm text-gray-600"},re={class:"mt-4 flex items-center gap-3"},de=["disabled"],ce={key:0,class:"text-red-600 text-sm"},ue={class:"bg-white p-4 rounded shadow"},fe={key:0,class:"text-sm text-gray-500"},pe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},me={class:"h-32 bg-white flex items-center justify-center p-3 text-center"},xe={class:"text-gray-600"},_e={class:"text-3xl"},ve={class:"text-xs mt-1 break-all"},ge={class:"p-3 space-y-2 text-sm"},ye={class:"flex items-center justify-between text-xs text-gray-500"},be=["onUpdate:modelValue"],he=["onUpdate:modelValue"],ke={class:"text-[11px]"},we=["onChange"],Ce={class:"flex gap-2 pt-1"},Te=["href"],Ue=["onClick","disabled"],Fe=["onClick"],Ae={key:0,class:"col-span-full text-center text-gray-500 py-8"},D=".pdf,.doc,.docx,.xls,.xlsx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$e={__name:"Timeline",props:{unitId:{type:[Number,String],required:!0}},setup(e){const a=e,o=$(()=>"/units-management"),s=v({title:{en:"",ar:""}}),r=v([]),c=v(!1),u=v(""),N=$(()=>{var l,n;return!!((l=s.value.title.en)!=null&&l.trim())&&!!((n=s.value.title.ar)!=null&&n.trim())&&r.value.length>0});function E(l){const n=Array.from(l.target.files||[]);r.value=n}async function V(){var l,n;c.value=!0,u.value="";try{const i=r.value.map(p=>({title:{...s.value.title},file:p})),d=Z(a.unitId,i);await C.create(d),await g(),r.value=[],s.value.title={en:"",ar:""}}catch(i){console.error(i),u.value=((n=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:n.message)||(i==null?void 0:i.message)||"Upload failed"}finally{c.value=!1}}const T=v([]),U=v(!1),_=A({}),F=A({}),y=A({});function I(l){l.forEach(n=>{_[n.id]={title:{en:n.title_en||"",ar:n.title_ar||""}}})}async function g(){U.value=!0;try{const l=await C.list(a.unitId);T.value=l,I(l)}finally{U.value=!1}}function j(l,n){var d;const i=((d=n.target.files)==null?void 0:d[0])||null;i&&(F[l]=i)}async function B(l){var i,d;const n=_[l];if(n){y[l]=!0;try{const p=[{id:l,title:n.title,file:F[l]}],O=ee(a.unitId,p);await C.update(O),delete F[l],await g()}catch(p){console.error(p),alert(((d=(i=p==null?void 0:p.response)==null?void 0:i.data)==null?void 0:d.message)||"Update failed")}finally{y[l]=!1}}}async function L(l){confirm("Delete this timeline item?")&&(await C.remove(l),await g())}return R(g),(l,n)=>(f(),q(P,null,{default:J(()=>[t("div",te,[t("div",ne,[n[2]||(n[2]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Timeline",-1)),t("a",{href:o.value,class:"px-3 py-1 border rounded"},"Back to Units",8,ie)]),t("div",se,[n[5]||(n[5]=t("h3",{class:"text-lg font-bold mb-3"},"Add Timeline Items",-1)),t("div",ae,[t("div",null,[n[3]||(n[3]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),h(t("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>s.value.title.en=i),class:"form-input",type:"text",required:""},null,512),[[k,s.value.title.en]])]),t("div",null,[n[4]||(n[4]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),h(t("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>s.value.title.ar=i),class:"form-input",type:"text",required:""},null,512),[[k,s.value.title.ar]])])]),t("div",le,[t("input",{type:"file",multiple:"",accept:D,onChange:E},null,32),r.value.length?(f(),m("div",oe,x(r.value.length)+" file(s) selected ",1)):w("",!0)]),t("div",re,[t("button",{disabled:c.value||!N.value,onClick:V,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},x(c.value?"Uploading…":"Upload"),9,de),u.value?(f(),m("span",ce,x(u.value),1)):w("",!0)])]),t("div",ue,[t("div",{class:"flex items-center justify-between mb-3"},[n[6]||(n[6]=t("h3",{class:"text-lg font-bold"},"Timeline Items",-1)),t("button",{onClick:g,class:"px-3 py-1 border rounded"},"Refresh")]),U.value?(f(),m("div",fe,"Loading…")):(f(),m("div",pe,[(f(!0),m(M,null,z(T.value,i=>(f(),m("div",{key:i.id,class:"rounded border bg-gray-50 overflow-hidden"},[t("div",me,[t("div",xe,[t("div",_e,x(i.file_icon.split(" ")[0]),1),t("div",ve,x(i.file_name),1)])]),t("div",ge,[t("div",ye,[t("span",null,"#"+x(i.id),1)]),t("div",null,[n[7]||(n[7]=t("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),h(t("input",{"onUpdate:modelValue":d=>_[i.id].title.en=d,class:"form-input",type:"text"},null,8,be),[[k,_[i.id].title.en]])]),t("div",null,[n[8]||(n[8]=t("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),h(t("input",{"onUpdate:modelValue":d=>_[i.id].title.ar=d,class:"form-input",type:"text"},null,8,he),[[k,_[i.id].title.ar]])]),t("div",ke,[n[9]||(n[9]=t("label",{class:"block text-gray-500"},"Replace File",-1)),t("input",{type:"file",accept:D,onChange:d=>j(i.id,d)},null,40,we)]),t("div",Ce,[i.file_url?(f(),m("a",{key:0,href:i.file_url,target:"_blank",class:"px-2 py-1 border rounded"},"Open",8,Te)):w("",!0),t("button",{class:"px-2 py-1 border rounded",onClick:d=>B(i.id),disabled:y[i.id]},x(y[i.id]?"Saving…":"Save"),9,Ue),t("button",{class:"px-2 py-1 border rounded text-red-600",onClick:d=>L(i.id)}," Delete ",8,Fe)])])]))),128)),T.value.length?w("",!0):(f(),m("div",Ae," No timeline items found. "))]))])])]),_:1}))}},Ee=X($e,[["__scopeId","data-v-c1b645d8"]]);export{Ee as default};
