import{k as $,l as g,i as M,m as I,p as P,c as z,o as p,w as H,b as a,a as j,j as y,s as x,f,h as N,F as R,q as E,t as h}from"./app-BJ7Yrijg.js";import{_ as K}from"./AuthenticatedLayout-byBFqb7B.js";import{F as T,a as Q}from"./FolderPicker-BVgAQz2J.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";function X(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function Y(t){var s;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((s=t==null?void 0:t.data)==null?void 0:s.data)?t.data.data:[]}function Z(t){return t?`/storage/${t}`:""}function ee(t={}){const s=X(t.title),d=s&&typeof s=="object"?s:{en:s??"",ar:s??""};return{id:t.id,unit_id:t.unit_id,folder_id:t.folder_id,date:t.date??"",image:t.image??"",image_url:Z(t.image),title_en:d.en??"",title_ar:d.ar??"",created_at:t.created_at,updated_at:t.updated_at}}const C={list:async t=>{const{data:s}=await $.get(`/api/unit-gallery/${t}`);return Y(s).map(ee)},create:async t=>{const{data:s}=await $.post("/api/unit-gallery/create",t,{headers:{"Content-Type":"multipart/form-data"}});return s},update:async t=>{const{data:s}=await $.post("/api/unit-gallery/update",t,{headers:{"Content-Type":"multipart/form-data"}});return s},remove:async t=>{const{data:s}=await $.delete(`/api/unit-gallery/delete/${t}`);return s}};function te(t,s=[]){const d=new FormData;return d.append("unit_id",String(t)),s.forEach((n,c)=>{var _,i;d.append(`data[${c}][folder_id]`,String(n.folder_id??"")),d.append(`data[${c}][date]`,n.date??""),d.append(`data[${c}][title][en]`,((_=n==null?void 0:n.title)==null?void 0:_.en)??""),d.append(`data[${c}][title][ar]`,((i=n==null?void 0:n.title)==null?void 0:i.ar)??""),n.image&&d.append(`data[${c}][image]`,n.image)}),d}function ae(t,s=[]){const d=new FormData;return d.append("unit_id",String(t)),s.forEach((n,c)=>{var _,i;d.append(`data[${c}][id]`,String(n.id??"")),d.append(`data[${c}][folder_id]`,String(n.folder_id??"")),n.date!==void 0&&d.append(`data[${c}][date]`,n.date??""),((_=n==null?void 0:n.title)==null?void 0:_.en)!==void 0&&d.append(`data[${c}][title][en]`,n.title.en??""),((i=n==null?void 0:n.title)==null?void 0:i.ar)!==void 0&&d.append(`data[${c}][title][ar]`,n.title.ar??""),n.image&&d.append(`data[${c}][image]`,n.image)}),d}const le={class:"p-6 space-y-6"},ne={class:"flex items-center justify-between"},se=["href"],de={class:"bg-white p-4 rounded shadow"},ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},re={class:"mt-4"},oe={key:0,class:"mt-3 flex flex-wrap gap-2"},ue=["src"],ce={class:"mt-4 flex items-center gap-3"},pe=["disabled"],fe={key:0,class:"text-red-600 text-sm"},me={class:"bg-white p-4 rounded shadow"},ve={key:0,class:"text-sm text-gray-500"},ge={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"},_e={class:"aspect-[4/3] bg-white flex items-center justify-center"},ye=["src"],xe={key:1,class:"text-gray-400 text-sm"},be={class:"p-2 space-y-2 text-xs"},he={class:"flex items-center justify-between"},we={class:"text-gray-500"},ke=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],Ve=["onUpdate:modelValue"],Fe={class:"text-[11px]"},$e=["onChange"],Ce={class:"flex gap-2 pt-1"},Ae=["onClick","disabled"],Se=["onClick"],De={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ie={__name:"Gallery",props:{unitId:{type:[Number,String],required:!0}},setup(t){const s=g([]),d=g(!1);async function n(){d.value=!0;try{s.value=await Q.list("gallery")}finally{d.value=!1}}const c=t,_=M(()=>"/units-management"),i=g({folder_id:null,date:"",title:{en:"",ar:""}}),w=g([]),k=g([]),U=g(!1),V=g("");function L(r){const e=Array.from(r.target.files||[]);w.value=e,k.value=e.map(o=>URL.createObjectURL(o))}async function B(){var r,e;U.value=!0,V.value="";try{const o=w.value.map(l=>({folder_id:i.value.folder_id,date:i.value.date,title:{...i.value.title},image:l})),v=te(c.unitId,o);await C.create(v),await b(),w.value=[],k.value=[],i.value.title={en:"",ar:""}}catch(o){console.error(o),V.value=((e=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Upload failed"}finally{U.value=!1}}const A=g([]),S=g(!1),m=I({}),D=I({}),F=I({});function G(r){r.forEach(e=>{m[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function b(){S.value=!0;try{const r=await C.list(c.unitId);A.value=r,G(r)}finally{S.value=!1}}function q(r,e){var v;const o=((v=e.target.files)==null?void 0:v[0])||null;o&&(D[r]=o)}async function O(r){var o,v;const e=m[r];if(e){F[r]=!0;try{const l=[{id:r,folder_id:e.folder_id,date:e.date,title:e.title,image:D[r]}],u=ae(c.unitId,l);await C.update(u),delete D[r],await b()}catch(l){console.error(l),alert(((v=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:v.message)||"Update failed")}finally{F[r]=!1}}}async function J(r){confirm("Delete this image?")&&(await C.remove(r),await b())}return P(async()=>{await n(),await b()}),(r,e)=>(p(),z(K,null,{default:H(()=>{var o,v;return[a("div",le,[a("div",ne,[e[6]||(e[6]=a("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Gallery",-1)),a("a",{href:_.value,class:"px-3 py-1 border rounded"},"Back to Units",8,se)]),a("div",de,[e[10]||(e[10]=a("h3",{class:"text-lg font-bold mb-3"},"Add Images",-1)),a("div",ie,[j(T,{type:"gallery",label:"Folder *",modelValue:i.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.folder_id=l),options:s.value,onCreated:e[1]||(e[1]=l=>s.value.unshift(l)),onRefresh:n},null,8,["modelValue","options"]),a("div",null,[e[7]||(e[7]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),y(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.date=l),class:"form-input",type:"date",required:""},null,512),[[x,i.value.date]])]),a("div",null,[e[8]||(e[8]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),y(a("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.title.en=l),class:"form-input",type:"text",required:""},null,512),[[x,i.value.title.en]])]),a("div",null,[e[9]||(e[9]=a("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),y(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.title.ar=l),class:"form-input",type:"text",required:""},null,512),[[x,i.value.title.ar]])])]),a("div",re,[a("input",{type:"file",multiple:"",accept:"image/*",onChange:L},null,32),k.value.length?(p(),f("div",oe,[(p(!0),f(R,null,E(k.value,(l,u)=>(p(),f("img",{key:u,src:l,class:"w-24 h-16 object-cover rounded border"},null,8,ue))),128))])):N("",!0)]),a("div",ce,[a("button",{disabled:U.value||!w.value.length||!i.value.folder_id||!i.value.date||!((o=i.value.title.en)!=null&&o.trim())||!((v=i.value.title.ar)!=null&&v.trim()),onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},h(U.value?"Uploading…":"Upload"),9,pe),V.value?(p(),f("span",fe,h(V.value),1)):N("",!0)])]),a("div",me,[a("div",{class:"flex items-center justify-between mb-3"},[e[11]||(e[11]=a("h3",{class:"text-lg font-bold"},"Images",-1)),a("button",{onClick:b,class:"px-3 py-1 border rounded"},"Refresh")]),S.value?(p(),f("div",ve,"Loading…")):(p(),f("div",ge,[(p(!0),f(R,null,E(A.value,l=>(p(),f("div",{key:l.id,class:"rounded border overflow-hidden bg-gray-50"},[a("div",_e,[l.image_url?(p(),f("img",{key:0,src:l.image_url,class:"w-full h-full object-cover"},null,8,ye)):(p(),f("div",xe,"No Image"))]),a("div",be,[a("div",he,[a("span",null,"#"+h(l.id),1),a("span",we,"Folder: "+h(l.folder_id),1)]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-[11px] text-gray-500"},"Date",-1)),y(a("input",{"onUpdate:modelValue":u=>m[l.id].date=u,class:"form-input",type:"date"},null,8,ke),[[x,m[l.id].date]])]),j(T,{type:"gallery",label:"Folder *",modelValue:m[l.id].folder_id,"onUpdate:modelValue":u=>m[l.id].folder_id=u,options:s.value,onCreated:e[5]||(e[5]=u=>s.value.unshift(u)),onRefresh:n},null,8,["modelValue","onUpdate:modelValue","options"]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-[11px] text-gray-500"},"Title (EN)",-1)),y(a("input",{"onUpdate:modelValue":u=>m[l.id].title.en=u,class:"form-input",type:"text"},null,8,Ue),[[x,m[l.id].title.en]])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-[11px] text-gray-500"},"Title (AR)",-1)),y(a("input",{"onUpdate:modelValue":u=>m[l.id].title.ar=u,class:"form-input",type:"text"},null,8,Ve),[[x,m[l.id].title.ar]])]),a("div",Fe,[e[15]||(e[15]=a("label",{class:"block text-gray-500"},"Replace Image",-1)),a("input",{type:"file",accept:"image/*",onChange:u=>q(l.id,u)},null,40,$e)]),a("div",Ce,[a("button",{class:"px-2 py-1 border rounded",onClick:u=>O(l.id),disabled:F[l.id]},h(F[l.id]?"Saving…":"Save"),9,Ae),a("button",{class:"px-2 py-1 border rounded text-red-600",onClick:u=>J(l.id)}," Delete ",8,Se)])])]))),128)),A.value.length?N("",!0):(p(),f("div",De," No images found. "))]))])])]}),_:1}))}},Te=W(Ie,[["__scopeId","data-v-351d2b12"]]);export{Te as default};
