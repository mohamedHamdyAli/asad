import{m as j,r as E,p as y,i as fe,q as me,c as $,o as d,w as W,b as r,a as k,u as x,h as g,f as p,F as X,s as Y,t as h,j as B,k as O}from"./app-Ddo0-UJ6.js";import{_ as ge}from"./AuthenticatedLayout-CTeKgYcY.js";import{_ as _e}from"./UnitNav-CbTkuP_g.js";import{F as Z,a as ye}from"./FolderPicker-CoTFmINd.js";import{c as N,a as xe,b as F,e as ee,F as ve,E as q,d as P}from"./index.esm-3Xgvr1dQ.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";function be(s){try{return typeof s=="string"?JSON.parse(s):s}catch{return s}}function ke(s){var o;return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.message)?s.message:Array.isArray((o=s==null?void 0:s.data)==null?void 0:o.data)?s.data.data:[]}function we(s){return s?`/storage/${s}`:""}function Ue(s={}){const o=be(s.title),u=o&&typeof o=="object"?o:{en:o??"",ar:o??""};return{id:s.id,unit_id:s.unit_id,folder_id:s.folder_id,date:s.date??"",image:s.image??"",image_url:we(s.image),title_en:u.en??"",title_ar:u.ar??"",created_at:s.created_at,updated_at:s.updated_at}}const R={list:async s=>{const{data:o}=await j.get(`/api/unit-gallery/${s}`);return ke(o).map(Ue)},create:async s=>{const{data:o}=await j.post("/api/unit-gallery/create",s,{headers:{"Content-Type":"multipart/form-data"}});return o},update:async s=>{const{data:o}=await j.post("/api/unit-gallery/update",s,{headers:{"Content-Type":"multipart/form-data"}});return o},remove:async s=>{const{data:o}=await j.delete(`/api/unit-gallery/delete/${s}`);return o}};function $e(s,o=[]){const u=new FormData;return u.append("unit_id",String(s)),o.forEach((n,c)=>{var b,v;u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),u.append(`data[${c}][date]`,n.date??""),u.append(`data[${c}][title][en]`,((b=n==null?void 0:n.title)==null?void 0:b.en)??""),u.append(`data[${c}][title][ar]`,((v=n==null?void 0:n.title)==null?void 0:v.ar)??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}function Fe(s,o=[]){const u=new FormData;return u.append("unit_id",String(s)),o.forEach((n,c)=>{var b,v;u.append(`data[${c}][id]`,String(n.id??"")),u.append(`data[${c}][folder_id]`,String(n.folder_id??"")),n.date!==void 0&&u.append(`data[${c}][date]`,n.date??""),((b=n==null?void 0:n.title)==null?void 0:b.en)!==void 0&&u.append(`data[${c}][title][en]`,n.title.en??""),((v=n==null?void 0:n.title)==null?void 0:v.ar)!==void 0&&u.append(`data[${c}][title][ar]`,n.title.ar??""),n.image&&u.append(`data[${c}][image]`,n.image)}),u}const Ie={class:"p-6 space-y-6"},qe={class:"flex items-center justify-between"},Ae=["href"],Ve={class:"bg-white p-4 rounded shadow"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Se={class:"mt-4"},Ce=["onChange"],je={key:1,class:"mt-3 flex flex-wrap gap-2"},Ee=["src"],Ne={class:"mt-4 flex items-center gap-3"},Re=["disabled"],Te={key:0,class:"text-red-600 text-sm"},Ge={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},Le={key:0,class:"text-sm text-gray-500"},Be={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 2xl:grid-cols-4 gap-5"},Oe={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},Pe=["src"],ze={key:1,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},Me=["href"],Je={key:2,class:"relative z-10 flex flex-col items-center justify-center text-gray-500 text-xs pointer-events-auto"},He={class:"break-all px-2"},Ke=["href"],Qe={class:"p-3.5 space-y-3"},We={key:0,class:"error"},Xe=["onUpdate:modelValue"],Ye={key:1,class:"error"},Ze=["onUpdate:modelValue","placeholder"],et={key:0,class:"error"},tt=["onUpdate:modelValue","placeholder"],at={key:0,class:"error"},rt={class:"text-[11px]"},st=["onChange"],nt={key:0,class:"mt-1 text-[11px] text-gray-500"},lt={class:"flex items-center gap-2 pt-1"},it=["onClick","disabled"],dt=["onClick"],ot={key:0,class:"ml-auto inline-flex items-center rounded-full bg-amber-50 text-amber-700 px-2.5 py-0.5 text-[11px] border border-amber-200"},ut={key:0,class:"col-span-full text-center text-gray-500 py-8"},ct={__name:"Gallery",props:{unitId:{type:[Number,String],required:!0}},setup(s){const o=N({folder_id:ee().required("Folder is required"),date:F().required("Date is required"),title:N({en:F().required("English title is required"),ar:F().required("Arabic title is required")}),files:xe().nullable().test("required","Please select at least one image",t=>Array.isArray(t)&&t.length>0)}),u=N({folder_id:ee().required("Folder is required"),date:F().required("Date is required"),title:N({en:F().required("English title is required"),ar:F().required("Arabic title is required")})}),n=E({}),c=y([]),b=y(!1);async function v(){b.value=!0;try{c.value=await ye.list("gallery",w.unitId)}finally{b.value=!1}}const w=s,te=fe(()=>"/units-management"),A=y({folder_id:null,date:"",title:{en:"",ar:""},files:[]}),z=y([]),V=y([]),D=y(!1),S=y("");function ae(t,e){const a=Array.from(t.target.files||[]);z.value=a,V.value=a.map(l=>URL.createObjectURL(l)),e("files",a)}function T(t){return t?`/storage/${t.image}`:""}function re(t){return t!=null&&t.image?/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|heic|heif|avif)$/i.test(t.image):!1}function se(t){return t!=null&&t.image?/\.pdf$/i.test(t.image):!1}function ne(t){return t!=null&&t.image?decodeURIComponent(t.image.split("/").pop()):"Unknown file"}async function le(t){var e,a;D.value=!0,S.value="";try{const l=t.files.map(m=>({folder_id:t.folder_id,date:t.date,title:{...t.title},image:m})),i=$e(w.unitId,l);await R.create(i),await I(),z.value=[],V.value=[],A.value.title={en:"",ar:""}}catch(l){console.error(l),S.value=((a=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:a.message)||(l==null?void 0:l.message)||"Upload failed"}finally{D.value=!1}}const G=y([]),L=y(!1),M=y({});function ie(t){const e={};t.forEach(a=>{e[a.id]={date:a.date||"",folder_id:a.folder_id??null,title:{en:a.title_en||"",ar:a.title_ar||""}}}),M.value=e}function de(t,e){var a,l,i,m;return(t==null?void 0:t.date)===(e==null?void 0:e.date)&&(t==null?void 0:t.folder_id)===(e==null?void 0:e.folder_id)&&((a=t==null?void 0:t.title)==null?void 0:a.en)===((l=e==null?void 0:e.title)==null?void 0:l.en)&&((i=t==null?void 0:t.title)==null?void 0:i.ar)===((m=e==null?void 0:e.title)==null?void 0:m.ar)}function J(t){const e=_[t.id],a=M.value[t.id];return!de(e,a)||!!U[t.id]}function H(t){const e=t==null?void 0:t.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}const _=E({}),U=E({}),C=E({});function oe(t){t.forEach(e=>{_[e.id]={date:e.date||"",folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}async function I(){L.value=!0;try{const t=await R.list(w.unitId);G.value=t,oe(t),ie(t)}finally{L.value=!1}}function ue(t,e){var l;const a=((l=e.target.files)==null?void 0:l[0])||null;a&&(U[t]=a)}async function ce(t){var a,l;const e=_[t];if(e){n[t]={};try{await u.validate(e,{abortEarly:!1})}catch(i){i.inner.forEach(m=>{n[t][m.path]=m.message});return}C[t]=!0;try{const i=[{id:t,folder_id:e.folder_id,date:e.date,title:e.title,image:U[t]}],m=Fe(w.unitId,i);await R.update(m),delete U[t],await I()}catch(i){console.error(i),alert(((l=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:l.message)||"Update failed")}finally{C[t]=!1}}}async function pe(t){confirm("Delete this image?")&&(await R.remove(t),await I())}return me(async()=>{await v(),await I()}),(t,e)=>(d(),$(ge,null,{default:W(()=>[r("div",Ie,[r("div",qe,[e[4]||(e[4]=r("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Gallery",-1)),r("a",{href:te.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,Ae)]),k(_e,{"unit-id":Number(s.unitId),cols:2},null,8,["unit-id"]),k(x(ve),{"validation-schema":x(o),"validate-on-mount":!1,"initial-values":A.value,onSubmit:le},{default:W(({setFieldValue:a,submitCount:l})=>[r("div",Ve,[e[8]||(e[8]=r("h3",{class:"text-lg font-bold mb-3"},"Add Images",-1)),r("div",De,[r("div",null,[k(Z,{type:"gallery",label:"Folder *","model-value":A.value.folder_id,options:c.value,unitId:w.unitId,"onUpdate:modelValue":i=>{A.value.folder_id=i,a("folder_id",i)},onCreated:e[0]||(e[0]=i=>c.value.unshift(i)),onRefresh:v},null,8,["model-value","options","unitId","onUpdate:modelValue"]),l>0?(d(),$(x(q),{key:0,name:"folder_id",class:"error"})):g("",!0)]),r("div",null,[e[5]||(e[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Date *",-1)),k(x(P),{name:"date",type:"date",class:"form-input"}),l>0?(d(),$(x(q),{key:0,name:"date",class:"error"})):g("",!0)]),r("div",null,[e[6]||(e[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),k(x(P),{name:"title.en",class:"form-input"}),l>0?(d(),$(x(q),{key:0,name:"title.en",class:"error"})):g("",!0)]),r("div",null,[e[7]||(e[7]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),k(x(P),{name:"title.ar",class:"form-input"}),l>0?(d(),$(x(q),{key:0,name:"title.ar",class:"error"})):g("",!0)])]),r("div",Se,[r("input",{type:"file",multiple:"",onChange:i=>ae(i,a)},null,40,Ce),l>0?(d(),$(x(q),{key:0,name:"files",class:"error"})):g("",!0),V.value.length?(d(),p("div",je,[(d(!0),p(X,null,Y(V.value,(i,m)=>(d(),p("img",{key:m,src:i,class:"w-24 h-16 object-cover rounded border"},null,8,Ee))),128))])):g("",!0)]),r("div",Ne,[r("button",{type:"submit",disabled:D.value,class:"px-4 py-2 bg-black text-white rounded hover:bg-gray-700"},h(D.value?"Uploadingâ€¦":"Upload"),9,Re),S.value?(d(),p("span",Te,h(S.value),1)):g("",!0)])])]),_:1},8,["validation-schema","initial-values"]),r("div",Ge,[r("div",{class:"flex items-center justify-between mb-4"},[e[9]||(e[9]=r("h3",{class:"text-lg font-semibold text-gray-800"},"Images",-1)),r("button",{onClick:I,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),L.value?(d(),p("div",Le,"Loadingâ€¦")):(d(),p("div",Be,[(d(!0),p(X,null,Y(G.value,a=>{var l,i,m,K,Q;return d(),p("div",{key:a.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] transition-all duration-200"},[r("div",Oe,[re(a)?(d(),p("img",{key:0,src:T(a),class:"absolute inset-0 w-full h-full object-cover"},null,8,Pe)):se(a)?(d(),p("div",ze,[e[10]||(e[10]=r("div",{class:"text-4xl mb-2"},"ðŸ“•",-1)),e[11]||(e[11]=r("span",{class:"px-2"},"PDF Document",-1)),r("a",{href:T(a),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Me)])):(d(),p("div",Je,[e[12]||(e[12]=r("div",{class:"text-4xl mb-2"},"ðŸ“„",-1)),r("span",He,h(ne(a)),1),r("a",{href:T(a),target:"_blank",rel:"noopener",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ke)])),e[13]||(e[13]=r("div",{class:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-transparent"},null,-1))]),r("div",Qe,[e[18]||(e[18]=r("div",{class:"text-xs text-gray-500"},[r("span",{class:"font-medium text-gray-700"},"Folder")],-1)),k(Z,{type:"gallery",label:" ",modelValue:_[a.id].folder_id,"onUpdate:modelValue":f=>_[a.id].folder_id=f,options:c.value,unitId:w.unitId,onCreated:e[1]||(e[1]=f=>c.value.unshift(f)),onRefresh:v},null,8,["modelValue","onUpdate:modelValue","options","unitId"]),(l=n==null?void 0:n[a.id])!=null&&l.folder_id?(d(),p("p",We,h(n[a.id].folder_id),1)):g("",!0),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Date",-1)),B(r("input",{"onUpdate:modelValue":f=>_[a.id].date=f,class:"form-input",type:"date"},null,8,Xe),[[O,_[a.id].date]])]),(i=n==null?void 0:n[a.id])!=null&&i.date?(d(),p("p",Ye,h(n[a.id].date),1)):g("",!0),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),B(r("textarea",{"onUpdate:modelValue":f=>_[a.id].title.en=f,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[2]||(e[2]=f=>H(f)),placeholder:a.title_en?"":"Enter English title"},null,40,Ze),[[O,_[a.id].title.en]]),(m=n==null?void 0:n[a.id])!=null&&m["title.en"]?(d(),p("p",et,h(n[a.id]["title.en"]),1)):g("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),B(r("textarea",{"onUpdate:modelValue":f=>_[a.id].title.ar=f,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[3]||(e[3]=f=>H(f)),placeholder:a.title_ar?"":"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"},null,40,tt),[[O,_[a.id].title.ar]]),(K=n==null?void 0:n[a.id])!=null&&K["title.ar"]?(d(),p("p",at,h(n[a.id]["title.ar"]),1)):g("",!0)]),r("div",rt,[e[17]||(e[17]=r("label",{class:"block text-gray-500 mb-1"},"Replace Image",-1)),r("input",{type:"file",onChange:f=>ue(a.id,f)},null,40,st),U[a.id]?(d(),p("p",nt," Selected: "+h((Q=U[a.id])==null?void 0:Q.name),1)):g("",!0)]),r("div",lt,[r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:f=>ce(a.id),disabled:C[a.id]||!J(a)},h(C[a.id]?"Savingâ€¦":"Save"),9,it),r("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:f=>pe(a.id)}," Delete ",8,dt),J(a)?(d(),p("span",ot," Unsaved changes ")):g("",!0)])])])}),128)),G.value.length?g("",!0):(d(),p("div",ut," No images found. "))]))])])]),_:1}))}},xt=he(ct,[["__scopeId","data-v-1bcb5d4b"]]);export{xt as default};
