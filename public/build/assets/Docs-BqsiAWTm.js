import{m as F,i as j,p as v,r as S,q as z,c as G,o as c,w as H,b as l,a as E,j as $,k as D,f,h as w,t as y,F as K,s as Q}from"./app-JYR8DZsF.js";import{_ as W}from"./AuthenticatedLayout-4E8zXejd.js";import{F as T,a as X}from"./FolderPicker-_1sAPPVo.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Z(t){try{return typeof t=="string"?JSON.parse(t):t}catch{return t}}function ee(t){var i;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.message)?t.message:Array.isArray((i=t==null?void 0:t.data)==null?void 0:i.data)?t.data.data:[]}function te(t){return t?`/storage/${t}`:""}function ae(t){return(t||"").split("/").pop()||""}function le(t){return/\.pdf$/i.test(t||"")}function ne(t={}){const i=Z(t.title),o=i&&typeof i=="object"?i:{en:i??"",ar:i??""},s=te(t.file);return{id:t.id,unit_id:t.unit_id,folder_id:t.folder_id,file:t.file??"",file_url:s,file_name:ae(t.file),is_pdf:le(t.file),title_en:o.en??"",title_ar:o.ar??"",created_at:t.created_at,updated_at:t.updated_at}}const V={list:async t=>{const{data:i}=await F.get(`/api/unit-docs/${t}`);return ee(i).map(ne)},create:async t=>{const{data:i}=await F.post("/api/unit-docs/create",t,{headers:{"Content-Type":"multipart/form-data"}});return i},update:async t=>{const{data:i}=await F.post("/api/unit-docs/update",t,{headers:{"Content-Type":"multipart/form-data"}});return i},remove:async t=>{const{data:i}=await F.delete(`/api/unit-docs/delete/${t}`);return i}};function se(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((s,d)=>{var m,g;o.append(`data[${d}][folder_id]`,String(s.folder_id??"")),o.append(`data[${d}][title][en]`,((m=s==null?void 0:s.title)==null?void 0:m.en)??""),o.append(`data[${d}][title][ar]`,((g=s==null?void 0:s.title)==null?void 0:g.ar)??""),s.file&&o.append(`data[${d}][file]`,s.file)}),o}function ie(t,i=[]){const o=new FormData;return o.append("unit_id",String(t)),i.forEach((s,d)=>{var m,g;o.append(`data[${d}][id]`,String(s.id??"")),o.append(`data[${d}][folder_id]`,String(s.folder_id??"")),((m=s==null?void 0:s.title)==null?void 0:m.en)!==void 0&&o.append(`data[${d}][title][en]`,s.title.en??""),((g=s==null?void 0:s.title)==null?void 0:g.ar)!==void 0&&o.append(`data[${d}][title][ar]`,s.title.ar??""),s.file&&o.append(`data[${d}][file]`,s.file)}),o}const re={class:"p-6 space-y-6"},oe={class:"flex items-center justify-between"},de=["href"],ue={class:"bg-white p-4 rounded shadow"},ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},fe={class:"mt-4"},pe={key:0,class:"mt-3 text-sm text-gray-600"},me={class:"mt-4 flex items-center gap-3"},ge=["disabled"],_e={key:0,class:"text-red-600 text-sm"},ve={class:"bg-white p-5 rounded-2xl shadow-sm ring-1 ring-black/[0.05]"},xe={key:0,class:"text-sm text-gray-500"},be={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-5"},ye={class:"relative aspect-[4/3] bg-gray-50 flex items-center justify-center"},he=["src"],we={key:1,class:"flex flex-col items-center text-gray-500 text-xs"},ke={class:"mt-2 break-all max-w-[90%]"},Ue=["href"],Ce={class:"p-3.5 space-y-3 text-sm"},Fe=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],De={class:"text-[11px]"},Ve=["onChange"],Ae={key:0,class:"mt-1 text-[11px] text-gray-500"},Ie={class:"flex items-center gap-2 pt-2"},Se=["onClick","disabled"],Ne=["onClick"],je={key:0,class:"col-span-full text-center text-gray-500 py-8"},Ee={__name:"Docs",props:{unitId:{type:[Number,String],required:!0}},setup(t){const i=t,o=j(()=>"/units-management"),s=v([]),d=v(!1);async function m(){d.value=!0;try{s.value=await X.list("document",i.unitId)}finally{d.value=!1}}function g(n){s.value.unshift(n)}const u=v({folder_id:null,title:{en:"",ar:""}}),b=v([]),k=v(!1),U=v(""),R=j(()=>{var n,e;return!!u.value.folder_id&&!!((n=u.value.title.en)!=null&&n.trim())&&!!((e=u.value.title.ar)!=null&&e.trim())&&b.value.length>0});function B(n){const e=Array.from(n.target.files||[]);b.value=e}async function L(){var n,e;k.value=!0,U.value="";try{const a=b.value.map(r=>({folder_id:u.value.folder_id,title:{...u.value.title},file:r})),p=se(i.unitId,a);await V.create(p),await h(),b.value=[],u.value.title={en:"",ar:""}}catch(a){console.error(a),U.value=((e=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Upload failed"}finally{k.value=!1}}const A=v([]),I=v(!1),_=S({}),x=S({}),C=S({});function q(n){n.forEach(e=>{_[e.id]={folder_id:e.folder_id??null,title:{en:e.title_en||"",ar:e.title_ar||""}}})}function N(n){const e=n==null?void 0:n.target;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}async function h(){I.value=!0;try{const n=await V.list(i.unitId);A.value=n,q(n)}finally{I.value=!1}}function P(n,e){var p;const a=((p=e.target.files)==null?void 0:p[0])||null;a&&(x[n]=a)}async function O(n){var a,p;const e=_[n];if(e){C[n]=!0;try{const r=[{id:n,folder_id:e.folder_id,title:e.title||{en:"",ar:""},file:x[n]}],M=ie(i.unitId,r);await V.update(M),delete x[n],await h()}catch(r){console.error(r),alert(((p=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:p.message)||"Update failed")}finally{C[n]=!1}}}async function J(n){confirm("Delete this document?")&&(await V.remove(n),await h())}return z(async()=>{await m(),await h()}),(n,e)=>(c(),G(W,null,{default:H(()=>[l("div",re,[l("div",oe,[e[5]||(e[5]=l("h2",{class:"text-2xl font-bold text-dash-title"},"Unit Documents",-1)),l("a",{href:o.value,class:"px-3 py-1 border rounded text-black"},"Back to Units",8,de)]),l("div",ue,[e[8]||(e[8]=l("h3",{class:"text-lg font-bold mb-3"},"Add Documents",-1)),l("div",ce,[E(T,{type:"document",label:"Folder *",modelValue:u.value.folder_id,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.folder_id=a),options:s.value,unitId:i.unitId,onCreated:g,onRefresh:m},null,8,["modelValue","options","unitId"]),l("div",null,[e[6]||(e[6]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),$(l("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.title.en=a),class:"form-input",type:"text",required:""},null,512),[[D,u.value.title.en]])]),l("div",null,[e[7]||(e[7]=l("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),$(l("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.title.ar=a),class:"form-input",type:"text",required:""},null,512),[[D,u.value.title.ar]])])]),l("div",fe,[l("input",{type:"file",multiple:"",onChange:B},null,32),b.value.length?(c(),f("div",pe,y(b.value.length)+" file(s) selected ",1)):w("",!0)]),l("div",me,[l("button",{disabled:k.value||!R.value,onClick:L,class:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60"},y(k.value?"Uploadingâ€¦":"Upload"),9,ge),U.value?(c(),f("span",_e,y(U.value),1)):w("",!0)])]),l("div",ve,[l("div",{class:"flex items-center justify-between mb-4"},[e[9]||(e[9]=l("h3",{class:"text-lg font-semibold text-gray-800"},"Documents",-1)),l("button",{onClick:h,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),I.value?(c(),f("div",xe,"Loadingâ€¦")):(c(),f("div",be,[(c(!0),f(K,null,Q(A.value,a=>{var p;return c(),f("div",{key:a.id,class:"group rounded-2xl overflow-hidden bg-white border border-gray-200/70 shadow-[0_1px_2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.08)] hover:-translate-y-0.5 transition-all duration-200"},[l("div",ye,[a.file_url&&/\.(jpg|jpeg|png|gif|webp)$/i.test(a.file_url)?(c(),f("img",{key:0,src:a.file_url,class:"absolute inset-0 w-full h-full object-cover",alt:"Document Preview"},null,8,he)):(c(),f("div",we,[e[10]||(e[10]=l("div",{class:"text-4xl"},"ðŸ“„",-1)),l("span",ke,y(a.file_name),1),a.file_url?(c(),f("a",{key:0,href:a.file_url,target:"_blank",class:"mt-2 px-2 py-1 border rounded text-xs hover:bg-gray-100"}," Open ",8,Ue)):w("",!0)]))]),l("div",Ce,[l("div",null,[e[11]||(e[11]=l("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (EN)",-1)),$(l("textarea",{"onUpdate:modelValue":r=>_[a.id].title.en=r,class:"form-input !h-auto min-h-9",rows:"1",onInput:e[3]||(e[3]=r=>N(r))},null,40,Fe),[[D,_[a.id].title.en]])]),l("div",null,[e[12]||(e[12]=l("label",{class:"block text-[11px] text-gray-500 mb-1"},"Title (AR)",-1)),$(l("textarea",{"onUpdate:modelValue":r=>_[a.id].title.ar=r,class:"form-input !h-auto min-h-9",rows:"1",dir:"rtl",onInput:e[4]||(e[4]=r=>N(r))},null,40,$e),[[D,_[a.id].title.ar]])]),E(T,{type:"document",label:"Folder *",modelValue:_[a.id].folder_id,"onUpdate:modelValue":r=>_[a.id].folder_id=r,options:s.value,unitId:i.unitId,onCreated:g,onRefresh:m},null,8,["modelValue","onUpdate:modelValue","options","unitId"]),l("div",De,[e[13]||(e[13]=l("label",{class:"block text-gray-500 mb-1"},"Replace File",-1)),l("input",{type:"file",onChange:r=>P(a.id,r)},null,40,Ve),x!=null&&x[a.id]?(c(),f("p",Ae," Selected: "+y((p=x[a.id])==null?void 0:p.name),1)):w("",!0)]),l("div",Ie,[l("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",onClick:r=>O(a.id),disabled:C[a.id]},y(C[a.id]?"Savingâ€¦":"Save"),9,Se),l("button",{class:"px-3 py-1.5 text-sm rounded-lg border border-red-200 text-red-700 bg-red-50 hover:bg-red-100",onClick:r=>J(a.id)}," Delete ",8,Ne)])])])}),128)),A.value.length?w("",!0):(c(),f("div",je," No documents found. "))]))])])]),_:1}))}},qe=Y(Ee,[["__scopeId","data-v-15681ac8"]]);export{qe as default};
