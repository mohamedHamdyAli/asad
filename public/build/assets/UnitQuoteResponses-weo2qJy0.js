import{m as f,p as _,i as w,A as X,q as Y,c as Z,o,w as j,b as t,j as A,k as T,t as u,f as l,h as D,F as P,s as B,n as S,y as q}from"./app-CpUfYV9e.js";import{_ as ee}from"./AuthenticatedLayout-B3A4OH2E.js";import{U as te}from"./unitQuotes-C7WpZfBd.js";import{V as se}from"./vendors-BJRv4T-z.js";import{U as ne}from"./users-dxFpYc9p.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";function F(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function ae(e){var n;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.data)?e.data.data:[]}function M(e={}){const n=F(e.title),d=F(e.time_line);return{id:e.id,unit_quote_id:e.unit_quote_id,vendor_id:e.vendor_id,user_id:e.user_id,title_en:(n==null?void 0:n.en)??"",title_ar:(n==null?void 0:n.ar)??"",price:e.price??"",time_line_en:(d==null?void 0:d.en)??"",time_line_ar:(d==null?void 0:d.ar)??"",created_at:e.created_at,updated_at:e.updated_at}}const V={list:async()=>{const{data:e}=await f.get("/api/unit-quote-responses");return ae(e).map(M)},show:async e=>{const{data:n}=await f.get(`/api/unit-quote-responses/show/${e}`),d=(n==null?void 0:n.data)??n;return M(d)},create:async e=>{const{data:n}=await f.post("/api/unit-quote-responses/create",e,{headers:{"Content-Type":"multipart/form-data"}});return n},update:async(e,n)=>{const{data:d}=await f.post(`/api/unit-quote-responses/update/${e}`,n,{headers:{"Content-Type":"multipart/form-data"}});return d},remove:async e=>{const{data:n}=await f.delete(`/api/unit-quote-responses/delete/${e}`);return n}};function re(e={}){var d,y;const n=new FormData;return n.append("data[unit_quote_id]",e.unit_quote_id??""),n.append("data[vendor_id]",e.vendor_id??""),n.append("data[user_id]",e.user_id??""),n.append("data[title][en]",((d=e.title)==null?void 0:d.en)??""),n.append("data[title][ar]",((y=e.title)==null?void 0:y.ar)??""),e.price!==void 0&&n.append("data[price]",e.price),e.time_line&&(n.append("data[time_line][en]",e.time_line.en??""),n.append("data[time_line][ar]",e.time_line.ar??"")),n}function oe(e={}){const n=new FormData;return e.unit_quote_id!==void 0&&n.append("data[unit_quote_id]",e.unit_quote_id),e.vendor_id!==void 0&&n.append("data[vendor_id]",e.vendor_id),e.user_id!==void 0&&n.append("data[user_id]",e.user_id),e.title&&(n.append("data[title][en]",e.title.en??""),n.append("data[title][ar]",e.title.ar??"")),e.price!==void 0&&n.append("data[price]",e.price),e.time_line&&(n.append("data[time_line][en]",e.time_line.en??""),n.append("data[time_line][ar]",e.time_line.ar??"")),n}const de={list:async()=>{const{data:e}=await f.get("/api/type-of-buildings");return e.data||e}},le={list:async()=>{const{data:e}=await f.get("/api/type-of-prices");return e.data||e}},ue={class:"p-6 space-y-8"},pe={class:"flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"},ce={class:"text-sm text-gray-500"},_e={class:"bg-white p-6 rounded-2xl shadow"},fe={key:0,class:"text-sm text-gray-500"},ye={key:1,class:"text-center text-gray-500 py-6"},me={key:2,class:"overflow-x-auto"},xe={class:"min-w-full border border-gray-200 text-sm"},ve={class:"py-2 px-3 font-medium"},ge={class:"py-2 px-3"},he={class:"font-medium text-gray-900"},be={class:"text-xs text-gray-500 mt-0.5"},we={class:"py-2 px-3"},ke={class:"py-2 px-3 text-gray-700"},Ce={class:"py-2 px-3 text-gray-700"},Ue={class:"py-2 px-3 text-gray-700"},Ae={class:"py-2 px-3"},Pe=["onUpdate:modelValue","disabled"],Ve=["value"],Re={class:"py-2 px-3"},$e=["onUpdate:modelValue","disabled"],Qe={class:"py-2 px-3"},Te=["onUpdate:modelValue","disabled"],De={class:"py-2 px-3"},Be=["href"],Se=["src"],Le={key:1,class:"text-gray-400"},Fe={class:"py-2 px-3"},Me={class:"py-2 px-3 text-center space-x-1"},Ne=["onClick"],Oe=["onClick"],Ee=["onClick"],Ie=["onClick"],ze={key:0,class:"flex justify-between items-center mt-6 text-sm"},Je={class:"text-gray-600"},Ge={class:"space-x-2"},He=["disabled"],Ke=["onClick"],We=["disabled"],Xe={__name:"UnitQuoteResponses",setup(e){const n=_([]),d=_([]),y=_([]),R=_([]),$=_([]),k=_(""),Q=_(!1),p=_(1),m=_(7),x=w(()=>{const i=k.value.toLowerCase();return n.value.filter(r=>r.title.toLowerCase().includes(i)||r.user_name&&r.user_name.toLowerCase().includes(i)).sort((r,s)=>s.id-r.id)}),v=w(()=>Math.ceil(x.value.length/m.value)),N=w(()=>(p.value-1)*m.value+1),O=w(()=>Math.min(p.value*m.value,x.value.length)),L=w(()=>{const i=(p.value-1)*m.value;return x.value.slice(i,i+m.value)});X(k,()=>p.value=1);async function g(){Q.value=!0;try{const[i,r,s,h,C,U]=await Promise.all([te.list(),V.list(),ne.list(),se.list(),de.list(),le.list()]);n.value=i.map(b=>{const c=r.find(a=>a.unit_quote_id===b.id);return{...b,has_response:!!c,editing:!1,response:c?{id:c.id,vendor_id:c.vendor_id,user_id:c.user_id,price:c.price,time_line:c.time_line_en||""}:{vendor_id:"",user_id:"",price:"",time_line:""}}}),d.value=s,y.value=h,R.value=C,$.value=U}finally{Q.value=!1}}function E(i){i.editing=!0}async function I(i){const r=re({unit_quote_id:i.id,vendor_id:i.response.vendor_id,user_id:i.response.user_id,title:{en:i.title,ar:i.title},price:i.response.price,time_line:{en:i.response.time_line,ar:i.response.time_line}});await V.create(r),await g()}async function z(i){const r=oe({unit_quote_id:i.id,vendor_id:i.response.vendor_id,user_id:i.response.user_id,title:{en:i.title,ar:i.title},price:i.response.price,time_line:{en:i.response.time_line,ar:i.response.time_line}});await V.update(i.response.id,r),i.editing=!1,await g()}async function J(i){confirm("Delete this response?")&&(await V.remove(i.response.id),await g())}function G(i){return i?new Date(i).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function H(i){i>=1&&i<=v.value&&(p.value=i)}function K(){p.value<v.value&&p.value++}function W(){p.value>1&&p.value--}return Y(g),(i,r)=>(o(),Z(ee,null,{default:j(()=>[t("div",ue,[t("div",{class:"flex items-center justify-between"},[r[1]||(r[1]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Quote Responses",-1)),t("button",{onClick:g,class:"px-3 py-1.5 border rounded-lg text-sm hover:bg-gray-50"}," Refresh ")]),t("div",pe,[A(t("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>k.value=s),type:"text",placeholder:"Search quotes by title or user…",class:"form-input w-1/2"},null,512),[[T,k.value]]),t("span",ce,u(x.value.length)+" quote(s) found ",1)]),t("div",_e,[r[4]||(r[4]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"}," Quotes & Responses ",-1)),Q.value?(o(),l("div",fe,"Loading…")):L.value.length?(o(),l("div",me,[t("table",xe,[r[3]||(r[3]=t("thead",{class:"bg-gray-100 text-gray-700"},[t("tr",null,[t("th",{class:"py-2 px-3 text-left"}),t("th",{class:"py-2 px-3 text-left"},"Title"),t("th",{class:"py-2 px-3 text-left"},"Other Title"),t("th",{class:"py-2 px-3 text-left"},"Building Type"),t("th",{class:"py-2 px-3 text-left"},"Price Type"),t("th",{class:"py-2 px-3 text-left"},"User"),t("th",{class:"py-2 px-3 text-left"},"Vendor"),t("th",{class:"py-2 px-3 text-left"},"Price"),t("th",{class:"py-2 px-3 text-left"},"Timeline"),t("th",{class:"py-2 px-3 text-left"},"Payment"),t("th",{class:"py-2 px-3 text-left"},"Status"),t("th",{class:"py-2 px-3 text-center"},"Actions")])],-1)),t("tbody",null,[(o(!0),l(P,null,B(L.value,s=>{var h,C,U,b,c;return o(),l("tr",{key:s.id,class:S(["border-t hover:bg-gray-50 transition",{"bg-blue-50/40":s.editing}])},[t("td",ve,u(s.id),1),t("td",ge,[t("div",he,u(s.title),1),t("div",be,u(G(s.created_at)),1)]),t("td",we,u(s.other_title||"—"),1),t("td",ke,u(((h=R.value.find(a=>a.id===s.type_of_building_id))==null?void 0:h.name)||((C=R.value.find(a=>a.id===s.type_of_building_id))==null?void 0:C.title)||"—"),1),t("td",Ce,u(((U=$.value.find(a=>a.id===s.type_of_price_id))==null?void 0:U.name)||((b=$.value.find(a=>a.id===s.type_of_price_id))==null?void 0:b.title)||"—"),1),t("td",Ue,u(((c=d.value.find(a=>a.id===s.user_id))==null?void 0:c.name)||`User ${s.user_id}`),1),t("td",Ae,[A(t("select",{"onUpdate:modelValue":a=>s.response.vendor_id=a,class:"form-input",disabled:!s.editing&&s.has_response},[r[2]||(r[2]=t("option",{value:"",disabled:""},"Select Vendor",-1)),(o(!0),l(P,null,B(y.value,a=>(o(),l("option",{key:a.id,value:a.id},u(a.name),9,Ve))),128))],8,Pe),[[q,s.response.vendor_id]])]),t("td",Re,[A(t("input",{"onUpdate:modelValue":a=>s.response.price=a,type:"number",class:"form-input",disabled:!s.editing&&s.has_response},null,8,$e),[[T,s.response.price,void 0,{number:!0}]])]),t("td",Qe,[A(t("input",{"onUpdate:modelValue":a=>s.response.time_line=a,type:"text",class:"form-input",disabled:!s.editing&&s.has_response},null,8,Te),[[T,s.response.time_line]])]),t("td",De,[s.pay_image?(o(),l("a",{key:0,href:`/storage/${s.pay_image}`,target:"_blank",class:"text-blue-600 hover:underline"},[t("img",{src:`/storage/${s.pay_image}`,alt:"Preview",class:"h-10 w-10 object-cover rounded shadow-sm"},null,8,Se)],8,Be)):(o(),l("span",Le,"—"))]),t("td",Fe,[t("span",{class:S(["px-2 py-0.5 rounded-full text-xs border",s.has_response?"bg-green-100 text-green-700 border-green-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},u(s.has_response?"Responded":"Pending"),3)]),t("td",Me,[s.has_response?(o(),l(P,{key:1},[s.editing?D("",!0):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:a=>E(s)}," Edit ",8,Oe)),s.editing?(o(),l("button",{key:1,class:"px-3 py-1 text-xs border rounded-lg text-green-700 border-green-200 hover:bg-green-50",onClick:a=>z(s)}," Update ",8,Ee)):D("",!0),t("button",{class:"px-3 py-1 text-xs border rounded-lg text-red-700 border-red-200 hover:bg-red-50",onClick:a=>J(s)}," Delete ",8,Ie)],64)):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:a=>I(s)}," Save ",8,Ne))])],2)}),128))])]),v.value>1?(o(),l("div",ze,[t("span",Je," Showing "+u(N.value)+"–"+u(O.value)+" of "+u(x.value.length),1),t("div",Ge,[t("button",{onClick:W,disabled:p.value===1,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Prev ",8,He),(o(!0),l(P,null,B(v.value,s=>(o(),l("button",{key:s,onClick:h=>H(s),class:S(["px-3 py-1 border rounded-lg",s===p.value?"bg-blue-600 text-white":"hover:bg-gray-50"])},u(s),11,Ke))),128)),t("button",{onClick:K,disabled:p.value===v.value,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Next ",8,We)])])):D("",!0)])):(o(),l("div",ye," No quotes found. "))])])]),_:1}))}},st=ie(Xe,[["__scopeId","data-v-efc87960"]]);export{st as default};
