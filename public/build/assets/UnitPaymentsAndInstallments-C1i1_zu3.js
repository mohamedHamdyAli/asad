import{p as v,C as ot,c as j,o as n,b as t,t as x,a as d,w as E,f as b,h as I,u as i,O as tt,z as it,m as V,q as rt,F as et,s as st,e as F,n as z,T as xt,d as yt,j as R,k as lt,y as nt}from"./app-T0LQ4Oxa.js";import{_ as gt}from"./AuthenticatedLayout-BxpqaVNf.js";import{_ as ft}from"./UnitNav-BIzs7DlU.js";import{U as B,b as _t,a as wt}from"./unitPayments-B0Pje3h9.js";import{b as ht,U as J,a as kt}from"./unitInstallments-BCBORk_J.js";import{c as G,b as A,f as H,d as h,E as D,F as dt}from"./index.esm-BOvK6yvX.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $t={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},It={class:"bg-white rounded-xl shadow-xl w-full max-w-xl relative overflow-hidden max-h-[85vh] animate-fadeIn"},Ct={class:"sticky top-0 bg-white z-10 px-6 pt-5 pb-3 border-b"},Pt={class:"text-lg font-semibold"},At={class:"px-6 py-4 overflow-y-auto max-h-[calc(85vh-120px)]"},St={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mt={class:"md:col-span-2"},Dt={class:"md:col-span-2"},Nt={key:0,class:"md:col-span-2"},Tt={class:"sticky bottom-0 bg-white pt-4 mt-6 border-t flex justify-end gap-3"},qt=["disabled"],jt={__name:"InstallmentModal",props:{mode:String,data:Object,paymentId:[String,Number]},emits:["close","saved"],setup(y,{emit:u}){var T,L,U,g,k,p,M,w,C;const{show:f}=it(),a=y,r=u,_=v(!1),N=G({title:G({en:A().required("Title (EN) is required"),ar:A().required("Title (AR) is required")}),description:G({en:A().nullable(),ar:A().nullable()}),amount:H().typeError("Amount must be a number").required("Amount is required").min(0,"Amount must be >= 0"),percentage:H().nullable().min(0,"Min 0").max(100,"Max 100").typeError("Percentage must be a number"),milestone_date:A().nullable(),submission_date:A().nullable(),consultant_approval_date:A().nullable(),due_date:A().nullable(),status:A().nullable().when([],{is:()=>a.mode==="edit",then:o=>o.required("Status is required"),otherwise:o=>o.notRequired()})});function $(o,l){if(!o)return l;if(typeof o=="string")try{return JSON.parse(o)}catch{return l}return o}const S=v({title:$((T=a.data)==null?void 0:T.title,{en:"",ar:""}),description:$((L=a.data)==null?void 0:L.description,{en:"",ar:""}),amount:((U=a.data)==null?void 0:U.amount)??"",percentage:((g=a.data)==null?void 0:g.percentage)??"",milestone_date:((k=a.data)==null?void 0:k.milestone_date)??"",submission_date:((p=a.data)==null?void 0:p.submission_date)??"",consultant_approval_date:((M=a.data)==null?void 0:M.consultant_approval_date)??"",due_date:((w=a.data)==null?void 0:w.due_date)??"",...a.mode==="edit"?{status:((C=a.data)==null?void 0:C.status)??"pending"}:{}});ot(()=>a.data,o=>{o&&(S.value={title:$(o.title,{en:"",ar:""}),description:$(o.description,{en:"",ar:""}),amount:o.amount??"",percentage:o.percentage??"",milestone_date:o.milestone_date??"",submission_date:o.submission_date??"",consultant_approval_date:o.consultant_approval_date??"",due_date:o.due_date??"",...a.mode==="edit"?{status:o.status??"pending"}:{}})},{immediate:!0});async function q(o){_.value=!0;try{if(a.mode==="add"){const{status:l,...P}=o,K=ht(a.paymentId,P);await J.create(K)}else{const l={...o,unit_payment_id:a.paymentId},P=kt(l);await J.update(a.data.id,P)}r("saved"),r("close")}catch(l){console.error(l),f(l),alert("Failed to save installment")}finally{_.value=!1}}return(o,l)=>(n(),j(tt,{to:"body"},[t("div",$t,[t("div",It,[t("button",{onClick:l[0]||(l[0]=P=>o.$emit("close")),class:"absolute top-3 right-4 text-gray-500 hover:text-black z-20"}," ✕ "),t("div",Ct,[t("h3",Pt,x(y.mode==="add"?"Add Installment":"Edit Installment"),1)]),t("div",At,[d(i(dt),{onSubmit:q,"initial-values":S.value,"validation-schema":i(N)},{default:E(()=>[t("div",St,[t("div",null,[l[2]||(l[2]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (EN) *",-1)),d(i(h),{name:"title.en",as:"input",class:"form-input"}),d(i(D),{name:"title.en",class:"text-red-600 text-xs mt-1"})]),t("div",null,[l[3]||(l[3]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Title (AR) *",-1)),d(i(h),{name:"title.ar",as:"input",class:"form-input",dir:"rtl"}),d(i(D),{name:"title.ar",class:"text-red-600 text-xs mt-1"})]),t("div",Mt,[l[4]||(l[4]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (EN)",-1)),d(i(h),{name:"description.en",as:"textarea",rows:"2",class:"form-input"}),d(i(D),{name:"description.en",class:"text-red-600 text-xs mt-1"})]),t("div",Dt,[l[5]||(l[5]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Description (AR)",-1)),d(i(h),{name:"description.ar",as:"textarea",rows:"2",class:"form-input",dir:"rtl"}),d(i(D),{name:"description.ar",class:"text-red-600 text-xs mt-1"})]),t("div",null,[l[6]||(l[6]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Amount *",-1)),d(i(h),{name:"amount",as:"input",type:"number",class:"form-input"}),d(i(D),{name:"amount",class:"text-red-600 text-xs mt-1"})]),t("div",null,[l[7]||(l[7]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Percentage",-1)),d(i(h),{name:"percentage",as:"input",type:"number",class:"form-input"}),d(i(D),{name:"percentage",class:"text-red-600 text-xs mt-1"})]),t("div",null,[l[8]||(l[8]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Milestone Date",-1)),d(i(h),{name:"milestone_date",as:"input",type:"date",class:"form-input"})]),t("div",null,[l[9]||(l[9]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Submission Date",-1)),d(i(h),{name:"submission_date",as:"input",type:"date",class:"form-input"})]),t("div",null,[l[10]||(l[10]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Consultant Approval Date",-1)),d(i(h),{name:"consultant_approval_date",as:"input",type:"date",class:"form-input"})]),t("div",null,[l[11]||(l[11]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Due Date",-1)),d(i(h),{name:"due_date",as:"input",type:"date",class:"form-input"})]),a.mode==="edit"?(n(),b("div",Nt,[l[13]||(l[13]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Status",-1)),d(i(h),{name:"status",as:"select",class:"form-input"},{default:E(()=>l[12]||(l[12]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"paid"},"Paid",-1),t("option",{value:"partial"},"Partial",-1),t("option",{value:"unpaid"},"Unpaid",-1),t("option",{value:"overdue"},"Overdue",-1)])),_:1})])):I("",!0)]),t("div",Tt,[t("button",{class:"px-4 py-2 border rounded hover:bg-gray-100",onClick:l[1]||(l[1]=P=>o.$emit("close")),type:"button"}," Cancel "),t("button",{class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",type:"submit",disabled:_.value},x(_.value?"Saving…":"Save"),9,qt)])]),_:1},8,["initial-values","validation-schema"])])])])]))}},Ut=ut(jt,[["__scopeId","data-v-077528a4"]]),Z={list:async y=>{const{data:u}=await V.get(`/api/unit-payments/installments/${y}/invoices`);return Array.isArray(u)?u:(u==null?void 0:u.data)??[]},updateStatus:async(y,u)=>{const{data:f}=await V.post(`/api/unit-payments/installments/${y}/status`,{status:u});return f},confirmInvoice:async(y,u)=>{const{data:f}=await V.post("/api/unit-payments/invoices/confirm",{invoice_id:y,action:u});return f}},Et={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},Lt={class:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 relative animate-fadeIn max-h-[90vh] overflow-y-auto"},Ft={key:0,class:"text-sm text-gray-500"},Vt={key:1},zt={class:"flex justify-between items-start"},Ot={class:"font-semibold text-gray-800"},Rt={class:"text-blue-600"},Bt={class:"mt-2"},Gt={class:"mt-3"},Jt=["src","onClick"],Ht={class:"flex flex-col gap-2"},Kt=["onClick","disabled"],Qt=["onClick","disabled"],Wt={key:0,class:"text-center text-gray-500 text-sm mt-6"},Xt={class:"bg-white rounded-xl shadow-2xl p-4 w-full max-w-lg"},Yt=["src"],Zt={__name:"InvoiceModal",props:{installment:Object},emits:["close"],setup(y,{emit:u}){const f=y,a=v([]),r=v(!1),_=v(""),N=v(""),$=v(!1),S=v(null);rt(async()=>{r.value=!0,a.value=await Z.list(f.installment.id),r.value=!1});async function q(g,k){var p,M;if(_.value="",N.value="",!!confirm(`Mark invoice #${g.id} as ${k}?`))try{const w=await Z.confirmInvoice(g.id,k);(w==null?void 0:w.status)==="error"?(N.value="error",_.value=w.message||"Action failed."):(w==null?void 0:w.status)==="success"&&(N.value="success",_.value=w.message||"Action successful."),a.value=await Z.list(f.installment.id),setTimeout(()=>_.value="",4e3)}catch(w){N.value="error",_.value=((M=(p=w.response)==null?void 0:p.data)==null?void 0:M.message)||"Something went wrong.",setTimeout(()=>_.value="",4e3)}}function T(g){return g?`/storage/${g}`:""}function L(g){S.value=g,$.value=!0}function U(){S.value=null,$.value=!1}return(g,k)=>(n(),j(tt,{to:"body"},[t("div",Et,[t("div",Lt,[t("button",{onClick:k[0]||(k[0]=p=>g.$emit("close")),class:"absolute top-3 right-4 text-gray-400 hover:text-gray-700 text-xl"}," ✕ "),k[2]||(k[2]=t("h3",{class:"text-2xl font-semibold text-gray-800 mb-6 border-b pb-2"}," Invoices ",-1)),r.value?(n(),b("div",Ft,"Loading...")):(n(),b("div",Vt,[(n(!0),b(et,null,st(a.value,p=>(n(),b("div",{key:p.id,class:"p-4 mb-3 border rounded-xl hover:shadow transition bg-gray-50"},[t("div",zt,[t("div",null,[t("p",Ot,[F(" Invoice #"+x(p.id)+" — ",1),t("span",Rt,x(p.paid_amount)+" EGP",1)]),t("div",Bt,[t("span",{class:z(["inline-block px-3 py-1 text-xs rounded-full font-medium border",p.status==="confirmed"?"bg-green-100 text-green-700 border-green-200":p.status==="rejected"?"bg-red-100 text-red-700 border-red-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},x(p.status?p.status.toUpperCase():"PENDING"),3)]),t("div",Gt,[t("img",{src:T(p.invoice_file),alt:"Invoice File",class:"rounded-lg shadow-sm border object-contain max-h-40 cursor-pointer hover:scale-105 transition",onClick:M=>L(p.invoice_file)},null,8,Jt)])]),t("div",Ht,[t("button",{onClick:M=>q(p,"confirm"),class:z(["px-4 py-1.5 rounded-lg text-sm font-medium text-white transition",p.status==="confirmed"?"bg-green-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"]),disabled:p.status==="confirmed"},x(p.status==="confirmed"?"Approved":"Approve"),11,Kt),t("button",{onClick:M=>q(p,"reject"),class:"px-4 py-1.5 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition",disabled:p.status==="rejected"},x(p.status==="rejected"?"Rejected":"Reject"),9,Qt)])])]))),128)),a.value.length?I("",!0):(n(),b("div",Wt," No invoices found. "))])),d(xt,{name:"fade"},{default:E(()=>[_.value?(n(),b("div",{key:0,class:z(["mt-5 p-3 rounded-lg text-sm font-medium border text-center",N.value==="error"?"bg-red-50 text-red-700 border-red-200":"bg-green-50 text-green-700 border-green-200"])},x(_.value),3)):I("",!0)]),_:1}),$.value?(n(),b("div",{key:2,class:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100]",onClick:yt(U,["self"])},[t("div",Xt,[t("div",{class:"flex justify-between items-center mb-2"},[k[1]||(k[1]=t("h4",{class:"font-semibold text-gray-700 text-lg"},"Invoice Preview",-1)),t("button",{onClick:U,class:"text-gray-500 hover:text-gray-700 text-xl"}," ✕ ")]),t("img",{src:T(S.value),alt:"Invoice",class:"rounded-lg object-contain max-h-[75vh] w-full"},null,8,Yt)])])):I("",!0)])])]))}},te=ut(Zt,[["__scopeId","data-v-48c1c86b"]]),ee={class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},se={class:"bg-white w-full max-w-2xl rounded-lg p-6 relative shadow-xl animate-fadeIn"},ae={key:0,class:"text-center text-gray-500 py-8"},le={key:1,class:"divide-y divide-gray-200 max-h-96 overflow-y-auto"},ne={class:"flex justify-between items-center"},oe={class:"font-medium text-gray-800"},ie={class:"text-sm text-gray-600 mt-1"},re={class:"text-sm text-gray-500"},de={class:"text-xs text-gray-400"},ue={key:0,class:"text-sm text-gray-600 mt-1"},me={__name:"PaymentLogsModal",props:{logs:{type:Array,default:()=>[]}},setup(y){return(u,f)=>(n(),j(tt,{to:"body"},[t("div",ee,[t("div",se,[t("button",{onClick:f[0]||(f[0]=a=>u.$emit("close")),class:"absolute right-4 top-3 text-gray-500 hover:text-black"},"✕"),f[1]||(f[1]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-800"},"Payment Logs",-1)),y.logs.length?(n(),b("ul",le,[(n(!0),b(et,null,st(y.logs,a=>(n(),b("li",{key:a.id,class:"py-3"},[t("div",ne,[t("div",null,[t("p",oe,x(a.action||"Action"),1),t("p",ie,x(a.description||"Description"),1),t("p",re,"By: "+x(a.created_by_name||"System Admin"),1)]),t("span",de,x(new Date(a.created_at).toLocaleString()),1)]),a.notes?(n(),b("p",ue,x(a.notes),1)):I("",!0)]))),128))])):(n(),b("div",ae,"No logs found."))])])]))}},ce={unitLogs:async y=>{const{data:u}=await V.get(`/api/unit-payments/logs/${y}`);return(u==null?void 0:u.data)??[]},installmentLogs:async y=>{const{data:u}=await V.get(`/api/unit-payments/installment/${y}/logs`);return(u==null?void 0:u.data)??[]}},pe={class:"container mx-auto p-6"},be={class:"flex border-b mb-6 mt-6 items-center"},ve={key:0,class:"p-6 rounded shadow mt-6"},xe={key:0,class:"text-sm text-gray-500"},ye={key:1,class:"text-center text-gray-500 py-6"},ge={key:2,class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},fe={key:1,class:"bg-white p-6 rounded shadow mt-6"},_e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},we={class:"mt-4 text-right"},he=["disabled"],ke={key:1,class:"space-y-6"},$e={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},Ie={class:"flex justify-end gap-2"},Ce={key:2,class:"space-y-4"},Pe={class:"flex justify-between items-center mb-4"},Ae=["disabled"],Se={key:0,class:"bg-white rounded-xl shadow-sm p-4"},Me={class:"min-w-full text-sm text-left border"},De={class:"p-2 border"},Ne={class:"p-2 border"},Te={class:"p-2 border"},qe={class:"p-2 border"},je={class:"p-2 border"},Ue={class:"p-2 border text-center"},Ee=["onClick"],Le={class:"p-2 border flex gap-2"},Fe=["onClick"],Ve=["onClick"],ze=["onClick"],Oe={key:0,class:"text-center py-4 text-gray-500"},We={__name:"UnitPaymentsAndInstallments",props:{unitId:Number},setup(y){const{show:u}=it(),f=y,a=v("payments"),r=v(null),_=v({total_price:"",installments_count:"",payment_type:"installments",overall_status:"pending"}),N=G({total_price:H().typeError("Total price is required").required("Total price is required").positive("Total price must be greater than 0"),installments_count:H().typeError("Installments count is required").required("Installments count is required").integer("Installments count must be an integer").min(1,"At least 1 installment is required"),payment_type:A().required("Payment type is required"),overall_status:A().required("Overall status is required")}),$=v(!1),S=v(!1),q=v(!1),T=v([]);function L(m){r.value={...m,editable:{...m}}}async function U(m){q.value=!0;try{const s=await ce.installmentLogs(m);T.value=s}catch{T.value=[],u(e),console.log("No logs found")}}async function g(){var m;S.value=!0;try{const s=await B.list(f.unitId);if(((m=s==null?void 0:s.data)==null?void 0:m.length)>0||(s==null?void 0:s.length)>0){const c=s.data?s.data[0]:s[0];L(c),C.value=c.id}else r.value=null,C.value=null;a.value==="installments"&&await P()}catch(s){u(s)}finally{S.value=!1}}async function k(m){try{$.value=!0;const s=_t(f.unitId,[m]);await B.create(s),await g()}catch(s){u(s)}finally{$.value=!1}}async function p(){try{if(!r.value)return;const m=wt(r.value.editable);await B.update(r.value.id,m),await g()}catch(m){u(m)}}async function M(m){confirm("Delete this payment?")&&(await B.remove(m),await g())}function w(m){const s=Number(m);return isNaN(s)?"0.00":s.toFixed(2)}const C=v(null),o=v([]),l=v(!1);async function P(){if(C.value){l.value=!0;try{o.value=await J.list(C.value)}finally{l.value=!1}}}async function K(m){confirm("Delete this installment?")&&(await J.remove(m),await g(),await P())}const O=v(!1),Q=v("add"),W=v(null);function mt(){Q.value="add",W.value=null,O.value=!0}function ct(m){Q.value="edit",W.value={...m,unit_payment_id:C.value},O.value=!0}function pt(){O.value=!1}const X=v(!1),at=v(null);function bt(m){at.value=m,X.value=!0}function vt(){X.value=!1}return rt(g),ot(a,async m=>{m==="installments"&&C.value&&await P()}),(m,s)=>(n(),j(gt,null,{default:E(()=>[t("div",pe,[d(ft,{"unit-id":Number(y.unitId),cols:2},null,8,["unit-id"]),t("div",be,[t("button",{class:z([a.value==="payments"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600","px-4 py-2 font-medium"]),onClick:s[0]||(s[0]=c=>a.value="payments")}," Payments ",2),t("button",{class:z([a.value==="installments"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600","px-4 py-2 font-medium"]),onClick:s[1]||(s[1]=c=>a.value="installments")}," Installments ",2)]),a.value==="payments"?(n(),b("div",ve,[s[12]||(s[12]=t("div",{class:"flex justify-between items-center mb-4"},[t("h3",{class:"text-lg font-semibold text-gray-800"},"Payment")],-1)),s[13]||(s[13]=t("h3",{class:"text-lg font-semibold mb-3"},"Current Payment",-1)),S.value?(n(),b("div",xe,"Loading…")):r.value?(n(),b("div",ge,[t("div",null,[s[8]||(s[8]=t("strong",null,"Total Price:",-1)),F(" "+x(w(r.value.total_price)),1)]),t("div",null,[s[9]||(s[9]=t("strong",null,"Installments:",-1)),F(" "+x(r.value.installments_count),1)]),t("div",null,[s[10]||(s[10]=t("strong",null,"Type:",-1)),F(" "+x(r.value.payment_type),1)]),t("div",null,[s[11]||(s[11]=t("strong",null,"Status:",-1)),F(" "+x(r.value.overall_status),1)])])):(n(),b("div",ye," No payment created yet. "))])):I("",!0),a.value==="payments"?(n(),b("div",fe,[s[27]||(s[27]=t("h3",{class:"text-lg font-semibold mb-4"},"Unit Payment",-1)),r.value?(n(),b("div",ke,[t("div",$e,[t("div",null,[s[21]||(s[21]=t("label",{class:"block text-gray-600 text-xs mb-1"},"Total Price",-1)),R(t("input",{"onUpdate:modelValue":s[2]||(s[2]=c=>r.value.editable.total_price=c),type:"number",class:"w-full border p-2 rounded"},null,512),[[lt,r.value.editable.total_price,void 0,{number:!0}]])]),t("div",null,[s[22]||(s[22]=t("label",{class:"block text-gray-600 text-xs mb-1"},"Installments Count",-1)),R(t("input",{"onUpdate:modelValue":s[3]||(s[3]=c=>r.value.editable.installments_count=c),type:"number",class:"w-full border p-2 rounded"},null,512),[[lt,r.value.editable.installments_count,void 0,{number:!0}]])]),t("div",null,[s[24]||(s[24]=t("label",{class:"block text-gray-600 text-xs mb-1"},"Type",-1)),R(t("select",{"onUpdate:modelValue":s[4]||(s[4]=c=>r.value.editable.payment_type=c),class:"w-full border p-2 rounded"},s[23]||(s[23]=[t("option",{value:"installments"},"Installments",-1),t("option",{value:"cash"},"Cash",-1)]),512),[[nt,r.value.editable.payment_type]])]),t("div",null,[s[26]||(s[26]=t("label",{class:"block text-gray-600 text-xs mb-1"},"Status",-1)),R(t("select",{"onUpdate:modelValue":s[5]||(s[5]=c=>r.value.editable.overall_status=c),class:"w-full border p-2 rounded"},s[25]||(s[25]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"in_progress"},"In Progress",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"overdue"},"Overdue",-1)]),512),[[nt,r.value.editable.overall_status]])])]),t("div",Ie,[t("button",{onClick:p,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"}," Save Changes "),t("button",{onClick:s[6]||(s[6]=c=>M(r.value.id)),class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"}," Delete ")])])):(n(),j(i(dt),{key:0,"validation-schema":i(N),"initial-values":_.value,onSubmit:k},{default:E(({submitCount:c})=>[s[20]||(s[20]=t("p",{class:"text-gray-600 mb-4"}," No payment created yet for this unit. ",-1)),t("div",_e,[t("div",null,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"Total Price *",-1)),d(i(h),{name:"total_price",type:"number",class:"form-control w-full border p-2 rounded"}),d(i(D),{name:"total_price",class:"text-red-600 text-xs mt-1"})]),t("div",null,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"Installments Count *",-1)),d(i(h),{name:"installments_count",type:"number",class:"form-control w-full border p-2 rounded"}),d(i(D),{name:"installments_count",class:"text-red-600 text-xs mt-1"})]),t("div",null,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"Payment Type *",-1)),d(i(h),{name:"payment_type",as:"select",class:"form-control w-full border p-2 rounded"},{default:E(()=>s[16]||(s[16]=[t("option",{value:"installments"},"Installments",-1),t("option",{value:"cash"},"Cash",-1)])),_:1}),d(i(D),{name:"payment_type",class:"text-red-600 text-xs mt-1"})]),t("div",null,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium mb-1"},"Overall Status *",-1)),d(i(h),{name:"overall_status",as:"select",class:"form-control w-full border p-2 rounded"},{default:E(()=>s[18]||(s[18]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"in_progress"},"In Progress",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"overdue"},"Overdue",-1)])),_:1}),d(i(D),{name:"overall_status",class:"text-red-600 text-xs mt-1"})])]),t("div",we,[t("button",{type:"submit",disabled:$.value,class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50"},x($.value?"Saving…":"Create Payment"),9,he)])]),_:1},8,["validation-schema","initial-values"]))])):I("",!0),a.value==="installments"?(n(),b("div",Ce,[t("div",Pe,[s[28]||(s[28]=t("h3",{class:"text-lg font-semibold text-gray-800"},"Installments",-1)),t("button",{disabled:!r.value,onClick:mt,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"}," + Add Installment ",8,Ae)]),C.value?(n(),b("div",Se,[t("div",{class:"flex justify-between items-center mb-3"},[s[29]||(s[29]=t("h3",{class:"font-semibold text-lg text-gray-800"},"Installments",-1)),t("button",{onClick:P,class:"px-3 py-1 text-sm border rounded-lg hover:bg-gray-50"}," Refresh ")]),t("table",Me,[s[31]||(s[31]=t("thead",{class:"bg-gray-50 text-gray-700 uppercase text-xs"},[t("tr",null,[t("th",{class:"p-2 border"},"Title"),t("th",{class:"p-2 border"},"Amount"),t("th",{class:"p-2 border"},"Percentage"),t("th",{class:"p-2 border"},"Status"),t("th",{class:"p-2 border"},"Due Date"),t("th",{class:"p-2 border"},"Invoices"),t("th",{class:"p-2 border"},"Actions")])],-1)),t("tbody",null,[(n(!0),b(et,null,st(o.value,c=>(n(),b("tr",{key:c.id,class:"hover:bg-gray-50 transition"},[t("td",De,x(c.title.en),1),t("td",Ne,x(c.amount),1),t("td",Te,x(c.percentage),1),t("td",qe,x(c.status),1),t("td",je,x(c.due_date||"-"),1),t("td",Ue,[t("button",{onClick:Y=>bt(c),class:"text-blue-600 underline text-xs hover:text-blue-800"}," View ",8,Ee)]),t("td",Le,[t("button",{onClick:Y=>ct(c),class:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700"}," Edit ",8,Fe),t("button",{onClick:Y=>K(c.id),class:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700"}," Delete ",8,Ve),t("button",{onClick:Y=>U(c.id),class:"px-3 py-1 text-xs border rounded text-gray-700 border-gray-200 hover:bg-gray-50 flex items-center gap-1"},s[30]||(s[30]=[t("i",{class:"fa fa-clock text-blue-500"},null,-1),F(" Logs ")]),8,ze)])]))),128))])]),o.value.length?I("",!0):(n(),b("div",Oe," No installments found. "))])):I("",!0)])):I("",!0)]),O.value?(n(),j(Ut,{key:0,mode:Q.value,data:W.value,paymentId:C.value,onClose:pt,onSaved:P},null,8,["mode","data","paymentId"])):I("",!0),X.value?(n(),j(te,{key:1,installment:at.value,onClose:vt},null,8,["installment"])):I("",!0),q.value?(n(),j(me,{key:2,logs:T.value,onClose:s[7]||(s[7]=c=>q.value=!1)},null,8,["logs"])):I("",!0)]),_:1}))}};export{We as default};
