import{k as y,l as u,z as j,p as L,f as d,o as c,h as x,b as r,t as m,F as D,q as M,j as C,s as A}from"./app-BJ7Yrijg.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";function z(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function F(e={}){const a=z(e.name),n=a&&typeof a=="object"?a:{en:a??"",ar:a??""};return{id:e.id,file_type:e.file_type,name_en:n.en??"",name_ar:n.ar??"",label:n.en||n.ar||`Folder #${e.id}`,folder_image:e.folder_image?`/storage/${e.folder_image}`:null}}function B(e){var a;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.message)?e.message:Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)?e.data.data:[]}const N={list:async e=>{const{data:a}=await y.get(`/api/folder/${e}`);return B(a).map(F)},create:async e=>{const{data:a}=await y.post("/api/folder/create",e,{headers:{"Content-Type":"multipart/form-data"}}),n=(a==null?void 0:a.data)??a;return F(n)},update:async(e,a)=>{const{data:n}=await y.post(`/api/folder/update/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}});return F((n==null?void 0:n.data)??n)},remove:async e=>{const{data:a}=await y.delete(`/api/folder/delete/${e}`);return a}};function R({file_type:e,name:a={en:"",ar:""},folder_image:n=null}){const i=new FormData;return i.append("file_type",e),i.append("name[en]",a.en??""),i.append("name[ar]",a.ar??""),n&&i.append("folder_image",n),i}const T={class:"space-y-2"},q={key:0,class:"block text-xs text-gray-500"},E={class:"flex gap-2"},I=["disabled","value"],J={value:"",disabled:""},O=["value"],P={key:1,class:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center"},G={class:"bg-white rounded-xl p-4 w-full max-w-md relative"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},K={class:"md:col-span-2"},Q=["src"],W={class:"mt-4 flex justify-end gap-2"},X=["disabled"],Y={key:0,class:"mt-2 text-sm text-red-600"},Z={__name:"FolderPicker",props:{type:{type:String,required:!0},modelValue:{type:[Number,String,null],default:null},label:{type:String,default:"Folder"},options:{type:Array,default:null}},emits:["update:modelValue","created","refresh"],setup(e,{emit:a}){const n=e,i=a,v=u(!1),f=u(n.options??[]);j(()=>n.options,s=>{Array.isArray(s)&&(f.value=s)});async function w(){if(n.options){i("refresh");return}v.value=!0;try{f.value=await N.list(n.type)}finally{v.value=!1}}L(()=>{n.options||w()});const _=u(!1),b=u(!1),p=u(""),o=u({name:{en:"",ar:""},folder_image:null}),g=u(null);function V(s){var l;const t=((l=s.target.files)==null?void 0:l[0])||null;o.value.folder_image=t,g.value=t?URL.createObjectURL(t):null}function k(){_.value=!1,p.value="",o.value={name:{en:"",ar:""},folder_image:null},g.value=null}function S(s){const t=Number(s);return Number.isNaN(t)?null:t}async function $(){var s,t;b.value=!0,p.value="";try{const l=R({file_type:n.type,name:o.value.name,folder_image:o.value.folder_image}),h=await N.create(l);f.value=[h,...f.value],i("created",h),i("update:modelValue",h.id),k()}catch(l){p.value=((t=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Create failed"}finally{b.value=!1}}return(s,t)=>(c(),d("div",T,[e.label?(c(),d("label",q,m(e.label),1)):x("",!0),r("div",E,[r("select",{class:"form-input flex-1",disabled:v.value,value:e.modelValue??"",onChange:t[0]||(t[0]=l=>s.$emit("update:modelValue",S(l.target.value)))},[r("option",J,m(v.value?"Loading folders…":"Select folder"),1),(c(!0),d(D,null,M(f.value,l=>(c(),d("option",{key:l.id,value:l.id},m(l.label)+" ("+m(l.id)+") ",9,O))),128))],40,I),r("button",{type:"button",class:"px-2 py-1 border rounded",onClick:t[1]||(t[1]=l=>_.value=!0)}," + New "),r("button",{type:"button",class:"px-2 py-1 border rounded",onClick:w},"↻")]),_.value?(c(),d("div",P,[r("div",G,[r("button",{class:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",onClick:k},"✕"),t[7]||(t[7]=r("h3",{class:"text-lg font-semibold mb-3"},"Create Folder",-1)),r("div",H,[r("div",null,[t[4]||(t[4]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (EN) *",-1)),C(r("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.name.en=l),type:"text",class:"form-input"},null,512),[[A,o.value.name.en]])]),r("div",null,[t[5]||(t[5]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Name (AR) *",-1)),C(r("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.name.ar=l),type:"text",class:"form-input"},null,512),[[A,o.value.name.ar]])]),r("div",K,[t[6]||(t[6]=r("label",{class:"block text-xs text-gray-500 mb-1"},"Image (optional)",-1)),r("input",{type:"file",accept:"image/*",onChange:V},null,32),g.value?(c(),d("img",{key:0,src:g.value,class:"mt-2 w-24 h-16 object-cover rounded border"},null,8,Q)):x("",!0)])]),r("div",W,[r("button",{class:"px-3 py-1 border rounded",onClick:k},"Cancel"),r("button",{class:"px-3 py-1 bg-green-600 text-white rounded disabled:opacity-60",disabled:b.value||!o.value.name.en.trim()||!o.value.name.ar.trim(),onClick:$},m(b.value?"Saving…":"Create"),9,X)]),p.value?(c(),d("div",Y,m(p.value),1)):x("",!0)])])):x("",!0)]))}},ae=U(Z,[["__scopeId","data-v-80ac9850"]]);export{ae as F,N as a};
