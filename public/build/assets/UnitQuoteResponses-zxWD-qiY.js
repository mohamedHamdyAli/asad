import{m as y,p as c,i as b,A as H,q as K,c as W,o,w as X,b as s,j as U,k as T,t as u,f as l,h as D,F as P,s as B,n as S,y as Y}from"./app-CHzwI3cM.js";import{_ as Z}from"./AuthenticatedLayout-BJaAcZYD.js";import{U as j}from"./unitQuotes-BD2TmZFG.js";import{V as q}from"./vendors-sfoqRA54.js";import{U as ee}from"./users-DtopCllq.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";function F(e){try{return typeof e=="string"?JSON.parse(e):e}catch{return e}}function se(e){var n;return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.data)?e.data.data:[]}function M(e={}){const n=F(e.title),d=F(e.time_line);return{id:e.id,unit_quote_id:e.unit_quote_id,vendor_id:e.vendor_id,user_id:e.user_id,title_en:(n==null?void 0:n.en)??"",title_ar:(n==null?void 0:n.ar)??"",price:e.price??"",time_line_en:(d==null?void 0:d.en)??"",time_line_ar:(d==null?void 0:d.ar)??"",created_at:e.created_at,updated_at:e.updated_at}}const A={list:async()=>{const{data:e}=await y.get("/api/unit-quote-responses");return se(e).map(M)},show:async e=>{const{data:n}=await y.get(`/api/unit-quote-responses/show/${e}`),d=(n==null?void 0:n.data)??n;return M(d)},create:async e=>{const{data:n}=await y.post("/api/unit-quote-responses/create",e,{headers:{"Content-Type":"multipart/form-data"}});return n},update:async(e,n)=>{const{data:d}=await y.post(`/api/unit-quote-responses/update/${e}`,n,{headers:{"Content-Type":"multipart/form-data"}});return d},remove:async e=>{const{data:n}=await y.delete(`/api/unit-quote-responses/delete/${e}`);return n}};function ne(e={}){var d,f;const n=new FormData;return n.append("data[unit_quote_id]",e.unit_quote_id??""),n.append("data[vendor_id]",e.vendor_id??""),n.append("data[user_id]",e.user_id??""),n.append("data[title][en]",((d=e.title)==null?void 0:d.en)??""),n.append("data[title][ar]",((f=e.title)==null?void 0:f.ar)??""),e.price!==void 0&&n.append("data[price]",e.price),e.time_line&&(n.append("data[time_line][en]",e.time_line.en??""),n.append("data[time_line][ar]",e.time_line.ar??"")),n}function ie(e={}){const n=new FormData;return e.unit_quote_id!==void 0&&n.append("data[unit_quote_id]",e.unit_quote_id),e.vendor_id!==void 0&&n.append("data[vendor_id]",e.vendor_id),e.user_id!==void 0&&n.append("data[user_id]",e.user_id),e.title&&(n.append("data[title][en]",e.title.en??""),n.append("data[title][ar]",e.title.ar??"")),e.price!==void 0&&n.append("data[price]",e.price),e.time_line&&(n.append("data[time_line][en]",e.time_line.en??""),n.append("data[time_line][ar]",e.time_line.ar??"")),n}const ae={list:async()=>{const{data:e}=await y.get("/api/type-of-buildings");return e.data||e}},re={list:async()=>{const{data:e}=await y.get("/api/type-of-prices");return e.data||e}},oe={class:"p-6 space-y-8"},de={class:"flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"},le={class:"text-sm text-gray-500"},ue={class:"bg-white p-6 rounded-2xl shadow"},pe={key:0,class:"text-sm text-gray-500"},ce={key:1,class:"text-center text-gray-500 py-6"},_e={key:2,class:"overflow-x-auto"},ye={class:"min-w-full border border-gray-200 text-sm"},fe={class:"py-2 px-3 font-medium"},me={class:"py-2 px-3"},ge={class:"font-medium text-gray-900"},xe={class:"text-xs text-gray-500 mt-0.5"},ve={class:"py-2 px-3"},he={class:"py-2 px-3 text-gray-700"},be={class:"py-2 px-3 text-gray-700"},we={class:"py-2 px-3 text-gray-700"},ke={class:"py-2 px-3"},Ce=["onUpdate:modelValue","disabled"],Ue=["value"],Pe={class:"py-2 px-3"},Ae=["onUpdate:modelValue","disabled"],Ve={class:"py-2 px-3"},Re=["onUpdate:modelValue","disabled"],$e={class:"py-2 px-3"},Qe=["href"],Te=["src"],De={key:1,class:"text-gray-400"},Be={class:"py-2 px-3"},Se={class:"py-2 px-3 text-center space-x-1"},Le=["onClick"],Fe=["onClick"],Me=["onClick"],Ne=["onClick"],Oe={key:0,class:"flex justify-between items-center mt-6 text-sm"},Ee={class:"text-gray-600"},Ie={class:"space-x-2"},ze=["disabled"],Je=["onClick"],Ge=["disabled"],He={__name:"UnitQuoteResponses",setup(e){const n=c([]),d=c([]),f=c([]),V=c([]),R=c([]),w=c(""),$=c(!1),_=c(1),m=c(7),g=b(()=>{const i=w.value.toLowerCase();return n.value.filter(a=>a.title.toLowerCase().includes(i)||a.user_name&&a.user_name.toLowerCase().includes(i)).sort((a,t)=>t.id-a.id)}),Q=b(()=>Math.ceil(g.value.length/m.value)),N=b(()=>(_.value-1)*m.value+1),O=b(()=>Math.min(_.value*m.value,g.value.length)),L=b(()=>{const i=(_.value-1)*m.value;return g.value.slice(i,i+m.value)});H(w,()=>_.value=1);async function x(){$.value=!0;try{const[i,a,t,v,k,C]=await Promise.all([j.list(),A.list(),ee.list(),q.list(),ae.list(),re.list()]);n.value=i.map(h=>{const p=a.find(r=>r.unit_quote_id===h.id);return{...h,has_response:!!p,editing:!1,response:p?{id:p.id,vendor_id:p.vendor_id,user_id:p.user_id,price:p.price,time_line:p.time_line_en||""}:{vendor_id:"",user_id:"",price:"",time_line:""}}}),d.value=t,f.value=v,V.value=k,R.value=C}finally{$.value=!1}}function E(i){i.editing=!0}async function I(i){const a=ne({unit_quote_id:i.id,vendor_id:i.response.vendor_id,user_id:i.response.user_id,title:{en:i.title,ar:i.title},price:i.response.price,time_line:{en:i.response.time_line,ar:i.response.time_line}});await A.create(a),await x()}async function z(i){const a=ie({unit_quote_id:i.id,vendor_id:i.response.vendor_id,user_id:i.response.user_id,title:{en:i.title,ar:i.title},price:i.response.price,time_line:{en:i.response.time_line,ar:i.response.time_line}});await A.update(i.response.id,a),i.editing=!1,await x()}async function J(i){confirm("Delete this response?")&&(await A.remove(i.response.id),await x())}function G(i){return i?new Date(i).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}return K(x),(i,a)=>(o(),W(Z,null,{default:X(()=>[s("div",oe,[s("div",{class:"flex items-center justify-between"},[a[3]||(a[3]=s("h2",{class:"text-2xl font-bold text-gray-800"},"Unit Quote Responses",-1)),s("button",{onClick:x,class:"px-3 py-1.5 border rounded-lg text-sm hover:bg-gray-50"}," Refresh ")]),s("div",de,[U(s("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>w.value=t),type:"text",placeholder:"Search quotes by title or user…",class:"form-input w-1/2"},null,512),[[T,w.value]]),s("span",le,u(g.value.length)+" quote(s) found ",1)]),s("div",ue,[a[6]||(a[6]=s("h3",{class:"text-lg font-semibold text-gray-800 mb-4"}," Quotes & Responses ",-1)),$.value?(o(),l("div",pe,"Loading…")):L.value.length?(o(),l("div",_e,[s("table",ye,[a[5]||(a[5]=s("thead",{class:"bg-gray-100 text-gray-700"},[s("tr",null,[s("th",{class:"py-2 px-3 text-left"}),s("th",{class:"py-2 px-3 text-left"},"Title"),s("th",{class:"py-2 px-3 text-left"},"Other Title"),s("th",{class:"py-2 px-3 text-left"},"Building Type"),s("th",{class:"py-2 px-3 text-left"},"Price Type"),s("th",{class:"py-2 px-3 text-left"},"User"),s("th",{class:"py-2 px-3 text-left"},"Vendor"),s("th",{class:"py-2 px-3 text-left"},"Price"),s("th",{class:"py-2 px-3 text-left"},"Timeline"),s("th",{class:"py-2 px-3 text-left"},"Payment"),s("th",{class:"py-2 px-3 text-left"},"Status"),s("th",{class:"py-2 px-3 text-center"},"Actions")])],-1)),s("tbody",null,[(o(!0),l(P,null,B(L.value,t=>{var v,k,C,h,p;return o(),l("tr",{key:t.id,class:S(["border-t hover:bg-gray-50 transition",{"bg-blue-50/40":t.editing}])},[s("td",fe,u(t.id),1),s("td",me,[s("div",ge,u(t.title),1),s("div",xe,u(G(t.created_at)),1)]),s("td",ve,u(t.other_title||"—"),1),s("td",he,u(((v=V.value.find(r=>r.id===t.type_of_building_id))==null?void 0:v.name)||((k=V.value.find(r=>r.id===t.type_of_building_id))==null?void 0:k.title)||"—"),1),s("td",be,u(((C=R.value.find(r=>r.id===t.type_of_price_id))==null?void 0:C.name)||((h=R.value.find(r=>r.id===t.type_of_price_id))==null?void 0:h.title)||"—"),1),s("td",we,u(((p=d.value.find(r=>r.id===t.user_id))==null?void 0:p.name)||`User ${t.user_id}`),1),s("td",ke,[U(s("select",{"onUpdate:modelValue":r=>t.response.vendor_id=r,class:"form-input",disabled:!t.editing&&t.has_response},[a[4]||(a[4]=s("option",{value:"",disabled:""},"Select Vendor",-1)),(o(!0),l(P,null,B(f.value,r=>(o(),l("option",{key:r.id,value:r.id},u(r.name),9,Ue))),128))],8,Ce),[[Y,t.response.vendor_id]])]),s("td",Pe,[U(s("input",{"onUpdate:modelValue":r=>t.response.price=r,type:"number",class:"form-input",disabled:!t.editing&&t.has_response},null,8,Ae),[[T,t.response.price,void 0,{number:!0}]])]),s("td",Ve,[U(s("input",{"onUpdate:modelValue":r=>t.response.time_line=r,type:"text",class:"form-input",disabled:!t.editing&&t.has_response},null,8,Re),[[T,t.response.time_line]])]),s("td",$e,[t.pay_image?(o(),l("a",{key:0,href:`/storage/${t.pay_image}`,target:"_blank",class:"text-blue-600 hover:underline"},[s("img",{src:`/storage/${t.pay_image}`,alt:"Preview",class:"h-10 w-10 object-cover rounded shadow-sm"},null,8,Te)],8,Qe)):(o(),l("span",De,"—"))]),s("td",Be,[s("span",{class:S(["px-2 py-0.5 rounded-full text-xs border",t.has_response?"bg-green-100 text-green-700 border-green-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},u(t.has_response?"Responded":"Pending"),3)]),s("td",Se,[t.has_response?(o(),l(P,{key:1},[t.editing?D("",!0):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:r=>E(t)}," Edit ",8,Fe)),t.editing?(o(),l("button",{key:1,class:"px-3 py-1 text-xs border rounded-lg text-green-700 border-green-200 hover:bg-green-50",onClick:r=>z(t)}," Update ",8,Me)):D("",!0),s("button",{class:"px-3 py-1 text-xs border rounded-lg text-red-700 border-red-200 hover:bg-red-50",onClick:r=>J(t)}," Delete ",8,Ne)],64)):(o(),l("button",{key:0,class:"px-3 py-1 text-xs border rounded-lg text-blue-700 border-blue-200 hover:bg-blue-50",onClick:r=>I(t)}," Save ",8,Le))])],2)}),128))])]),Q.value>1?(o(),l("div",Oe,[s("span",Ee," Showing "+u(N.value)+"–"+u(O.value)+" of "+u(g.value.length),1),s("div",Ie,[s("button",{onClick:a[1]||(a[1]=(...t)=>i.prevPage&&i.prevPage(...t)),disabled:_.value===1,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Prev ",8,ze),(o(!0),l(P,null,B(Q.value,t=>(o(),l("button",{key:t,onClick:v=>i.goToPage(t),class:S(["px-3 py-1 border rounded-lg",t===_.value?"bg-blue-600 text-white":"hover:bg-gray-50"])},u(t),11,Je))),128)),s("button",{onClick:a[2]||(a[2]=(...t)=>i.nextPage&&i.nextPage(...t)),disabled:_.value===Q.value,class:"px-3 py-1 border rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Next ",8,Ge)])])):D("",!0)])):(o(),l("div",ce," No quotes found. "))])])]),_:1}))}},qe=te(He,[["__scopeId","data-v-4ab97b1f"]]);export{qe as default};
